{"id":"agent-shepherd-01p3","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:14:40.693587+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:14:40.800123+01:00","deleted_at":"2026-01-07T18:14:40.800123+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-02w","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:32:29.143931+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:29.211824+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-06T04:32:29.211824+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-03q1i","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:39:41.98577+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:39:42.058496+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-09T04:39:42.058496+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-04rz","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:43:59.842002+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:43:59.918666+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T02:43:59.918666+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-0708","title":"Phase 2: Enhanced Workflows","description":"## Overview\nPhase 2 of Agent Shepherd enhancement plan focusing on enhanced workflows with conditional transitions, loop prevention, and AI-based decision-making.\n\n## Scope\n\n### 2.1 Extend Transition Types\n- Add jump_back and dynamic_decision transition types\n- Implement enhanced transition validation\n- Update worker engine to handle new transitions\n\n### 2.2 Add Conditional Transition Configuration Schema\n- Extend PhaseConfig with transitions block\n- Support direct jumps and AI-based routing\n- Create example policies with conditional transitions\n\n### 2.3 Implement Loop Prevention System\n- Track phase visit counts\n- Validate transition limits\n- Detect oscillating cycles\n- Configure prevention rules\n\n### 2.4 Create Decision Agent Capability System\n- Define decision agent capabilities\n- Update agent registry with decision agents\n- Execute decision agents for dynamic transitions\n- Handle failures gracefully\n\n### 2.5 Add Decision Prompt Building and Response Parsing\n- Standardize prompt templates\n- Build comprehensive decision instructions\n- Implement response validation and sanitization\n- Add decision analytics\n\n## Dependencies\n- 2.1 depends on Phase 1 completion\n- 2.2 depends on 2.1\n- 2.3 depends on 2.2\n- 2.4 depends on 2.2 and 2.3\n- 2.5 depends on 2.4\n\n## Estimated Duration\n3-4 weeks\n\n## Execution Notes\nWhen assigned this epic, consume the overall context and select the next available child issue to work on, rather than working on the epic directly.\n\n## Scratchpad\nDetailed implementation plan with all subtasks breakdown preserved for reference.","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2026-01-06T23:48:18.356462+01:00","updated_at":"2026-01-06T23:56:55.128651+01:00","deleted_at":"2026-01-06T23:56:55.128651+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"agent-shepherd-07ld","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:11:47.47413+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:11:47.631672+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T18:11:47.631672+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-0a0dh","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T01:13:54.352876+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:13:54.829509+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T01:13:54.829509+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-0a9i","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-08T05:56:17.584443+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:56:17.654887+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-08T05:56:17.654887+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-0afe","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T19:03:07.158929+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:03:07.223368+01:00","deleted_at":"2026-01-07T19:03:07.223368+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-0ahv","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:58:05.44206+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:58:05.61717+01:00","deleted_at":"2026-01-06T15:58:05.61717+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-0bf17","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:52:29.919299+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:52:30.079857+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-11T00:52:30.079857+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-0f4g","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T21:46:04.248668+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:46:04.383347+01:00","deleted_at":"2026-01-07T21:46:04.383347+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-0ffz","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:33:22.943299+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:23.013021+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T18:33:23.013021+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-0gm20","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:24:05.93994+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:24:06.088653+01:00","labels":["label2","label3"],"deleted_at":"2026-01-09T01:24:06.088653+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-0jg34","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-08T23:43:42.521343+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:43:42.98435+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-08T23:43:42.98435+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-0ket","title":"2.2.7 Add Configuration Tests","description":"Test policy configuration parsing and validation.\n\n## Tasks\n- Test valid transition config parsing:\n  - Load policy with string transitions\n  - Load policy with object transitions\n  - Load policy with mixed string/object transitions\n  - Verify transitions block parsed correctly\n- Test invalid transition config throws error:\n  - Missing required fields in TransitionConfig\n  - Invalid allowed_destinations (phase not in policy)\n  - Invalid confidence thresholds (outside 0.0-1.0)\n  - on_partial_success as string (should only be object)\n- Test string transitions work (backward compatible):\n  - on_success: \"validate\" → direct jump\n  - on_failure: \"develop\" → direct jump\n- Test object transitions with AI decision config:\n  - Parse capability, prompt, allowed_destinations\n  - Parse optional fields: messaging, confidence_thresholds\n- Test default linear behavior when transitions not specified:\n  - Policy without transitions block uses default logic\n  - Existing policies continue to work unchanged\n- Test allowed_destinations validation:\n  - Verify destinations subset of policy phases\n  - Reject invalid destinations\n\n## Expected Deliverables\n- Complete configuration test suite\n- Valid config tests\n- Invalid config error tests\n- Backward compatibility tests","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:51:34.438114+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-0lq9","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:18:30.597022+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:18:30.641583+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T19:18:30.641583+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-0myn","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:18:29.342388+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:18:29.409354+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T19:18:29.409354+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-0ndx","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:11:45.013881+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:11:45.078341+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T18:11:45.078341+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-0obwt","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-09T20:11:02.235782+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:11:02.309338+01:00","deleted_at":"2026-01-09T20:11:02.309338+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-0qo2c","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T01:24:05.426829+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:24:05.90546+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T01:24:05.90546+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-0rad","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:39:11.485545+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:39:11.573642+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T14:39:11.573642+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-0rey6","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:12:17.183952+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:12:17.233289+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-08T23:12:17.233289+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-0st6g","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:38:38.416681+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:38:38.561659+01:00","labels":["label2","label3"],"deleted_at":"2026-01-09T01:38:38.561659+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-0toz4","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:20:30.06468+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:30.140386+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-09T01:20:30.140386+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-0tzl","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:33:44.191068+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:44.386959+01:00","deleted_at":"2026-01-07T18:33:44.386959+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-0uyi","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:40:15.243149+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:40:15.285412+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T18:40:15.285412+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-0w1z","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:54:01.282418+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:54:01.428767+01:00","deleted_at":"2026-01-06T15:54:01.428767+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-0wdk","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:05:09.598636+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:05:09.690533+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T19:05:09.690533+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-10f9","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:54:01.520568+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:54:01.558447+01:00","deleted_at":"2026-01-06T15:54:01.558447+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-11b","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:32:30.252356+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:30.334657+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-06T04:32:30.334657+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-11d2","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:33:44.09247+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:44.160009+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T18:33:44.160009+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-11i4","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T16:34:52.316463+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T16:34:52.753965+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T16:34:52.753965+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-11ofw","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:20:31.501915+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:31.645722+01:00","deleted_at":"2026-01-09T01:20:31.645722+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-157j","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-06T16:00:25.058446+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T16:00:25.11759+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-06T16:00:25.11759+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-15de8","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-11T00:31:29.135182+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:31:29.325409+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-11T00:31:29.325409+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-15mi","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T20:36:37.485253+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T20:36:37.615721+01:00","deleted_at":"2026-01-07T20:36:37.615721+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-17iv","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T02:36:02.888546+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:36:03.278863+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T02:36:03.278863+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-17m15","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:12:17.349547+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:12:17.469831+01:00","deleted_at":"2026-01-08T23:12:17.469831+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-17os","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:31:18.623587+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:31:18.688816+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T18:31:18.688816+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-17s4w","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:16:31.42816+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:16:31.504813+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-09T20:16:31.504813+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-1bex","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:39:11.69899+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:39:11.867687+01:00","deleted_at":"2026-01-07T14:39:11.867687+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-1cks","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T18:40:14.053134+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:40:14.124795+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T18:40:14.124795+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-1dlv","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T21:44:09.327049+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:44:09.540914+01:00","deleted_at":"2026-01-07T21:44:09.540914+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-1ep","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:36:26.311435+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:36:26.349023+01:00","deleted_at":"2026-01-06T04:36:26.349023+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-1glj","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:30:21.565619+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:30:21.739335+01:00","deleted_at":"2026-01-07T14:30:21.739335+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-1iga7","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:50:41.64483+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:50:41.71218+01:00","deleted_at":"2026-01-09T04:50:41.71218+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-1jfh","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-08T02:57:15.267688+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T02:57:15.339957+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-08T02:57:15.339957+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-1k0a","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T22:07:37.463063+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T22:07:37.527571+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T22:07:37.527571+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-1nnw","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:54:00.72693+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:54:00.801376+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-06T15:54:00.801376+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-1o73","title":"PHASE 2: Enhanced Workflows - Conditional Transitions, Loop Prevention, and Decision Agents","description":"Phase 2 of Agent Shepherd enhancement plan focusing on advanced workflow capabilities with conditional transitions, loop prevention systems, and AI-powered decision agents.\n\n## Overview\nThis phase extends the workflow system with intelligent routing capabilities, safety mechanisms to prevent infinite loops, and AI decision agents for complex workflow orchestration.\n\n## Scope\n\n### 2.1 Extend Transition Types\n- Analyze current transition system limitations\n- Design enhanced transition interface with jump_back and dynamic_decision types\n- Implement determineTransition() enhancements with new transition types\n- Add transition validation for safety\n- Update worker engine transition handling\n\n### 2.2 Add Conditional Transition Configuration Schema\n- Extend PhaseConfig interface with optional transitions block\n- Update policy YAML schema for validation\n- Implement transition config parsing\n- Add getTransitionKey() helper for outcome mapping\n- Update determineTransition() to use conditional transitions\n- Create example policies demonstrating various transition patterns\n\n### 2.3 Implement Loop Prevention System\n- Add phase visit tracking using runs.db\n- Implement validatePhaseLimits() with HITL escalation\n- Add transition limit tracking and validation\n- Implement cycle detection for oscillating patterns\n- Integrate loop prevention into determineTransition()\n- Add configuration for loop prevention settings\n\n### 2.4 Create Decision Agent Capability System\n- Define decision agent capabilities (test-decision, validation-decision, complex-decision)\n- Update agent registry with sample decision agents\n- Implement buildDecisionInstructions() for comprehensive prompts\n- Create DecisionResult interface for parsed responses\n- Implement parseDecisionResponse() with safety validation\n- Execute decision agents in worker engine\n- Handle decision agent failures gracefully\n- Add decision metadata logging\n- Add confidence threshold configuration\n\n### 2.5 Add Decision Prompt Building and Response Parsing\n- Standardize prompt templates for each decision context\n- Enhance buildDecisionInstructions() with rich context\n- Add contextual information to prompts (recent decisions, phase history)\n- Implement response validation against schema\n- Add response sanitization for various agent formats\n- Add retry logic for decision agents with clarifying prompts\n- Add decision analytics for performance tracking\n- Comprehensive tests for all components\n\n## Dependencies\n- Depends on Phase 1 completion\n- 2.2 depends on 2.1 (transition types)\n- 2.3 depends on 2.2 (conditional transitions)\n- 2.4 depends on 2.2, 2.3 (decision agents need transitions and loop prevention)\n- 2.5 depends on 2.4 (prompt building needs decision system)\n\n## Estimated Duration\n3-4 weeks\n\n## Execution Notes\nWhen assigned this epic, consume the overall context and select the next available child issue to work on, rather than working on the epic directly.\n\n## Scratchpad\nDetailed implementation plan with all subtasks breakdown preserved for reference.","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2026-01-07T00:04:36.386771+01:00","updated_at":"2026-01-07T00:06:15.832092+01:00","deleted_at":"2026-01-07T00:06:15.832092+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"agent-shepherd-1om57","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:15:58.810086+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:59.024432+01:00","deleted_at":"2026-01-09T01:15:59.024432+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-1plg","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:24:22.834847+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:24:22.89898+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T18:24:22.89898+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-1pz","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:34:13.83542+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:13.995078+01:00","deleted_at":"2026-01-06T04:34:13.995078+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-1qhk","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:03:07.671953+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:03:07.758556+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T19:03:07.758556+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-1qka","title":"2.2.4 Add getTransitionKey() Helper","description":"Map outcome types to transition configuration keys.\n\n## Tasks\n- Implement getTransitionKey() function:\n  - Takes outcome with success boolean and optional result_type\n  - Maps to transition configuration key:\n    - result_type: 'success' → 'on_success'\n    - result_type: 'failure' → 'on_failure'\n    - result_type: 'partial_success' → 'on_partial_success'\n    - result_type: 'unclear' → 'on_unclear'\n    - No result_type but success=true → 'on_success'\n    - No result_type but success=false → 'on_failure'\n- Handle backward compatibility:\n  - If no result_type, fall back to success boolean\n  - Existing code using only success/failure still works\n\n## Expected Deliverables\n- getTransitionKey() function implemented\n- Outcome type mapping working\n- Backward compatibility maintained","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:51:34.416247+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-1rk8","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:29:38.963643+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:29:39.12444+01:00","deleted_at":"2026-01-07T18:29:39.12444+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-1ruy","title":"2.3 Implement Loop Prevention System","description":"Prevent infinite routing loops in dynamic workflows.\n\n## Scope\n- Track phase visit counts\n- Validate transition limits\n- Detect oscillating cycles\n- Configure prevention rules\n\n## Dependencies\nDepends on 2.2 (Conditional Transitions)\n\n## Estimated Duration\n1 week\n\n## Scratchpad\n### 2.3.1 Phase Visit Tracking\n- Add getPhaseVisitCount() to Logger\n- Add index to runs.db on (issue_id, phase)\n- Add max_visits field to PhaseConfig\n\n### 2.3.2 Implement validatePhaseLimits()\n- Check phase visit count before execution\n- Trigger HITL when limit exceeded\n- Block further execution\n\n### 2.3.3 Transition Limit Tracking\n- Add getTransitionCount() to Logger\n- Count phase→phase transition patterns\n\n### 2.3.4 Implement validateTransitionLimits()\n- Check specific transition counts\n- Trigger HITL when limit exceeded\n- Configurable limits\n\n### 2.3.5 Cycle Detection\n- Add detectCycles() method\n- Analyze recent transition sequences\n- Detect oscillating patterns (A→B→A)\n\n### 2.3.6 Integrate Loop Prevention into determineTransition()\n- Apply loop prevention checks BEFORE transitions\n- Block if any check fails\n- Log all loop prevention decisions\n\n### 2.3.7 Configuration for Loop Prevention\n- Add loop_prevention section to config\n- Configure max_visits, max_transitions, cycle detection\n- Per-phase overrides\n\n### 2.3.8 Integration Tests\n- Test phase visit limits\n- Test transition limits\n- Test cycle detection\n- Test HITL escalation","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-06T23:49:12.963165+01:00","updated_at":"2026-01-06T23:56:55.128651+01:00","deleted_at":"2026-01-06T23:56:55.128651+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-1sjx","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T19:03:06.970107+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:03:07.033645+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T19:03:07.033645+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-1sk4a","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:24:04.88405+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:24:05.076966+01:00","deleted_at":"2026-01-09T01:24:05.076966+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-1tu2","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:51:19.448054+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:51:19.488186+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T02:51:19.488186+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-1u2","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:34:13.273959+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:13.340846+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-06T04:34:13.340846+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-1u20","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T06:03:26.61776+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T06:03:26.706901+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T06:03:26.706901+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-1w9","title":"test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-19T03:50:18.388276+01:00","updated_at":"2025-12-19T04:02:51.934268+01:00","deleted_at":"2025-12-19T04:02:51.934268+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-1xy","title":"Phase 6: Documentation \u0026 Integration Tests","description":"**Effort:** ~5 hours | **Risk:** Low\n\nUpdate all documentation and write end-to-end tests.\n\n## Tasks\n\n1. Update `docs/policies-config.md` with trigger system documentation\n2. Remove or deprecate old trigger fields from documentation\n3. Update `docs/config-config.md` with workflow and hitl sections\n4. Update `docs/architecture.md` with label system information\n5. Update `README.md` with label usage examples\n6. Update `AGENTS.md` with new label conventions\n7. Write integration tests for full workflow scenarios\n8. Update documentation with migration guide (if needed)\n\n## Files Modified\n- `.agent-shepherd/docs/policies-config.md`\n- `.agent-shepherd/docs/config-config.md`\n- `.agent-shepherd/docs/architecture.md`\n- `.agent-shepherd/README.md`\n- `.agent-shepherd/AGENTS.md`\n- `tests/integration/label-workflow.test.ts` (new file)\n\n## Acceptance Criteria\n- [ ] docs/policies-config.md documents trigger system\n- [ ] Deprecated trigger fields handled in docs\n- [ ] docs/config-config.md documents workflow section\n- [ ] docs/config-config.md documents hitl section\n- [ ] docs/architecture.md shows label-based workflow\n- [ ] README.md has label usage examples\n- [ ] AGENTS.md documents label conventions\n- [ ] Integration tests cover full workflow scenarios\n- [ ] Integration tests cover exclusion control\n- [ ] Integration tests cover invalid workflow handling\n- [ ] All tests passing\n\n## Integration Test Scenarios\n\n### Full Workflow Execution\n```typescript\ndescribe('Label Workflow Integration Tests', () =\u003e {\n  it('should process issue from start to finish with all labels', async () =\u003e {\n    // Create issue with explicit workflow label\n    await bdCreate({\n      title: 'Test feature',\n      type: 'feature',\n      labels: ['ashep-workflow:complex']\n    });\n    \n    // Issue gets picked up by worker\n    const issue = await getReadyIssues().then(issues =\u003e issues[0]);\n    expect(issue.labels).toContain('ashep-workflow:complex');\n    \n    // First phase started\n    await processIssue(issue);\n    const labels = await getIssueLabels(issue.id);\n    expect(labels).toContain('ashep-phase:plan');\n    \n    // Simulate phase completion\n    await applyTransition(issue.id, {\n      type: 'advance',\n      next_phase: 'implement'\n    });\n    const updatedLabels = await getIssueLabels(issue.id);\n    expect(updatedLabels).toContain('ashep-phase:implement');\n    expect(updatedLabels).not.toContain('ashep-phase:plan');\n    \n    // HITL scenario\n    await applyTransition(issue.id, {\n      type: 'block',\n      reason: 'Human approval required'\n    });\n    const hitlLabels = await getIssueLabels(issue.id);\n    expect(hitlLabels).toContain('ashep-hitl:approval');\n    expect(issue.status).toBe('blocked');\n    \n    // Approve and continue\n    await bdUpdate(issue.id, { removeLabel: 'ashep-hitl:approval' });\n    await processIssue(issue);\n    const finalLabels = await getIssueLabels(issue.id);\n    expect(finalLabels).not.toContain('ashep-hitl:approval');\n    expect(finalLabels).toContain('ashep-phase:implement');\n  });\n});\n```\n\n### Exclusion Control\n```typescript\nit('should skip excluded issues', async () =\u003e {\n  // Create excluded issue\n  await bdCreate({\n    title: 'Skip this',\n    type: 'task',\n    labels: ['ashep-excluded']\n  });\n  \n  // Create normal issue\n  await bdCreate({\n    title: 'Process this',\n    type: 'task'\n  });\n  \n  // Worker should only process non-excluded\n  const eligible = await getEligibleIssues();\n  expect(eligible).toHaveLength(1);\n  expect(eligible[0].title).toBe('Process this');\n});\n```\n\n### Invalid Workflow Label\n```typescript\nit('should warn and fall back when configured', async () =\u003e {\n  const issue = await bdCreate({\n    title: 'Test',\n    type: 'task',\n    labels: ['ashep-workflow:nonexistent']\n  });\n  \n  // Should fall back to type matching\n  const policy = policyEngine.matchPolicy(issue);\n  expect(policy).toBe('simple'); // Assuming simple has 'task' in issue_types\n});\n```","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T17:09:43.553208+01:00","updated_at":"2026-01-05T17:22:57.675083+01:00","close_reason":"Removed as requested by user","dependencies":[{"issue_id":"agent-shepherd-1xy","depends_on_id":"agent-shepherd-3of","type":"parent-child","created_at":"2026-01-05T17:09:47.147434+01:00","created_by":"daemon"},{"issue_id":"agent-shepherd-1xy","depends_on_id":"agent-shepherd-s4t","type":"blocks","created_at":"2026-01-05T17:10:32.578192+01:00","created_by":"daemon"}],"deleted_at":"2026-01-05T17:22:57.675083+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-1ym1q","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:43:41.421049+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:43:41.493442+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-08T23:43:41.493442+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-20w","title":"2.1 Implement Beads integration (shell commands, issue parsing)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-19T03:52:09.911686+01:00","updated_at":"2025-12-19T04:02:51.934268+01:00","deleted_at":"2025-12-19T04:02:51.934268+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-218k","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:40:14.161194+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:40:14.233305+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T18:40:14.233305+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-21fk","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T03:57:12.247686+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T03:57:12.34784+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-08T03:57:12.34784+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-21i3","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T05:54:20.619438+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:54:20.789698+01:00","deleted_at":"2026-01-08T05:54:20.789698+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-22pc","title":"2.4.2 Update Agent Registry with Decision Agents","description":"Add sample decision agents to agent registry.\n\n## Tasks\n- Add decision agents to config/agents.yaml:\n  - test-quality-decider:\n    - name: Test Quality Decider\n    - description: Analyzes test results and decides next workflow phase\n    - capabilities: [test-decision, analysis]\n    - model: gpt-4\n    - priority: 8\n    - active: true\n    - constraints: performance_tier: balanced\n  - validation-gatekeeper:\n    - name: Validation Gatekeeper\n    - description: Reviews validation results and quality metrics\n    - capabilities: [validation-decision, code-analysis]\n    - model: claude-3\n    - priority: 9\n    - active: true\n    - constraints: performance_tier: balanced\n  - workflow-orchestrator:\n    - name: Workflow Orchestrator\n    - description: Handles complex multi-factor workflow decisions\n    - capabilities: [complex-decision, planning]\n    - model: gpt-4-turbo\n    - priority: 10\n    - active: true\n    - constraints: performance_tier: balanced\n- Test agent selection with new capabilities:\n  - Verify test-decision capability selects test-quality-decider\n  - Verify validation-decision capability selects validation-gatekeeper\n  - Verify complex-decision capability selects workflow-orchestrator\n  - Test priority ordering (higher priority selected first)\n\n## Expected Deliverables\n- Decision agents added to agents.yaml\n- Agent selection tested for new capabilities","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:53:05.376279+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-259a8","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:41:43.375801+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:41:43.664301+01:00","deleted_at":"2026-01-09T04:41:43.664301+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-25flv","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:39:41.516743+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:39:41.62065+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-09T04:39:41.62065+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-269bl","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:52:27.321032+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:52:27.477346+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-11T00:52:27.477346+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-27vp","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:59:43.58687+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:59:43.755289+01:00","deleted_at":"2026-01-07T02:59:43.755289+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-27x","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:35:54.328573+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:35:54.486324+01:00","deleted_at":"2026-01-06T04:35:54.486324+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-28ffu","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T01:15:30.979367+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:31.058283+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-09T01:15:31.058283+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-28ts","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T16:00:25.328068+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T16:00:25.406207+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-06T16:00:25.406207+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-28va","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:11:46.218178+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:11:46.301707+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T18:11:46.301707+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-28x","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:34:53.744448+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:53.899155+01:00","deleted_at":"2026-01-06T04:34:53.899155+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2933","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:05:10.060385+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:05:10.149131+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T19:05:10.149131+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-29k3","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:03:08.164516+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:03:08.208806+01:00","deleted_at":"2026-01-07T19:03:08.208806+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2b1","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-06T04:34:53.038516+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:53.097649+01:00","deleted_at":"2026-01-06T04:34:53.097649+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-2bpv","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:35:17.680735+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:35:17.787656+01:00","deleted_at":"2026-01-06T23:35:17.787656+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2brs","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:30:21.469069+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:30:21.533488+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T14:30:21.533488+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2bzys","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:06:40.623085+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:06:40.716299+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-09T20:06:40.716299+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2c6m","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T04:53:56.248233+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T04:53:56.415625+01:00","deleted_at":"2026-01-07T04:53:56.415625+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2cu","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:36:26.052349+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:36:26.213642+01:00","deleted_at":"2026-01-06T04:36:26.213642+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2cuo7","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-10T00:11:56.186594+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T00:11:56.256066+01:00","deleted_at":"2026-01-10T00:11:56.256066+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-2f2t","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:24:23.750239+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:24:23.814364+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T18:24:23.814364+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2hhh","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T16:34:51.177408+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T16:34:51.26245+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T16:34:51.26245+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2hs","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:24:42.98298+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:28.97253+01:00","deleted_at":"2026-01-06T04:32:28.97253+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2ib0","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T21:46:02.962479+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:46:03.074753+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T21:46:03.074753+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2iwyk","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:40:52.386546+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:40:52.584941+01:00","deleted_at":"2026-01-09T20:40:52.584941+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2kooe","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:50:39.660783+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:50:39.77831+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T04:50:39.77831+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2kou","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:40:00.702808+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:40:00.816325+01:00","deleted_at":"2026-01-07T18:40:00.816325+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2kp3","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:11:46.747949+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:11:46.879441+01:00","deleted_at":"2026-01-07T18:11:46.879441+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2kv0","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T03:38:12.457812+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:38:12.56899+01:00","deleted_at":"2026-01-07T03:38:12.56899+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2llk","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T06:03:25.995867+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T06:03:26.061676+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T06:03:26.061676+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2m0d","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T20:36:36.190982+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T20:36:36.269172+01:00","deleted_at":"2026-01-07T20:36:36.269172+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-2m6","title":"Update policy-capability-validator.ts for fallback validation","description":"File: .agent-shepherd/src/core/policy-capability-validator.ts\n\nTask: Modify validation to check fallback hierarchy and update error severity\n\nRequired Changes:\n\n1. Add validateFallbackAgent() function:\n```typescript\nfunction validateFallbackAgent(\n  agentId: string,\n  policyName: string,\n  phaseName: string | null,\n  level: 'global' | 'policy' | 'phase'\n): ValidationResult\n```\n\nThis function should:\n- Check if fallback agent exists in agent registry\n- Verify fallback agent is active\n- Return appropriate validation result\n\n2. Modify validateCapability() to check fallback hierarchy:\n   - When no agent has a capability, check if fallback covers it\n   - Check fallback agents at all 3 levels (phase, policy, global)\n   - Change severity: missing capability with valid fallback = info/warning (not error)\n   - Return error if fallback enabled but agent doesn't exist or is inactive\n\n3. Update validatePolicyChain() to show fallback info:\n   - Collect all capabilities using fallback\n   - Display info messages about which capabilities use fallback\n   - Show which fallback agent handles each capability\n\nExample output:\n```\nℹ️  Policy chain validation: Using fallback for 2 capabilities\n   • policies.yaml: default.test: Capability 'testing' handled by fallback agent 'Build Agent'\n   • policies.yaml: default.review: Capability 'review' handled by fallback agent 'Summary Agent'\n```\n\n4. Add new error type for invalid fallback config:\n   - Fallback agent doesn't exist\n   - Fallback agent is inactive\n\nAcceptance Criteria:\n- [ ] validateFallbackAgent() checks agent existence and active status\n- [ ] validateCapability() uses fallback hierarchy\n- [ ] Missing capability with valid fallback = info/warning severity\n- [ ] Invalid fallback config = error severity\n- [ ] Validation passes when fallback covers missing capabilities\n- [ ] Validation errors when fallback agent doesn't exist\n- [ ] Validation errors when fallback agent is inactive\n- [ ] Fallback info displayed in validation output","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T02:43:57.893794+01:00","updated_at":"2026-01-05T03:02:29.925614+01:00","closed_at":"2026-01-05T03:02:29.925614+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-2m6","depends_on_id":"agent-shepherd-uj0","type":"parent-child","created_at":"2026-01-05T02:45:00.515048+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-2nmbq","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:20:54.947415+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:55.023044+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-09T01:20:55.023044+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2nra","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T02:57:15.721426+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T02:57:15.791119+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-08T02:57:15.791119+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2p8v","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T03:57:13.781287+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T03:57:13.907906+01:00","deleted_at":"2026-01-08T03:57:13.907906+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2pds","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T04:53:56.630228+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T04:53:56.738795+01:00","deleted_at":"2026-01-07T04:53:56.738795+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2q30","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:12:16.008441+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:12:16.093979+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-08T23:12:16.093979+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2qpc","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:58:06.306962+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:58:06.418476+01:00","labels":["label2","label3"],"deleted_at":"2026-01-06T15:58:06.418476+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2qums","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T23:23:26.980753+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:23:27.053256+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T23:23:27.053256+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2sfs","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:51:18.48263+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:51:18.549077+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T02:51:18.549077+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2tbzt","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:50:41.541183+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:50:41.606995+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-09T04:50:41.606995+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2tmjs","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:46:38.194339+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:46:38.292335+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-09T20:46:38.292335+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2tsk","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:35:16.814681+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:35:16.882342+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-06T23:35:16.882342+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2ug8","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:35:18.235465+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:35:18.356487+01:00","labels":["label2","label3"],"deleted_at":"2026-01-06T23:35:18.356487+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2v5f","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:05:10.505736+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:05:10.550277+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T19:05:10.550277+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2vgw","title":"2.3.6 Integrate Loop Prevention into determineTransition()","description":"Call all loop prevention checks before allowing transitions.\n\n## Tasks\n- Modify policy.ts:determineTransition():\n  - Apply loop prevention checks BEFORE any transition decision\n  - Call validatePhaseLimits() if outcome.success\n    - Only check limits on success (prevents infinite retry loops)\n  - Call validateTransitionLimits() for jump transitions:\n    - If transition.type === 'advance' or 'jump_back'\n    - Get nextPhase from transition\n    - Validate transition limits\n  - Call detectCycles() to check for oscillating patterns\n  - Add early return if any validation fails:\n    - Return { type: 'block', reason: 'Loop detected' }\n    - Log all loop prevention decisions with details\n    - Include which check failed and why\n\n## Expected Deliverables\n- Loop prevention integrated into determineTransition()\n- All validation checks called before transitions\n- Blocking behavior when limits exceeded\n- Comprehensive logging of prevention decisions","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:52:01.688023+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-2w0d","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:28:06.838553+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:28:06.908784+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-06T23:28:06.908784+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2x5m","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T03:43:26.308612+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:43:26.372096+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T03:43:26.372096+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2xc","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:42:30.927075+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:42:31.015543+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-06T04:42:31.015543+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2xs26","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-11T00:31:29.77961+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:31:29.894937+01:00","deleted_at":"2026-01-11T00:31:29.894937+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-2y6f","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:24:23.334644+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:24:23.397527+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T18:24:23.397527+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2yg7","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T03:43:26.809578+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:43:26.874109+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T03:43:26.874109+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-2zpq","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T18:33:22.288937+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:22.356003+01:00","deleted_at":"2026-01-07T18:33:22.356003+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-2zy1","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:26:24.902354+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:26:24.943066+01:00","deleted_at":"2026-01-07T14:26:24.943066+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-308","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:36:25.539222+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:36:25.933279+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-06T04:36:25.933279+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-32d","title":"Phase 5: README Symlink","description":"Create README.md symlink at repo root pointing to .agent-shepherd/README.md for GitHub visibility. Run: cd /Users/tonyhartmann/DevShare/JS/agent-shepherd \u0026\u0026 ln -s .agent-shepherd/README.md README.md \u0026\u0026 git add README.md \u0026\u0026 git commit -m \"Add symlink to README for GitHub visibility\"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T03:19:02.709844+01:00","created_by":"tonyhartmann","updated_at":"2025-12-30T03:33:32.279153+01:00","closed_at":"2025-12-30T03:33:32.279153+01:00","close_reason":"Closed via update","dependencies":[{"issue_id":"agent-shepherd-32d","depends_on_id":"agent-shepherd-7gt","type":"parent-child","created_at":"2025-12-30T03:20:11.717064+01:00","created_by":"daemon"},{"issue_id":"agent-shepherd-32d","depends_on_id":"agent-shepherd-bcr","type":"blocks","created_at":"2025-12-30T03:20:26.958643+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-32q","title":"Update cmdInit() to add fallback to default config","description":"File: .agent-shepherd/src/cli/index.ts\n\nTask: Add fallback section to default config.yaml created by cmdInit()\n\nRequired Changes:\n\n1. Locate cmdInit() function in src/cli/index.ts\n\n2. Update the default config.yaml template to include:\n```yaml\nfallback:\n  enabled: true\n  default_agent: build\n  # Optional: Add mappings for better agent matching\n  # mappings:\n  #   review: summary\n  #   architecture: plan\n```\n\n3. Ensure the fallback section is added at the appropriate place in the YAML (after main config, before worker/monitor sections)\n\n4. Add comment explaining fallback system:\n```yaml\n# Fallback Agent System\n# When a policy requires a capability that no agent has,\n# the system will fall back to the specified agent.\n# This allows quickstart to work with default agents.\nfallback:\n  enabled: true\n  default_agent: build\n```\n\nAcceptance Criteria:\n- [ ] Default config.yaml includes fallback section\n- [ ] fallback.enabled is true\n- [ ] fallback.default_agent is \"build\"\n- [ ] YAML is properly formatted and indented\n- [ ] Comments explain fallback system clearly\n- [ ] Example mappings are commented (not active)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T02:43:57.885505+01:00","updated_at":"2026-01-05T03:09:36.613062+01:00","closed_at":"2026-01-05T03:09:36.613062+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-32q","depends_on_id":"agent-shepherd-uj0","type":"parent-child","created_at":"2026-01-05T02:45:00.520067+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-332i","title":"2.4.3 Implement buildDecisionInstructions()","description":"Build comprehensive prompt for decision agents.\n\n## Tasks\n- Create buildDecisionInstructions() in policy engine:\n  - Combines issue data, previous results, and decision parameters\n  - Returns complete markdown prompt\n- Build comprehensive prompt structure:\n  - Issue Context:\n    - Title, description, type, priority, status\n  - Previous Phase Result:\n    - Phase, outcome (SUCCESS/FAILED), message, duration, error, warnings\n  - Decision Instructions:\n    - TransitionConfig.prompt (custom instructions)\n  - Allowed Next Phases:\n    - List of allowed_destinations\n  - Response Format:\n    - JSON structure with decision, reasoning, confidence\n- Design rationale:\n  - Provides issue grounding (what we're deciding about)\n  - Provides historical context (previous outcomes inform current decision)\n  - Provides clear instructions (specific guidance for decision type)\n  - Provides safety bounds (allowed destinations prevent invalid jumps)\n  - Provides structured output format (JSON for reliable parsing)\n\n## Expected Deliverables\n- buildDecisionInstructions() method implemented\n- Comprehensive prompt structure defined\n- Context and instructions included","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:53:05.392036+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-34fs","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T21:46:02.845792+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:46:02.924223+01:00","deleted_at":"2026-01-07T21:46:02.924223+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-3587","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T03:57:12.736067+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T03:57:12.785987+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-08T03:57:12.785987+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-35dj","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T04:53:57.376041+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T04:53:57.481202+01:00","deleted_at":"2026-01-07T04:53:57.481202+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-35yd","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T22:55:51.77872+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:55:51.900486+01:00","deleted_at":"2026-01-08T22:55:51.900486+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-36m2","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:30:21.772293+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:30:21.818217+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T14:30:21.818217+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-36uj","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:05:09.389574+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:05:09.460754+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T19:05:09.460754+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-37nk","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T22:07:38.068254+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T22:07:38.236091+01:00","deleted_at":"2026-01-07T22:07:38.236091+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-38ua","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T15:02:10.461811+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T15:02:10.592555+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T15:02:10.592555+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-38v7","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T03:38:12.00164+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:38:12.066851+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T03:38:12.066851+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-39me","title":"2.1.4 Add Transition Validation","description":"Create validation method to check transitions before returning them. Validate jump_target_phase exists in policy, prevent circular jumps, and ensure dynamic_agent has available agents.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-07T00:04:54.239371+01:00","updated_at":"2026-01-07T00:06:15.832092+01:00","deleted_at":"2026-01-07T00:06:15.832092+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-3br","title":"Update agent-registry.ts for fallback agent selection","description":"File: .agent-shepherd/src/core/agent-registry.ts\n\nTask: Add fallback agent selection and integrate with selectAgent()\n\nRequired Changes:\n\n1. Add getFallbackAgent() function:\n```typescript\nfunction getFallbackAgent(\n  capability: string,\n  policy: Policy,\n  phase: Phase | null\n): Agent | null\n```\n\nImplementation should follow cascading hierarchy:\n1. Phase-level override? Return agent from phase.fallback_agent\n2. Phase disabled? Return null (phase.fallback_enabled === false)\n3. Policy mappings? Return agent from policy.fallback_mappings[capability]\n4. Policy disabled? Return null (policy.fallback_enabled === false)\n5. Global mappings? Return agent from config.fallback.mappings[capability]\n6. Global disabled? Return null (!config.fallback.enabled)\n7. Use policy or global default_agent (policy.fallback_agent || config.fallback.default_agent)\n\n2. Modify selectAgent() to use fallback:\n```typescript\nfunction selectAgent(\n  capability: string,\n  policy: Policy,\n  phase: Phase | null\n): Agent | null {\n  // 1. Try to find agent with capability\n  let agent = getAgentsByCapability(capability);\n  \n  if (!agent) {\n    // 2. No agent has capability - use fallback\n    agent = getFallbackAgent(capability, policy, phase);\n    \n    if (agent) {\n      logger.info(`ℹ️ Using fallback agent '${agent.name}' for capability '${capability}'`);\n    }\n  }\n  \n  return agent;\n}\n```\n\n3. Add logging when fallback is used:\n   - Log which agent is used as fallback\n   - Log which capability triggered fallback\n   - Use logger from logging.ts\n\nAcceptance Criteria:\n- [ ] getFallbackAgent() implements cascading hierarchy correctly\n- [ ] Phase-level overrides policy and global\n- [ ] Policy-level overrides global\n- [ ] fallback_enabled: false disables fallback at that level\n- [ ] config.fallback.enabled: false disables all fallbacks\n- [ ] selectAgent() calls getFallbackAgent() when no agent has capability\n- [ ] Fallback usage is logged\n- [ ] Logs include agent name and capability","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T02:43:57.884526+01:00","updated_at":"2026-01-05T03:08:00.925671+01:00","closed_at":"2026-01-05T03:08:00.925671+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-3br","depends_on_id":"agent-shepherd-uj0","type":"parent-child","created_at":"2026-01-05T02:45:00.518399+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-3byll","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:13:52.714122+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:13:52.789072+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-09T01:13:52.789072+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-3c74y","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:13:53.676339+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:13:53.876402+01:00","deleted_at":"2026-01-09T01:13:53.876402+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-3cb3","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:32:17.969128+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:32:18.057582+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T14:32:18.057582+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-3ff","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-06T04:34:54.182699+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:54.548877+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-06T04:34:54.548877+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-3ft18","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T23:03:53.692483+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:03:53.765676+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-09T23:03:53.765676+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-3hp1","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T03:43:26.691318+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:43:26.777827+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T03:43:26.777827+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-3i0m","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:26:24.019748+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:26:24.110778+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T14:26:24.110778+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-3jvz","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:30:22.510637+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:30:22.642693+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T14:30:22.642693+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-3l7u","title":"2.1 Extend Transition Types","description":"Extend transition system to support non-linear progression and AI decision-making.\n\n## Scope\n- Add jump_back and dynamic_decision transition types\n- Implement enhanced transition validation\n- Update worker engine to handle new transitions\n- Add comprehensive unit tests\n\n## Dependencies\nDepends on Phase 1 completion\n\n## Estimated Duration\n1 week\n\n## Scratchpad\n### 2.1.1 Analyze Current Transition System\n- Review policy.ts:PhaseTransition interface (lines 53-57)\n- Review policy.ts:determineTransition() implementation (lines 263-327)\n- Document current transition types: advance, retry, block, close\n- Identify limitations: no backward jumps, no AI delegation, linear only\n\n### 2.1.2 Design Enhanced Transition Interface\n- Add types: jump_back, dynamic_decision\n- Add fields: jump_target_phase, dynamic_agent, decision_config\n- Maintain backward compatibility\n\n### 2.1.3 Implement determineTransition() Enhancements\n- Add jump_back logic\n- Add dynamic_decision logic\n- Maintain existing advance/retry/block/close\n\n### 2.1.4 Add Transition Validation\n- Validate jump_target_phase exists\n- Detect circular jumps (phase to itself)\n- Validate dynamic_agent capability\n\n### 2.1.5 Update Worker Engine Transition Handling\n- Extend applyTransition() for jump_back\n- Add executeDecisionAgent() for dynamic_decision\n- Handle backward compatibility\n\n### 2.1.6 Add Unit Tests for Transition Logic\n- Test all transition types\n- Test validation catches errors\n- Test backward compatibility","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-06T23:48:51.424425+01:00","updated_at":"2026-01-06T23:56:55.128651+01:00","deleted_at":"2026-01-06T23:56:55.128651+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-3mzk","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T03:57:12.383287+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T03:57:12.458379+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-08T03:57:12.458379+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-3mzv","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:39:11.290131+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:39:11.455702+01:00","deleted_at":"2026-01-07T14:39:11.455702+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-3o8y","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T15:02:09.509979+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T15:02:09.688515+01:00","deleted_at":"2026-01-07T15:02:09.688515+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-3of","title":"Agent Shepherd Label System - Complete Implementation","description":"## Executive Summary\nThis epic implements four core label-based features to enable comprehensive workflow orchestration using Beads labels:\n\n1. **Trigger System** - Automatic workflow selection via `ashep-workflow:` labels and issue type matching\n2. **Phase Tracking** - Track current phase via `ashep-phase:` labels\n3. **Status/HITL Markers** - Mark human-in-the-loop states via `ashep-hitl:` labels\n4. **Exclusion Control** - Exclude issues via `ashep-excluded` label\n\n**Total Scope:** 5 implementation phases, 13 files modified, ~1500 lines of new code\n\n## Design Decisions\n\n### Label Naming Convention\nAll Agent Shepherd labels use `ashep-` prefix (dash, not colon):\n- `ashep-workflow:\u003cname\u003e` - Explicit workflow assignment\n- `ashep-phase:\u003cname\u003e` - Current workflow phase\n- `ashep-excluded` - Exclusion marker\n- `ashep-hitl:\u003creason\u003e` - Human-in-the-loop state\n\n### Trigger System Design\n**Priority:**\n1. Explicit workflow label (`ashep-workflow:xxx`) → Direct assignment\n2. Issue type matching → Policy with matching `issue_types` array (highest priority wins)\n3. Default policy → Fallback\n\n**Invalid workflow label handling:** Configurable via `config.workflow.invalid_label_strategy` (default: `warning-fallback`)\n\n### HITL Reason Design (Hybrid Approach)\n```yaml\nhitl:\n  allowed_reasons:\n    predefined: [\"approval\", \"manual-intervention\", \"timeout\", \"error\", \"review-request\"]\n    allow_custom: true\n    custom_validation: \"alphanumeric-dash-underscore\"\n```\n\n### Backward Compatibility\n- Remove `excluded_tags` text-based filtering immediately (no migration period)\n\n## Implementation Phases\n\n### Phase 1: Infrastructure - Foundation\nAdd label fetching and management capabilities to Beads integration (~4 hours)\n\n### Phase 2: Schema \u0026 Configuration\nAdd trigger system and HITL configuration to schemas and default config (~3 hours)\n\n### Phase 3: Trigger System\nImplement automatic workflow selection based on labels and issue types (~6 hours)\n\n### Phase 4: Phase \u0026 HITL Tracking\nTrack workflow phases and human-in-the-loop states via labels (~6 hours)\n\n### Phase 5: Exclusion Control\nExclude issues from processing via `ashep-excluded` label (~2 hours)\n\n### Phase 6: Documentation \u0026 Integration Tests\nUpdate all documentation and write end-to-end tests (~5 hours)\n\n## Success Criteria\n\n**Feature 1: Trigger System**\n- [ ] Explicit workflow label (`ashep-workflow:`) takes precedence\n- [ ] Issue type matching works correctly\n- [ ] Priority-based selection works (higher wins)\n- [ ] Config order breaks priority ties correctly\n- [ ] Default policy used when no match\n- [ ] Invalid workflow label handled according to `invalid_label_strategy`\n\n**Feature 2: Phase Tracking**\n- [ ] `ashep-phase:` label added on phase start\n- [ ] `ashep-phase:` label updated on phase transition\n- [ ] `ashep-phase:` label removed on issue close\n- [ ] Issues resume from correct phase label\n\n**Feature 3: HITL Markers**\n- [ ] `ashep-hitl:` label set on approval requirement\n- [ ] HITL reasons validated against predefined list\n- [ ] Custom HITL reasons validated by config rules\n- [ ] Approval note generated with instructions\n\n**Feature 4: Exclusion Control**\n- [ ] Issues with `ashep-excluded` filtered from processing\n- [ ] `excluded_tags` config removed\n- [ ] Text-based filtering removed\n\n## Breaking Changes\n- Removed: `excluded_tags` from WorkerConfig (users must update config)\n- Behavior Change: Issues are now filtered by label, not text content\n- Schema Changes: New required/optional fields in config and policies schemas\n\n## Files Modified Summary\n| File | Lines Changed | Type |\n|------|---------------|------|\n| .agent-shepherd/src/core/beads.ts | +150 | Core |\n| .agent-shepherd/src/core/policy.ts | +100 | Core |\n| .agent-shepherd/src/core/worker-engine.ts | +80 | Core |\n| .agent-shepherd/schemas/config.schema.json | +50 | Schema |\n| .agent-shepherd/schemas/policies.schema.json | +20 | Schema |\n| .agent-shepherd/src/cli/index.ts | +30 | CLI |\n| Documentation files | +410/-40 | Docs |\n| Test files (NEW) | +730 | Tests |\n| **TOTAL** | **+1500/-40** | |\n\n---\n## Scratchpad\n\n**When assigned this epic, consume the overall context and select the next available child issue to work on, rather than working on the epic directly.**\n\n### Complete Implementation Plan\n\nSee full detailed plan with code previews, acceptance criteria, and test strategies in original prompt. The plan includes:\n\n- Detailed task breakdowns for each phase\n- Code snippets and previews\n- Risk assessment and mitigation strategies\n- Testing strategy (unit, integration, manual)\n- Gantt chart for implementation timeline\n\n### Dependencies\n- Phase 1 → Phase 2 → Phase 3 → Phase 4 → Phase 5 → Phase 6 (sequential)\n\n### Estimated Timeline\n5-7 working days for full implementation and testing","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2026-01-05T17:07:38.978906+01:00","updated_at":"2026-01-05T17:22:55.870468+01:00","close_reason":"Removed as requested by user","deleted_at":"2026-01-05T17:22:55.870468+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"epic"}
{"id":"agent-shepherd-3oi0","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:33:45.001068+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:45.109364+01:00","deleted_at":"2026-01-07T18:33:45.109364+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-3oml","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T05:54:19.571029+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:54:19.636369+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-08T05:54:19.636369+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-3pq7","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:00:16.071186+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:00:16.11892+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T19:00:16.11892+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-3r6o","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T05:56:19.536732+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:56:19.671983+01:00","labels":["label2","label3"],"deleted_at":"2026-01-08T05:56:19.671983+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-3ty7","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T15:02:09.083022+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T15:02:09.263559+01:00","deleted_at":"2026-01-07T15:02:09.263559+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-3uum","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T04:53:56.042602+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T04:53:56.127155+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T04:53:56.127155+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-3vc","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:24:42.760504+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:29.116145+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-06T04:32:29.116145+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-3vx","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-06T04:34:14.664714+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:14.726164+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-06T04:34:14.726164+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-3wqo","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:30:20.728307+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:30:20.794406+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T14:30:20.794406+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-3x2i","title":"3.1.6 Add Startup Cleanup","description":"Clean up on system start to maintain performance. Create performStartupCleanup() method that archives old data, deletes ancient data, rebuilds indexes, and vacuums databases. Call in Logger constructor.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:09:12.097627+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:12:28.540456+01:00","deleted_at":"2026-01-07T01:12:28.540456+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-3y39c","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:15:31.320536+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:31.421958+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-09T01:15:31.421958+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-3y3q","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T15:02:08.981718+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T15:02:09.051215+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T15:02:09.051215+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-3yz21","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:41:41.639656+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:41:41.74603+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-09T04:41:41.74603+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-3zeb","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:57:13.38709+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:57:13.545025+01:00","deleted_at":"2026-01-06T15:57:13.545025+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-3zejm","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:23:32.848199+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:23:32.953345+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-09T01:23:32.953345+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-41kdy","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T05:10:40.215531+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T05:10:40.336943+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T05:10:40.336943+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-42bh","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T05:54:20.200273+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:54:20.366925+01:00","deleted_at":"2026-01-08T05:54:20.366925+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-42l","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:36:25.155333+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:36:25.238079+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-06T04:36:25.238079+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-43ax","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:18:30.385026+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:18:30.564894+01:00","deleted_at":"2026-01-07T19:18:30.564894+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-44e6","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T02:57:16.041032+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T02:57:16.125721+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-08T02:57:16.125721+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-44lb","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T22:07:38.77021+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T22:07:38.815018+01:00","deleted_at":"2026-01-07T22:07:38.815018+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-44oh","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:03:09.022281+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:03:09.130166+01:00","deleted_at":"2026-01-07T19:03:09.130166+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-496ca","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:23:33.787747+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:23:33.834847+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-09T01:23:33.834847+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-49tm6","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:11:02.840334+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:11:02.939184+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-09T20:11:02.939184+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-49vf","title":"2.1.5 Update Worker Engine Transition Handling","description":"Extend applyTransition() to handle new transition types.\n\n## Tasks\n- Extend worker-engine.ts:applyTransition() (lines 356-408):\n  - Add case for jump_back:\n    - Update issue status to \"open\"\n    - Update phase label to jump_target_phase\n    - Clear HITL labels\n    - Log jump message\n  - Add case for dynamic_decision:\n    - Execute AI decision agent to determine actual transition\n    - Apply the final transition returned by decision agent\n    - Log dynamic decision result\n- Ensure backward compatibility with existing transition types\n- Add error handling for invalid dynamic_decision results\n\n## Expected Deliverables\n- Extended applyTransition() implementation\n- jump_back transition handling\n- dynamic_decision transition handling\n- Error handling for decision failures\n- Backward compatibility maintained","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:51:09.168815+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-4aoe","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T05:56:18.002107+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:56:18.072226+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-08T05:56:18.072226+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-4ar","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:42:30.720544+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:42:30.895358+01:00","deleted_at":"2026-01-06T04:42:30.895358+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-4es49","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T01:06:42.710668+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T01:06:43.150722+01:00","deleted_at":"2026-01-11T01:06:43.150722+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-4fsc","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T15:02:10.007166+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T15:02:10.431708+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T15:02:10.431708+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-4g1d","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:57:13.29905+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:57:13.357868+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-06T15:57:13.357868+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-4gx","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:34:54.063015+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:54.156162+01:00","deleted_at":"2026-01-06T04:34:54.156162+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-4hu","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:32:31.009101+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:31.132231+01:00","labels":["label2","label3"],"deleted_at":"2026-01-06T04:32:31.132231+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-4hxc","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:36:01.966366+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:36:02.128629+01:00","deleted_at":"2026-01-07T02:36:02.128629+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-4js6c","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:24:04.179263+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:24:04.276954+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-09T01:24:04.276954+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-4lyu","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:33:44.540945+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:44.607231+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T18:33:44.607231+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-4m3w","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:51:18.674579+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:51:18.756574+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T02:51:18.756574+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-4oeh","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T18:14:40.831439+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:14:41.281633+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T18:14:41.281633+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-4r0r","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:54:00.827821+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:54:00.882529+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-06T15:54:00.882529+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-4tz6d","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:24:04.776338+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:24:04.849592+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-09T01:24:04.849592+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-4vs","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:32:30.450542+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:30.607809+01:00","deleted_at":"2026-01-06T04:32:30.607809+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-4w98f","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:06:41.195096+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:06:41.261135+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-09T20:06:41.261135+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-4whf4","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-09T01:23:32.740937+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:23:32.812593+01:00","deleted_at":"2026-01-09T01:23:32.812593+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-4wq05","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T23:03:54.991179+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:03:55.042438+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-09T23:03:55.042438+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-4ws2t","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:11:03.394278+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:11:03.443073+01:00","deleted_at":"2026-01-09T20:11:03.443073+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-4xe7","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:40:14.50214+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:40:14.571251+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T18:40:14.571251+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-4xek","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:35:16.330494+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:35:16.388848+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-06T23:35:16.388848+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-4y98i","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T01:06:40.185444+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T01:06:40.374327+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-11T01:06:40.374327+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-4ye","title":"Build Agent Shepherd Orchestration System","description":"The current agent ecosystem lacks effective orchestration for multi-step workflows, policy enforcement, and human-in-the-loop coordination. Agent Shepherd fills this gap by providing a production-ready TypeScript/Bun project that orchestrates AI coding agents across Beads issues, using OpenCode as the execution environment, enabling safe, explainable, and autonomous software development.\n\n**Reference Documentation**: See @urls.md for authoritative links to Beads, OpenCode, OpenSpec, BMAD Method, ReactFlow, and architectural inspiration from Steve Yegge's articles on agent autonomy and multi-step development.\n\n- Add full CLI interface with commands for worker, monitor, work, init, install, sync-agents, ui\n- Implement Worker Engine to pull from Beads and launch agents in OpenCode sessions\n- Add Monitor Engine for supervision, timeout detection, and HITL handling\n- Create Policy Engine for workflow phase transitions and retries\n- Build Agent Registry with capability-based agent selection\n- Integrate logging with JSONL and SQLite dual storage like Beads\n- Add OpenCode integration using @opencode-ai/sdk for session management\n- Implement Beads integration via shell commands for issue management\n- Develop minimal ReactFlow-based UI for flow visualization\n- Include installer and init commands with default configs","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-19T03:50:52.515477+01:00","updated_at":"2025-12-19T04:02:51.934268+01:00","deleted_at":"2025-12-19T04:02:51.934268+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-4yley","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T04:39:40.141289+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:39:40.243504+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-09T04:39:40.243504+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-51mps","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T05:10:41.44163+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T05:10:41.620489+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-09T05:10:41.620489+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-53ucj","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:46:38.650132+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:46:38.698425+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-09T20:46:38.698425+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-54vh","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T02:51:18.389769+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:51:18.45218+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T02:51:18.45218+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-55dj","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T19:18:29.644019+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:18:29.708264+01:00","deleted_at":"2026-01-07T19:18:29.708264+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-55k","title":"1.4 Initialize git repo if not present","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-19T03:54:39.905045+01:00","updated_at":"2025-12-19T04:02:51.934268+01:00","deleted_at":"2025-12-19T04:02:51.934268+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-577x","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:24:23.631528+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:24:23.719989+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T18:24:23.719989+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-58luu","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T05:10:40.379299+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T05:10:40.499233+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-09T05:10:40.499233+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-5ahp","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:36:01.569623+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:36:01.633316+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T02:36:01.633316+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-5bvs","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T22:07:37.557935+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T22:07:37.626147+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T22:07:37.626147+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-5cnh","title":"2.4 Create Decision Agent Capability System","description":"Enable AI-based intelligent workflow routing.\n\n## Scope\n- Define decision agent capabilities\n- Update agent registry with decision agents\n- Execute decision agents for dynamic transitions\n- Handle failures gracefully\n\n## Dependencies\nDepends on 2.2 and 2.3\n\n## Estimated Duration\n1 week\n\n## Scratchpad\n### 2.4.1 Define Decision Agent Capabilities\n- test-decision: Analyze test results and quality\n- validation-decision: Quality gate decisions\n- complex-decision: Multi-factor workflow decisions\n- Document purpose and requirements\n\n### 2.4.2 Update Agent Registry with Decision Agents\n- Add test-quality-decider\n- Add validation-gatekeeper\n- Add workflow-orchestrator\n- Test agent selection\n\n### 2.4.3 Implement buildDecisionInstructions()\n- Build comprehensive prompt for decision agents\n- Include issue data, previous results, decision parameters\n- Add allowed destinations and response format\n\n### 2.4.4 Create DecisionResult Interface\n- Define structure for parsed decision responses\n- Include action, target_phase, reasoning, confidence\n\n### 2.4.5 Implement parseDecisionResponse()\n- Parse and validate AI decision responses\n- Validate against allowed_destinations\n- Calculate requires_approval from confidence\n\n### 2.4.6 Execute Decision Agent in Worker Engine\n- Launch decision agent via OpenCode CLI\n- Build instructions and execute\n- Parse decision and return PhaseTransition\n\n### 2.4.7 Handle Decision Agent Failures\n- Default to safe fallback (require_approval)\n- Trigger HITL with failure context\n- Log errors\n\n### 2.4.8 Add Decision Metadata Logging\n- Log comprehensive decision metadata\n- Store agent info, config, result\n- Add indexes for analysis queries\n\n### 2.4.9 Add Confidence Threshold Configuration\n- Configure auto_advance and require_approval thresholds\n- Implement confidence-based auto-approval logic\n- Add test scenarios","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-06T23:49:12.964498+01:00","updated_at":"2026-01-06T23:56:55.128651+01:00","deleted_at":"2026-01-06T23:56:55.128651+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-5ewo","title":"3.2.9 Tests for Archival System","description":"Test all archival operations to ensure data preservation. Test archival preserves data, cross-database queries, JSONL archival sync, archive pruning, archive database access, and performance differences.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:09:35.514268+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:12:28.128095+01:00","deleted_at":"2026-01-07T01:12:28.128095+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-5f91w","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:06:40.857382+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:06:41.039021+01:00","deleted_at":"2026-01-09T20:06:41.039021+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-5famm","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-11T01:06:43.914683+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T01:06:44.969043+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-11T01:06:44.969043+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-5ghj5","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:43:40.797403+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:43:40.876488+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-08T23:43:40.876488+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-5hq3","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T16:34:50.791389+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T16:34:50.858173+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T16:34:50.858173+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-5ills","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:11:03.311595+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:11:03.360637+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-09T20:11:03.360637+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-5is","title":"Phase 3: Installer Scripts","description":"Create .agent-shepherd/install.sh for macOS/Linux and .agent-shepherd/install.ps1 for Windows. Both support version param (default latest), installation mode choice (hybrid/local), global link choice, cloning to temp dir, backing up/restoring config/plugins, copying installation, storing VERSION file, running bun install, and bun link if global linking requested.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T03:19:09.520945+01:00","created_by":"tonyhartmann","updated_at":"2025-12-30T03:35:38.832938+01:00","closed_at":"2025-12-30T03:35:38.832938+01:00","close_reason":"Closed via update","dependencies":[{"issue_id":"agent-shepherd-5is","depends_on_id":"agent-shepherd-7gt","type":"parent-child","created_at":"2025-12-30T03:20:16.076644+01:00","created_by":"daemon"},{"issue_id":"agent-shepherd-5is","depends_on_id":"agent-shepherd-n9n","type":"blocks","created_at":"2025-12-30T03:20:30.894523+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-5lox","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:18:29.738228+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:18:29.833178+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T19:18:29.833178+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-5nypr","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-10T00:11:57.342698+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T00:11:57.458612+01:00","deleted_at":"2026-01-10T00:11:57.458612+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-5osj","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:44:01.161586+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:44:01.270091+01:00","deleted_at":"2026-01-07T02:44:01.270091+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-5r2h","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:29:40.002151+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:29:40.103435+01:00","deleted_at":"2026-01-07T18:29:40.103435+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-5rb","title":"1.1 Create package.json with Bun, TypeScript, dependencies (@opencode-ai/sdk, react, reactflow, etc.)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-19T03:54:09.00127+01:00","updated_at":"2025-12-19T04:02:51.934268+01:00","deleted_at":"2025-12-19T04:02:51.934268+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-5s51","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T16:00:25.523384+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T16:00:25.681048+01:00","deleted_at":"2026-01-06T16:00:25.681048+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-5skt","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T05:46:22.408513+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:46:22.551754+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T05:46:22.551754+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-5skxt","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T01:23:34.101105+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:23:34.674144+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T01:23:34.674144+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-5sv","title":"label-workflow-test: No matching policy test","status":"tombstone","priority":2,"issue_type":"epic","created_at":"2026-01-06T04:32:29.700688+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:29.770604+01:00","deleted_at":"2026-01-06T04:32:29.770604+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"epic"}
{"id":"agent-shepherd-5t8","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:34:14.406673+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:14.44422+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-06T04:34:14.44422+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-5v9hc","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:13:53.568338+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:13:53.641704+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-09T01:13:53.641704+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-5vjja","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:16:31.91007+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:16:32.106469+01:00","deleted_at":"2026-01-09T20:16:32.106469+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-5wl33","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:50:42.693348+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:50:42.915349+01:00","labels":["label2","label3"],"deleted_at":"2026-01-09T04:50:42.915349+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-5wnk","title":"2.4.7 Handle Decision Agent Failures","description":"Gracefully handle failures in decision agent execution.\n\n## Tasks\n- Implement failure handling in executeDecisionAgent():\n  - If decision agent execution fails:\n    - Log error with full details (error, stack trace, context)\n    - Default to safe fallback: require_approval\n    - Trigger HITL with decision failure context\n    - Include error details in HITL reason\n    - Block issue to prevent uncontrolled progression\n- Test failure scenarios:\n  - Decision agent crashes\n  - Decision agent returns malformed response\n  - No agent available with required capability\n  - Network timeout during decision execution\n\n## Expected Deliverables\n- Failure handling implemented\n- Safe fallback to require_approval\n- HITL triggering with failure context\n- Error logging with details","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:53:10.233088+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-5wx5","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:32:18.880528+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:32:18.923315+01:00","deleted_at":"2026-01-07T14:32:18.923315+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-5x53","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T05:54:21.568619+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:54:21.72554+01:00","labels":["label2","label3"],"deleted_at":"2026-01-08T05:54:21.72554+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-5xf9","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T16:00:25.902683+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T16:00:26.06469+01:00","deleted_at":"2026-01-06T16:00:26.06469+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-5xim","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T21:44:09.205415+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:44:09.288094+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T21:44:09.288094+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-5ynb","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:57:13.59457+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:57:13.642561+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-06T15:57:13.642561+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-5yz6","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:28:09.068241+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:28:09.171083+01:00","deleted_at":"2026-01-06T23:28:09.171083+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-5zm","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:34:14.754137+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:14.879187+01:00","labels":["label2","label3"],"deleted_at":"2026-01-06T04:34:14.879187+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-60eq","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:14:40.543234+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:14:40.587164+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T18:14:40.587164+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-61j","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:35:54.65546+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:35:54.752761+01:00","deleted_at":"2026-01-06T04:35:54.752761+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-628ls","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:40:51.694942+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:40:51.766927+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T20:40:51.766927+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-62p5","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:26:23.649235+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:26:23.712463+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T14:26:23.712463+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-63bdi","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:20:30.414708+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:30.464038+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-09T01:20:30.464038+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-64h","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:34:53.232707+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:53.293245+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-06T04:34:53.293245+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-665uq","title":"Presets System","description":"## Overview\nCreate a \"batteries included\" preset system that bundles OpenCode agents, Agent Shepherd agent registries, and workflow files into installable packages. Depends on Epic 1 (Workflow Files) and Epic 2 (Agent Registry Files) being complete.\n\n## Scratchpad\nEpic 3: Presets System\nOverview\nCreate a \"batteries included\" preset system that bundles OpenCode agents, Agent Shepherd agent registries, and workflow files into installable packages. Depends on Epic 1 (Workflow Files) and Epic 2 (Agent Registry Files) being complete.\nWhat: Preset System Architecture\nDirectory Structure:\n.agent-shepherd/\n├── presets/                     # NEW: Preset bundles\n│   ├── coding/                  # Category subfolders  \n│   │   └── full-stack-dev/      # Specific preset\n│   │       ├── opencode-agents/ # OpenCode .md agent files\n│   │       ├── agents/          # Agent Shepherd registry YAML files\n│   │       ├── workflows/       # Workflow YAML files\n│   │       ├── manifest.json    # Preset metadata \u0026 requirements\n│   │       └── README.md        # User documentation\n│   ├── devops/\n│   │   └── ci-cd-automation/\n│   └── content/\n│       └── newsletter-publishing/\n├── installed-presets/           # NEW: Tracks installed presets\n│   └── full-stack-dev.json      # Installation manifest copy\nPreset Manifest Structure:\n{\n  name: full-stack-dev,\n  version: 1.0.0, \n  category: coding,\n  description: Complete full-stack development workflow with planning, implementation, testing, and code review,\n  dependencies: {\n    opencode: installed,\n    beads: initialized\n  },\n  components: {\n    opencode-agents: [\n      ashep-general-coder.md,\n      ashep-code-reviewer.md,\n      ashep-test-specialist.md\n    ],\n    agent-registries: [coding-agents.yaml],\n    workflows: [full-stack-workflow.yaml, review-workflow.yaml]\n  },\n  capabilities: [coding, testing, review, planning],\n  tags: [typescript, react, full-stack],\n  compatibility: {\n    min_agent_shepherd_version: 1.0.0\n  }\n}\nWhy: Benefits \u0026 Rationale\nZero-config Onboarding: Users get complete working agent/policy combinations instantly\nModular \u0026 Composable: Mix and match presets for different use cases (coding + devops + content)\nStable \u0026 Safe: File copying avoids merge conflicts vs inline YAML merging\nExtensible: Easy to add new preset categories and bundles\nSelf-documenting: Clear organization with manifests and READMEs\nDependency-aware: Validates requirements before installation\nShared Resource Safe: Handles OpenCode agents used by multiple presets\nEnables Ecosystem: Foundation for community-contributed preset marketplace\nHow: Implementation Steps\nPhase 1: Core Infrastructure (New preset-manager.ts)\n1.1 Create preset-manager.ts module\n- Location: .agent-shepherd/src/core/preset-manager.ts\n- Purpose: Central management for preset operations\n- Core functions: list, validate, install, uninstall\n1.2 Implement preset discovery and loading\n- Scan presets/ directory recursively\n- Parse manifest.json files\n- Build preset registry with metadata\n- Handle nested category subdirectories\n1.3 Add dependency validation system\n- Check OpenCode installation (.opencode/ exists)\n- Check Beads initialization (.beads/ exists)  \n- Validate Agent Shepherd version compatibility\n- Support custom dependency checkers\n1.4 Implement installation logic with conflict resolution\n- Copy OpenCode agents (skip if exists, track usage)\n- Copy agent registry files to agents/enabled/\n- Copy workflow files to workflows/enabled/\n- Store installation manifest in installed-presets/\nPhase 2: CLI Commands (cli/index.ts)\n2.1 Add ashep preset list command\n- List all available presets by category\n- Show installed status, version, description\n- Support filtering by category or capability\n2.2 Add ashep preset info \u003cname\u003e command\n- Display detailed preset information\n- Show components, requirements, capabilities\n- Indicate installation status and conflicts\n2.3 Add ashep preset install \u003cname\u003e command\n- Validate dependencies and compatibility\n- Show installation plan (what will be copied)\n- Execute installation with progress feedback\n- Update installed-presets tracking\n2.4 Add ashep preset uninstall \u003cname\u003e command\n- Show uninstallation plan (what will be removed)\n- Check for shared resource conflicts\n- Remove files (only if not used by other presets)\n- Clean up installed-presets tracking\n2.5 Add ashep preset create \u003cname\u003e command\n- Create preset directory structure template\n- Generate manifest.json with defaults\n- Create placeholder directories and README\nPhase 3: Shared Resource Management\n3.1 Implement OpenCode agent usage tracking\n- Track which presets use which OpenCode agents\n- Prevent removal if agent still referenced elsewhere\n- Support \"force\" uninstall option for advanced users\n3.2 Add preset compatibility checking\n- Detect conflicting agent IDs across presets\n- Warn about capability overlaps\n- Suggest alternative preset combinations\n3.3 Implement rollback on installation failure\n- Track all file operations during install\n- Rollback partial installations on errors\n- Leave system in clean state\nPhase 4: Integration \u0026 Validation\n4.1 Update config-validator.ts to validate preset manifests\n- Validate manifest.json schema compliance\n- Check component file existence\n- Validate dependency specifications\n4.2 Add preset-aware error messages\n- Clear messages when dependencies missing\n- Helpful suggestions for resolving conflicts\n- Guidance on manual dependency installation\nPhase 5: Tests\n5.1 Add unit tests for preset discovery and loading\n- Test recursive scanning of preset directories\n- Verify manifest parsing and validation\n- Test category organization handling\n5.2 Add tests for dependency validation\n- Mock OpenCode/Beads installation states\n- Test version compatibility checking\n- Verify custom dependency validators\n5.3 Add tests for installation logic\n- Test file copying with conflict detection\n- Verify usage tracking for shared agents\n- Test rollback on installation failures\n5.4 Add tests for shared resource management\n- Test agent usage counting and cleanup\n- Verify conflict detection and warnings\n- Test force uninstall scenarios\n5.5 Add tests for CLI commands\n- Mock filesystem and dependency checks\n- Test all preset commands end-to-end\n- Verify error handling and user feedback\nPhase 6: Documentation Updates\n6.1 Create new docs/presets.md documentation\n- Complete guide to using presets\n- Examples of installation and management\n- Troubleshooting common issues\n6.2 Add presets section to docs/cli-reference.md\n- Document all preset CLI commands\n- Include usage examples and options\n- Show command outputs and error messages\n6.3 Update README.md with presets information\n- Add presets to features list\n- Quick start guide for preset installation\n- Link to detailed presets documentation\n6.4 Update AGENTS.md architecture section\n- Document preset system in overall architecture\n- Explain relationship to agent/workflow files\n- Describe how presets enable batteries-included experience\n6.5 Add preset development guide\n- How to create custom presets\n- Manifest schema reference\n- Best practices for preset organization\nEdge Cases \u0026 Considerations\nShared Agents: OpenCode agents used by multiple presets need reference counting\nNested Categories: Support arbitrary nesting (coding/typescript/, coding/python/)\nVersion Conflicts: Handle preset version compatibility and updates\nPartial Installations: Ensure rollback leaves system in consistent state\nUser Permissions: Handle file permission issues during copy operations\nLarge Presets: Support progress indication for large preset installations\nOffline Usage: Allow presets to work without network (local file bundles)\nTesting Strategy\n- Unit tests: Core preset management logic\n- Integration tests: Full install/uninstall cycles with mocked filesystem\n- CLI tests: Command functionality with realistic scenarios\n- Edge case tests: Shared resources, conflicts, failures\n- User experience tests: Error messages and guidance\nRollout Plan\n1. Implement core preset-manager.ts with discovery and validation\n2. Add CLI commands for preset management\n3. Implement shared resource tracking and conflict resolution\n4. Add comprehensive tests and error handling\n5. Create initial preset bundles (start with simple examples)\n6. Update all documentation with examples\n7. Test with real presets and gather user feedback\n8. Release with batteries-included marketing emphasis\nDependencies\n- Requires Epic 1: Workflow Files Extension (for workflow components)\n- Requires Epic 2: Agent Registry Files Extension (for agent components)\n- Enables: Community preset ecosystem and zero-config onboarding\nSuccess Metrics\n- Users can install presets with single command\n- No configuration required for preset-provided capabilities\n- Shared agents handled safely across presets\n- Clear error messages guide users through issues\n- Preset ecosystem enables community contributions\nThis implementation provides the complete \"batteries included\" experience while building on the solid foundations established by the workflow and agent registry file extensions. The system is designed to be user-friendly, safe, and extensible for future growth.\n\n## Execution Note\nWhen assigned this epic, consume the overall context and select the next available child issue to work on, rather than working on the epic directly.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-10T01:42:59.182884+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:44:05.735726+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq","depends_on_id":"agent-shepherd-y9syu","type":"blocks","created_at":"2026-01-10T01:43:53.704643+01:00","created_by":"daemon"},{"issue_id":"agent-shepherd-665uq","depends_on_id":"agent-shepherd-lx838","type":"blocks","created_at":"2026-01-10T01:48:20.492579+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.1","title":"Phase 1: Core Infrastructure","description":"Create preset-manager.ts module with discovery, validation, and installation logic. Includes implementing preset discovery and loading, dependency validation system, and installation logic with conflict resolution.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-10T01:43:08.993106+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:08.993106+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.1","depends_on_id":"agent-shepherd-665uq","type":"parent-child","created_at":"2026-01-10T01:43:08.993822+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.1.1","title":"1.1 Create preset-manager.ts module","description":"Location: .agent-shepherd/src/core/preset-manager.ts. Purpose: Central management for preset operations. Core functions: list, validate, install, uninstall.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:43:10.42445+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:10.42445+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.1.1","depends_on_id":"agent-shepherd-665uq.1","type":"parent-child","created_at":"2026-01-10T01:43:10.425281+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.1.2","title":"1.2 Implement preset discovery and loading","description":"Scan presets/ directory recursively. Parse manifest.json files. Build preset registry with metadata. Handle nested category subdirectories.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:43:11.887786+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:11.887786+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.1.2","depends_on_id":"agent-shepherd-665uq.1","type":"parent-child","created_at":"2026-01-10T01:43:11.888595+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.1.3","title":"1.3 Add dependency validation system","description":"Check OpenCode installation (.opencode/ exists). Check Beads initialization (.beads/ exists). Validate Agent Shepherd version compatibility. Support custom dependency checkers.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:43:13.094525+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:13.094525+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.1.3","depends_on_id":"agent-shepherd-665uq.1","type":"parent-child","created_at":"2026-01-10T01:43:13.095262+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.1.4","title":"1.4 Implement installation logic with conflict resolution","description":"Copy OpenCode agents (skip if exists, track usage). Copy agent registry files to agents/enabled/. Copy workflow files to workflows/enabled/. Store installation manifest in installed-presets/.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:43:15.205869+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:15.205869+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.1.4","depends_on_id":"agent-shepherd-665uq.1","type":"parent-child","created_at":"2026-01-10T01:43:15.206669+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.2","title":"Phase 2: CLI Commands","description":"Add CLI commands for preset management: list, info, install, uninstall, create.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-10T01:43:16.394925+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:16.394925+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.2","depends_on_id":"agent-shepherd-665uq","type":"parent-child","created_at":"2026-01-10T01:43:16.396127+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.2.1","title":"2.1 Add ashep preset list command","description":"List all available presets by category. Show installed status, version, description. Support filtering by category or capability.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:43:18.114504+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:18.114504+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.2.1","depends_on_id":"agent-shepherd-665uq.2","type":"parent-child","created_at":"2026-01-10T01:43:18.115243+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.2.2","title":"2.2 Add ashep preset info \u003cname\u003e command","description":"Display detailed preset information. Show components, requirements, capabilities. Indicate installation status and conflicts.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:43:19.441963+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:19.441963+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.2.2","depends_on_id":"agent-shepherd-665uq.2","type":"parent-child","created_at":"2026-01-10T01:43:19.442843+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.2.3","title":"2.3 Add ashep preset install \u003cname\u003e command","description":"Validate dependencies and compatibility. Show installation plan (what will be copied). Execute installation with progress feedback. Update installed-presets tracking.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:43:20.877458+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:20.877458+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.2.3","depends_on_id":"agent-shepherd-665uq.2","type":"parent-child","created_at":"2026-01-10T01:43:20.878396+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.2.4","title":"2.4 Add ashep preset uninstall \u003cname\u003e command","description":"Show uninstallation plan (what will be removed). Check for shared resource conflicts. Remove files (only if not used by other presets). Clean up installed-presets tracking.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:43:22.088406+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:22.088406+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.2.4","depends_on_id":"agent-shepherd-665uq.2","type":"parent-child","created_at":"2026-01-10T01:43:22.089159+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.2.5","title":"2.5 Add ashep preset create \u003cname\u003e command","description":"Create preset directory structure template. Generate manifest.json with defaults. Create placeholder directories and README.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:43:23.543437+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:23.543437+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.2.5","depends_on_id":"agent-shepherd-665uq.2","type":"parent-child","created_at":"2026-01-10T01:43:23.544953+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.3","title":"Phase 3: Shared Resource Management","description":"Implement OpenCode agent usage tracking, preset compatibility checking, and rollback on installation failure.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-10T01:43:24.651943+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:24.651943+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.3","depends_on_id":"agent-shepherd-665uq","type":"parent-child","created_at":"2026-01-10T01:43:24.652936+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.3.1","title":"3.1 Implement OpenCode agent usage tracking","description":"Track which presets use which OpenCode agents. Prevent removal if agent still referenced elsewhere. Support \"force\" uninstall option for advanced users.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:43:25.811356+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:25.811356+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.3.1","depends_on_id":"agent-shepherd-665uq.3","type":"parent-child","created_at":"2026-01-10T01:43:25.813403+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.3.2","title":"3.2 Add preset compatibility checking","description":"Detect conflicting agent IDs across presets. Warn about capability overlaps. Suggest alternative preset combinations.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:43:26.957189+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:26.957189+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.3.2","depends_on_id":"agent-shepherd-665uq.3","type":"parent-child","created_at":"2026-01-10T01:43:26.95828+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.3.3","title":"3.3 Implement rollback on installation failure","description":"Track all file operations during install. Rollback partial installations on errors. Leave system in clean state.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:43:28.312803+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:28.312803+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.3.3","depends_on_id":"agent-shepherd-665uq.3","type":"parent-child","created_at":"2026-01-10T01:43:28.313449+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.4","title":"Phase 4: Integration \u0026 Validation","description":"Update config-validator.ts to validate preset manifests, add preset-aware error messages.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-10T01:43:29.427819+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:29.427819+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.4","depends_on_id":"agent-shepherd-665uq","type":"parent-child","created_at":"2026-01-10T01:43:29.428847+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.4.1","title":"4.1 Update config-validator.ts to validate preset manifests","description":"Validate manifest.json schema compliance. Check component file existence. Validate dependency specifications.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:43:30.862826+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:30.862826+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.4.1","depends_on_id":"agent-shepherd-665uq.4","type":"parent-child","created_at":"2026-01-10T01:43:30.863706+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.4.2","title":"4.2 Add preset-aware error messages","description":"Clear messages when dependencies missing. Helpful suggestions for resolving conflicts. Guidance on manual dependency installation.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:43:32.654881+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:32.654881+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.4.2","depends_on_id":"agent-shepherd-665uq.4","type":"parent-child","created_at":"2026-01-10T01:43:32.655934+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.5","title":"Phase 5: Tests","description":"Comprehensive testing for preset system: discovery, dependency validation, installation, shared resources, CLI commands.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-10T01:43:34.074289+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:34.074289+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.5","depends_on_id":"agent-shepherd-665uq","type":"parent-child","created_at":"2026-01-10T01:43:34.074984+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.5.1","title":"5.1 Add unit tests for preset discovery and loading","description":"Test recursive scanning of preset directories. Verify manifest parsing and validation. Test category organization handling.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:43:35.56677+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:35.56677+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.5.1","depends_on_id":"agent-shepherd-665uq.5","type":"parent-child","created_at":"2026-01-10T01:43:35.567614+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.5.2","title":"5.2 Add tests for dependency validation","description":"Mock OpenCode/Beads installation states. Test version compatibility checking. Verify custom dependency validators.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:43:37.109257+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:37.109257+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.5.2","depends_on_id":"agent-shepherd-665uq.5","type":"parent-child","created_at":"2026-01-10T01:43:37.110153+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.5.3","title":"5.3 Add tests for installation logic","description":"Test file copying with conflict detection. Verify usage tracking for shared agents. Test rollback on installation failures.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:43:38.329278+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:38.329278+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.5.3","depends_on_id":"agent-shepherd-665uq.5","type":"parent-child","created_at":"2026-01-10T01:43:38.330117+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.5.4","title":"5.4 Add tests for shared resource management","description":"Test agent usage counting and cleanup. Verify conflict detection and warnings. Test force uninstall scenarios.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:43:39.786144+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:39.786144+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.5.4","depends_on_id":"agent-shepherd-665uq.5","type":"parent-child","created_at":"2026-01-10T01:43:39.786992+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.5.5","title":"5.5 Add tests for CLI commands","description":"Mock filesystem and dependency checks. Test all preset commands end-to-end. Verify error handling and user feedback.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:43:41.014164+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:41.014164+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.5.5","depends_on_id":"agent-shepherd-665uq.5","type":"parent-child","created_at":"2026-01-10T01:43:41.015177+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.6","title":"Phase 6: Documentation Updates","description":"Update all documentation with presets information: new docs/presets.md, CLI reference, README, AGENTS.md, preset development guide.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-10T01:43:42.32516+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:42.32516+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.6","depends_on_id":"agent-shepherd-665uq","type":"parent-child","created_at":"2026-01-10T01:43:42.325986+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.6.1","title":"6.1 Create new docs/presets.md documentation","description":"Complete guide to using presets. Examples of installation and management. Troubleshooting common issues.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:43:43.962481+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:43.962481+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.6.1","depends_on_id":"agent-shepherd-665uq.6","type":"parent-child","created_at":"2026-01-10T01:43:43.965271+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.6.2","title":"6.2 Add presets section to docs/cli-reference.md","description":"Document all preset CLI commands. Include usage examples and options. Show command outputs and error messages.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:43:45.087923+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:45.087923+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.6.2","depends_on_id":"agent-shepherd-665uq.6","type":"parent-child","created_at":"2026-01-10T01:43:45.088753+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.6.3","title":"6.3 Update README.md with presets information","description":"Add presets to features list. Quick start guide for preset installation. Link to detailed presets documentation.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:43:46.365137+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:46.365137+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.6.3","depends_on_id":"agent-shepherd-665uq.6","type":"parent-child","created_at":"2026-01-10T01:43:46.366128+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.6.4","title":"6.4 Update AGENTS.md architecture section","description":"Document preset system in overall architecture. Explain relationship to agent/workflow files. Describe how presets enable batteries-included experience.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:43:47.675452+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:47.675452+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.6.4","depends_on_id":"agent-shepherd-665uq.6","type":"parent-child","created_at":"2026-01-10T01:43:47.676559+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-665uq.6.5","title":"6.5 Add preset development guide","description":"How to create custom presets. Manifest schema reference. Best practices for preset organization.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:43:49.049862+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:43:49.049862+01:00","dependencies":[{"issue_id":"agent-shepherd-665uq.6.5","depends_on_id":"agent-shepherd-665uq.6","type":"parent-child","created_at":"2026-01-10T01:43:49.050667+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-675y","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:14:40.333853+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:14:40.510278+01:00","deleted_at":"2026-01-07T18:14:40.510278+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-6979","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T05:56:18.751749+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:56:18.795776+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-08T05:56:18.795776+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-6ac8","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:40:16.018927+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:40:16.171009+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T18:40:16.171009+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-6ae","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:35:53.73826+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:35:53.819352+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-06T04:35:53.819352+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-6b53","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T05:46:20.357114+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:46:20.428931+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T05:46:20.428931+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-6c0r","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T19:00:14.984932+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:00:15.047529+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T19:00:15.047529+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-6dmh","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T19:05:09.496566+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:05:09.564653+01:00","deleted_at":"2026-01-07T19:05:09.564653+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-6dpa","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:36:02.157752+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:36:02.238144+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T02:36:02.238144+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-6dxd","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:40:14.810149+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:40:14.898547+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T18:40:14.898547+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-6e5s","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:29:39.293171+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:29:39.393582+01:00","deleted_at":"2026-01-07T18:29:39.393582+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-6ff2","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:32:17.580803+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:32:17.648211+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T14:32:17.648211+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-6fvd","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-08T05:54:19.872687+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:54:19.945442+01:00","deleted_at":"2026-01-08T05:54:19.945442+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-6g3yb","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:15:58.54339+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:58.650406+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-09T01:15:58.650406+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-6gp1","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T22:07:37.656045+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T22:07:37.71954+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T22:07:37.71954+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-6hq67","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T01:06:42.182407+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T01:06:42.394481+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-11T01:06:42.394481+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-6izf","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T22:07:38.846568+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T22:07:38.955231+01:00","deleted_at":"2026-01-07T22:07:38.955231+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-6jps","title":"2.5 Add Decision Prompt Building and Response Parsing","description":"Build comprehensive prompt system for decision agents.\n\n## Scope\n- Standardize prompt templates\n- Build comprehensive decision instructions\n- Implement response validation and sanitization\n- Add decision analytics\n\n## Dependencies\nDepends on 2.4 (Decision Agent System)\n\n## Estimated Duration\n1 week\n\n## Scratchpad\n### 2.5.1 Standardize Prompt Templates\n- Create templates for test-decision, validation-decision, complex-decision\n- Support variable substitution\n- Store in config/decision-prompts.yaml\n\n### 2.5.2 Enhance buildDecisionInstructions()\n- Load capability-specific templates\n- Substitute variables with actual data\n- Add recent decisions and phase history\n\n### 2.5.3 Add Contextual Information to Prompts\n- Include recent decisions\n- Include average phase durations\n- Include previous agent outputs\n- Include relevant Beads issue labels\n\n### 2.5.4 Implement Response Validation\n- Validate JSON structure\n- Validate required fields\n- Validate action format\n- Validate target phase\n\n### 2.5.5 Add Response Sanitization\n- Strip markdown code blocks\n- Handle extra whitespace\n- Handle escaped quotes\n- Ensure valid UTF-8\n\n### 2.5.6 Add Retry Logic for Decision Agents\n- Retry with clarifying instructions\n- Max 2 retries\n- Fallback to require_approval\n\n### 2.5.7 Add Decision Analytics\n- Track confidence distribution\n- Track most common target phases\n- Track approval rate vs confidence\n- Track decision agent performance\n\n### 2.5.8 Comprehensive Tests\n- Test prompt generation\n- Test response parsing\n- Test response validation\n- Test response sanitization\n- Test retry logic\n- Test decision analytics","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-06T23:49:12.973384+01:00","updated_at":"2026-01-06T23:56:55.128651+01:00","deleted_at":"2026-01-06T23:56:55.128651+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-6kv","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:36:26.376527+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:36:26.476357+01:00","deleted_at":"2026-01-06T04:36:26.476357+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-6l0c","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:39:12.679626+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:39:12.812768+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T14:39:12.812768+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-6mbu1","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:15:33.175795+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:33.324998+01:00","labels":["label2","label3"],"deleted_at":"2026-01-09T01:15:33.324998+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-6n9","title":"Update policies.schema.json with fallback fields","description":"File: .agent-shepherd/schemas/policies.schema.json\n\nTask: Add fallback fields to policy and phase levels in the policies schema\n\nRequired Changes:\n\n1. Add fallback fields to Policy level:\n   - fallback_enabled (boolean, optional): Whether fallback is enabled for this policy\n   - fallback_agent (string, optional): Fallback agent ID for this policy\n   - fallback_mappings (object, optional): Capability-specific fallback mappings for this policy\n\n2. Add fallback fields to Phase level:\n   - fallback_agent (string, optional): Fallback agent ID override for this phase\n   - fallback_enabled (boolean, optional): Whether fallback is enabled for this phase\n\nSchema Structure for Policy:\n```json\n{\n  \"fallback_enabled\": {\n    \"type\": \"boolean\",\n    \"description\": \"Whether fallback is enabled for this policy. Inherits from global if not set.\"\n  },\n  \"fallback_agent\": {\n    \"type\": \"string\",\n    \"description\": \"Fallback agent ID for this policy. Inherits from global if not set.\"\n  },\n  \"fallback_mappings\": {\n    \"type\": \"object\",\n    \"description\": \"Capability-specific fallback mappings for this policy\",\n    \"additionalProperties\": {\n      \"type\": \"string\"\n    }\n  }\n}\n```\n\nSchema Structure for Phase:\n```json\n{\n  \"fallback_agent\": {\n    \"type\": \"string\",\n    \"description\": \"Fallback agent ID override for this phase\"\n  },\n  \"fallback_enabled\": {\n    \"type\": \"boolean\",\n    \"description\": \"Whether fallback is enabled for this phase. Overrides policy and global settings.\"\n  }\n}\n```\n\nAcceptance Criteria:\n- [ ] Policy-level fallback fields are added and optional\n- [ ] Phase-level fallback fields are added and optional\n- [ ] Schema validates with fallback fields\n- [ ] Schema validates without fallback fields (backward compatibility)\n- [ ] All fields have proper descriptions explaining their behavior","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T02:43:57.856884+01:00","updated_at":"2026-01-05T02:53:05.090909+01:00","closed_at":"2026-01-05T02:53:05.090909+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-6n9","depends_on_id":"agent-shepherd-uj0","type":"parent-child","created_at":"2026-01-05T02:45:00.503606+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-6niw","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:26:24.634296+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:26:24.797824+01:00","deleted_at":"2026-01-07T14:26:24.797824+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-6ocr5","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T01:15:59.424661+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:59.919216+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T01:15:59.919216+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-6piw","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:00:15.387287+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:00:15.448364+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T19:00:15.448364+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-6q8z","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T02:57:16.156782+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T02:57:16.223891+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-08T02:57:16.223891+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-6qbe","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T19:18:29.440945+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:18:29.510799+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T19:18:29.510799+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-6qrc","title":"2.1.3 Implement determineTransition() Enhancements","description":"Extend determineTransition() to support jump_back and dynamic_decision types. Add logic to handle new transition types while maintaining existing advance/retry/block/close behavior.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-07T00:04:52.409982+01:00","updated_at":"2026-01-07T00:06:15.832092+01:00","deleted_at":"2026-01-07T00:06:15.832092+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-6ti","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-06T04:34:13.369221+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:13.430159+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-06T04:34:13.430159+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-6vbnj","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:52:28.027721+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:52:28.273455+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-11T00:52:28.273455+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-6vj8","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T20:36:37.654194+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T20:36:38.133999+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T20:36:38.133999+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-6vyuy","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:15:30.862178+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:30.942382+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T01:15:30.942382+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-6xj6","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T19:00:15.171642+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:00:15.235606+01:00","deleted_at":"2026-01-07T19:00:15.235606+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-6y1t4","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-11T01:06:40.443854+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T01:06:40.646519+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-11T01:06:40.646519+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-6yf2b","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:20:55.145214+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:55.261789+01:00","deleted_at":"2026-01-09T01:20:55.261789+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-6yy5i","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:43:41.746577+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:43:41.841608+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-08T23:43:41.841608+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-6yyz5","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T05:10:42.170754+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T05:10:42.231798+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-09T05:10:42.231798+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-6yz8e","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:31:31.880123+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:31:31.97884+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-11T00:31:31.97884+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-6z2hm","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:50:41.756847+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:50:41.936397+01:00","deleted_at":"2026-01-09T04:50:41.936397+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-702j2","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:15:31.568428+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:31.784412+01:00","deleted_at":"2026-01-09T01:15:31.784412+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-73us5","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T05:10:42.589842+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T05:10:43.339784+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T05:10:43.339784+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-74kl2","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:11:03.078863+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:11:03.2753+01:00","deleted_at":"2026-01-09T20:11:03.2753+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-74tyi","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-10T00:11:56.086427+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T00:11:56.154688+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-10T00:11:56.154688+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-74z","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:36:25.961976+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:36:26.022965+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-06T04:36:26.022965+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-750","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:34:53.65248+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:53.713476+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-06T04:34:53.713476+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-7566","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T16:00:26.092894+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T16:00:26.135495+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-06T16:00:26.135495+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-75dkm","title":"Implement Beads Status \u0026 Label System (ashep-managed)","description":"Implement ashep-managed label system to track which issues are managed by agent-shepherd, while maintaining existing status flow (open ↔ in_progress for phase execution).\n\nWhen assigned this epic, consume the overall context and select the next available child issue to work on, rather than working on the epic directly.\n\n## Scratchpad\nPlan 1: Beads Status \u0026 Label System (ashep-managed)\nOverview\nImplement ashep-managed label system to track which issues are managed by agent-shepherd, while maintaining existing status flow (open ↔ in_progress for phase execution).\n---\nStep 1: Add Beads Label Functions\nFile: src/core/beads.ts\nWhat: Add three new functions to manage ashep-managed label\nWhy: Worker needs to add/remove this label to mark issue ownership\nHow:\n// Add at end of file, before exports\n/**\n * Set ashep-managed label for an issue\n */\nexport async function setAshepManagedLabel(issueId: string): Promise\u003cvoid\u003e {\n  await addIssueLabel(issueId, \"ashep-managed\");\n}\n/**\n * Remove ashep-managed label from an issue\n */\nexport async function removeAshepManagedLabel(issueId: string): Promise\u003cvoid\u003e {\n  await removeIssueLabel(issueId, \"ashep-managed\");\n}\n/**\n * Check if issue has ashep-managed label\n */\nexport async function hasAshepManagedLabel(issueId: string): Promise\u003cboolean\u003e {\n  const labels = await getIssueLabels(issueId);\n  return labels.includes(\"ashep-managed\");\n}\nTests: \n- Manually add label to issue, verify function returns true\n- Manually remove label, verify function returns false\n- Test with issue that has no labels\n---\nStep 2: Worker Engine - Add Label on First Pickup\nFile: src/core/worker-engine.ts\nWhat: Add ashep-managed label when worker first picks up an issue\nWhy: Mark issue as being managed by ashep, visible to humans via bd list --label ashep-managed\nHow: In processIssue() method, after line 151 (after setting phase label):\n// Check for existing phase label to resume from\nconst currentPhaseLabel = await getCurrentPhase(issue.id);\nlet phase: string;\nif (currentPhaseLabel \u0026\u0026 phases.includes(currentPhaseLabel)) {\n  phase = currentPhaseLabel;\n  console.log(`Resuming issue from phase '${phase}'`);\n} else {\n  phase = phases[0] || \"plan\";\n  await setPhaseLabel(issue.id, phase);\n}\n// NEW: Add ashep-managed label if not already present\nconst hasManagedLabel = await hasAshepManagedLabel(issue.id);\nif (!hasManagedLabel) {\n  await setAshepManagedLabel(issue.id);\n  console.log(`Added ashep-managed label to issue ${issue.id}`);\n}\nWhy this location: After phase label is set, ensures label exists before phase execution begins\n---\nStep 3: Worker Engine - Remove Label on Close\nFile: src/core/worker-engine.ts\nWhat: Remove ashep-managed label when issue is closed\nWhy: Clean up label when issue lifecycle ends (optional but good hygiene)\nHow: In applyTransition() method, modify case \"close\": (around line 561-567):\ncase \"close\":\n  await updateIssue(issueId, { status: \"closed\" });\n  // NEW: Remove ashep-managed label\n  await removeAshepManagedLabel(issueId);\n  await removePhaseLabels(issueId);\n  await clearHITLLabels(issueId);\n  console.log(`Closed issue: ${transition.reason}`);\n  break;\nWhy keep label in other transitions:\n- advance, retry, jump_back: Issue still managed, keep label\n- block: Issue still managed, keep label\n- Only remove on close (lifecycle complete)\n---\nStep 4: Add New CLI Commands\nFile: src/cli/index.ts\nWhat: Add 4 new commands for better visibility into managed issues\nWhy: Humans need to see active work, HITL items, ready work, and struggling issues\nHow:\n4.1 ashep list-active\nasync function cmdListActive(): Promise\u003cvoid\u003e {\n  const proc = Bun.spawn([\n    \"bd\", \"list\", \n    \"--label\", \"ashep-managed\",\n    \"--status\", \"open,in_progress\",\n    \"--json\"\n  ], {\n    stdout: \"pipe\",\n    stderr: \"pipe\"\n  });\n  \n  const output = await new Response(proc.stdout).text();\n  const issues = JSON.parse(output);\n  \n  if (issues.length === 0) {\n    console.log(\"No active issues found.\");\n    return;\n  }\n  \n  console.log(`\\nActive Issues (${issues.length}):`);\n  console.log(\"┌─────────┬─────────────────────────────────┬──────────────┬─────────┬──────────────┐\");\n  console.log(\"│ ID      │ Title                           │ Phase        │ Priority │ Updated      │\");\n  console.log(\"├─────────┼─────────────────────────────────┼──────────────┼─────────┼──────────────┤\");\n  \n  for (const issue of issues) {\n    const phaseLabel = issue.labels?.find(l =\u003e l.startsWith(\"ashep-phase:\"));\n    const phase = phaseLabel?.replace(\"ashep-phase:\", \"\") || \"unknown\";\n    const updatedTime = new Date(issue.updated_at).toLocaleString();\n    \n    const title = issue.title.substring(0, 30) + (issue.title.length \u003e 30 ? \"...\" : \"\");\n    console.log(`│ ${issue.id.padEnd(7)} │ ${title.padEnd(31)} │ ${phase.padEnd(12)} │ ${ `P${issue.priority}`.padEnd(7)} │ ${updatedTime.padEnd(12)} │`);\n  }\n  \n  console.log(\"└─────────┴─────────────────────────────────┴──────────────┴─────────┴──────────────┘\");\n}\n4.2 ashep list-hitl\nasync function cmdListHITL(): Promise\u003cvoid\u003e {\n  const proc = Bun.spawn([\"bd\", \"list\", \"--json\"], {\n    stdout: \"pipe\",\n    stderr: \"pipe\"\n  });\n  \n  const output = await new Response(proc.stdout).text();\n  const issues = JSON.parse(output);\n  \n  // Filter for issues with ashep-hitl: labels\n  const hitlIssues = issues.filter(issue =\u003e \n    issue.labels?.some(l =\u003e l.startsWith(\"ashep-hitl:\"))\n  );\n  \n  if (hitlIssues.length === 0) {\n    console.log(\"No HITL issues found.\");\n    return;\n  }\n  \n  console.log(`\\nHITL Issues (${hitlIssues.length}):`);\n  console.log(\"┌─────────┬─────────────────────────────────┬──────────────┬─────────┬──────────────────┐\");\n  console.log(\"│ ID      │ Title                           │ Reason       │ Phase    │ Status          │\");\n  \n  for (const issue of hitlIssues) {\n    const hitlLabel = issue.labels?.find(l =\u003e l.startsWith(\"ashep-hitl:\"));\n    const reason = hitlLabel?.replace(\"ashep-hitl:\", \"\") || \"unknown\";\n    const phaseLabel = issue.labels?.find(l =\u003e l.startsWith(\"ashep-phase:\"));\n    const phase = phaseLabel?.replace(\"ashep-phase:\", \"\") || \"unknown\";\n    const title = issue.title.substring(0, 30) + (issue.title.length \u003e 30 ? \"...\" : \"\");\n    \n    console.log(`│ ${issue.id.padEnd(7)} │ ${title.padEnd(31)} │ ${reason.padEnd(12)} │ ${phase.padEnd(8)} │ ${issue.status.padEnd(14)} │`);\n  }\n  \n  console.log(\"└─────────┴─────────────────────────────────┴──────────────┴─────────┴──────────────────┘\");\n}\n4.3 ashep list-ready\nasync function cmdListReady(): Promise\u003cvoid\u003e {\n  const proc = Bun.spawn([\n    \"bd\", \"list\", \n    \"--label\", \"ashep-managed\",\n    \"--status\", \"open\",\n    \"--json\"\n  ], {\n    stdout: \"pipe\",\n    stderr: \"pipe\"\n  });\n  \n  const output = await new Response(proc.stdout).text();\n  const issues = JSON.parse(output);\n  \n  if (issues.length === 0) {\n    console.log(\"No ready issues found.\");\n    return;\n  }\n  \n  // Similar table format to list-active\n  // Display with: ID, Title, Phase, Priority, Updated\n}\n4.4 ashep list-struggle\nasync function cmdListStruggle(hours?: number): Promise\u003cvoid\u003e {\n  const staleThresholdHours = hours || 24;\n  const staleCutoff = Date.now() - (staleThresholdHours * 60 * 60 * 1000);\n  \n  const proc = Bun.spawn([\"bd\", \"list\", \"--json\"], {\n    stdout: \"pipe\",\n    stderr: \"pipe\"\n  });\n  \n  const output = await new Response(proc.stdout).text();\n  const issues = JSON.parse(output);\n  \n  // Filter for ashep-managed issues that are:\n  // 1. Blocked status, OR\n  // 2. Has ashep-hitl: label, OR\n  // 3. Not updated in X hours\n  const strugglingIssues = issues.filter(issue =\u003e {\n    const isManaged = issue.labels?.includes(\"ashep-managed\");\n    if (!isManaged) return false;\n    \n    const isBlocked = issue.status === \"blocked\";\n    const hasHITL = issue.labels?.some(l =\u003e l.startsWith(\"ashep-hitl:\"));\n    const isStale = new Date(issue.updated_at).getTime() \u003c staleCutoff;\n    \n    return isBlocked || hasHITL || isStale;\n  });\n  \n  // Display with: ID, Title, Issue Type, Phase, Status, Age/Reason\n}\n---\nStep 5: Update CLI Command Registry\nFile: src/cli/index.ts\nWhat: Register new commands in COMMANDS object and main() switch\nWhy: Make commands discoverable and executable\nHow:\n// Update COMMANDS object (line 22-43)\nconst COMMANDS: Record\u003cstring, string\u003e = {\n  // ... existing ...\n  \"list-active\": \"List ashep-managed issues (open or in_progress)\",\n  \"list-hitl\": \"List issues requiring human-in-the-loop\",\n  \"list-ready\": \"List ashep-managed issues ready to work (open only)\",\n  \"list-struggle\": \"List problematic/struggling issues (blocked, stale)\",\n  // ... rest ...\n};\n// Update showHelp() to include new commands in examples\n// Update main() switch (after line 1433)\ncase \"list-active\":\n  await cmdListActive();\n  break;\ncase \"list-hitl\":\n  await cmdListHITL();\n  break;\ncase \"list-ready\":\n  await cmdListReady();\n  break;\ncase \"list-struggle\":\n  await cmdListStruggle(args[1] ? parseInt(args[1]) : undefined);\n  break;\n---\nStep 6: Documentation Updates\nFile: docs/cli-reference.md\nWhat: Document the 4 new commands\nWhy: Users need reference for usage and flags\nHow: Add section:\n Listing Commands\n ashep list-active\nList all ashep-managed issues that are currently active (open or in_progress status).\nUsage: ashep list-active\nExample:\n  $ ashep list-active\n  \n  Active Issues (3):\n  ┌─────────┬─────────────────────────────────┬──────────────┬─────────┬──────────────┐\n  │ ID      │ Title                           │ Phase        │ Priority │ Updated      │\n  ├─────────┼─────────────────────────────────┼──────────────┼─────────┼──────────────┤\n  │ bd-42   │ Fix authentication bug          │ implement    │ P1       │ 2m ago       │\n  │ bd-87   │ Add user settings             │ test         │ P2       │ 15m ago      │\n  └─────────┴─────────────────────────────────┴──────────────┴─────────┴──────────────┘\nDocument all 4 commands with examples\n**File:** `AGENTS.md`\n**What:** Update Beads Integration section to mention `ashep-managed` label\n**Why:** Maintain accurate documentation of system behavior\n**How:** Add note:\n```markdown\n### Beads Label System\nAgent Shepherd uses the following labels to track issue state:\n- `ashep-managed` - Indicates issue is managed by ashep (set once, kept until issue closed)\n- `ashep-phase:\u003cname\u003e` - Current workflow phase (e.g., ashep-phase:implement)\n- `ashep-hitl:\u003creason\u003e` - Human-in-the-loop state (e.g., ashep-hitl:approval)\nUseful commands:\n- `bd list --label ashep-managed` - See all managed issues\n- `ashep list-active` - See currently active work\n- `ashep list-hitl` - See issues needing human attention\n---\nStep 7: Testing\nWhat: Test label system and CLI commands\nWhy: Ensure implementation works as expected\nHow:\n- [ ] Create test issue: bd create --title \"Test\" --type task\n- [ ] Run worker: ashep work \u003cissue-id\u003e\n- [ ] Verify ashep-managed label added: bd label list \u003cissue-id\u003e\n- [ ] Test ashep list-active shows issue\n- [ ] Verify issue closed: check label removed\n- [ ] Test ashep list-hitl with HITL issue\n- [ ] Test ashep list-struggle with stale issue\n- [ ] Verify all commands handle empty results gracefully\n- [ ] Test table formatting with long titles, long IDs\n--- \n\nNote: In regards to the documentation ... the whole feature must be documented not just the cli commands, so the plan was not complete.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-09T03:51:45.098448+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T05:16:45.637159+01:00","closed_at":"2026-01-09T05:16:45.637159+01:00","close_reason":"Beads Status \u0026 Label System implementation completed"}
{"id":"agent-shepherd-75dkm.1","title":"Add Beads Label Functions","description":"File: src/core/beads.ts\nWhat: Add three new functions to manage ashep-managed label\nWhy: Worker needs to add/remove this label to mark issue ownership\nHow:\n// Add at end of file, before exports\n/**\n * Set ashep-managed label for an issue\n */\nexport async function setAshepManagedLabel(issueId: string): Promise\u003cvoid\u003e {\n  await addIssueLabel(issueId, \"ashep-managed\");\n}\n/**\n * Remove ashep-managed label from an issue\n */\nexport async function removeAshepManagedLabel(issueId: string): Promise\u003cvoid\u003e {\n  await removeIssueLabel(issueId, \"ashep-managed\");\n}\n/**\n * Check if issue has ashep-managed label\n */\nexport async function hasAshepManagedLabel(issueId: string): Promise\u003cboolean\u003e {\n  const labels = await getIssueLabels(issueId);\n  return labels.includes(\"ashep-managed\");\n}\nTests: \n- Manually add label to issue, verify function returns true\n- Manually remove label, verify function returns false\n- Test with issue that has no labels","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T03:51:48.984334+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:05:31.821666+01:00","closed_at":"2026-01-09T04:05:31.821666+01:00","close_reason":"Implemented Beads label functions: setAshepManagedLabel, removeAshepManagedLabel, hasAshepManagedLabel","dependencies":[{"issue_id":"agent-shepherd-75dkm.1","depends_on_id":"agent-shepherd-75dkm","type":"parent-child","created_at":"2026-01-09T03:51:49.001357+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-75dkm.2","title":"Worker Engine - Add Label on First Pickup","description":"File: src/core/worker-engine.ts\nWhat: Add ashep-managed label when worker first picks up an issue\nWhy: Mark issue as being managed by ashep, visible to humans via bd list --label ashep-managed\nHow: In processIssue() method, after line 151 (after setting phase label):\n// Check for existing phase label to resume from\nconst currentPhaseLabel = await getCurrentPhase(issue.id);\nlet phase: string;\nif (currentPhaseLabel \u0026\u0026 phases.includes(currentPhaseLabel)) {\n  phase = currentPhaseLabel;\n  console.log(`Resuming issue from phase '${phase}'`);\n} else {\n  phase = phases[0] || \"plan\";\n  await setPhaseLabel(issue.id, phase);\n}\n// NEW: Add ashep-managed label if not already present\nconst hasManagedLabel = await hasAshepManagedLabel(issue.id);\nif (!hasManagedLabel) {\n  await setAshepManagedLabel(issue.id);\n  console.log(`Added ashep-managed label to issue ${issue.id}`);\n}\nWhy this location: After phase label is set, ensures label exists before phase execution begins","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T03:51:51.735867+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:05:31.814629+01:00","closed_at":"2026-01-09T04:05:31.814629+01:00","close_reason":"Added ashep-managed label on first pickup in worker processIssue method","dependencies":[{"issue_id":"agent-shepherd-75dkm.2","depends_on_id":"agent-shepherd-75dkm","type":"parent-child","created_at":"2026-01-09T03:51:51.746461+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-75dkm.3","title":"Worker Engine - Remove Label on Close","description":"File: src/core/worker-engine.ts\nWhat: Remove ashep-managed label when issue is closed\nWhy: Clean up label when issue lifecycle ends (optional but good hygiene)\nHow: In applyTransition() method, modify case \"close\": (around line 561-567):\ncase \"close\":\n  await updateIssue(issueId, { status: \"closed\" });\n  // NEW: Remove ashep-managed label\n  await removeAshepManagedLabel(issueId);\n  await removePhaseLabels(issueId);\n  await clearHITLLabels(issueId);\n  console.log(`Closed issue: ${transition.reason}`);\n  break;\nWhy keep label in other transitions:\n- advance, retry, jump_back: Issue still managed, keep label\n- block: Issue still managed, keep label\n- Only remove on close (lifecycle complete)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T03:51:54.470082+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:05:31.843503+01:00","closed_at":"2026-01-09T04:05:31.843503+01:00","close_reason":"Removed ashep-managed label on close in worker applyTransition method","dependencies":[{"issue_id":"agent-shepherd-75dkm.3","depends_on_id":"agent-shepherd-75dkm","type":"parent-child","created_at":"2026-01-09T03:51:54.478044+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-75dkm.4","title":"Add New CLI Commands","description":"File: src/cli/index.ts\nWhat: Add 4 new commands for better visibility into managed issues\nWhy: Humans need to see active work, HITL items, ready work, and struggling issues\nHow: Implement 4 commands: list-active, list-hitl, list-ready, list-struggle with detailed table formatting and filtering logic.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T03:51:58.721475+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T05:16:45.431843+01:00","closed_at":"2026-01-09T05:16:45.431843+01:00","close_reason":"All new CLI commands have been added","dependencies":[{"issue_id":"agent-shepherd-75dkm.4","depends_on_id":"agent-shepherd-75dkm","type":"parent-child","created_at":"2026-01-09T03:51:58.726634+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-75dkm.4.1","title":"Implement ashep list-active command","description":"Implement the ashep list-active command to list all ashep-managed issues that are currently active (open or in_progress status).\n\nCode:\nasync function cmdListActive(): Promise\u003cvoid\u003e {\n  const proc = Bun.spawn([\n    \"bd\", \"list\", \n    \"--label\", \"ashep-managed\",\n    \"--status\", \"open,in_progress\",\n    \"--json\"\n  ], {\n    stdout: \"pipe\",\n    stderr: \"pipe\"\n  });\n  \n  const output = await new Response(proc.stdout).text();\n  const issues = JSON.parse(output);\n  \n  if (issues.length === 0) {\n    console.log(\"No active issues found.\");\n    return;\n  }\n  \n  console.log(`\\nActive Issues (${issues.length}):`);\n  console.log(\"┌─────────┬─────────────────────────────────┬──────────────┬─────────┬──────────────┐\");\n  console.log(\"│ ID      │ Title                           │ Phase        │ Priority │ Updated      │\");\n  console.log(\"├─────────┼─────────────────────────────────┼──────────────┼─────────┼──────────────┤\");\n  \n  for (const issue of issues) {\n    const phaseLabel = issue.labels?.find(l =\u003e l.startsWith(\"ashep-phase:\"));\n    const phase = phaseLabel?.replace(\"ashep-phase:\", \"\") || \"unknown\";\n    const updatedTime = new Date(issue.updated_at).toLocaleString();\n    \n    const title = issue.title.substring(0, 30) + (issue.title.length \u003e 30 ? \"...\" : \"\");\n    console.log(`│ ${issue.id.padEnd(7)} │ ${title.padEnd(31)} │ ${phase.padEnd(12)} │ ${ `P${issue.priority}`.padEnd(7)} │ ${updatedTime.padEnd(12)} │`);\n  }\n  \n  console.log(\"└─────────┴─────────────────────────────────┴──────────────┴─────────┴──────────────┘\");\n}","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T03:52:02.17017+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T05:16:45.173843+01:00","closed_at":"2026-01-09T05:16:45.173843+01:00","close_reason":"Implementation of ashep list-active command completed","dependencies":[{"issue_id":"agent-shepherd-75dkm.4.1","depends_on_id":"agent-shepherd-75dkm.4","type":"parent-child","created_at":"2026-01-09T03:52:02.179088+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-75dkm.4.2","title":"Implement ashep list-hitl command","description":"Implement the ashep list-hitl command to list issues requiring human-in-the-loop.\n\nCode:\nasync function cmdListHITL(): Promise\u003cvoid\u003e {\n  const proc = Bun.spawn([\"bd\", \"list\", \"--json\"], {\n    stdout: \"pipe\",\n    stderr: \"pipe\"\n  });\n  \n  const output = await new Response(proc.stdout).text();\n  const issues = JSON.parse(output);\n  \n  // Filter for issues with ashep-hitl: labels\n  const hitlIssues = issues.filter(issue =\u003e \n    issue.labels?.some(l =\u003e l.startsWith(\"ashep-hitl:\"))\n  );\n  \n  if (hitlIssues.length === 0) {\n    console.log(\"No HITL issues found.\");\n    return;\n  }\n  \n  console.log(`\\nHITL Issues (${hitlIssues.length}):`);\n  console.log(\"┌─────────┬─────────────────────────────────┬──────────────┬─────────┬──────────────────┐\");\n  console.log(\"│ ID      │ Title                           │ Reason       │ Phase    │ Status          │\");\n  \n  for (const issue of hitlIssues) {\n    const hitlLabel = issue.labels?.find(l =\u003e l.startsWith(\"ashep-hitl:\"));\n    const reason = hitlLabel?.replace(\"ashep-hitl:\", \"\") || \"unknown\";\n    const phaseLabel = issue.labels?.find(l =\u003e l.startsWith(\"ashep-phase:\"));\n    const phase = phaseLabel?.replace(\"ashep-phase:\", \"\") || \"unknown\";\n    const title = issue.title.substring(0, 30) + (issue.title.length \u003e 30 ? \"...\" : \"\");\n    \n    console.log(`│ ${issue.id.padEnd(7)} │ ${title.padEnd(31)} │ ${reason.padEnd(12)} │ ${phase.padEnd(8)} │ ${issue.status.padEnd(14)} │\");\n  }\n  \n  console.log(\"└─────────┴─────────────────────────────────┴──────────────┴─────────┴──────────────────┘\");\n}","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T03:52:05.50578+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T05:16:44.796426+01:00","closed_at":"2026-01-09T05:16:44.796426+01:00","close_reason":"Implementation of ashep list-hitl command completed","dependencies":[{"issue_id":"agent-shepherd-75dkm.4.2","depends_on_id":"agent-shepherd-75dkm.4","type":"parent-child","created_at":"2026-01-09T03:52:05.512294+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-75dkm.4.3","title":"Implement ashep list-ready command","description":"Implement the ashep list-ready command to list ashep-managed issues ready to work (open only).\n\nSimilar table format to list-active, displaying: ID, Title, Phase, Priority, Updated.\n\nCode:\nasync function cmdListReady(): Promise\u003cvoid\u003e {\n  const proc = Bun.spawn([\n    \"bd\", \"list\", \n    \"--label\", \"ashep-managed\",\n    \"--status\", \"open\",\n    \"--json\"\n  ], {\n    stdout: \"pipe\",\n    stderr: \"pipe\"\n  });\n  \n  const output = await new Response(proc.stdout).text();\n  const issues = JSON.parse(output);\n  \n  if (issues.length === 0) {\n    console.log(\"No ready issues found.\");\n    return;\n  }\n  \n  // Similar table format to list-active\n  // Display with: ID, Title, Phase, Priority, Updated\n}","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T03:52:07.994508+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T05:16:44.593372+01:00","closed_at":"2026-01-09T05:16:44.593372+01:00","close_reason":"Implementation of ashep list-ready command completed","dependencies":[{"issue_id":"agent-shepherd-75dkm.4.3","depends_on_id":"agent-shepherd-75dkm.4","type":"parent-child","created_at":"2026-01-09T03:52:08.016028+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-75dkm.4.4","title":"Implement ashep list-struggle command","description":"Implement the ashep list-struggle command to list problematic/struggling issues (blocked, stale).\n\nCode:\nasync function cmdListStruggle(hours?: number): Promise\u003cvoid\u003e {\n  const staleThresholdHours = hours || 24;\n  const staleCutoff = Date.now() - (staleThresholdHours * 60 * 60 * 1000);\n  \n  const proc = Bun.spawn([\"bd\", \"list\", \"--json\"], {\n    stdout: \"pipe\",\n    stderr: \"pipe\"\n  });\n  \n  const output = await new Response(proc.stdout).text();\n  const issues = JSON.parse(output);\n  \n  // Filter for ashep-managed issues that are:\n  // 1. Blocked status, OR\n  // 2. Has ashep-hitl: label, OR\n  // 3. Not updated in X hours\n  const strugglingIssues = issues.filter(issue =\u003e {\n    const isManaged = issue.labels?.includes(\"ashep-managed\");\n    if (!isManaged) return false;\n    \n    const isBlocked = issue.status === \"blocked\";\n    const hasHITL = issue.labels?.some(l =\u003e l.startsWith(\"ashep-hitl:\"));\n    const isStale = new Date(issue.updated_at).getTime() \u003c staleCutoff;\n    \n    return isBlocked || hasHITL || isStale;\n  });\n  \n  // Display with: ID, Title, Issue Type, Phase, Status, Age/Reason\n}","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T03:52:10.965966+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T05:16:44.38759+01:00","closed_at":"2026-01-09T05:16:44.38759+01:00","close_reason":"Implementation of ashep list-struggle command completed","dependencies":[{"issue_id":"agent-shepherd-75dkm.4.4","depends_on_id":"agent-shepherd-75dkm.4","type":"parent-child","created_at":"2026-01-09T03:52:10.989812+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-75dkm.5","title":"Update CLI Command Registry","description":"File: src/cli/index.ts\nWhat: Register new commands in COMMANDS object and main() switch\nWhy: Make commands discoverable and executable\nHow:\n// Update COMMANDS object (line 22-43)\nconst COMMANDS: Record\u003cstring, string\u003e = {\n  // ... existing ...\n  \"list-active\": \"List ashep-managed issues (open or in_progress)\",\n  \"list-hitl\": \"List issues requiring human-in-the-loop\",\n  \"list-ready\": \"List ashep-managed issues ready to work (open only)\",\n  \"list-struggle\": \"List problematic/struggling issues (blocked, stale)\",\n  // ... rest ...\n};\n// Update showHelp() to include new commands in examples\n// Update main() switch (after line 1433)\ncase \"list-active\":\n  await cmdListActive();\n  break;\ncase \"list-hitl\":\n  await cmdListHITL();\n  break;\ncase \"list-ready\":\n  await cmdListReady();\n  break;\ncase \"list-struggle\":\n  await cmdListStruggle(args[1] ? parseInt(args[1]) : undefined);\n  break;","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T03:52:13.386758+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:56:43.023149+01:00","closed_at":"2026-01-09T04:56:43.023149+01:00","close_reason":"Closed via update","dependencies":[{"issue_id":"agent-shepherd-75dkm.5","depends_on_id":"agent-shepherd-75dkm","type":"parent-child","created_at":"2026-01-09T03:52:13.408355+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-75dkm.6","title":"Documentation Updates","description":"Update documentation to reflect the new Beads Status \u0026 Label System feature.\n\nFiles to update:\n- docs/cli-reference.md: Document the 4 new commands with usage and examples\n- AGENTS.md: Update Beads Integration section to mention ashep-managed label and useful commands","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T03:52:15.270174+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:57:23.785961+01:00","closed_at":"2026-01-09T04:57:23.785961+01:00","close_reason":"Closed via update","dependencies":[{"issue_id":"agent-shepherd-75dkm.6","depends_on_id":"agent-shepherd-75dkm","type":"parent-child","created_at":"2026-01-09T03:52:15.292788+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-75dkm.6.1","title":"Update docs/cli-reference.md with new commands","description":"Add documentation for the 4 new CLI commands in docs/cli-reference.md.\n\nAdd section: Listing Commands\nashep list-active\nList all ashep-managed issues that are currently active (open or in_progress status).\nUsage: ashep list-active\nExample:\n  $ ashep list-active\n  \n  Active Issues (3):\n  ┌─────────┬─────────────────────────────────┬──────────────┬─────────┬──────────────┐\n  │ ID      │ Title                           │ Phase        │ Priority │ Updated      │\n  ├─────────┼─────────────────────────────────┼──────────────┼─────────┼──────────────┤\n  │ bd-42   │ Fix authentication bug          │ implement    │ P1       │ 2m ago       │\n  │ bd-87   │ Add user settings             │ test         │ P2       │ 15m ago      │\n  └─────────┴─────────────────────────────────┴──────────────┴─────────┴──────────────┘\n\nDocument all 4 commands with examples.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T03:52:18.837309+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:57:04.53709+01:00","closed_at":"2026-01-09T04:57:04.53709+01:00","close_reason":"Closed via update","dependencies":[{"issue_id":"agent-shepherd-75dkm.6.1","depends_on_id":"agent-shepherd-75dkm.6","type":"parent-child","created_at":"2026-01-09T03:52:18.859647+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-75dkm.6.2","title":"Update AGENTS.md Beads Integration section","description":"Update the Beads Integration section in AGENTS.md to mention the ashep-managed label.\n\nAdd note:\n### Beads Label System\nAgent Shepherd uses the following labels to track issue state:\n- `ashep-managed` - Indicates issue is managed by ashep (set once, kept until issue closed)\n- `ashep-phase:\u003cname\u003e` - Current workflow phase (e.g., ashep-phase:implement)\n- `ashep-hitl:\u003creason\u003e` - Human-in-the-loop state (e.g., ashep-hitl:approval)\nUseful commands:\n- `bd list --label ashep-managed` - See all managed issues\n- `ashep list-active` - See currently active work\n- `ashep list-hitl` - See issues needing human attention","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T03:52:20.907614+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:57:23.790974+01:00","closed_at":"2026-01-09T04:57:23.790974+01:00","close_reason":"Closed via update","dependencies":[{"issue_id":"agent-shepherd-75dkm.6.2","depends_on_id":"agent-shepherd-75dkm.6","type":"parent-child","created_at":"2026-01-09T03:52:20.927804+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-75dkm.7","title":"Testing","description":"Test the label system and CLI commands to ensure implementation works as expected.\n\nTesting Checklist:\n- [ ] Create test issue: bd create --title \"Test\" --type task\n- [ ] Run worker: ashep work \u003cissue-id\u003e\n- [ ] Verify ashep-managed label added: bd label list \u003cissue-id\u003e\n- [ ] Test ashep list-active shows issue\n- [ ] Verify issue closed: check label removed\n- [ ] Test ashep list-hitl with HITL issue\n- [ ] Test ashep list-struggle with stale issue\n- [ ] Verify all commands handle empty results gracefully\n- [ ] Test table formatting with long titles, long IDs","notes":"Starting testing phase. Will test: label addition, list commands, empty results handling, table formatting.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T03:52:22.840812+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T05:02:03.897477+01:00","closed_at":"2026-01-09T05:02:03.897477+01:00","close_reason":"Closed via update","dependencies":[{"issue_id":"agent-shepherd-75dkm.7","depends_on_id":"agent-shepherd-75dkm","type":"parent-child","created_at":"2026-01-09T03:52:22.862324+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-7614r","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:38:37.754983+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:38:37.875322+01:00","deleted_at":"2026-01-09T01:38:37.875322+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-769o","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T20:36:38.356192+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T20:36:38.484454+01:00","deleted_at":"2026-01-07T20:36:38.484454+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-7747","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:41:59.042061+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:41:59.105603+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T02:41:59.105603+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-77t3a","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-09T01:15:31.208976+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:31.284571+01:00","deleted_at":"2026-01-09T01:15:31.284571+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-7ag","title":"label-workflow-test: Custom workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-06T04:24:42.793001+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:29.096188+01:00","labels":["ashep-workflow:advanced"],"deleted_at":"2026-01-06T04:32:29.096188+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-7ax","title":"Update config.schema.json with fallback schema","description":"File: .agent-shepherd/schemas/config.schema.json\n\nTask: Add fallback object schema to the configuration schema\n\nRequired Changes:\n1. Add fallback object to the config schema with the following properties:\n   - enabled (boolean): Master switch for fallback system\n   - default_agent (string): Default fallback agent ID for all capabilities\n   - mappings (object): Optional capability-specific fallback agent mappings\n\n2. Mark the fallback object as optional for backward compatibility (older configs without fallback should still validate)\n\nSchema Structure:\n```json\n{\n  \"type\": \"object\",\n  \"properties\": {\n    \"fallback\": {\n      \"type\": \"object\",\n      \"description\": \"Fallback agent system configuration\",\n      \"properties\": {\n        \"enabled\": {\n          \"type\": \"boolean\",\n          \"description\": \"Master switch for fallback system. If false, no fallback anywhere.\"\n        },\n        \"default_agent\": {\n          \"type\": \"string\",\n          \"description\": \"Default fallback agent ID for all capabilities\"\n        },\n        \"mappings\": {\n          \"type\": \"object\",\n          \"description\": \"Optional capability-specific fallback agent mappings\",\n          \"additionalProperties\": {\n            \"type\": \"string\"\n          }\n        }\n      }\n    }\n  }\n}\n```\n\nAcceptance Criteria:\n- [ ] Schema validates correctly with fallback section\n- [ ] Schema validates correctly without fallback section (backward compatibility)\n- [ ] All fallback properties have proper types and descriptions\n- [ ] Mappings object allows string values (agent IDs)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T02:43:57.844618+01:00","updated_at":"2026-01-05T02:53:05.089726+01:00","closed_at":"2026-01-05T02:53:05.089726+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-7ax","depends_on_id":"agent-shepherd-uj0","type":"parent-child","created_at":"2026-01-05T02:45:00.501564+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-7bq","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:42:31.045855+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:42:31.11021+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-06T04:42:31.11021+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-7c9ah","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:17:05.782029+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:17:05.912064+01:00","deleted_at":"2026-01-08T23:17:05.912064+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-7cln","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:18:29.962025+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:18:30.139729+01:00","deleted_at":"2026-01-07T19:18:30.139729+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-7cto1","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:50:42.953066+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:50:43.127951+01:00","deleted_at":"2026-01-09T04:50:43.127951+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-7dga","title":"3.2.1 Design Dual Database Architecture","description":"Separate active and archive databases with different access patterns. Design active database for fast queries on recent data (30 days), archive database for slower but larger storage of historical data (30-365 days).","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:09:20.487599+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:12:28.303182+01:00","deleted_at":"2026-01-07T01:12:28.303182+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-7e32","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:31:18.99248+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:31:19.03373+01:00","deleted_at":"2026-01-07T18:31:19.03373+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-7eth","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T16:00:24.969321+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T16:00:25.029502+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-06T16:00:25.029502+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-7f4j","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T03:38:12.379095+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:38:12.423753+01:00","deleted_at":"2026-01-07T03:38:12.423753+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-7fy6","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-06T23:28:08.38528+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:28:08.878951+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-06T23:28:08.878951+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-7gt","title":"Agent Shepherd Installation \u0026 Distribution Refactor","description":"Refactor Agent Shepherd's installation and distribution system to support hybrid installations, cross-platform compatibility, and user-friendly installer scripts. This includes creating installer scripts for macOS/Linux and Windows, adding update/version commands, and implementing README symlink for GitHub visibility.","design":"Agent Shepherd - Installation \u0026 Distribution Refactor\nSession Summary\nThe Problem\nAgent Shepherd lives in .agent-shepherd/ by design - when installed in user projects, it should be a clean, self-contained dotfolder that doesn't pollute the user's repo. However, this creates a GitHub visibility problem: the README at .agent-shepherd/README.md is hidden because GitHub only shows READMEs at the repository root.\nWe explored several solutions:\n- Moving everything to repo root (rejected - would conflict with user's files when installed)\n- Two separate repos (rejected - unnecessary complexity)\n- Symlink + smart installer (chosen solution)\nThe Solution\n1. Symlink for GitHub visibility: Create README.md at repo root as a symlink to .agent-shepherd/README.md. GitHub renders symlinked READMEs, so visitors see the full documentation. The symlink is only in the development repo - users never get it.\n2. Smart installer: Instead of users cloning the whole repo, they run an installer script that copies ONLY .agent-shepherd/ to their project. This means:\n   - Users get a clean installation (just the dotfolder)\n   - No README conflict with their own project\n   - No dev files (openspec/, .beads/, etc.) polluting their repo\n3. Hybrid installation model: Users choose between:\n   - Hybrid: Binary in ~/.agent-shepherd/, config per-project in ./.agent-shepherd/config/\n   - Local: Everything self-contained in ./.agent-shepherd/\n4. Command linking options: Users choose whether to:\n   - Global link: ashep command available everywhere (convenient, single version)\n   - No link: Run via bunx ashep or explicit path (supports multiple versions)\n5. Versioning via GitHub releases: Tags like v1.0.0 enable:\n   - Installing specific versions\n   - ashep update / ashep update v1.2.0 for upgrades/downgrades\n   - Version tracking in ~/.agent-shepherd/VERSION\n6. Cross-platform support: Two installers (bash + PowerShell) plus fixes to the codebase to replace Unix-specific commands with Node APIs.\nWhy This Approach?\n| Decision | Why |\n|----------|-----|\n| Symlink README | Single source of truth, visible on GitHub, not shipped to users |\n| Installer script | Users get only what they need, clean project |\n| Hybrid option | Shared binary saves disk space, per-project config makes sense |\n| Local option | Self-contained projects that work when cloned |\n| Dual installers | Windows and macOS/Linux have different shells |\n| ashep update | Easy maintenance, version pinning for stability |\nCurrent Windows Compatibility Issues\nThe codebase has Unix-specific commands that break on Windows:\n- cp -r → needs fs.cpSync()\n- rm -rf → needs fs.rmSync()\n- $HOME → needs os.homedir()\n- curl | bash for Beads install → needs OS detection\n---\nImplementation Plan\nPhase 1: Cross-Platform Fixes\nGoal: Make current code work on Windows\nFile: .agent-shepherd/src/cli/index.ts\n1. Add imports:\nimport { cpSync, rmSync } from \"fs\";\nimport { homedir, platform } from \"os\";\n2. Replace shell commands:\n   - Line 667: execSync(\\cp -r ...\\`) → cpSync(source, dest, { recursive: true })`\n   - Line 755: execSync(\\rm -rf ...\\`) → rmSync(path, { recursive: true, force: true })`\n   - Line 792: process.env.HOME → homedir()\n3. OS-aware Beads installation in quickstart:\nif (platform() === \"win32\") {\n  console.log(\"Please install Beads manually: https://get.beads.dev\");\n} else {\n  execSync(\"curl -fsSL https://get.beads.dev | bash\", { stdio: \"inherit\" });\n}\n---\nPhase 2: Hybrid Installation Support\nGoal: Support global install + local config\nFile: .agent-shepherd/src/core/path-utils.ts\nReplace current implementation with:\nimport { existsSync } from \"fs\";\nimport { join, dirname } from \"path\";\nimport { homedir } from \"os\";\nexport function getGlobalInstallDir(): string {\n  return join(homedir(), \".agent-shepherd\");\n}\nexport function findLocalAgentShepherdDir(): string | null {\n  let currentDir = process.cwd();\n  while (true) {\n    const agentShepherdDir = join(currentDir, \".agent-shepherd\");\n    if (existsSync(agentShepherdDir)) {\n      return agentShepherdDir;\n    }\n    const parentDir = dirname(currentDir);\n    if (parentDir === currentDir) break;\n    currentDir = parentDir;\n  }\n  return null;\n}\nexport function findInstallDir(): string {\n  // Check for local full install (has src/)\n  const local = findLocalAgentShepherdDir();\n  if (local \u0026\u0026 existsSync(join(local, \"src\"))) {\n    return local;\n  }\n  // Fall back to global\n  const global = getGlobalInstallDir();\n  if (existsSync(global)) {\n    return global;\n  }\n  throw new Error(\"Agent Shepherd not installed. Run the installer or 'ashep init'\");\n}\nexport function findConfigDir(): string {\n  // Check for local config\n  const local = findLocalAgentShepherdDir();\n  if (local \u0026\u0026 existsSync(join(local, \"config\"))) {\n    return join(local, \"config\");\n  }\n  // Fall back to global config\n  const global = getGlobalInstallDir();\n  const globalConfig = join(global, \"config\");\n  if (existsSync(globalConfig)) {\n    return globalConfig;\n  }\n  throw new Error(\"No configuration found. Run 'ashep init' in your project.\");\n}\nexport function findPluginsDir(): string {\n  const local = findLocalAgentShepherdDir();\n  if (local \u0026\u0026 existsSync(join(local, \"plugins\"))) {\n    return join(local, \"plugins\");\n  }\n  const global = getGlobalInstallDir();\n  return join(global, \"plugins\");\n}\n// Legacy function - backward compatibility\nexport function findAgentShepherdDir(): string {\n  const local = findLocalAgentShepherdDir();\n  if (local) return local;\n  const global = getGlobalInstallDir();\n  if (existsSync(global)) return global;\n  throw new Error(\".agent-shepherd directory not found. Run the installer or 'ashep init'\");\n}\nUpdate files using path-utils:\n- src/core/config.ts\n- src/core/config-validator.ts\n- src/core/agent-registry.ts\n- src/core/policy.ts\n- src/cli/index.ts\n---\nPhase 3: Installer Scripts\nGoal: Create platform-specific installers\nFile: .agent-shepherd/install.sh (macOS/Linux)\n#!/bin/bash\nset -e\nVERSION=\"${1:-latest}\"\nREPO_URL=\"https://github.com/USER/agent-shepherd.git\"\necho \"Agent Shepherd Installer\"\necho \"========================\"\necho \"\"\necho \"1. Where should Agent Shepherd be installed?\"\necho \"\"\necho \"   [H] Hybrid (recommended)\"\necho \"       Binary: ~/.agent-shepherd/\"\necho \"       Config: per-project (./.agent-shepherd/config/)\"\necho \"\"\necho \"   [L] Local (self-contained)\"\necho \"       Everything: ./.agent-shepherd/\"\necho \"\"\nread -p \"\u003e \" INSTALL_MODE\nif [[ \"$INSTALL_MODE\" =~ ^[Ll]$ ]]; then\n  INSTALL_DIR=\"$(pwd)/.agent-shepherd\"\n  echo \"Installing locally to: $INSTALL_DIR\"\nelse\n  INSTALL_DIR=\"$HOME/.agent-shepherd\"\n  echo \"Installing globally to: $INSTALL_DIR\"\nfi\necho \"\"\necho \"2. How do you want to run 'ashep'?\"\necho \"\"\necho \"   [G] Global link (recommended)\"\necho \"       Run 'ashep' from anywhere\"\necho \"\"\necho \"   [N] No global link\"\necho \"       Run via: bunx ashep\"\necho \"\"\nread -p \"\u003e \" LINK_MODE\n# Clone to temp\nTEMP_DIR=$(mktemp -d)\necho \"\"\necho \"Downloading Agent Shepherd${VERSION:+ $VERSION}...\"\nif [ \"$VERSION\" = \"latest\" ]; then\n  git clone --depth 1 \"$REPO_URL\" \"$TEMP_DIR\" 2\u003e/dev/null\nelse\n  git clone --depth 1 --branch \"$VERSION\" \"$REPO_URL\" \"$TEMP_DIR\" 2\u003e/dev/null\nfi\n# Backup existing config/plugins if upgrading\nif [ -d \"$INSTALL_DIR/config\" ]; then\n  echo \"Backing up existing config...\"\n  cp -r \"$INSTALL_DIR/config\" \"$TEMP_DIR/config-backup\"\nfi\nif [ -d \"$INSTALL_DIR/plugins\" ]; then\n  echo \"Backing up existing plugins...\"\n  cp -r \"$INSTALL_DIR/plugins\" \"$TEMP_DIR/plugins-backup\"\nfi\n# Remove old installation (preserve config/plugins/logs)\nif [ -d \"$INSTALL_DIR\" ]; then\n  find \"$INSTALL_DIR\" -mindepth 1 -maxdepth 1 \\\n    ! -name 'config' ! -name 'plugins' ! -name 'logs' \\\n    -exec rm -rf {} +\nfi\n# Copy new installation\nmkdir -p \"$INSTALL_DIR\"\ncp -r \"$TEMP_DIR/.agent-shepherd/\"* \"$INSTALL_DIR/\"\n# Restore backups\n[ -d \"$TEMP_DIR/config-backup\" ] \u0026\u0026 cp -r \"$TEMP_DIR/config-backup\" \"$INSTALL_DIR/config\"\n[ -d \"$TEMP_DIR/plugins-backup\" ] \u0026\u0026 cp -r \"$TEMP_DIR/plugins-backup\" \"$INSTALL_DIR/plugins\"\n# Store version\necho \"$VERSION\" \u003e \"$INSTALL_DIR/VERSION\"\n# Install dependencies\necho \"Installing dependencies...\"\ncd \"$INSTALL_DIR\"\nbun install\n# Link globally if requested\nif [[ \"$LINK_MODE\" =~ ^[Gg]$ ]]; then\n  echo \"Linking ashep command globally...\"\n  bun link\nfi\n# Cleanup\nrm -rf \"$TEMP_DIR\"\necho \"\"\necho \"✅ Agent Shepherd installed!\"\necho \"\"\nif [[ ! \"$INSTALL_MODE\" =~ ^[Ll]$ ]]; then\n  echo \"Run 'ashep init' in your project to create local config.\"\nfi\nFile: .agent-shepherd/install.ps1 (Windows)\nSimilar logic in PowerShell syntax (see full implementation plan above).\n---\nPhase 4: Update \u0026 Version Commands\nGoal: Add ashep update and ashep version\nFile: .agent-shepherd/src/cli/index.ts\nAdd to COMMANDS:\nconst COMMANDS: Record\u003cstring, string\u003e = {\n  // ... existing\n  update: \"Update Agent Shepherd to latest or specific version\",\n  version: \"Show installed version\",\n};\nAdd functions:\n- cmdUpdate(version?: string) - Downloads new version, preserves config/plugins, reinstalls\n- cmdVersion() - Reads VERSION file or package.json version\n- getCurrentVersion() - Helper to get current version\nAdd to switch statement:\ncase \"update\":\n  await cmdUpdate(args[1]);\n  break;\ncase \"version\":\n  cmdVersion();\n  break;\n---\nPhase 5: README Symlink\nGoal: GitHub shows README on repo landing page\ncd /Users/tonyhartmann/DevShare/JS/agent-shepherd\nln -s .agent-shepherd/README.md README.md\ngit add README.md\ngit commit -m \"Add symlink to README for GitHub visibility\"\n---\nPhase 6: Update ashep init\nGoal: ashep init creates only local config (for hybrid mode)\nModify cmdInit() to always create ./.agent-shepherd/config/ in current directory, regardless of whether global install exists.\n---\nPhase 7: Documentation Updates\nGoal: Update installation docs\nUpdate .agent-shepherd/README.md with new installation instructions:\n- Quick install via curl/irm\n- Hybrid vs Local explanation\n- Update command usage\n- Developer setup (git clone for contributors)\n---\nExecution Order\n1. Phase 1 - Cross-platform fixes (unblocks Windows)\n2. Phase 5 - README symlink (quick win for GitHub visibility)\n3. Phase 2 - Hybrid path resolution (core architecture change)\n4. Phase 3 - Installer scripts (user experience)\n5. Phase 4 - Update command (maintenance)\n6. Phase 6 - Update init command (polish)\n7. Phase 7 - Documentation (finalize)","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-30T03:18:55.493804+01:00","created_by":"tonyhartmann","updated_at":"2025-12-30T03:36:50.738061+01:00","closed_at":"2025-12-30T03:36:50.738061+01:00","close_reason":"Closed via update"}
{"id":"agent-shepherd-7i5is","title":"Implement Worker Assistant Feature","description":"Add a worker assistant agent that provides AI assistance for interpreting complex agent outcomes when the worker engine's deterministic logic cannot determine clear advance/retry/block actions.\n\n## Scratchpad\n### Problem Statement\nThe worker engine processes agent outcomes using deterministic if-else logic, but sometimes receives complex outputs where success/failure isn't clear-cut. Need AI assistance to interpret nuanced results and make basic decisions: advance, retry, or block.\n\n### Rationale\nSpawn a ashep-worker-daemon-assistant agent when worker logic reaches an 'uncertain' state. Provides safety net without complicating existing transition system.\n\n### Benefits\n- Handles ambiguous agent outputs\n- Keeps worker logic simple\n- Full compatibility with existing system\n- Minimal performance impact (triggered only when needed)\n\n### Feature Scope\n- New agent capability: worker-assistant\n- Trigger detection in worker engine\n- Simple prompt/response format (ADVANCE/RETRY/BLOCK)\n- Integration with decision logging\n\n### Technical Implementation Details\n- Trigger when outcome is ambiguous or no transition rules match\n- Execute assistant agent with structured prompt\n- Parse response and convert to transition\n- Log decisions for observability\n\n### Configuration\n- workerAssistant.enabled: false (default)\n- Per-policy opt-out\n- Timeout and fallback settings\n\n### Testing\n- Unit tests for trigger conditions and response parsing\n- Integration tests with complex outcomes\n- Performance impact measurement\n\n### Documentation\n- Update config docs\n- Add agent capability docs\n- Update AGENTS.md\n\n### Implementation Steps\n1. Add agent capability to agents.yaml\n2. Implement trigger detection in worker-engine.ts\n3. Add assistant execution logic with prompt/response parsing\n4. Integrate decision logging\n5. Add configuration support with opt-out\n6. Write tests and update docs\n7. Test with validator agent outputs\n8. Handle edge cases and error handling\n\nWhen assigned this epic, consume the overall context and select the next available child issue to work on, rather than working on the epic directly.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-10T00:27:53.78011+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:38:13.470772+01:00","closed_at":"2026-01-11T00:38:13.470772+01:00","close_reason":"Closed"}
{"id":"agent-shepherd-7i5is.1","title":"Add worker-assistant capability to agents.yaml","description":"Add the new 'worker-assistant' capability to the agents configuration. This capability will be used to select agents that can provide assistance for interpreting complex agent outcomes.\n\nUpdate config/agents.yaml to include agents with this capability that can respond to worker assistant prompts.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T00:27:56.343364+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T23:59:39.697385+01:00","closed_at":"2026-01-10T23:59:39.697385+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-7i5is.1","depends_on_id":"agent-shepherd-7i5is","type":"parent-child","created_at":"2026-01-10T00:27:56.349105+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-7i5is.10","title":"Integrate worker assistant into processIssue method","description":"Add the integration point in the processIssue method of worker-engine.ts:\n\nAfter agent execution, before determineTransition:\nif (this.shouldTriggerWorkerAssistant(outcome, phase)) {\n  const directive = await this.executeWorkerAssistant(issue.id, outcome, phase);\n  \n  // Log the assistant decision\n  this.logger.logDecision({...});\n  \n  // Convert directive to transition\n  switch (directive) {\n    case 'advance': transition = await this.policyEngine.determineTransition(...); break;\n    case 'retry': transition = { type: 'retry', reason: 'Assistant recommended retry' }; break;\n    case 'block': transition = { type: 'block', reason: 'Assistant recommended human review' }; break;\n  }\n} else {\n  // Normal processing\n  transition = await this.policyEngine.determineTransition(...);\n}\n\nThis ties together all the components into the main workflow.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T00:28:10.247681+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:26:22.940905+01:00","closed_at":"2026-01-11T00:26:22.940905+01:00","close_reason":"Closed via update","dependencies":[{"issue_id":"agent-shepherd-7i5is.10","depends_on_id":"agent-shepherd-7i5is","type":"parent-child","created_at":"2026-01-10T00:28:10.25154+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-7i5is.2","title":"Implement trigger detection logic in worker-engine.ts","description":"Add the shouldTriggerWorkerAssistant method to worker-engine.ts that detects when worker logic cannot determine a clear action from agent outcomes.\n\nTrigger conditions:\n- Complex structured output (like validator reports)\n- outcome.success = true but warnings indicate issues\n- No matching transition rules configured\n\nMethod signature: private shouldTriggerWorkerAssistant(outcome: RunOutcome, phase: string): boolean","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T00:27:58.237948+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:06:22.373433+01:00","closed_at":"2026-01-11T00:06:22.373433+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-7i5is.2","depends_on_id":"agent-shepherd-7i5is","type":"parent-child","created_at":"2026-01-10T00:27:58.238722+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-7i5is.3","title":"Implement assistant execution logic with prompt/response parsing","description":"Add the executeWorkerAssistant method to worker-engine.ts that:\n1. Selects an agent with worker-assistant capability\n2. Builds the assistant prompt with issue details, phase, and outcome\n3. Executes the agent via opencode.runAgentCLI\n4. Parses the response (ADVANCE/RETRY/BLOCK) and returns the directive\n\nPrompt format: Structured prompt asking for one-word response based on issue context.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T00:28:00.018765+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:06:22.378751+01:00","closed_at":"2026-01-11T00:06:22.378751+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-7i5is.3","depends_on_id":"agent-shepherd-7i5is","type":"parent-child","created_at":"2026-01-10T00:28:00.025968+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-7i5is.4","title":"Integrate decision logging for observability","description":"Add logging of assistant decisions in the processIssue method integration point. Log the assistant's directive, reasoning, and outcome summary using the existing logger.logDecision method.\n\nInclude metadata about the outcome that triggered the assistant.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T00:28:01.578417+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:06:22.377836+01:00","closed_at":"2026-01-11T00:06:22.377836+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-7i5is.4","depends_on_id":"agent-shepherd-7i5is","type":"parent-child","created_at":"2026-01-10T00:28:01.583401+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-7i5is.5","title":"Add configuration support with opt-out options","description":"Add workerAssistant configuration section to config/config.yaml:\n- enabled: false (default)\n- agentCapability: 'worker-assistant'\n- timeoutMs: 10000\n- fallbackAction: 'block'\n\nAdd per-policy opt-out in policies.yaml:\npolicies:\n  my-policy:\n    worker_assistant:\n      enabled: false\n\nUpdate config validation schemas accordingly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T00:28:02.899069+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:06:22.378579+01:00","closed_at":"2026-01-11T00:06:22.378579+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-7i5is.5","depends_on_id":"agent-shepherd-7i5is","type":"parent-child","created_at":"2026-01-10T00:28:02.904118+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-7i5is.6","title":"Write unit and integration tests","description":"Add comprehensive tests in tests/worker-engine.test.ts:\n- Mock assistant agent responses\n- Test trigger conditions with various outcome types\n- Verify logging and transition mapping\n- Test configuration loading and opt-out behavior\n\nAdd integration tests for full workflow with complex outputs and timeout scenarios.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T00:28:04.566148+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:26:22.965496+01:00","closed_at":"2026-01-11T00:26:22.965496+01:00","close_reason":"Closed via update","dependencies":[{"issue_id":"agent-shepherd-7i5is.6","depends_on_id":"agent-shepherd-7i5is","type":"parent-child","created_at":"2026-01-10T00:28:04.571904+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-7i5is.7","title":"Update documentation for worker assistant feature","description":"Update relevant documentation files:\n- docs/config-config.md: Add workerAssistant section\n- docs/agents-config.md: Document worker-assistant capability\n- AGENTS.md: Add section explaining the worker assistant feature and its role\n\nEnsure all configuration options and usage are documented.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T00:28:05.747953+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:26:22.969402+01:00","closed_at":"2026-01-11T00:26:22.969402+01:00","close_reason":"Closed via update","dependencies":[{"issue_id":"agent-shepherd-7i5is.7","depends_on_id":"agent-shepherd-7i5is","type":"parent-child","created_at":"2026-01-10T00:28:05.752448+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-7i5is.8","title":"Test with validator agent outputs","description":"Test the worker assistant feature with real validator agent outputs that produce complex structured results. Verify that the assistant correctly interprets these outputs and provides appropriate ADVANCE/RETRY/BLOCK directives.\n\nEnsure the feature works end-to-end with actual agent execution scenarios.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T00:28:07.107191+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:26:22.966729+01:00","closed_at":"2026-01-11T00:26:22.966729+01:00","close_reason":"Closed via update","dependencies":[{"issue_id":"agent-shepherd-7i5is.8","depends_on_id":"agent-shepherd-7i5is","type":"parent-child","created_at":"2026-01-10T00:28:07.112877+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-7i5is.9","title":"Handle edge cases and error handling","description":"Implement robust error handling for edge cases:\n- Assistant unavailable: Fallback to 'block' for human review\n- Invalid response: Parse strictly, fallback on error\n- Timeout: Cancel after 10 seconds and fallback\n- Performance: Ensure only triggered for truly uncertain cases (\u003c5% of runs)\n\nAdd proper error logging and graceful degradation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T00:28:08.505625+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:26:22.949806+01:00","closed_at":"2026-01-11T00:26:22.949806+01:00","close_reason":"Closed via update","dependencies":[{"issue_id":"agent-shepherd-7i5is.9","depends_on_id":"agent-shepherd-7i5is","type":"parent-child","created_at":"2026-01-10T00:28:08.50969+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-7ig","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:34:14.472573+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:14.509106+01:00","deleted_at":"2026-01-06T04:34:14.509106+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-7jyu","title":"3.1 Implement Garbage Collection with Retention Policies","description":"Implement comprehensive garbage collection system with configurable retention policies to manage database size and maintain performance. Includes retention policy interface, configuration, archival methods, deletion logic, startup cleanup, scheduled cleanup, size limit enforcement, and cleanup metrics tracking.","status":"tombstone","priority":2,"issue_type":"epic","created_at":"2026-01-07T01:08:58.00323+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:12:28.950967+01:00","deleted_at":"2026-01-07T01:12:28.950967+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"agent-shepherd-7kacr","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:39:39.990298+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:39:40.101136+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T04:39:40.101136+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-7l13","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T21:46:05.16539+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:46:05.29926+01:00","deleted_at":"2026-01-07T21:46:05.29926+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-7mx","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:35:53.847635+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:35:53.907579+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-06T04:35:53.907579+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-7n9yo","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:08:08.359679+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:08:08.572773+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-11T00:08:08.572773+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-7nmuo","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:11:01.880382+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:11:01.959059+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T20:11:01.959059+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-7ouo","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:33:45.774443+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:45.87853+01:00","deleted_at":"2026-01-07T18:33:45.87853+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-7qni","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:26:23.83197+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:26:23.894541+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T14:26:23.894541+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-7smr","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T04:53:56.767888+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T04:53:57.188636+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T04:53:57.188636+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-7ss","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:34:14.536304+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:14.635945+01:00","deleted_at":"2026-01-06T04:34:14.635945+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-7sw92","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-08T23:17:04.634468+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:17:04.701744+01:00","deleted_at":"2026-01-08T23:17:04.701744+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-7t3r","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T19:00:16.363184+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:00:16.764849+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T19:00:16.764849+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-7ts9","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:32:18.501203+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:32:18.567252+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T14:32:18.567252+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-7tz","title":"Test Beads Integration","description":"Testing the Beads sync functionality.\n\n- Test converter and sync scripts.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-19T03:57:33.136202+01:00","updated_at":"2025-12-19T04:02:51.934268+01:00","deleted_at":"2025-12-19T04:02:51.934268+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-7vin","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:31:18.478174+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:31:18.592958+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T18:31:18.592958+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-7wi9","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T05:46:21.143342+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:46:21.240223+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T05:46:21.240223+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-7xe9a","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:24:04.646213+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:24:04.742927+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-09T01:24:04.742927+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-7y941","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T20:06:41.820601+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:06:42.268529+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T20:06:42.268529+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-7yku5","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:43:41.874972+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:43:41.945777+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-08T23:43:41.945777+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-7yt4","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T05:04:23.179678+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:04:23.246447+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T05:04:23.246447+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-7yzx","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T19:03:08.376652+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:03:08.818715+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T19:03:08.818715+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-7z55n","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:15:57.606573+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:57.688336+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T01:15:57.688336+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-809u","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:58:05.022249+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:58:05.199937+01:00","deleted_at":"2026-01-06T15:58:05.199937+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-80ce","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:33:22.613043+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:22.792794+01:00","deleted_at":"2026-01-07T18:33:22.792794+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-81uc","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T18:24:24.34601+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:24:24.848947+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T18:24:24.848947+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-826e6","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:38:37.35907+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:38:37.552094+01:00","deleted_at":"2026-01-09T01:38:37.552094+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-82kp","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:41:58.730434+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:41:58.797046+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T02:41:58.797046+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-82wqd","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-10T00:11:58.149141+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T00:11:58.265273+01:00","deleted_at":"2026-01-10T00:11:58.265273+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-82x","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-06T04:35:53.651465+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:35:53.711481+01:00","deleted_at":"2026-01-06T04:35:53.711481+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-834","title":"Phase 1: Infrastructure - Foundation","description":"**Effort:** ~4 hours | **Risk:** Low\n\nAdd label fetching and management capabilities to Beads integration.\n\n## Tasks\n\n1. Update BeadsIssue interface to include `labels?: string[]` field\n2. Implement `getIssueLabels(issueId: string)` function\n3. Implement `updateIssueLabels(issueId, addLabels, removeLabels)` function\n4. Implement `addIssueLabel(issueId, label)` helper\n5. Implement `removeIssueLabel(issueId, label)` helper\n6. Update `getIssue()` to include labels in returned object\n7. Update `getReadyIssues()` to include labels for all issues\n8. Write unit tests for all label functions\n\n## Files Modified\n- `.agent-shepherd/src/core/beads.ts`\n- `tests/beads-labels.test.ts` (new file)\n\n## Acceptance Criteria\n- [ ] BeadsIssue.labels field exists in interface\n- [ ] getIssueLabels() returns array of label strings\n- [ ] updateIssueLabels() adds and removes labels correctly\n- [ ] getIssue() includes labels in returned object\n- [ ] getReadyIssues() includes labels for all issues\n- [ ] All label functions handle errors gracefully\n- [ ] Unit tests cover all label functions\n\n## Code Preview\n```typescript\n// Add to BeadsIssue interface\nexport interface BeadsIssue {\n  id: string;\n  title: string;\n  description: string;\n  status: \"open\" | \"in_progress\" | \"blocked\" | \"closed\";\n  priority: number;\n  issue_type: string;\n  labels?: string[];  // NEW\n  created_at: string;\n  updated_at: string;\n  dependency_count?: number;\n  dependent_count?: number;\n}\n\nasync function getIssueLabels(issueId: string): Promise\u003cstring[]\u003e {\n  try {\n    const proc = Bun.spawn([\"bd\", \"list\", \"--labels\", \"--json\"], {\n      stdout: \"pipe\",\n      stderr: \"pipe\",\n    });\n    \n    const output = await new Response(proc.stdout).text();\n    const exitCode = await proc.exited;\n    \n    if (exitCode !== 0) {\n      return [];\n    }\n    \n    const allLabels = JSON.parse(output);\n    const issueLabels = allLabels.filter((l: any) =\u003e l.issue_id === issueId);\n    return issueLabels.map((l: any) =\u003e l.label);\n  } catch (error) {\n    console.error(`Failed to fetch labels for ${issueId}:`, error);\n    return [];\n  }\n}\n```","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T17:08:05.690307+01:00","updated_at":"2026-01-05T17:22:58.47874+01:00","close_reason":"Removed as requested by user","dependencies":[{"issue_id":"agent-shepherd-834","depends_on_id":"agent-shepherd-3of","type":"parent-child","created_at":"2026-01-05T17:08:09.143963+01:00","created_by":"daemon"}],"deleted_at":"2026-01-05T17:22:58.47874+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-83f7","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:32:18.183309+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:32:18.3529+01:00","deleted_at":"2026-01-07T14:32:18.3529+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-84b68","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:39:43.161409+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:39:43.371766+01:00","labels":["label2","label3"],"deleted_at":"2026-01-09T04:39:43.371766+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-84rq","title":"2.2.5 Update determineTransition() to Use Conditional Transitions","description":"Modify determineTransition() to check for transitions block first, use conditional routing when available, fall back to default linear behavior. Maintain 100% backward compatibility.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-07T00:05:22.771273+01:00","updated_at":"2026-01-07T00:06:15.832092+01:00","deleted_at":"2026-01-07T00:06:15.832092+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-85a4","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:58:05.650715+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:58:05.692596+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-06T15:58:05.692596+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-864h","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T20:36:38.169769+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T20:36:38.320096+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T20:36:38.320096+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-86qp","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:30:21.041556+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:30:21.10729+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T14:30:21.10729+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-87yq","title":"2.1 Extend Transition Types","description":"Analyze current transition system limitations and extend with new transition types (jump_back, dynamic_decision) for more flexible workflows.\n\n## Scope\n- Analyze current transition types and their limitations\n- Design enhanced PhaseTransition interface with new types\n- Implement determineTransition() enhancements\n- Add transition validation for safety\n- Update worker engine to handle new transition types\n- Add comprehensive unit tests\n\n## Subtasks\n- Analyze Current Transition System\n- Design Enhanced Transition Interface  \n- Implement determineTransition() Enhancements\n- Add Transition Validation\n- Update Worker Engine Transition Handling\n- Add Unit Tests for Transition Logic","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-07T00:04:41.868812+01:00","updated_at":"2026-01-07T00:06:15.832092+01:00","deleted_at":"2026-01-07T00:06:15.832092+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-88r","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:42:32.220922+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:42:32.323705+01:00","deleted_at":"2026-01-06T04:42:32.323705+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-8aj9","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T03:43:28.424235+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:43:28.531088+01:00","deleted_at":"2026-01-07T03:43:28.531088+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-8avd","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T03:43:27.6091+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:43:27.652081+01:00","deleted_at":"2026-01-07T03:43:27.652081+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-8bkyl","title":"Test ashep-managed label functionality","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T04:57:35.075964+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T05:01:25.726722+01:00","closed_at":"2026-01-09T05:01:25.726722+01:00","close_reason":"Test completed","labels":["ashep-managed","ashep-phase:implement"]}
{"id":"agent-shepherd-8cm64","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T05:10:40.932818+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T05:10:41.051448+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-09T05:10:41.051448+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-8de","title":"2. Core Modules","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-19T03:51:59.601223+01:00","updated_at":"2025-12-19T04:02:51.934268+01:00","deleted_at":"2025-12-19T04:02:51.934268+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-8dmt7","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:46:37.973694+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:46:38.160846+01:00","deleted_at":"2026-01-09T20:46:38.160846+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-8drw","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:58:04.461357+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:58:04.521988+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-06T15:58:04.521988+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-8e2y","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T05:04:24.118332+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:04:24.231012+01:00","deleted_at":"2026-01-07T05:04:24.231012+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-8gcu9","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:49:41.384029+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:49:41.58781+01:00","deleted_at":"2026-01-09T04:49:41.58781+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-8inz6","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:20:29.928853+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:30.029586+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-09T01:20:30.029586+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-8k6y9","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:52:30.370438+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:52:30.672946+01:00","deleted_at":"2026-01-11T00:52:30.672946+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-8kut","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T06:03:26.092653+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T06:03:26.156836+01:00","deleted_at":"2026-01-07T06:03:26.156836+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-8m15","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:00:15.67293+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:00:15.753574+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T19:00:15.753574+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-8m7","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:35:54.517052+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:35:54.558506+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-06T04:35:54.558506+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-8mf6","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T05:56:18.828037+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:56:18.873297+01:00","deleted_at":"2026-01-08T05:56:18.873297+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-8msa4","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:50:40.894833+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:50:41.026605+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-09T04:50:41.026605+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-8mzw","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T05:56:17.480598+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:56:17.550572+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-08T05:56:17.550572+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-8ox5w","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:46:38.813792+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:46:38.931418+01:00","deleted_at":"2026-01-09T20:46:38.931418+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-8rdiw","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:52:32.380045+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:52:32.684422+01:00","deleted_at":"2026-01-11T00:52:32.684422+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-8rjma","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:13:53.91315+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:13:53.981141+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-09T01:13:53.981141+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-8rrwz","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T01:13:52.603334+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:13:52.678228+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-09T01:13:52.678228+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-8s11","title":"3.3.1 Comprehensive Field Extraction","description":"Parse all available fields from OpenCode JSON output. Extract session metadata, agent information, message history, tool calls, file operations, token usage, error details, and warnings.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:09:39.42249+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:12:27.938938+01:00","deleted_at":"2026-01-07T01:12:27.938938+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-8s2j","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T05:46:21.60653+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:46:21.652718+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T05:46:21.652718+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-8tup","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T14:26:23.922739+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:26:23.985755+01:00","deleted_at":"2026-01-07T14:26:23.985755+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-8txx","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:03:08.848339+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:03:08.988069+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T19:03:08.988069+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-8xg2w","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T01:15:57.723981+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:57.801318+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-09T01:15:57.801318+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-8xhs","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T05:04:23.277244+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:04:23.47059+01:00","deleted_at":"2026-01-07T05:04:23.47059+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-8xrc3","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T05:10:43.640888+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T05:10:43.839874+01:00","deleted_at":"2026-01-09T05:10:43.839874+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-8xwq8","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T04:41:43.707237+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:41:44.413594+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T04:41:44.413594+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-8zbv","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:00:16.223215+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:00:16.333459+01:00","deleted_at":"2026-01-07T19:00:16.333459+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-8zesh","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:15:59.954257+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:16:00.106926+01:00","labels":["label2","label3"],"deleted_at":"2026-01-09T01:16:00.106926+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-90g3g","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:16:32.816308+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:16:32.938704+01:00","deleted_at":"2026-01-09T20:16:32.938704+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-91vy","title":"1. Authentication System","description":"Complete authentication system implementation","status":"tombstone","priority":2,"issue_type":"epic","created_at":"2026-01-07T01:23:03.731796+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:30:48.506265+01:00","deleted_at":"2026-01-07T01:30:48.506265+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"agent-shepherd-91vy-1","title":"1.1 UI Components","description":"Authentication UI components (login, register, reset)","status":"tombstone","priority":2,"issue_type":"epic","created_at":"2026-01-07T01:23:06.491393+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:30:48.506265+01:00","deleted_at":"2026-01-07T01:30:48.506265+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"agent-shepherd-91vy-1-1","title":"1.1.1 Login Form Component","description":"Implement login form with validation and error handling","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:23:06.996994+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:30:48.506265+01:00","deleted_at":"2026-01-07T01:30:48.506265+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-91vy-1-2","title":"1.1.2 Register Form Component","description":"Implement user registration form with validation","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:23:07.469694+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:30:48.506265+01:00","deleted_at":"2026-01-07T01:30:48.506265+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-91vy-1-3","title":"1.1.3 Password Reset Component","description":"Implement password reset functionality","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:23:07.917985+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:30:48.506265+01:00","deleted_at":"2026-01-07T01:30:48.506265+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-91vy.1","title":"1.1 UI Components","status":"tombstone","priority":2,"issue_type":"epic","created_at":"2026-01-07T01:24:25.486338+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:30:48.506265+01:00","deleted_at":"2026-01-07T01:30:48.506265+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"agent-shepherd-91vy.1.1","title":"1.1.1 Login Form Component","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:24:25.680418+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:30:48.506265+01:00","deleted_at":"2026-01-07T01:30:48.506265+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-91vy.1.2","title":"1.1.2 Register Form Component","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:24:26.119441+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:30:48.506265+01:00","deleted_at":"2026-01-07T01:30:48.506265+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-91vy.1.3","title":"1.1.3 Password Reset Component","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:24:26.415601+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:30:48.506265+01:00","deleted_at":"2026-01-07T01:30:48.506265+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-923b","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T16:34:52.101184+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T16:34:52.144614+01:00","deleted_at":"2026-01-07T16:34:52.144614+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-927","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:32:29.80143+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:29.883902+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-06T04:32:29.883902+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-94nx","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:24:23.427771+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:24:23.599929+01:00","deleted_at":"2026-01-07T18:24:23.599929+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-94r1","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:58:04.923762+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:58:04.989858+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-06T15:58:04.989858+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-94yr1","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T23:23:27.835704+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:23:27.936429+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-09T23:23:27.936429+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-9520","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T04:53:55.359853+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T04:53:55.42405+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T04:53:55.42405+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-96jer","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-08T23:17:05.944783+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:17:06.394228+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-08T23:17:06.394228+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-97mz","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T02:42:00.057895+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:42:00.479375+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T02:42:00.479375+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-97ni3","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T04:49:38.144287+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:49:38.261716+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-09T04:49:38.261716+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-9axf","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:05:09.183952+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:05:09.25399+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T19:05:09.25399+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-9bxb4","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:08:11.081+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:08:11.195683+01:00","deleted_at":"2026-01-11T00:08:11.195683+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-9crjb","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:20:30.593725+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:30.722187+01:00","deleted_at":"2026-01-09T01:20:30.722187+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-9d1v4","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:40:53.983476+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:40:54.135528+01:00","labels":["label2","label3"],"deleted_at":"2026-01-09T20:40:54.135528+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-9dd0c","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T01:06:41.413545+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T01:06:41.59689+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-11T01:06:41.59689+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-9fq6q","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:11:04.311025+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:11:04.436225+01:00","deleted_at":"2026-01-09T20:11:04.436225+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-9gem8","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T23:03:54.018689+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:03:54.117891+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-09T23:03:54.117891+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-9jvp","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T02:36:01.662371+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:36:01.73035+01:00","deleted_at":"2026-01-07T02:36:01.73035+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-9lrj","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T20:36:37.060431+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T20:36:37.274184+01:00","deleted_at":"2026-01-07T20:36:37.274184+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-9mp0","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:40:15.315125+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:40:15.358406+01:00","deleted_at":"2026-01-07T18:40:15.358406+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-9myo","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:59:44.001652+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:59:44.168679+01:00","deleted_at":"2026-01-07T02:59:44.168679+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-9nvv","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T15:02:09.72096+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T15:02:09.764613+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T15:02:09.764613+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-9ohqm","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T01:06:41.15735+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T01:06:41.352276+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-11T01:06:41.352276+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-9pxcv","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T23:03:53.801933+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:03:53.874935+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-09T23:03:53.874935+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-9q0du","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:46:38.429004+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:46:38.617251+01:00","deleted_at":"2026-01-09T20:46:38.617251+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-9rbg","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T03:57:12.010386+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T03:57:12.212487+01:00","deleted_at":"2026-01-08T03:57:12.212487+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-9rsdb","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:08:10.892427+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:08:11.002706+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-11T00:08:11.002706+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-9s2fw","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T23:03:55.309922+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:03:55.79389+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T23:03:55.79389+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-9sg","title":"1. Project Setup","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-19T03:51:08.036964+01:00","updated_at":"2025-12-19T04:02:51.934268+01:00","deleted_at":"2025-12-19T04:02:51.934268+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-9t5","title":"Update policy.ts to parse fallback fields","description":"File: .agent-shepherd/src/core/policy.ts\n\nTask: Parse fallback fields when loading policies and handle inheritance logic\n\nRequired Changes:\n\n1. Add TypeScript interfaces for fallback fields:\n```typescript\ninterface PolicyFallbackConfig {\n  fallback_enabled?: boolean;\n  fallback_agent?: string;\n  fallback_mappings?: Record\u003cstring, string\u003e;\n}\n\ninterface PhaseFallbackConfig {\n  fallback_agent?: string;\n  fallback_enabled?: boolean;\n}\n```\n\n2. Add fallback fields to Policy interface:\n```typescript\ninterface Policy {\n  // ... existing properties\n  fallback_enabled?: boolean;\n  fallback_agent?: string;\n  fallback_mappings?: Record\u003cstring, string\u003e;\n}\n```\n\n3. Add fallback fields to Phase interface:\n```typescript\ninterface Phase {\n  // ... existing properties\n  fallback_agent?: string;\n  fallback_enabled?: boolean;\n}\n```\n\n4. Update loadPolicies() to parse fallback fields:\n   - Read fallback fields from policies.yaml\n   - Store in policy and phase objects\n\n5. Implement inheritance logic:\n   - Policy inherits from global config if fallback_enabled not set\n   - Policy inherits from global config if fallback_agent not set\n   - Phase inherits from policy if fallback_enabled not set\n   - Phase can override both policy and global settings\n\nAcceptance Criteria:\n- [ ] Fallback fields load correctly from policies.yaml\n- [ ] TypeScript types match schema structure\n- [ ] Inheritance logic works correctly (phase overrides policy overrides global)\n- [ ] Missing fields are treated as \"inherit from parent\"\n- [ ] Explicit false values disable fallback at that level","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T02:43:57.878681+01:00","updated_at":"2026-01-05T02:53:53.823276+01:00","closed_at":"2026-01-05T02:53:53.823276+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-9t5","depends_on_id":"agent-shepherd-uj0","type":"parent-child","created_at":"2026-01-05T02:45:00.511343+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-9uhxz","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T23:23:29.218778+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:23:29.395928+01:00","labels":["label2","label3"],"deleted_at":"2026-01-09T23:23:29.395928+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-9xlyy","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:46:37.443779+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:46:37.517628+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-09T20:46:37.517628+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-9y5","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:34:52.950702+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:53.010012+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-06T04:34:53.010012+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-9zl41","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:13:54.860189+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:13:55.024885+01:00","labels":["label2","label3"],"deleted_at":"2026-01-09T01:13:55.024885+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-a0g7","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T04:53:55.26778+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T04:53:55.330967+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T04:53:55.330967+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-a12","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:34:53.126255+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:53.205024+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-06T04:34:53.205024+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-a13q","title":"3.1.1 Design Retention Policy Interface","description":"Define structure for retention policy configuration with graduated retention tiers. Create TypeScript interface with active_window_days, archive_threshold_days, delete_threshold_days. Define DEFAULT_POLICY constant.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:09:00.576098+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:12:28.950967+01:00","deleted_at":"2026-01-07T01:12:28.950967+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-a2ar9","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T23:03:55.155935+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:03:55.27588+01:00","deleted_at":"2026-01-09T23:03:55.27588+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-a38","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:34:13.745264+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:13.805211+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-06T04:34:13.805211+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-a3en1","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:31:31.201478+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:31:31.362008+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-11T00:31:31.362008+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-a3jr","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-08T05:54:19.666058+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:54:19.731098+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-08T05:54:19.731098+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-a3uo","title":"2.4.8 Add Decision Metadata Logging","description":"Log comprehensive metadata for all decisions.\n\n## Tasks\n- Log decision metadata in executeDecisionAgent():\n  - Agent information: decision_agent_id, capability\n  - Decision configuration: prompt, allowed_destinations, confidence_thresholds\n  - Decision result: confidence, target_phase, requires_approval\n  - Context: issue_id, from_phase, raw_response, parsed_decision\n- Log structure:\n  - logDecision({run_id, type: 'dynamic_decision', decision: action, reasoning: reasoning, metadata})\n  - metadata includes all fields above\n- Add indexes for decision analysis queries:\n  - Index on type='dynamic_decision'\n  - Index on metadata.capability\n  - Index on metadata.confidence\n\n## Expected Deliverables\n- Comprehensive decision metadata logging\n- Metadata structure defined\n- Indexes added for analysis queries","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:53:10.248975+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-a51w","title":"2.5.7 Add Decision Analytics","description":"Track and analyze decision patterns.\n\n## Tasks\n- Add decision analytics queries to Logger:\n  - getDecisionConfidenceDistribution(capability?: string):\n    - Query decisions where type='dynamic_decision'\n    - Group by confidence ranges: \u003c0.3, 0.3-0.5, 0.5-0.7, 0.7-0.9, \u003e0.9\n    - Return array of {range: string, count: number}\n  - getTargetPhaseCounts(capability: string):\n    - Query decisions by capability\n    - Count occurrences of each target_phase\n    - Return array of {phase: string, count: number}\n  - getDecisionAgentPerformance(agentId: string):\n    - Query decisions by agent_id\n    - Calculate success rate, avg confidence\n    - Return {success: number, avgConfidence: number}\n- Track decision metrics:\n  - Confidence distribution:\n    - Helps identify confidence calibration issues\n    - Shows if agents are over/under confident\n  - Most common target phases per decision type:\n    - Shows routing patterns\n    - Helps optimize transition config\n  - Approval rate vs confidence score:\n    - Correlate confidence with requires_approval\n    - Verify thresholds are appropriate\n  - Decision agent performance:\n    - Success rate per agent\n    - Average confidence per agent\n    - Most common decisions per agent\n    - Time spent per decision\n\n## Expected Deliverables\n- Decision analytics queries implemented\n  - Confidence distribution tracking\n  - Target phase tracking\n  - Agent performance tracking\n  - Approval rate vs confidence tracking","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:53:38.106853+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-a5tx","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-06T23:35:17.820679+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:35:18.204673+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-06T23:35:18.204673+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-a5yt","title":"3.1.5 Implement deleteAncientData()","description":"Delete data older than retention limit from archive database. Create deleteAncientData() method that deletes from archive database based on age, also checks active database, and logs deletions.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:09:08.738035+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:12:28.540456+01:00","deleted_at":"2026-01-07T01:12:28.540456+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-a8f73","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:06:40.749398+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:06:40.823863+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-09T20:06:40.823863+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-a8ssb","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:11:02.97153+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:11:03.042753+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-09T20:11:03.042753+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-a8t7","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T02:57:16.567233+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T02:57:16.614614+01:00","deleted_at":"2026-01-08T02:57:16.614614+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-abole","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T01:15:32.635185+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:33.139981+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T01:15:33.139981+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-aeb","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:34:13.458871+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:13.519341+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-06T04:34:13.519341+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-aeln8","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:13:53.417502+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:13:53.531165+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-09T01:13:53.531165+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-aemtk","title":"Implement Phase Messenger CLI Tool \u0026 Instruction Injection","description":"Create ashep get-messages CLI command for retrieving phase context with smart defaults, and inject usage instructions into agent workflows.\n\n## Scratchpad\nPlan 2: Phase Messenger CLI Tool \u0026 Instruction Injection\nOverview\nCreate ashep get-messages CLI command that LLM can call via bash tool to retrieve phase context, with smart defaults for last phase.\n\nStep 1: Add Format Helper to Phase Messenger\nFile: src/core/phase-messenger.ts\nWhat: Add function to format messages for CLI output\nWhy: Reusable formatting logic for CLI and potential LLM consumption\nHow: [detailed code]\n\nStep 2: Add CLI Command\nFile: src/cli/index.ts\nWhat: Implement ashep get-messages \u003cissue-id\u003e [options]\nWhy: Provide LLM-accessible tool for retrieving phase context on demand\nHow: [detailed code]\n\nStep 3: Inject Usage into Agent Instructions\nFile: src/core/worker-engine.ts\nWhat: Update buildInstructions() to include ashep get-messages usage\nWhy: Every LLM call knows how to retrieve phase context\nHow: [detailed code]\n\nStep 4: Register CLI Command\nFile: src/cli/index.ts\nWhat: Add to COMMANDS object and main() switch\nWhy: Make command discoverable\nHow: [detailed code]\n\nStep 5: Documentation Updates\nFile: docs/cli-reference.md and AGENTS.md\nWhat: Document ashep get-messages command and Phase Messenger section\nWhy: Complete CLI reference and document inter-phase communication\nHow: [detailed code]\n\nStep 6: Testing\nWhat: Test ashep get-messages functionality\nWhy: Ensure correct behavior for all options and edge cases\nHow: [detailed checklist]\n\nWhen assigned this epic, consume the overall context and select the next available child issue to work on, rather than working on the epic directly.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-09T03:56:46.206063+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T00:23:13.349884+01:00","closed_at":"2026-01-10T00:23:13.349884+01:00","close_reason":"Completed implementation of Phase Messenger CLI Tool \u0026 Instruction Injection epic"}
{"id":"agent-shepherd-aemtk.1","title":"Add formatMessagesForCLI function to phase-messenger.ts","description":"Add the export function formatMessagesForCLI to src/core/phase-messenger.ts with the specified implementation for formatting messages for CLI output.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T03:56:48.582734+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T00:23:13.089385+01:00","closed_at":"2026-01-10T00:23:13.089385+01:00","close_reason":"Completed addition of formatMessagesForCLI function","dependencies":[{"issue_id":"agent-shepherd-aemtk.1","depends_on_id":"agent-shepherd-aemtk","type":"parent-child","created_at":"2026-01-09T03:56:48.583601+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-aemtk.2","title":"Implement cmdGetMessages function in src/cli/index.ts","description":"Implement the cmdGetMessages async function in src/cli/index.ts with parsing options, retrieving messages, applying filters, and formatting output for both text and JSON formats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T03:56:50.480837+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T00:23:12.713775+01:00","closed_at":"2026-01-10T00:23:12.713775+01:00","close_reason":"Completed implementation of cmdGetMessages function","dependencies":[{"issue_id":"agent-shepherd-aemtk.2","depends_on_id":"agent-shepherd-aemtk","type":"parent-child","created_at":"2026-01-09T03:56:50.481708+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-aemtk.3","title":"Update buildInstructions() in worker-engine.ts to include ashep get-messages usage","description":"Modify the buildInstructions() method in src/core/worker-engine.ts to add the Phase Messenger section with CLI usage examples and instructions for LLM agents.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T03:56:52.217365+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T00:23:12.511406+01:00","closed_at":"2026-01-10T00:23:12.511406+01:00","close_reason":"Completed update to buildInstructions() in worker-engine.ts","dependencies":[{"issue_id":"agent-shepherd-aemtk.3","depends_on_id":"agent-shepherd-aemtk","type":"parent-child","created_at":"2026-01-09T03:56:52.218213+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-aemtk.4","title":"Register get-messages command in CLI index.ts","description":"Add 'get-messages' to the COMMANDS object and add the case 'get-messages' to the main() switch statement in src/cli/index.ts to make the command discoverable.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T03:56:53.331473+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T00:23:12.328188+01:00","closed_at":"2026-01-10T00:23:12.328188+01:00","close_reason":"Completed registration of get-messages command in CLI index.ts","dependencies":[{"issue_id":"agent-shepherd-aemtk.4","depends_on_id":"agent-shepherd-aemtk","type":"parent-child","created_at":"2026-01-09T03:56:53.332339+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-aemtk.5","title":"Update documentation for ashep get-messages command","description":"Add documentation for the ashep get-messages command to docs/cli-reference.md and add a Phase Messenger section to AGENTS.md explaining inter-phase communication.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T03:56:54.564512+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T00:23:12.089518+01:00","closed_at":"2026-01-10T00:23:12.089518+01:00","close_reason":"Completed documentation update for ashep get-messages command","dependencies":[{"issue_id":"agent-shepherd-aemtk.5","depends_on_id":"agent-shepherd-aemtk","type":"parent-child","created_at":"2026-01-09T03:56:54.565405+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-aemtk.6","title":"Test ashep get-messages functionality","description":"Test the ashep get-messages command with various options (--phase, --all, --metadata, --history, --unread-only, --format json), edge cases (no messages, invalid issue), and verify LLM can call it via bash tool.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T03:56:55.959097+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T00:23:11.852877+01:00","closed_at":"2026-01-10T00:23:11.852877+01:00","close_reason":"Completed testing of ashep get-messages functionality","dependencies":[{"issue_id":"agent-shepherd-aemtk.6","depends_on_id":"agent-shepherd-aemtk","type":"parent-child","created_at":"2026-01-09T03:56:55.959862+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-agfn","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:33:22.511327+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:22.581249+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T18:33:22.581249+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ah9r","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T21:44:10.316314+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:44:10.473528+01:00","deleted_at":"2026-01-07T21:44:10.473528+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ahcm","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T03:38:12.603683+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:38:13.030305+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T03:38:13.030305+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-ahrn","title":"3.3.2 Handle Multiple Output Formats","description":"Support various OpenCode output formats. Handle single JSON object, JSONL, mixed stdout/stderr JSON, and unstructured output with automatic format detection and fallback parsing.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:09:41.088028+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:12:27.938938+01:00","deleted_at":"2026-01-07T01:12:27.938938+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-ai3z","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:40:00.328034+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:40:00.512072+01:00","deleted_at":"2026-01-07T18:40:00.512072+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ajh68","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:38:36.887282+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:38:37.087478+01:00","deleted_at":"2026-01-09T01:38:37.087478+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ajmo","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T05:56:18.539315+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:56:18.7181+01:00","deleted_at":"2026-01-08T05:56:18.7181+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ajyo","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T05:56:18.903882+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:56:19.020042+01:00","deleted_at":"2026-01-08T05:56:19.020042+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ajz2","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:03:07.88489+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:03:08.058333+01:00","deleted_at":"2026-01-07T19:03:08.058333+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ak5r","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:33:44.640567+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:44.82013+01:00","deleted_at":"2026-01-07T18:33:44.82013+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-akjb","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T21:44:08.672308+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:44:08.76777+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T21:44:08.76777+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-alg8","title":"Agent Shepherd Enhancement Plan - Detailed Implementation Roadmap (Revised)","description":"Phase 1 of Agent Shepherd enhancement plan focusing on core fixes for retry counting, RunOutcome enrichment, logging tests, and duration metrics.\n\n## Overview\nThis epic implements critical fixes to improve reliability, observability, and testing coverage of the Agent Shepherd system.\n\n## Scope\n\n### 1.1 Fix Retry Counting Logic\n- Implement proper retry counting using runs.db\n- Enforce max_attempts limits to prevent infinite retries\n- Add comprehensive tests for retry logic\n\n### 1.2 Complete RunOutcome Enrichment\n- Parse full OpenCode CLI JSON output\n- Extend RunOutcome interface with rich execution data\n- Capture metrics, artifacts, warnings, error details, tool calls\n- Implement duration tracking and timeout detection\n\n### 1.3 Add Comprehensive Logging System Tests\n- Zero-to-full test coverage for Logger class\n- Test initialization, run record lifecycle, decision logging\n- Test dual storage (JSONL/SQLite) consistency\n- Performance benchmarking with large datasets\n\n### 1.4 Implement Duration Metrics\n- Track execution time for performance monitoring\n- Add timeout detection based on policy thresholds\n- Provide duration aggregation queries for analysis\n- Identify performance bottlenecks across phases\n\n## Dependencies\n- 1.4 (Duration Metrics) depends on 1.2 (RunOutcome Enrichment)\n\n## Estimated Duration\n2-3 weeks\n\n## Execution Notes\nWhen assigned this epic, consume the overall context and select the next available child issue to work on, rather than working on the epic directly.\n\n## Scratchpad\nDetailed implementation plan with all subtasks breakdown preserved for reference.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-06T23:17:31.435173+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:26:07.648978+01:00","closed_at":"2026-01-08T23:26:07.648978+01:00","close_reason":"Closed"}
{"id":"agent-shepherd-alg8.1","title":"1.3 Add Comprehensive Logging System Tests","description":"Zero-to-full test coverage for the Logger class and dual storage system.\n\n### Problem\nZero test coverage for critical audit/logging system that stores all execution history.\n\n### Solution\n- Create comprehensive test suite for Logger class\n- Test initialization, CRUD operations, dual storage consistency\n- Test error handling and integration scenarios\n- Performance benchmarking with large datasets\n\n### Dependencies\nNone\n\n### Implementation Plan\n1. Analyze Logger class coverage and identify test scenarios\n2. Test Logger initialization with various configurations\n3. Test complete run record lifecycle (create, update, query, retrieve)\n4. Test decision logging and retrieval\n5. Test dual storage (JSONL/SQLite) consistency\n6. Test error handling for various failure conditions\n7. Test integration with worker engine workflow\n8. Performance benchmarking with 1000+ records\n\n### Expected Outcomes\n- Full test coverage for Logger class methods\n- Verified dual storage consistency (JSONL source of truth, SQLite cache)\n- Robust error handling with graceful degradation\n- Performance benchmarks to ensure scalability\n- Integration tests validating real usage scenarios","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T23:17:48.184377+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T04:32:13.049839+01:00","closed_at":"2026-01-07T04:32:13.049839+01:00","close_reason":"Closed via update","dependencies":[{"issue_id":"agent-shepherd-alg8.1","depends_on_id":"agent-shepherd-alg8","type":"parent-child","created_at":"2026-01-06T23:17:48.186756+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.1.1","title":"1.3.3 Test Run Record Lifecycle","description":"Test complete lifecycle of run records from creation to updates to retrieval.\n\n### Test Cases\n- Test createRun():\n  - Verify both JSONL and SQLite entries created\n  - Verify JSONL line appended to runs.jsonl\n  - Verify SQLite record inserted with all fields\n  - Verify created_at and updated_at timestamps set\n  - Verify returned RunRecord matches input\n  - Test with all optional fields (outcome, metadata) populated\n  - Test with minimal required fields only\n- Test updateRun():\n  - Verify JSONL line appended with updated record\n  - Verify SQLite record updated (not new insert)\n  - Verify updated_at timestamp updated\n  - Verify all fields preserved (not lost on update)\n  - Test partial updates (only some fields provided)\n  - Test status changes, outcome updates\n  - Test multiple updates to same run (verify history in JSONL)\n- Test getRun():\n  - Verify correct record retrieved by ID\n  - Verify all fields deserialized correctly from SQLite JSON\n  - Verify JSON metadata and outcome parsed correctly\n  - Test retrieving non-existent run (should return null)\n- Test queryRuns():\n  - Test filtering by issue_id\n  - Test filtering by agent_id\n  - Test filtering by status\n  - Test filtering by phase\n  - Test multiple filters combined\n  - Test pagination with limit\n  - Test offset with limit\n  - Test ordering by created_at DESC (default)\n  - Verify query returns empty array when no matches\n  - Test query without filters (returns all runs)\n- Test JSONL to SQLite consistency:\n  - After multiple updates, verify JSONL has full history\n  - Verify SQLite has latest version\n  - Verify data matches between both storage systems\n  - Test that SQLite is used for queries (fast), not JSONL\n\n### Expected Deliverables\n- Complete test suite for run record lifecycle\n- Tests for all CRUD operations\n- Dual storage consistency tests","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T23:21:11.462548+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T04:32:12.442908+01:00","closed_at":"2026-01-07T04:32:12.442908+01:00","close_reason":"Closed via update","dependencies":[{"issue_id":"agent-shepherd-alg8.1.1","depends_on_id":"agent-shepherd-alg8.1","type":"parent-child","created_at":"2026-01-06T23:21:11.46839+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.1.2","title":"1.3.1 Analyze Logger Class Coverage","description":"Complete analysis of Logger class to identify all test scenarios.\n\n### Tasks\n- Review entire logging.ts implementation (lines 1-423)\n- Identify all public methods and their use cases:\n  - constructor(dataDir?) - Initialization with schema setup\n  - createRun(record) - Create new run record\n  - updateRun(runId, updates) - Update existing run\n  - getRun(runId) - Retrieve single run\n  - queryRuns(query) - Query runs with filters\n  - logDecision(decision) - Log decision record\n  - getDecisions(runId) - Get decisions for run\n  - close() - Close database connection\n- Identify all database operations:\n  - Schema initialization (tables and indexes)\n  - CRUD operations on runs table\n  - CRUD operations on decisions table\n  - Upsert operations for JSONL sync\n  - Query operations with filters\n- Identify JSONL sync logic:\n  - syncFromJSONL() - Load existing JSONL into SQLite on startup\n  - Dual storage: append to JSONL first, then update SQLite\n  - Row conversion from SQLite to objects\n\n### Expected Deliverables\n- Complete analysis document of Logger class\n- List of all methods and database operations\n- Test scenarios identified for each component","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T23:21:25.679922+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T04:32:12.423047+01:00","closed_at":"2026-01-07T04:32:12.423047+01:00","close_reason":"Closed via update","dependencies":[{"issue_id":"agent-shepherd-alg8.1.2","depends_on_id":"agent-shepherd-alg8.1","type":"parent-child","created_at":"2026-01-06T23:21:25.685072+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.1.3","title":"1.3.2 Test Logger Initialization","description":"Test Logger construction and database setup.\n\n### Test Cases\n- Test Logger construction with custom dataDir\n  - Verify correct directory is used\n  - Verify database file created in correct location\n  - Verify JSONL files created in correct location\n- Test default dataDir path resolution (should use .agent-shepherd)\n- Test schema initialization on new database\n  - Verify runs table created with all correct columns\n  - Verify decisions table created with all correct columns\n  - Verify all indexes created (idx_runs_issue_id, idx_runs_agent_id, idx_runs_status, idx_decisions_run_id)\n- Test schema upgrade handling (future-proofing)\n  - Verify existing database with old schema doesn't crash\n  - Verify new columns/indexes added if missing\n- Test JSONL sync on construction\n  - Verify existing JSONL records loaded into SQLite\n  - Verify sync doesn't duplicate existing records\n  - Verify both runs.jsonl and decisions.jsonl synced\n\n### Expected Deliverables\n- Test suite for Logger initialization\n- Tests for all initialization scenarios\n- Schema upgrade tests","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T23:21:25.719411+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T04:32:12.425841+01:00","closed_at":"2026-01-07T04:32:12.425841+01:00","close_reason":"Closed via update","dependencies":[{"issue_id":"agent-shepherd-alg8.1.3","depends_on_id":"agent-shepherd-alg8.1","type":"parent-child","created_at":"2026-01-06T23:21:25.720075+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.1.4","title":"1.3.4 Test Decision Logging","description":"Test decision record creation and retrieval.\n\n### Test Cases\n- Test logDecision():\n  - Verify both JSONL and SQLite entries created\n  - Verify JSONL line appended to decisions.jsonl\n  - Verify SQLite record inserted with all fields\n  - Verify timestamp auto-generated\n  - Verify ID auto-generated\n  - Test with all decision types: agent_selection, phase_transition, retry, hitl\n  - Test with metadata populated\n  - Test with reasoning provided\n- Test getDecisions():\n  - Verify all decisions for a run retrieved\n  - Verify ordered by timestamp ASC (oldest first)\n  - Verify all fields deserialized correctly\n  - Verify metadata JSON parsed correctly\n  - Test retrieving decisions for run with no decisions (returns empty array)\n  - Test retrieving decisions for run with multiple decisions\n- Test decision types:\n  - Verify agent_selection decisions logged correctly\n  - Verify phase_transition decisions logged correctly\n  - Verify retry decisions logged correctly\n  - Verify hitl decisions logged correctly\n- Test decision metadata:\n  - Verify complex metadata objects serialized/deserialized correctly\n  - Verify metadata includes relevant context (issue_id, phase, policy, etc.)\n\n### Expected Deliverables\n- Test suite for decision logging\n- Tests for all decision types and scenarios\n- Metadata serialization/deserialization tests","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T23:21:38.048208+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T04:32:12.45689+01:00","closed_at":"2026-01-07T04:32:12.45689+01:00","close_reason":"Closed via update","dependencies":[{"issue_id":"agent-shepherd-alg8.1.4","depends_on_id":"agent-shepherd-alg8.1","type":"parent-child","created_at":"2026-01-06T23:21:38.053974+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.1.5","title":"1.3.5 Test Dual Storage Consistency","description":"Verify JSONL and SQLite databases stay synchronized.\n\n### Test Cases\n- Test that JSONL is always source of truth:\n  - Verify all writes append to JSONL first\n  - Verify SQLite updates after JSONL append\n  - Verify data in JSONL matches SQLite\n- Test SQLite cache stays in sync with JSONL:\n  - After createRun, verify both have same data\n  - After updateRun, verify both updated\n  - After logDecision, verify both have decision\n  - After multiple updates, verify SQLite has latest version, JSONL has full history\n- Test handling of corrupted JSONL lines:\n  - Insert malformed JSON line in JSONL file\n  - Verify logger gracefully skips bad line during syncFromJSONL\n  - Verify valid lines still loaded correctly\n  - Verify error logged for corrupted line\n- Test performance:\n  - Verify queries use SQLite indexes (EXPLAIN QUERY PLAN)\n  - Verify queries don't scan JSONL (slow)\n  - Measure query time with 1000+ records\n\n### Expected Deliverables\n- Dual storage consistency test suite\n- Corrupted data handling tests\n- Performance benchmarks","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T23:21:38.088004+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T04:32:12.464648+01:00","closed_at":"2026-01-07T04:32:12.464648+01:00","close_reason":"Closed via update","dependencies":[{"issue_id":"agent-shepherd-alg8.1.5","depends_on_id":"agent-shepherd-alg8.1","type":"parent-child","created_at":"2026-01-06T23:21:38.088683+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.1.6","title":"1.3.6 Test Error Handling","description":"Test graceful handling of various error conditions.\n\n### Test Cases\n- Test handling of invalid JSON in JSONL:\n  - Insert malformed JSON line in runs.jsonl\n  - Verify syncFromJSONL logs error and skips bad line\n  - Verify valid lines still loaded\n  - Verify logger continues to function\n- Test handling of database connection errors:\n  - Mock database connection failure\n  - Verify error caught and logged\n  - Verify error propagated to caller\n  - Verify graceful shutdown or retry logic\n- Test handling of filesystem permission errors:\n  - Create directory without write permissions\n  - Verify error caught and logged\n  - Verify error propagated to caller\n- Test handling of missing dataDir:\n  - Create logger in non-existent directory\n  - Verify directory created automatically\n  - Verify logger initializes successfully\n\n### Expected Deliverables\n- Error handling test suite\n- Tests for all error conditions\n- Verification of graceful degradation","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T23:21:47.216783+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T04:32:12.458406+01:00","closed_at":"2026-01-07T04:32:12.458406+01:00","close_reason":"Closed via update","dependencies":[{"issue_id":"agent-shepherd-alg8.1.6","depends_on_id":"agent-shepherd-alg8.1","type":"parent-child","created_at":"2026-01-06T23:21:47.226121+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.1.7","title":"1.3.7 Test Integration with Worker Engine","description":"Test logger usage within worker engine workflow.\n\n### Test Cases\n- Test run creation in worker-engine.ts integration:\n  - Simulate processIssue() creating run\n  - Verify run record created with correct fields\n  - Verify agent_id, issue_id, phase, policy_name populated\n  - Verify status set to \"pending\"\n- Test run updates after agent execution:\n  - Simulate agent completion\n  - Verify status updated to \"completed\" or \"failed\"\n  - Verify outcome populated with execution data\n  - Verify completed_at timestamp set\n- Test decision logging for agent selection:\n  - Simulate agent selection in processIssue()\n  - Verify agent_selection decision logged\n  - Verify decision metadata includes issue_id, phase, policy\n- Test decision logging for phase transitions:\n  - Simulate determineTransition() returning transition\n  - Verify phase_transition decision logged\n  - Verify decision metadata includes next_phase, outcome\n\n### Expected Deliverables\n- Integration test suite with worker engine\n- Tests for all real usage scenarios\n- Verification of correct data flow","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T23:21:47.266642+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T04:32:12.467112+01:00","closed_at":"2026-01-07T04:32:12.467112+01:00","close_reason":"Closed via update","dependencies":[{"issue_id":"agent-shepherd-alg8.1.7","depends_on_id":"agent-shepherd-alg8.1","type":"parent-child","created_at":"2026-01-06T23:21:47.267457+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.1.8","title":"1.3.8 Performance Tests","description":"Benchmark logging system performance under load.\n\n### Test Cases\n- Benchmark query performance with 1000+ run records:\n  - Test queryRuns with various filters\n  - Test getRun by ID\n  - Test getDecisions for run\n  - Measure query time (should be \u003c 100ms for indexed queries)\n- Benchmark JSONL sync time on startup:\n  - Create JSONL file with 10,000 run records\n  - Measure time to sync to SQLite on startup\n  - Verify sync completes in reasonable time (\u003c 30 seconds)\n- Benchmark insert performance:\n  - Insert 1000 run records\n  - Measure time to append to JSONL\n  - Measure time to update SQLite\n  - Verify total time acceptable\n- Verify indexes are used by SQLite:\n  - Run EXPLAIN QUERY PLAN on queries\n  - Verify index scans used instead of table scans\n  - Verify all indexes defined and used\n\n### Expected Deliverables\n- Performance benchmark suite\n- Query performance measurements\n- Insert performance measurements\n- Index usage verification","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T23:22:00.82412+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T04:32:13.048307+01:00","closed_at":"2026-01-07T04:32:13.048307+01:00","close_reason":"Closed via update","dependencies":[{"issue_id":"agent-shepherd-alg8.1.8","depends_on_id":"agent-shepherd-alg8.1","type":"parent-child","created_at":"2026-01-06T23:22:00.836792+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.10","title":"3.3 Complete OpenCode CLI Output Parsing","description":"Complete comprehensive parsing of all available fields from OpenCode CLI output for maximum value extraction from agent execution.\n\n## Overview\nEnhance output parsing to capture all available information from OpenCode agent execution, including session metadata, tool usage, file operations, error details, and performance metrics.\n\n## Key Components\n- Comprehensive field extraction from various output formats\n- Robust error handling for malformed output\n- Caching of raw CLI output for re-parsing\n- Support for multiple output formats (JSON, JSONL, mixed)\n- Validation and data integrity checks\n\n## Dependencies\n- Phase 2 enhanced RunOutcome structure (fields to populate)\n- OpenCode CLI integration (output to parse)\n\n## Priority: MEDIUM","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-07T01:32:55.649119+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:44:24.15472+01:00","closed_at":"2026-01-07T21:44:24.15472+01:00","close_reason":"Epic completed: All 9 subtasks finished. Enhanced OpenCode CLI output parsing with comprehensive field extraction including message history, improved error details with stack traces and file locations, raw CLI output caching, cache metrics (reads/writes), robust error handling with safeGet utility, and expanded test coverage (34 tests all passing).","dependencies":[{"issue_id":"agent-shepherd-alg8.10","depends_on_id":"agent-shepherd-alg8","type":"parent-child","created_at":"2026-01-07T01:32:55.649904+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.10.1","title":"3.3.1 Comprehensive Field Extraction","description":"Parse all available fields from OpenCode output including session metadata, agent information, message history, tool calls, file operations, token usage, and error details.\n\n## WHAT\nExtract all available fields from JSON output and populate RunOutcome structure.\n\n## WHY\nCapture maximum value from agent execution for analysis and debugging.\n\n## HOW\nParse all fields from OpenCode JSON output:\n- Session metadata (session_id, timestamps, model)\n- Agent information (agent_id, provider, model)\n- Message history (conversation array)\n- Tool calls (name, inputs, outputs, timing)\n- File operations (paths, operations, sizes)\n- Token usage (input, output, total, cost)\n- Error details (type, message, stack trace)\n\n## Implementation\n- Comprehensive parsing logic\n- Type-safe interfaces for all data structures\n- Validation of extracted data\n- Graceful handling of missing fields","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:32:58.262139+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:44:18.967906+01:00","closed_at":"2026-01-07T21:44:18.967906+01:00","close_reason":"Completed: Enhanced OpenCode CLI parsing with message extraction, improved error details (stack traces, file paths, line numbers), raw output caching, cache metrics, and robust error handling with safeGet utility. Added comprehensive tests covering all new features.","dependencies":[{"issue_id":"agent-shepherd-alg8.10.1","depends_on_id":"agent-shepherd-alg8.10","type":"parent-child","created_at":"2026-01-07T01:32:58.263191+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.10.2","title":"3.3.2 Handle Multiple Output Formats","description":"Support various OpenCode output formats including single JSON, JSONL, mixed stdout/stderr, and unstructured output.\n\n## WHAT\nDetect and handle multiple output format variations from different agent runs.\n\n## WHY\nDifferent agent runs may produce different output structures, need robust parsing.\n\n## HOW\nSupport multiple formats:\n- Single JSON object\n- Multiple JSON lines (JSONL)\n- Mixed stdout/stderr JSON\n- Unstructured output (fallback)\n\nAuto-detect format and parse appropriately.\n\n## Implementation\n- Format detection logic\n- Separate parsing functions for each format\n- Merging data from multiple sources\n- Fallback parsing for unstructured output","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:33:00.431821+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:44:18.997461+01:00","closed_at":"2026-01-07T21:44:18.997461+01:00","close_reason":"Completed: Enhanced OpenCode CLI parsing with message extraction, improved error details (stack traces, file paths, line numbers), raw output caching, cache metrics, and robust error handling with safeGet utility. Added comprehensive tests covering all new features.","dependencies":[{"issue_id":"agent-shepherd-alg8.10.2","depends_on_id":"agent-shepherd-alg8.10","type":"parent-child","created_at":"2026-01-07T01:33:00.432616+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.10.3","title":"3.3.3 Extract Session Messages","description":"Parse full message history from CLI output to provide complete conversation context.\n\n## WHAT\nExtract messages array from JSON output and store in RunOutcome metadata.\n\n## WHY\nProvides complete conversation context for analysis and debugging.\n\n## HOW\nExtract and parse message history:\n- Role identification (user, assistant, system)\n- Content and timestamps\n- Token usage per message if available\n\nStore in RunOutcome.metadata.messages with full conversation history.\n\n## Implementation\n- Message interface definition\n- Parsing logic for message arrays\n- Timestamps and role validation\n- Storage in metadata structure","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:33:02.51006+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:44:19.026901+01:00","closed_at":"2026-01-07T21:44:19.026901+01:00","close_reason":"Completed: Enhanced OpenCode CLI parsing with message extraction, improved error details (stack traces, file paths, line numbers), raw output caching, cache metrics, and robust error handling with safeGet utility. Added comprehensive tests covering all new features.","dependencies":[{"issue_id":"agent-shepherd-alg8.10.3","depends_on_id":"agent-shepherd-alg8.10","type":"parent-child","created_at":"2026-01-07T01:33:02.51113+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.10.4","title":"3.3.4 Extract Tool Usage","description":"Parse tool calls from CLI output to track which tools were used and their performance.\n\n## WHAT\nExtract tool information from JSON and store in RunOutcome metadata.\n\n## WHY\nTracks tool usage patterns and performance for optimization and debugging.\n\n## HOW\nDefine ToolCall interface and extract:\n- Tool name and inputs\n- Outputs and execution time\n- Success/failure status\n- Sequential order\n\nStore in RunOutcome.metadata.tool_calls array.\n\n## Implementation\n- ToolCall interface with all fields\n- Parsing logic for tool arrays\n- Success/failure detection\n- Timing and performance metrics","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:33:04.492043+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:44:19.056347+01:00","closed_at":"2026-01-07T21:44:19.056347+01:00","close_reason":"Completed: Enhanced OpenCode CLI parsing with message extraction, improved error details (stack traces, file paths, line numbers), raw output caching, cache metrics, and robust error handling with safeGet utility. Added comprehensive tests covering all new features.","dependencies":[{"issue_id":"agent-shepherd-alg8.10.4","depends_on_id":"agent-shepherd-alg8.10","type":"parent-child","created_at":"2026-01-07T01:33:04.493059+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.10.5","title":"3.3.5 Extract File Operations","description":"Parse file operations from CLI output to track which files were accessed or modified.\n\n## WHAT\nExtract file operation information and store in RunOutcome metadata.\n\n## WHY\nTracks file access patterns for security and performance analysis.\n\n## HOW\nDefine FileOperation interface and extract:\n- File paths and operation types\n- File sizes and line changes\n- Operation timestamps\n\nStore in RunOutcome.metadata.file_operations array.\n\n## Implementation\n- FileOperation interface definition\n- Parsing logic for file operation arrays\n- Path validation and normalization\n- Size and change tracking","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:33:06.653748+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:44:19.086397+01:00","closed_at":"2026-01-07T21:44:19.086397+01:00","close_reason":"Completed: Enhanced OpenCode CLI parsing with message extraction, improved error details (stack traces, file paths, line numbers), raw output caching, cache metrics, and robust error handling with safeGet utility. Added comprehensive tests covering all new features.","dependencies":[{"issue_id":"agent-shepherd-alg8.10.5","depends_on_id":"agent-shepherd-alg8.10","type":"parent-child","created_at":"2026-01-07T01:33:06.654771+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.10.6","title":"3.3.6 Extract Error Details","description":"Parse detailed error information from CLI output for debugging failed executions.\n\n## WHAT\nExtract error details with stack traces and context from stdout and stderr.\n\n## WHY\nProvides debugging context for failures and error analysis.\n\n## HOW\nDefine ErrorDetails interface and extract:\n- Error type and message\n- Stack trace with file paths and line numbers\n- Context around error location\n\nStore in RunOutcome.error_details.\n\n## Implementation\n- ErrorDetails interface with all fields\n- Parsing from both stdout and stderr\n- Stack trace parsing and formatting\n- Context extraction and storage","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:33:08.967751+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:44:19.11903+01:00","closed_at":"2026-01-07T21:44:19.11903+01:00","close_reason":"Completed: Enhanced OpenCode CLI parsing with message extraction, improved error details (stack traces, file paths, line numbers), raw output caching, cache metrics, and robust error handling with safeGet utility. Added comprehensive tests covering all new features.","dependencies":[{"issue_id":"agent-shepherd-alg8.10.6","depends_on_id":"agent-shepherd-alg8.10","type":"parent-child","created_at":"2026-01-07T01:33:08.968726+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.10.7","title":"3.3.7 Implement Robust Error Handling","description":"Handle all error conditions gracefully to prevent parsing failures from crashing the system.\n\n## WHAT\nAdd comprehensive error handling for malformed JSON, missing fields, and partial output.\n\n## WHY\nParsing failures should not crash the system or lose data.\n\n## HOW\nImplement robust error handling:\n- Safe property access functions\n- Malformed JSON detection and skipping\n- Partial output handling\n- Validation of extracted data\n- Logging of parsing issues\n\n## Implementation\n- safeGet() utility function\n- Try-catch blocks around JSON parsing\n- Validation functions for data integrity\n- Warning/error logging for issues","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:33:11.283488+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:44:19.14876+01:00","closed_at":"2026-01-07T21:44:19.14876+01:00","close_reason":"Completed: Enhanced OpenCode CLI parsing with message extraction, improved error details (stack traces, file paths, line numbers), raw output caching, cache metrics, and robust error handling with safeGet utility. Added comprehensive tests covering all new features.","dependencies":[{"issue_id":"agent-shepherd-alg8.10.7","depends_on_id":"agent-shepherd-alg8.10","type":"parent-child","created_at":"2026-01-07T01:33:11.284272+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.10.8","title":"3.3.8 Add Caching for CLI Output","description":"Cache raw CLI output in run metadata to enable re-parsing without re-executing agents.\n\n## WHAT\nStore full CLI output (stdout, stderr, exit code) in run metadata.\n\n## WHY\nEnables re-parsing output with updated logic and provides audit trail.\n\n## HOW\nCache full CLI output in metadata:\n- Store stdout, stderr, exit code\n- Preserve for re-parsing with new logic\n- Include in JSONL for audit trail\n\n## Benefits\n- Re-parse without re-execution\n- Debugging with raw output\n- Audit trail of exact CLI output\n- Future analysis capabilities","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:33:13.493762+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:44:19.177305+01:00","closed_at":"2026-01-07T21:44:19.177305+01:00","close_reason":"Completed: Enhanced OpenCode CLI parsing with message extraction, improved error details (stack traces, file paths, line numbers), raw output caching, cache metrics, and robust error handling with safeGet utility. Added comprehensive tests covering all new features.","dependencies":[{"issue_id":"agent-shepherd-alg8.10.8","depends_on_id":"agent-shepherd-alg8.10","type":"parent-child","created_at":"2026-01-07T01:33:13.494581+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.10.9","title":"3.3.9 Comprehensive Tests","description":"Create comprehensive unit and integration tests for all parsing scenarios and edge cases.\n\n## WHAT\nTest suite covering all parsing functionality and error conditions.\n\n## WHY\nEnsures reliable extraction of all data and robust error handling.\n\n## HOW\nTest all aspects:\n- Parsing all output formats\n- Extraction of all field types\n- Error handling for malformed input\n- Caching and re-parsing\n- Integration with real OpenCode output\n\n## Test Coverage\n- Unit tests for parseRunOutput()\n- Integration tests with agent execution\n- Error condition testing\n- Data validation and integrity\n- Performance and edge case handling","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:33:16.078065+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:44:19.205935+01:00","closed_at":"2026-01-07T21:44:19.205935+01:00","close_reason":"Completed: Enhanced OpenCode CLI parsing with message extraction, improved error details (stack traces, file paths, line numbers), raw output caching, cache metrics, and robust error handling with safeGet utility. Added comprehensive tests covering all new features.","dependencies":[{"issue_id":"agent-shepherd-alg8.10.9","depends_on_id":"agent-shepherd-alg8.10","type":"parent-child","created_at":"2026-01-07T01:33:16.078851+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.11","title":"3.4 Add Startup Cleanup and Size Limit Enforcement","description":"Integrate cleanup operations into system startup and add size limit monitoring to prevent database bloat.\n\n## Overview\nMake cleanup operations automatic by integrating them into system startup and add proactive size monitoring to prevent performance degradation from oversized databases.\n\n## Key Components\n- Startup cleanup integration\n- Scheduled cleanup timer\n- Size monitoring and alerts\n- Emergency cleanup procedures\n- Cleanup health checks and metrics\n- Configuration for cleanup behavior\n\n## Dependencies\n- 3.1 Garbage Collection (cleanup operations to integrate)\n- 3.2 Archival System (dual database size monitoring)\n\n## Priority: MEDIUM","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-07T01:33:18.303239+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T22:07:54.95457+01:00","closed_at":"2026-01-07T22:07:54.95457+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-alg8.11","depends_on_id":"agent-shepherd-alg8","type":"parent-child","created_at":"2026-01-07T01:33:18.303918+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.11.1","title":"3.4.1 Integrate Startup Cleanup into Logger","description":"Trigger cleanup on Logger initialization to ensure system starts in clean state.\n\n## WHAT\nCall performStartupCleanup() in Logger constructor.\n\n## WHY\nEnsures system starts with clean databases and optimal performance.\n\n## HOW\nModify Logger constructor:\n- Perform startup cleanup if enabled\n- Run asynchronously (non-blocking)\n- Log results and handle errors gracefully\n\n## Implementation\n- Async execution to avoid blocking startup\n- Error handling to prevent startup failures\n- Configurable cleanup on startup\n- Logging of cleanup operations and results","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:33:21.077757+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T22:07:55.060937+01:00","closed_at":"2026-01-07T22:07:55.060937+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-alg8.11.1","depends_on_id":"agent-shepherd-alg8.11","type":"parent-child","created_at":"2026-01-07T01:33:21.07895+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.11.2","title":"3.4.2 Add Cleanup Configuration","description":"Add configuration section for cleanup behavior to allow customization per installation.\n\n## WHAT\nAdd cleanup section to config/config.yaml with configurable options.\n\n## WHY\nAllows different environments to have different cleanup behaviors.\n\n## HOW\nAdd cleanup configuration:\n```yaml\ncleanup:\n  enabled: true\n  run_on_startup: true\n  schedule_interval_hours: 24\n  archive_on_startup: true\n  delete_on_startup: false\n```\n\nCreate loadCleanupConfig() function to load and validate.\n\n## Implementation\n- Configuration validation\n- Default values for all settings\n- Support for disabling cleanup\n- Flexible scheduling options","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:33:23.420489+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T22:07:55.062507+01:00","closed_at":"2026-01-07T22:07:55.062507+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-alg8.11.2","depends_on_id":"agent-shepherd-alg8.11","type":"parent-child","created_at":"2026-01-07T01:33:23.421268+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.11.3","title":"3.4.3 Implement Scheduled Cleanup Timer","description":"Create background timer that runs cleanup at configured intervals automatically.\n\n## WHAT\nImplement periodic cleanup job with configurable timing.\n\n## WHY\nAutomated maintenance without manual intervention.\n\n## HOW\nImplement scheduled cleanup:\n- Start timer in Logger constructor\n- Run cleanup every schedule_interval_hours\n- Track last cleanup to prevent double runs\n- Log operations and results\n\n## Implementation\n- Interval-based scheduling\n- Prevention of overlapping runs\n- Error handling and recovery\n- Configurable intervals","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:33:25.600689+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T22:07:55.063894+01:00","closed_at":"2026-01-07T22:07:55.063894+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-alg8.11.3","depends_on_id":"agent-shepherd-alg8.11","type":"parent-child","created_at":"2026-01-07T01:33:25.601487+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.11.4","title":"3.4.4 Add Size Monitoring","description":"Periodically check database and file sizes and trigger cleanup when approaching limits.\n\n## WHAT\nImplement size monitoring that alerts and triggers cleanup when needed.\n\n## WHY\nPrevents performance degradation from oversized databases.\n\n## HOW\nImplement size monitoring:\n- Check sizes every hour\n- Alert when approaching limits (90%)\n- Trigger cleanup automatically\n- Track size trends\n\n## Implementation\n- Periodic size checks\n- Configurable thresholds\n- Automatic cleanup triggering\n- Size trend analysis","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:33:27.840671+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T22:07:55.065978+01:00","closed_at":"2026-01-07T22:07:55.065978+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-alg8.11.4","depends_on_id":"agent-shepherd-alg8.11","type":"parent-child","created_at":"2026-01-07T01:33:27.842677+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.11.5","title":"3.4.5 Implement Emergency Cleanup","description":"More aggressive cleanup when size limits are critically exceeded.\n\n## WHAT\nImplement emergency cleanup procedures for critical size violations.\n\n## WHY\nPrevents system from becoming unusable due to database bloat.\n\n## HOW\nImplement emergency cleanup:\n- Trigger when size exceeds hard limits (110%)\n- Archive younger data aggressively\n- Delete immediately if needed\n- Force vacuum operations\n\n## Implementation\n- Hard limit thresholds\n- Aggressive archival strategies\n- Immediate deletion when necessary\n- Force maintenance operations","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:33:34.902554+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T22:07:55.068245+01:00","closed_at":"2026-01-07T22:07:55.068245+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-alg8.11.5","depends_on_id":"agent-shepherd-alg8.11","type":"parent-child","created_at":"2026-01-07T01:33:34.903378+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.11.6","title":"3.4.6 Add Cleanup Health Checks","description":"Verify cleanup operations worked correctly and did not corrupt data.\n\n## WHAT\nRun health checks after cleanup to ensure system integrity.\n\n## WHY\nEnsures cleanup is effective and safe, prevents data corruption.\n\n## HOW\nImplement health checks:\n- Database integrity verification\n- Query functionality testing\n- Size reduction validation\n- Archive accessibility checks\n\n## Implementation\n- Post-cleanup validation\n- Integrity checks\n- Rollback on failure\n- Comprehensive health reporting","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:33:37.119644+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T22:07:55.069876+01:00","closed_at":"2026-01-07T22:07:55.069876+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-alg8.11.6","depends_on_id":"agent-shepherd-alg8.11","type":"parent-child","created_at":"2026-01-07T01:33:37.120607+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.11.7","title":"3.4.7 Add Cleanup Metrics Export","description":"Track and export cleanup metrics for monitoring and analysis.\n\n## WHAT\nStore cleanup statistics and provide export capabilities.\n\n## WHY\nProvides visibility into cleanup effectiveness and system health.\n\n## HOW\nTrack cleanup metrics:\n- Operations performed and counts\n- Size changes and trends\n- Duration and performance\n- Health check results\n\nExport via CLI and logs.\n\n## Implementation\n- Metrics collection and storage\n- Trend analysis capabilities\n- CLI export commands\n- Logging integration","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:33:39.37058+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T22:07:55.071376+01:00","closed_at":"2026-01-07T22:07:55.071376+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-alg8.11.7","depends_on_id":"agent-shepherd-alg8.11","type":"parent-child","created_at":"2026-01-07T01:33:39.371484+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.11.8","title":"3.4.8 Tests for Cleanup System","description":"Test all cleanup scenarios including startup, scheduled, size-triggered, and emergency cleanup.\n\n## WHAT\nComprehensive test suite for all cleanup system components.\n\n## WHY\nEnsures cleanup works reliably in all scenarios without data loss.\n\n## HOW\nTest all cleanup scenarios:\n- Startup cleanup runs automatically\n- Scheduled cleanup timing works\n- Size monitoring triggers cleanup\n- Emergency cleanup handles critical situations\n- Health checks pass after cleanup\n- Metrics recorded accurately\n\n## Test Coverage\n- All cleanup trigger types\n- Size limit enforcement\n- Emergency procedures\n- Health check validation\n- Metrics collection and export","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:33:41.861913+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T22:07:55.072864+01:00","closed_at":"2026-01-07T22:07:55.072864+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-alg8.11.8","depends_on_id":"agent-shepherd-alg8.11","type":"parent-child","created_at":"2026-01-07T01:33:41.862641+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12","title":"4.0 Phase 4: Communication \u0026 Documentation","description":"Phase 4: Communication \u0026 Documentation - Estimated Duration: 2-3 weeks\n\n## PHASE 4: Communication \u0026 Documentation\n\n**Estimated Duration: 2-3 weeks**\n\n### Overview\nThis phase implements inter-phase communication capabilities and comprehensive documentation for the enhanced Agent Shepherd system.\n\n### Key Deliverables\n- Phase Messenger Plugin for inter-phase communication\n- Message cleanup and archival system\n- Comprehensive architecture documentation\n- Schema definitions and API documentation\n- Integration guides and troubleshooting\n\n### Dependencies\n- Phase 2 (Enhanced Transitions)\n- Phase 3 (Loop Prevention \u0026 Garbage Collection)\n\n### Critical Implementation Notes\n\n1. **Optional Transitions**: All transition blocks are optional - if not provided, use default linear behavior\n2. **Garbage Collection**: Triggered on issue close, but GC decides what gets deleted based on retention policy (active 30 days → archive 90 days → delete 365 days)\n3. **Message Cleanup**: Messages follow same retention as runs - NOT automatically deleted on issue close, archived based on age\n4. **Backward Compatibility**: Every new feature is opt-in, existing policies work unchanged\n\n### Scratchpad\nWhen assigned this epic, consume the overall context and select the next available child issue to work on, rather than working on the epic directly.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-07T01:59:00.191772+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:25:59.643062+01:00","closed_at":"2026-01-08T23:25:59.643062+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-alg8.12","depends_on_id":"agent-shepherd-alg8","type":"parent-child","created_at":"2026-01-07T01:59:00.192508+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.1","title":"4.1 Build Phase Messenger Plugin","description":"4.1 Build Phase Messenger Plugin\n**Priority: MEDIUM | Dependency: None**\n\n#### Overview\nCreate phase messenger plugin structure for inter-phase communication with dual storage (JSONL + SQLite) and CLI commands.\n\n#### Subtasks\n- 4.1.1 Design Plugin Structure\n- 4.1.2 Design Message Storage Schema  \n- 4.1.3 Define Message Types\n- 4.1.4 Implement Message Storage\n- 4.1.5 Implement Message Storage Methods\n- 4.1.6 Implement phaseMsgSend Command\n- 4.1.7 Implement phaseMsgReceive Command\n- 4.1.8 Implement phaseMsgList Command\n- 4.1.9 Implement Message Cleanup\n- 4.1.10 Implement Size Limits\n- 4.1.11 Add Integration with Worker Engine\n- 4.1.12 Comprehensive Tests\n\n#### Scratchpad\nWhen assigned this epic, consume the overall context and select the next available child issue to work on, rather than working on the epic directly.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-07T01:59:03.532105+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:59:18.318509+01:00","closed_at":"2026-01-08T05:59:18.318509+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.1","depends_on_id":"agent-shepherd-alg8.12","type":"parent-child","created_at":"2026-01-07T01:59:03.533209+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.1.1","title":"4.1.1 Design Plugin Structure","description":"4.1.1 Design Plugin Structure\n\n**WHAT**: Create phase messenger plugin structure\n**Why**: Enables optional, isolated inter-phase communication\n**HOW**: Follow existing plugin patterns\n\nCreate plugins/phase-messenger/ directory:\n\n\nCreate manifest.json:\n\n\nFollow existing plugin patterns from plugins/hello-world/","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:59:06.96423+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:59:18.136224+01:00","closed_at":"2026-01-08T05:59:18.136224+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.1.1","depends_on_id":"agent-shepherd-alg8.12.1","type":"parent-child","created_at":"2026-01-07T01:59:06.964974+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.1.10","title":"4.1.10 Implement Size Limits","description":"4.1.10 Implement Size Limits\n\n**WHAT**: Add configuration and enforcement of message limits\n**WHY**: Prevents message storage from growing unbounded\n**HOW**: Configurable limits, periodic cleanup\n\nAdd config for message retention:\n- max_messages per issue\n- retention_days\n- max_db_size_mb\n- enabled flag\n\nImplement enforceSizeLimits():\n- Check database size\n- Delete oldest messages when over limit\n- Check message count per issue\n- Archive and delete when limits exceeded\n\nAdd periodic monitoring with setInterval","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:59:28.355593+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:59:16.673936+01:00","closed_at":"2026-01-08T05:59:16.673936+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.1.10","depends_on_id":"agent-shepherd-alg8.12.1","type":"parent-child","created_at":"2026-01-07T01:59:28.356561+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.1.11","title":"4.1.11 Add Integration with Worker Engine","description":"4.1.11 Add Integration with Worker Engine\n\n**WHAT**: Automatically send/receive messages during phase execution\n**WHY**: Seamless workflow data passing without manual CLI usage\n**HOW**: Hook into worker engine lifecycle\n\nAuto-send message on phase completion:\n- Check messaging: true in transition config\n- Send result message to next phase\n- Include phase, outcome, artifacts, metrics, duration\n\nAuto-receive message on phase start:\n- Query for messages to this phase\n- Include message content in agent instructions\n- Agent sees context from previous phase\n\nConfigure via transition config with messaging flag","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:59:30.475731+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:59:16.514828+01:00","closed_at":"2026-01-08T05:59:16.514828+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.1.11","depends_on_id":"agent-shepherd-alg8.12.1","type":"parent-child","created_at":"2026-01-07T01:59:30.476611+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.1.12","title":"4.1.12 Comprehensive Tests","description":"4.1.12 Comprehensive Tests\n\n**WHAT**: Test all message lifecycle operations\n**WHY**: Ensures reliable inter-phase communication\n**HOW**: Unit and integration tests\n\nTest message send/receive lifecycle:\n- Send via CLI, verify stored in JSONL and SQLite\n- Receive via CLI, verify correct message returned\n- Test most recent message logic\n\nTest multiple messages:\n- Send multiple to same phase\n- Verify receive returns most recent\n- Verify list returns all in order\n\nTest message types:\n- Send each type (context, result, decision, data, request, response)\n- Verify type stored correctly\n\nTest message cleanup:\n- Create messages for issue\n- Trigger cleanup\n- Verify archived and deleted\n\nTest size limits:\n- Create many messages\n- Enforce limits\n- Verify oldest deleted\n\nTest worker engine integration:\n- Enable messaging in config\n- Complete phase, verify message sent\n- Start next phase, verify message received\n- Verify content in agent instructions","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:59:33.197187+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:59:16.33872+01:00","closed_at":"2026-01-08T05:59:16.33872+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.1.12","depends_on_id":"agent-shepherd-alg8.12.1","type":"parent-child","created_at":"2026-01-07T01:59:33.197883+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.1.2","title":"4.1.2 Design Message Storage Schema","description":"4.1.2 Design Message Storage Schema\n\n**WHAT**: Define database schema for messages\n**WHY**: Efficient storage and querying of inter-phase messages\n**HOW**: Dual storage (JSONL + SQLite) like logging system\n\nCreate messages.db schema:\n\n\nDesign rationale:\n- **issue_id**: Links to Beads issue\n- **from_phase**: Source phase (sender)\n- **to_phase**: Target phase (receiver)\n- **run_counter**: Tracks workflow execution number\n- **timestamp**: Temporal ordering\n- **message_type**: Type classification (context, result, decision, data)\n- **content**: Flexible JSON payload\n- **metadata**: Optional additional data\n\nCreate messages.jsonl for audit trail (source of truth)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:59:09.800835+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:59:17.98231+01:00","closed_at":"2026-01-08T05:59:17.98231+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.1.2","depends_on_id":"agent-shepherd-alg8.12.1","type":"parent-child","created_at":"2026-01-07T01:59:09.801646+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.1.3","title":"4.1.3 Define Message Types","description":"4.1.3 Define Message Types\n\n**WHAT**: Define standard message types for different use cases\n**WHY**: Provides consistent messaging patterns\n**HOW**: Enum with documentation\n\nDefine message types:\n- context: Phase context sent to next phase\n- result: Phase results sent to next phase  \n- decision: Decision information\n- data: Arbitrary data payload\n- request: Request for information\n- response: Response to request\n\nDocument each message type with usage examples","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:59:12.246808+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:59:17.823363+01:00","closed_at":"2026-01-08T05:59:17.823363+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.1.3","depends_on_id":"agent-shepherd-alg8.12.1","type":"parent-child","created_at":"2026-01-07T01:59:12.24782+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.1.4","title":"4.1.4 Implement Message Storage","description":"4.1.4 Implement Message Storage\n\n**WHAT**: Create MessageLogger class with dual storage\n**WHY**: Reliable message storage with fast queries, following logging system pattern\n**HOW**: Implement MessageLogger with JSONL + SQLite dual storage\n\nCreate MessageLogger class in plugins/phase-messenger/index.js with:\n- Constructor with schema initialization\n- syncFromJSONL() method to load existing data\n- Dual storage pattern (JSONL source of truth, SQLite cache)\n- Proper error handling and directory creation","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:59:14.943076+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:59:17.662006+01:00","closed_at":"2026-01-08T05:59:17.662006+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.1.4","depends_on_id":"agent-shepherd-alg8.12.1","type":"parent-child","created_at":"2026-01-07T01:59:14.944022+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.1.5","title":"4.1.5 Implement Message Storage Methods","description":"4.1.5 Implement Message Storage Methods\n\n**WHAT**: Create sendMessage() and receiveMessage() methods\n**WHY**: Core functionality for inter-phase communication\n**HOW**: Append to JSONL, update SQLite, support queries\n\nImplement sendMessage():\n- Append to JSONL (source of truth)\n- Update SQLite cache\n- Return full message record\n\nImplement receiveMessage():\n- Query most recent message for issue+phase\n- Return parsed message record\n\nImplement listMessages():\n- Query messages with optional issue filter\n- Return ordered by timestamp DESC","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:59:17.07269+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:59:17.504923+01:00","closed_at":"2026-01-08T05:59:17.504923+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.1.5","depends_on_id":"agent-shepherd-alg8.12.1","type":"parent-child","created_at":"2026-01-07T01:59:17.073498+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.1.6","title":"4.1.6 Implement phaseMsgSend Command","description":"4.1.6 Implement phaseMsgSend Command\n\n**WHAT**: Add CLI command to send messages\n**WHY**: Simple, familiar interface for agents\n**HOW**: CLI command with parameters\n\nAdd command to plugins/phase-messenger/index.js:\n- Validate required parameters (issueId, toPhase, type, content)\n- Validate message type against allowed types\n- Parse content as JSON\n- Get current phase from Beads\n- Get run counter\n- Create message with metadata\n- Send via MessageLogger\n- Display success confirmation","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:59:19.099141+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:59:17.347148+01:00","closed_at":"2026-01-08T05:59:17.347148+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.1.6","depends_on_id":"agent-shepherd-alg8.12.1","type":"parent-child","created_at":"2026-01-07T01:59:19.100051+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.1.7","title":"4.1.7 Implement phaseMsgReceive Command","description":"4.1.7 Implement phaseMsgReceive Command\n\n**WHAT**: Add CLI command to receive messages\n**WHY**: Simple way to check for messages\n**HOW**: Query most recent message for phase\n\nAdd command to plugins/phase-messenger/index.js:\n- Validate required parameters (issueId, forPhase)\n- Query most recent message via MessageLogger\n- Display message details if found\n- Show formatted output with all fields\n- Handle case when no messages found","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:59:21.207754+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:59:17.181361+01:00","closed_at":"2026-01-08T05:59:17.181361+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.1.7","depends_on_id":"agent-shepherd-alg8.12.1","type":"parent-child","created_at":"2026-01-07T01:59:21.208672+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.1.8","title":"4.1.8 Implement phaseMsgList Command","description":"4.1.8 Implement phaseMsgList Command\n\n**WHAT**: Add CLI command to list messages\n**WHY**: View all messages or filter by issue\n**HOW**: Query and display messages\n\nAdd command to plugins/phase-messenger/index.js:\n- Optional issueId parameter for filtering\n- Optional limit parameter (default 20)\n- Query messages via MessageLogger\n- Display formatted list with key information\n- Show message count and summary","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:59:23.688505+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:59:17.010587+01:00","closed_at":"2026-01-08T05:59:17.010587+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.1.8","depends_on_id":"agent-shepherd-alg8.12.1","type":"parent-child","created_at":"2026-01-07T01:59:23.689304+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.1.9","title":"4.1.9 Implement Message Cleanup","description":"4.1.9 Implement Message Cleanup\n\n**WHAT**: Implement cleanupPhaseMessages() method\n**WHY**: Prevents unbounded message growth\n**HOW**: Delete from active DB, archive to separate file\n\nImplement cleanupPhaseMessages():\n- Query all messages for issue\n- Append to messages_archive.jsonl\n- Delete from active database\n- Return cleanup metrics\n\nArchive process preserves message history while keeping active DB lean","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:59:26.012068+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:59:16.848856+01:00","closed_at":"2026-01-08T05:59:16.848856+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.1.9","depends_on_id":"agent-shepherd-alg8.12.1","type":"parent-child","created_at":"2026-01-07T01:59:26.01301+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.2","title":"4.2 Implement Message Cleanup on Issue Completion","description":"4.2 Implement Message Cleanup on Issue Completion - MANUAL ONLY\n\n**Priority: MEDIUM | Strategy: Manual Cleanup**\n\n#### Overview\nManual message cleanup with per-issue archival (no automatic triggers to avoid breaking ongoing work).\n\n#### Subtasks\n- 4.2.1 Detect Issue Status Changes - CANCELLED (automatic monitoring removed)\n- 4.2.2 Trigger Cleanup on Close - CANCELLED (automatic triggers removed)  \n- 4.2.3 Archive Before Delete - IMPLEMENTED (per-issue archives)\n- 4.2.4 Add Manual Cleanup Command - IMPLEMENTED (phase-msg-cleanup CLI)\n- 4.2.5 Add Cleanup Status Reporting - IMPLEMENTED (phase-msg-status CLI)\n- 4.2.6 Tests - IMPLEMENTED (22 tests covering all scenarios)\n\n#### Key Features\n1. Manual Cleanup Only: Users trigger cleanup via CLI, no automatic interference\n2. Per-Issue Archives: Each issue gets its own archive file in messages_archive/{issue_id}.jsonl\n3. Metrics Tracking: Detailed cleanup metrics stored in cleanup_metrics.jsonl\n4. CLI Commands: phase-msg-cleanup and phase-msg-status available\n5. Comprehensive Tests: All 22 tests pass","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-07T01:59:35.583424+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:25:30.260957+01:00","closed_at":"2026-01-08T22:19:56.081139+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.2","depends_on_id":"agent-shepherd-alg8.12","type":"parent-child","created_at":"2026-01-07T01:59:35.584329+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.2.1","title":"4.2.1 Detect Issue Status Changes","description":"4.2.1 Detect Issue Status Changes - CANCELLED\n\n**STRATEGY CHANGED**: Automatic status monitoring removed to avoid interfering with ongoing work.\n\n**Original Plan**: Monitor Beads issue status for cleanup triggers, poll for status changes to 'closed', check for 'ashep-excluded' label addition.\n\n**Actual Implementation**: No automatic triggers implemented. Cleanup is manual-only via CLI commands to prevent breaking active work.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:59:37.883424+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:25:19.346512+01:00","closed_at":"2026-01-08T22:19:51.781306+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.2.1","depends_on_id":"agent-shepherd-alg8.12.2","type":"parent-child","created_at":"2026-01-07T01:59:37.884294+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.2.2","title":"4.2.2 Trigger Cleanup on Close","description":"4.2.2 Trigger Cleanup on Close - CANCELLED\n\n**STRATEGY CHANGED**: Automatic cleanup triggers removed to avoid interfering with ongoing work.\n\n**Original Plan**: Call cleanup when issue closes, trigger when issue status changes to 'closed' or gets 'ashep-excluded' label.\n\n**Actual Implementation**: No automatic triggers implemented. Cleanup is manual-only via CLI commands (phase-msg-cleanup) to prevent breaking active work.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:59:39.878655+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:25:21.683049+01:00","closed_at":"2026-01-08T22:19:51.783759+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.2.2","depends_on_id":"agent-shepherd-alg8.12.2","type":"parent-child","created_at":"2026-01-07T01:59:39.879645+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.2.3","title":"4.2.3 Archive Before Delete","description":"4.2.3 Archive Before Delete - IMPLEMENTED\n\n**WHAT**: Preserve messages in per-issue archives before deletion\n**WHY**: Maintains audit trail even after removal from active DB\n**HOW**: Create per-issue archive files\n\nArchive process:\n- Query all messages for issue\n- Create messages_archive/{issue_id}.jsonl file\n- Append messages with archive metadata\n- Preserve all original message data\n- Include archive timestamp and reason\n\nDesign rationale: Per-issue archives prevent single large file, preserve history, active DB stays lean.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:59:42.195785+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:25:24.054277+01:00","closed_at":"2026-01-08T22:19:51.785092+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.2.3","depends_on_id":"agent-shepherd-alg8.12.2","type":"parent-child","created_at":"2026-01-07T01:59:42.196631+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.2.4","title":"4.2.4 Add Manual Cleanup Command","description":"4.2.4 Add Manual Cleanup Command\n\n**WHAT**: Add CLI command for manual message cleanup\n**WHY**: Allows users to trigger cleanup manually\n**HOW**: Add phase-msg-cleanup command\n\nAdd command to plugins/phase-messenger/index.js:\n- Required --issue-id parameter\n- Optional --reason parameter (default 'manual')\n- Call messageLogger.cleanupPhaseMessages()\n- Display success/error messages\n\nUsage: ashep phase-msg-cleanup --issue-id ISSUE-123 [--reason manual]","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:59:44.364984+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:19:51.80407+01:00","closed_at":"2026-01-08T22:19:51.80407+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.2.4","depends_on_id":"agent-shepherd-alg8.12.2","type":"parent-child","created_at":"2026-01-07T01:59:44.365848+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.2.5","title":"4.2.5 Add Cleanup Status Reporting","description":"4.2.5 Add Cleanup Status Reporting\n\n**WHAT**: Track and report cleanup operations\n**WHY**: Visibility into message cleanup activity\n**HOW**: Track metrics and expose via CLI\n\nTrack cleanup metrics:\n- timestamp, issue_id, reason\n- messages_archived, messages_deleted\n- db_size_before_mb, db_size_after_mb\n\nRecord metrics in cleanup_metrics table\n\nAdd phase-msg-status command:\n- Optional --issue-id for specific issue\n- Show active/archived counts\n- Show overall database statistics","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:59:46.539433+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:19:51.805101+01:00","closed_at":"2026-01-08T22:19:51.805101+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.2.5","depends_on_id":"agent-shepherd-alg8.12.2","type":"parent-child","created_at":"2026-01-07T01:59:46.540497+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.2.6","title":"4.2.6 Tests","description":"4.2.6 Tests\n\n**WHAT**: Test cleanup triggers and archival\n**WHY**: Ensures messages are preserved and cleaned appropriately\n**HOW**: Create test scenarios\n\nTest cleanup triggers on issue close:\n- Create messages for issue\n- Set issue status to 'closed'\n- Verify cleanup triggered\n- Verify messages archived and deleted\n\nTest cleanup triggers on exclusion:\n- Add 'ashep-excluded' label\n- Verify same cleanup behavior\n\nTest archival preserves data:\n- Create messages with various content\n- Run cleanup\n- Verify all messages in archive JSONL\n- Verify data integrity matches\n\nTest manual cleanup command:\n- Run phase-msg-cleanup CLI\n- Verify cleanup executes\n- Verify messages archived/deleted\n- Verify cleanup status updated\n\nTest cleanup status reporting:\n- Run phase-msg-status for specific issue\n- Verify active/archived counts\n- Run without issue for overall stats","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:59:49.252809+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:19:51.805341+01:00","closed_at":"2026-01-08T22:19:51.805341+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.2.6","depends_on_id":"agent-shepherd-alg8.12.2","type":"parent-child","created_at":"2026-01-07T01:59:49.25368+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.3","title":"4.3 Create Comprehensive Architecture Documentation","description":"4.3 Create Comprehensive Architecture Documentation\n**Priority: HIGH | Dependency: Phase 2, Phase 3**\n\n#### Overview\nCreate comprehensive documentation for the enhanced Agent Shepherd system including architecture, transitions, loop prevention, decision agents, and garbage collection.\n\n#### Subtasks\n- 4.3.1 Create docs/enhanced-transitions.md\n- 4.3.2 Create docs/loop-prevention.md\n- 4.3.3 Create docs/decision-agents.md\n- 4.3.4 Create docs/garbage-collection.md\n- 4.3.5 Create docs/phase-messenger.md\n- 4.3.6 Update docs/architecture.md\n- 4.3.7 Update docs/policies-config.md\n- 4.3.8 Update AGENTS.md\n\n#### Scratchpad\nWhen assigned this epic, consume the overall context and select the next available child issue to work on, rather than working on the epic directly.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-07T01:59:52.04492+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:56:34.32691+01:00","closed_at":"2026-01-08T22:56:34.32691+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.3","depends_on_id":"agent-shepherd-alg8.12","type":"parent-child","created_at":"2026-01-07T01:59:52.046946+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.3.1","title":"4.3.1 Create docs/enhanced-transitions.md","description":"4.3.1 Create docs/enhanced-transitions.md\n\n**WHAT**: Document enhanced transition system\n**WHY**: Users need guide for using advanced workflow features\n**HOW**: Comprehensive documentation with examples\n\nDocument overview, conditional transitions, string transitions, AI-based transitions, outcome types, and migration guide from simple to enhanced transitions","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:59:54.188229+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:56:34.200375+01:00","closed_at":"2026-01-08T22:56:34.200375+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.3.1","depends_on_id":"agent-shepherd-alg8.12.3","type":"parent-child","created_at":"2026-01-07T01:59:54.189048+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.3.2","title":"4.3.2 Create docs/loop-prevention.md","description":"4.3.2 Create docs/loop-prevention.md\n\n**WHAT**: Document loop prevention system\n**WHY**: Critical for preventing infinite workflows\n**HOW**: Detailed explanation of all loop prevention mechanisms\n\nDocument phase visit limits, transition limits, cycle detection, configuration options, and HITL escalation","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:59:56.108504+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:56:33.736139+01:00","closed_at":"2026-01-08T22:56:33.736139+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.3.2","depends_on_id":"agent-shepherd-alg8.12.3","type":"parent-child","created_at":"2026-01-07T01:59:56.109588+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.3.3","title":"4.3.3 Create docs/decision-agents.md","description":"4.3.3 Create docs/decision-agents.md\n\n**WHAT**: Document decision-making agent system\n**WHY**: Critical for understanding AI-based routing\n**HOW**: Complete guide on capabilities, prompts, and integration\n\nDocument capabilities, prompt structure, custom templates, confidence thresholds, response format, and examples","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:59:58.403328+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:56:33.576439+01:00","closed_at":"2026-01-08T22:56:33.576439+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.3.3","depends_on_id":"agent-shepherd-alg8.12.3","type":"parent-child","created_at":"2026-01-07T01:59:58.404146+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.3.4","title":"4.3.4 Create docs/garbage-collection.md","description":"4.3.4 Create docs/garbage-collection.md\n\n**WHAT**: Document garbage collection and archival system\n**WHY**: Critical for long-term system maintenance\n**HOW**: Complete guide on retention policies and cleanup\n\nDocument retention tiers, garbage collection process, configuration, and message cleanup following same retention as runs","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T02:00:01.193928+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:56:33.410275+01:00","closed_at":"2026-01-08T22:56:33.410275+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.3.4","depends_on_id":"agent-shepherd-alg8.12.3","type":"parent-child","created_at":"2026-01-07T02:00:01.194693+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.3.5","title":"4.3.5 Create docs/phase-messenger.md","description":"4.3.5 Create docs/phase-messenger.md\n\n**WHAT**: Document phase messenger plugin\n**WHY**: Users need guide for inter-phase communication\n**HOW**: Complete documentation of plugin usage\n\nDocument overview, architecture, CLI commands, automatic integration, and usage examples","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T02:00:03.305949+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:56:33.251393+01:00","closed_at":"2026-01-08T22:56:33.251393+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.3.5","depends_on_id":"agent-shepherd-alg8.12.3","type":"parent-child","created_at":"2026-01-07T02:00:03.306769+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.3.6","title":"4.3.6 Update docs/architecture.md","description":"4.3.6 Update docs/architecture.md\n\n**WHAT**: Update architecture documentation with new systems\n**WHY**: Reflects current state of system\n**HOW**: Add new components and data flows\n\nUpdate architecture diagram and document data flows for enhanced transitions, loop prevention, decision agents, garbage collection, and phase messenger","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T02:00:05.621337+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:56:33.078933+01:00","closed_at":"2026-01-08T22:56:33.078933+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.3.6","depends_on_id":"agent-shepherd-alg8.12.3","type":"parent-child","created_at":"2026-01-07T02:00:05.622298+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.3.7","title":"4.3.7 Update docs/policies-config.md","description":"4.3.7 Update docs/policies-config.md\n\n**WHAT**: Add transition and decision agent documentation\n**WHY**: Users need complete policy configuration reference\n**HOW**: Add sections for new features\n\nAdd conditional transitions, loop prevention configuration, and decision agent examples with complete YAML configurations","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T02:00:07.754177+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:56:32.920278+01:00","closed_at":"2026-01-08T22:56:32.920278+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.3.7","depends_on_id":"agent-shepherd-alg8.12.3","type":"parent-child","created_at":"2026-01-07T02:00:07.755188+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.3.8","title":"4.3.8 Update AGENTS.md","description":"4.3.8 Update AGENTS.md\n\n**WHAT**: Update AGENTS.md with new features\n**WHY**: Primary reference for developers\n**HOW**: Add new features to project overview\n\nUpdate project overview with new features (Enhanced Transitions, Loop Prevention, Decision Agents, Garbage Collection, Phase Messenger) and update architecture patterns","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T02:00:09.737386+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:56:32.748191+01:00","closed_at":"2026-01-08T22:56:32.748191+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.3.8","depends_on_id":"agent-shepherd-alg8.12.3","type":"parent-child","created_at":"2026-01-07T02:00:09.738113+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.4","title":"4.4 Document All Schemas, APIs, and Integration Patterns","description":"4.4 Document All Schemas, APIs, and Integration Patterns\n**Priority: HIGH | Dependency: 4.3**\n\n#### Overview\nCreate JSON schemas, API documentation, integration examples, and troubleshooting guides for all new features.\n\n#### Subtasks\n- 4.4.1 Create schemas/transition.schema.json\n- 4.4.2 Create schemas/retention.schema.json\n- 4.4.3 Create schemas/decision.schema.json\n- 4.4.4 Create schemas/message.schema.json\n- 4.4.5 Create API Documentation\n- 4.4.6 Create Integration Examples\n- 4.4.7 Create Integration Guides\n- 4.4.8 Create Troubleshooting Guide\n\n#### Scratchpad\nWhen assigned this epic, consume the overall context and select the next available child issue to work on, rather than working on the epic directly.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-07T02:00:12.578746+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:25:50.274721+01:00","closed_at":"2026-01-08T23:25:50.274721+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.4","depends_on_id":"agent-shepherd-alg8.12","type":"parent-child","created_at":"2026-01-07T02:00:12.579569+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.4.1","title":"4.4.1 Create schemas/transition.schema.json","description":"4.4.1 Create schemas/transition.schema.json\n\n**WHAT**: Define JSON schema for transition configuration\n**WHY**: Enables validation and IDE autocomplete\n**HOW**: Complete schema with all fields and examples\n\nCreate comprehensive JSON schema for TransitionConfig and TransitionBlock with all properties, validation rules, and documentation","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T02:00:14.69307+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:25:50.122312+01:00","closed_at":"2026-01-08T23:25:50.122312+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.4.1","depends_on_id":"agent-shepherd-alg8.12.4","type":"parent-child","created_at":"2026-01-07T02:00:14.693884+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.4.2","title":"4.4.2 Create schemas/retention.schema.json","description":"4.4.2 Create schemas/retention.schema.json\n\n**WHAT**: Define schema for retention policy\n**WHY**: Validates garbage collection configuration\n**HOW**: Complete schema for retention settings\n\nCreate JSON schema for RetentionPolicy with age_days, archive_after_days, delete_after_days fields and validation","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T02:00:17.272764+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:25:49.969551+01:00","closed_at":"2026-01-08T23:25:49.969551+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.4.2","depends_on_id":"agent-shepherd-alg8.12.4","type":"parent-child","created_at":"2026-01-07T02:00:17.27368+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.4.3","title":"4.4.3 Create schemas/decision.schema.json","description":"4.4.3 Create schemas/decision.schema.json\n\n**WHAT**: Define schema for decision agent communication\n**WHY**: Ensures valid decision inputs and outputs\n**HOW**: Complete schema for decision flow\n\nCreate JSON schema for DecisionConfig and DecisionResult with all required fields and validation rules","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T02:00:19.330701+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:25:49.838218+01:00","closed_at":"2026-01-08T23:25:49.838218+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.4.3","depends_on_id":"agent-shepherd-alg8.12.4","type":"parent-child","created_at":"2026-01-07T02:00:19.331548+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.4.4","title":"4.4.4 Create schemas/message.schema.json","description":"4.4.4 Create schemas/message.schema.json\n\n**WHAT**: Define schema for phase messenger messages\n**WHY**: Validates message structure\n**HOW**: Complete schema with all message types\n\nCreate JSON schema for MessageRecord with all fields including message_type enum and validation rules","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T02:00:22.042481+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:25:49.675294+01:00","closed_at":"2026-01-08T23:25:49.675294+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.4.4","depends_on_id":"agent-shepherd-alg8.12.4","type":"parent-child","created_at":"2026-01-07T02:00:22.043261+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.4.5","title":"4.4.5 Create API Documentation","description":"4.4.5 Create API Documentation\n\n**WHAT**: Document all public APIs with JSDoc\n**WHY**: Enables developers to use APIs correctly\n**HOW**: Add comprehensive JSDoc to all public methods\n\nDocument PolicyEngine new methods (determineTransition), loop prevention methods (validatePhaseLimits, detectCycles), decision agent methods (buildDecisionInstructions, parseDecisionResponse), and Logger new methods with examples","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T02:00:24.291696+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:25:49.535878+01:00","closed_at":"2026-01-08T23:25:49.535878+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.4.5","depends_on_id":"agent-shepherd-alg8.12.4","type":"parent-child","created_at":"2026-01-07T02:00:24.292492+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.4.6","title":"4.4.6 Create Integration Examples","description":"4.4.6 Create Integration Examples\n\n**WHAT**: Provide working example configurations\n**WHY**: Users can reference and adapt examples\n**HOW**: Complete YAML files with detailed comments\n\nCreate examples/enhanced-workflow-example.yaml, examples/loop-prevention-example.yaml, and examples/decision-agent-example.yaml with complete working configurations","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T02:00:26.526288+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:25:49.363828+01:00","closed_at":"2026-01-08T23:25:49.363828+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.4.6","depends_on_id":"agent-shepherd-alg8.12.4","type":"parent-child","created_at":"2026-01-07T02:00:26.527053+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.4.7","title":"4.4.7 Create Integration Guides","description":"4.4.7 Create Integration Guides\n\n**WHAT**: Provide step-by-step integration guides\n**WHY**: Users need clear instructions for adopting features\n**HOW**: Comprehensive guides with code examples\n\nCreate docs/integration-guides.md with guides for adding enhanced transitions, enabling loop prevention, setting up decision agents, enabling phase messenger, and configuring garbage collection","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T02:00:28.871612+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:25:49.21869+01:00","closed_at":"2026-01-08T23:25:49.21869+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.4.7","depends_on_id":"agent-shepherd-alg8.12.4","type":"parent-child","created_at":"2026-01-07T02:00:28.872466+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.12.4.8","title":"4.4.8 Create Troubleshooting Guide","description":"4.4.8 Create Troubleshooting Guide\n\n**WHAT**: Comprehensive troubleshooting for all new features\n**WHY**: Users encounter issues, need solutions\n**HOW**: Organized by problem area with solutions\n\nCreate docs/troubleshooting.md with sections for transition issues, loop prevention issues, garbage collection issues, and phase messenger issues with symptoms, solutions, and examples","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T02:00:30.766677+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:25:49.090364+01:00","closed_at":"2026-01-08T23:25:49.090364+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.12.4.8","depends_on_id":"agent-shepherd-alg8.12.4","type":"parent-child","created_at":"2026-01-07T02:00:30.767461+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.2","title":"1.4 Implement Duration Metrics Calculation","description":"Track execution time for performance monitoring and timeout detection.\n\n### Problem\nNo visibility into agent performance, bottlenecks, or timeout violations.\n\n### Solution\n- Track start/end timestamps for agent execution\n- Calculate and store duration metrics\n- Add timeout detection based on policy thresholds\n- Provide duration aggregation queries for analysis\n\n### Dependencies\nDepends on 1.2 (RunOutcome Enrichment)\n\n### Implementation Plan\n1. Add timestamp tracking to worker engine\n2. Store calculated duration in RunOutcome\n3. Add phase duration tracking across retries\n4. Implement timeout detection logic\n5. Add duration query methods to Logger\n6. Add comprehensive tests for duration tracking\n\n### Expected Outcomes\n- Accurate duration calculation for all agent executions\n- Timeout detection when phases exceed policy limits\n- Duration aggregation queries (average, total, slowest phases)\n- Performance insights to identify bottlenecks\n- Full test coverage for duration tracking","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T23:17:48.189263+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:51:39.491894+01:00","closed_at":"2026-01-07T05:51:39.491894+01:00","close_reason":"Completed implementation and testing","dependencies":[{"issue_id":"agent-shepherd-alg8.2","depends_on_id":"agent-shepherd-alg8","type":"parent-child","created_at":"2026-01-06T23:17:48.190219+01:00","created_by":"daemon"},{"issue_id":"agent-shepherd-alg8.2","depends_on_id":"agent-shepherd-alg8.5","type":"blocks","created_at":"2026-01-06T23:23:13.58374+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.2.1","title":"1.4.2 Store Duration in RunOutcome","description":"Persist calculated duration metrics in execution outcome.\n\n### Implementation\n- Modify RunOutcome population in launchAgent():\n  - Set outcome.metrics = { duration_ms: endTimestamp - startTimestamp }\n  - Merge with any metrics from parseRunOutput() (prefer parsed metrics if available)\n- Handle case where agent times out vs completes normally:\n  - If timeout, still capture duration up to timeout point\n  - Add timeout metadata to indicate which phase timed out\n- Store both wall-clock time and CPU time if available from OpenCode:\n  - If OpenCode provides CPU time, store in metrics.cpu_time_ms\n  - This helps distinguish between wall-clock and actual processing time\n\n### Expected Deliverables\n- Duration stored in RunOutcome\n- Timeout handling implemented\n- CPU time capture if available","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T23:22:13.711139+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:51:39.350208+01:00","closed_at":"2026-01-07T05:51:39.350208+01:00","close_reason":"Completed implementation and testing","dependencies":[{"issue_id":"agent-shepherd-alg8.2.1","depends_on_id":"agent-shepherd-alg8.2","type":"parent-child","created_at":"2026-01-06T23:22:13.758809+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.2.2","title":"1.4.1 Add Timestamp Tracking to Worker Engine","description":"Track start and end timestamps for agent execution.\n\n### Implementation\n- Add start_timestamp: number variable before agent launch\n  - In worker-engine.ts:launchAgent() at line 290, before opencode.runAgentCLI()\n  - Add: const startTimestamp = Date.now();\n- Add end_timestamp: number variable after agent completion\n  - At line 310, after opencode.runAgentCLI() completes\n  - Add: const endTimestamp = Date.now();\n- Calculate duration_ms = end_timestamp - start_timestamp\n- Pass duration to RunOutcome.metrics.duration_ms\n\n### Expected Deliverables\n- Timestamp tracking implemented\n- Duration calculation working\n- Documentation of timing logic","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T23:22:13.711316+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:51:39.201057+01:00","closed_at":"2026-01-07T05:51:39.201057+01:00","close_reason":"Completed implementation and testing","dependencies":[{"issue_id":"agent-shepherd-alg8.2.2","depends_on_id":"agent-shepherd-alg8.2","type":"parent-child","created_at":"2026-01-06T23:22:13.75704+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.2.3","title":"1.4.4 Add Timeout Detection","description":"Compare actual duration against policy timeout thresholds.\n\n### Implementation\n- Compare duration vs policy timeout:\n  - Get timeout from policyEngine.calculateTimeout(policy, phase)\n  - Calculate: policy.calculateTimeout() returns timeout based on base and multiplier\n- Mark as timeout failure if duration exceeds timeout:\n  - Set outcome.success = false\n  - Set outcome.error = \"Execution exceeded timeout of ms\"\n  - Set outcome.error_details = { type: 'TimeoutError', timeout_ms: timeout, actual_duration_ms: duration_ms }\n- Add timeout detection metadata:\n  - Store timeout_threshold_ms in metadata\n  - Store timeout_exceeded boolean in metadata\n- Log timeout as special decision type:\n  - Log decision with type=\"timeout\" if timeout detected\n  - Include timeout vs actual duration in decision metadata\n\n### Expected Deliverables\n- Timeout detection implemented\n- Timeout metadata stored\n- Timeout decision logging","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T23:22:21.69818+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:51:39.066846+01:00","closed_at":"2026-01-07T05:51:39.066846+01:00","close_reason":"Completed implementation and testing","dependencies":[{"issue_id":"agent-shepherd-alg8.2.3","depends_on_id":"agent-shepherd-alg8.2","type":"parent-child","created_at":"2026-01-06T23:22:21.703471+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.2.5","title":"1.4.3 Add Phase Duration Tracking","description":"Track total time spent in each phase across all attempts.\n\n### Implementation\n- Track time spent in each phase across all attempts:\n  - Query logger for all runs for issue_id + phase\n  - Sum up duration_ms from all completed runs\n  - Store in run metadata as phase_total_duration_ms\n- Accumulate duration across retries:\n  - When retrying same phase, add to cumulative duration\n  - Track as separate field to show total phase time\n- Store phase_duration_ms in run metadata for each run\n\n### Expected Deliverables\n- Phase duration tracking implemented\n- Cumulative duration across retries\n- Metadata fields for phase timing","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T23:22:37.275112+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:51:38.924471+01:00","closed_at":"2026-01-07T05:51:38.924471+01:00","close_reason":"Completed implementation and testing","dependencies":[{"issue_id":"agent-shepherd-alg8.2.5","depends_on_id":"agent-shepherd-alg8.2","type":"parent-child","created_at":"2026-01-06T23:22:37.281699+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.2.6","title":"1.4.5 Add Duration Queries to Logger","description":"Provide methods to query duration metrics for analysis.\n\n### Implementation\n- Add getAveragePhaseDuration(issue_id: string, phase_name: string): Promise\u003cnumber\u003e:\n  - Query runs for issue_id and phase\n  - Filter by status=\"completed\" or \"failed\" (exclude pending)\n  - Calculate average of duration_ms from all runs\n  - Return average in milliseconds\n- Add getTotalIssueDuration(issue_id: string): Promise\u003cnumber\u003e:\n  - Query all runs for issue_id\n  - Sum up duration_ms from all completed runs\n  - Return total time spent on issue\n- Add getSlowestPhases(issue_id: string, limit?: number): Promise\u003cArray\u003c{phase: string, avg_duration_ms: number}\u003e\u003e:\n  - Group runs by phase\n  - Calculate average duration per phase\n  - Sort by average duration descending\n  - Return top N slowest phases\n  - Useful for identifying performance bottlenecks\n- Index runs.db by phase and completed_at for these queries:\n  - Add index: CREATE INDEX idx_runs_phase_completed ON runs(phase, completed_at)\n  - This optimizes aggregation queries\n\n### Expected Deliverables\n- Duration query methods implemented\n- Performance analysis capabilities\n- Index for optimized queries","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T23:22:37.316827+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:51:38.771369+01:00","closed_at":"2026-01-07T05:51:38.771369+01:00","close_reason":"Completed implementation and testing","dependencies":[{"issue_id":"agent-shepherd-alg8.2.6","depends_on_id":"agent-shepherd-alg8.2","type":"parent-child","created_at":"2026-01-06T23:22:37.317497+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.2.7","title":"1.4.6 Tests for Duration Tracking","description":"Comprehensive tests for duration calculation and tracking.\n\n### Test Cases\n- Test accurate duration calculation:\n  - Create mock execution with known start/end times\n  - Verify duration_ms calculated correctly\n  - Test with various execution times (short, medium, long)\n- Test timeout detection:\n  - Configure policy with short timeout\n  - Simulate execution exceeding timeout\n  - Verify marked as timeout failure\n  - Verify timeout metadata set correctly\n  - Test execution within timeout (should not mark as timeout)\n- Test duration aggregation across retries:\n  - Create multiple runs for same phase\n  - Verify phase_total_duration_ms accumulated correctly\n  - Verify average phase duration calculated correctly\n- Test performance analysis queries:\n  - Create runs with various durations per phase\n  - Test getAveragePhaseDuration returns correct averages\n  - Test getTotalIssueDuration returns correct sum\n  - Test getSlowestPhases identifies correct slow phases\n  - Test limit parameter in getSlowestPhases\n\n### Expected Deliverables\n- Complete test suite for duration tracking\n- Tests for timeout detection\n- Performance analysis query tests","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T23:22:37.351437+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:51:38.611512+01:00","closed_at":"2026-01-07T05:51:38.611512+01:00","close_reason":"Completed implementation and testing","dependencies":[{"issue_id":"agent-shepherd-alg8.2.7","depends_on_id":"agent-shepherd-alg8.2","type":"parent-child","created_at":"2026-01-06T23:22:37.352138+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.4","title":"1.1 Fix Retry Counting Logic","description":"Implement proper retry counting using runs.db to enforce max_attempts limits.\n\n### Problem\nCurrent system doesn't properly count retries, allowing infinite attempts even when max_attempts is configured.\n\n### Solution\n- Track actual retry attempts using existing run records in runs.db\n- Query runs.db for previous attempts per issue+phase combination\n- Pass retry count to policy engine to enforce limits\n- Block retry when max_attempts is reached\n\n### Dependencies\nNone\n\n### Implementation Plan\n1. Analyze current retry implementation in policy.ts\n2. Implement getPhaseRetryCount() method in Logger\n3. Integrate retry count calculation in worker-engine.ts\n4. Update policy engine to respect actual retry count\n5. Add comprehensive unit and integration tests\n\n### Expected Outcomes\n- Retry count properly increments with each failed attempt\n- max_attempts limit enforced, preventing infinite retries\n- Retry delay follows configured strategy (exponential/linear/fixed)\n- Full test coverage for retry logic","notes":"All subtasks completed successfully. Implemented getPhaseRetryCount() method, integrated retry count into worker engine, updated policy engine to use actual retry count, created comprehensive unit and integration tests. All type checking and linting passed.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T23:18:04.866481+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:41:45.190571+01:00","closed_at":"2026-01-07T02:41:45.187194+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.4","depends_on_id":"agent-shepherd-alg8","type":"parent-child","created_at":"2026-01-06T23:18:04.867153+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.4.1","title":"1.1.2 Implement Retry Counting via runs.db","description":"Track actual retry attempts using existing run records instead of ignoring max_attempts.\n\n### Implementation\n- Add getPhaseRetryCount(issueId: string, phaseName: string): Promise\u003cnumber\u003e method to Logger class\n  - Query runs.db for records matching issue_id + phase\n  - Filter by status=\"failed\" to count actual failed attempts\n  - Return count (this will be the retry_count for next attempt)\n- Add composite index to runs.db on (issue_id, phase, status) for performance\n- Update RunRecord interface to track attempt_number if needed for clarity\n\n### Expected Deliverables\n- getPhaseRetryCount() method implemented in Logger class\n- Composite index added to runs.db\n- Documentation of retry counting logic","notes":"Implemented getPhaseRetryCount() method and added composite index on (issue_id, phase, status). Type checking and linting passed.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T23:18:46.445282+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:29:53.669748+01:00","closed_at":"2026-01-07T02:29:53.665563+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.4.1","depends_on_id":"agent-shepherd-alg8.4","type":"parent-child","created_at":"2026-01-06T23:18:46.452074+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.4.2","title":"1.1.1 Analyze Current Retry Implementation","description":"Review policy.ts:determineTransition() retry logic (lines 307-327) to identify where retry_count should be tracked.\n\n### Tasks\n- Review policy.ts:determineTransition() retry logic (lines 307-327)\n- Identify where retry_count should be tracked vs where it's currently (not) tracked\n- Document the max_attempts from policy.retry configuration (lines 27, 71, 108)\n- Identify that retry_count is passed but never populated from actual run history\n- Document current retry_count source and limitations by examining the code flow\n\n### Expected Deliverables\n- Documentation of current retry counting implementation\n- Analysis of why infinite retries occur\n- Identification of required changes","notes":"Analysis complete. Root cause identified: retry_count defaults to 0 because it's never populated from run history. Required changes documented.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T23:18:56.918521+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:28:05.322931+01:00","closed_at":"2026-01-07T02:28:05.319556+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.4.2","depends_on_id":"agent-shepherd-alg8.4","type":"parent-child","created_at":"2026-01-06T23:18:56.923748+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.4.3","title":"1.1.3 Integrate Retry Count into Worker Engine","description":"Calculate and pass actual retry count to policy engine's determineTransition().\n\n### Implementation\n- Modify worker-engine.ts:processIssue() to:\n  - Before launching agent, query Logger for existing failed attempts of same phase\n  - Calculate: retry_count = number of previous failed runs\n  - Pass retry_count to determineTransition() call (line 226)\n- Update run record creation to include attempt_number in metadata for debugging\n\n### Expected Deliverables\n- Worker engine calculates retry_count before agent execution\n- retry_count passed to policy engine\n- attempt_number tracked in run metadata","notes":"Integrated retry count calculation in worker engine. Added retry_count to determineTransition() call and attempt_number to run metadata. Type checking and linting passed.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T23:19:13.556304+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:31:22.123838+01:00","closed_at":"2026-01-07T02:31:22.12196+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.4.3","depends_on_id":"agent-shepherd-alg8.4","type":"parent-child","created_at":"2026-01-06T23:19:13.564008+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.4.4","title":"1.1.4 Update Policy Engine to Use Actual Retry Count","description":"Make determineTransition() respect provided retry_count instead of defaulting to 0.\n\n### Implementation\n- Modify policy.ts:determineTransition():\n  - Remove the line: const retryCount = outcome.retry_count || 0;\n  - Use the retry_count parameter directly\n  - Add validation that retry_count \u003c max_attempts - 1 before allowing retry\n- Update logic: if (retryCount \u003e= retryConfig.max_attempts - 1), then block instead of retry\n\n### Expected Deliverables\n- Policy engine uses actual retry_count from worker engine\n- Validation ensures max_attempts is enforced\n- Retry blocked when limit reached","notes":"Updated determineTransition() to use actual retry_count parameter directly instead of defaulting to 0. Improved reason message to show actual max_attempts. Type checking and linting passed.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T23:19:13.600622+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:31:59.94934+01:00","closed_at":"2026-01-07T02:31:59.94934+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.4.4","depends_on_id":"agent-shepherd-alg8.4","type":"parent-child","created_at":"2026-01-06T23:19:13.601333+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.4.5","title":"1.1.5 Add Unit Tests for Retry Counting","description":"Comprehensive tests for retry counting logic to prevent regression.\n\n### Test Cases\n- First attempt: retry_count = 0, retry allowed\n- Second attempt after failure: retry_count = 1, retry allowed (if max_attempts \u003e 2)\n- After max_attempts: retry_count = max_attempts, blocked\n- Test retry_count calculation with multiple failed runs in database\n- Test retry_count is correctly passed to determineTransition()\n- Test backward compatibility with existing run records that don't have retry tracking\n- Test retry delay calculation with exponential/linear/fixed strategies at different attempt numbers\n\n### Expected Deliverables\n- Full test suite for retry counting logic\n- Tests for all retry scenarios\n- Integration with existing test infrastructure","notes":"Created comprehensive unit tests for retry counting logic covering: getPhaseRetryCount() method, determineTransition() with retry_count, calculateRetryDelay() for exponential/linear strategies, and integration scenarios. All 18 tests pass.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T23:19:13.634331+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:36:10.128155+01:00","closed_at":"2026-01-07T02:36:10.126214+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.4.5","depends_on_id":"agent-shepherd-alg8.4","type":"parent-child","created_at":"2026-01-06T23:19:13.635225+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.4.6","title":"1.1.6 Integration Testing","description":"End-to-end test of retry counting with actual policy execution.\n\n### Test Scenario\n- Create issue with policy having max_attempts: 2\n- Execute phase, force failure\n- Verify second attempt happens (retry_count = 1)\n- Force second failure\n- Verify third attempt is blocked (retry_count = 2, max_attempts = 2)\n\n### Verification\n- Retry count properly increments across attempts\n- Max_attempts blocks after limit is reached\n- Retry delay follows configured strategy\n\n### Expected Deliverables\n- End-to-end integration test for retry logic\n- Verification of retry limit enforcement\n- Documentation of test results","notes":"Created end-to-end integration tests for retry counting logic covering: retry flow with max_attempts: 2, retry count progression, max_attempts blocking, success on retry attempts, exponential backoff delays, and complete workflow simulation. All 8 tests pass.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T23:19:18.733913+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:41:39.16078+01:00","closed_at":"2026-01-07T02:41:39.157161+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.4.6","depends_on_id":"agent-shepherd-alg8.4","type":"parent-child","created_at":"2026-01-06T23:19:18.740963+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.5","title":"1.2 Complete RunOutcome Enrichment from OpenCode CLI","description":"Parse comprehensive execution data from OpenCode CLI JSON output for better observability.\n\n### Problem\nCurrently only capturing basic success/failure, missing valuable execution data available in OpenCode CLI output.\n\n### Solution\n- Parse full JSON output structure from OpenCode CLI\n- Extend RunOutcome interface with rich execution data\n- Capture metrics, artifacts, warnings, error details, tool calls\n- Implement duration tracking and timeout detection\n\n### Dependencies\nNone\n\n### Implementation Plan\n1. Analyze OpenCode CLI JSON output format\n2. Extend RunOutcome interface with new fields\n3. Create parseRunOutput() method for comprehensive parsing\n4. Calculate duration metrics and detect timeouts\n5. Integrate enhanced output into worker engine\n6. Update logging to preserve all new data\n7. Add comprehensive parsing tests\n\n### Expected Outcomes\n- Full OpenCode execution data captured and stored\n- Rich metrics: duration, tokens, API calls, model used\n- Structured artifacts with operation types\n- Detailed error information with stack traces\n- Tool usage tracking with inputs, outputs, timing\n- Timeout detection and reporting","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T23:18:29.96845+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:39:15.359888+01:00","closed_at":"2026-01-07T03:39:15.359888+01:00","close_reason":"All 7 subtasks completed: Analyzed OpenCode CLI output format, extended RunOutcome interface with new types, implemented parseRunOutput() with comprehensive JSONL parsing, added duration metrics and timeout detection, integrated enhanced output into worker engine, verified logging system handles new fields, and created comprehensive test suite with 27 tests covering all parsing scenarios.","dependencies":[{"issue_id":"agent-shepherd-alg8.5","depends_on_id":"agent-shepherd-alg8","type":"parent-child","created_at":"2026-01-06T23:18:29.983117+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.5.1","title":"1.2.1 Analyze OpenCode CLI Output Format","description":"Capture and document the full JSON output structure from OpenCode CLI.\n\n### Tasks\n- Execute sample OpenCode agent run with --format json flag\n- Capture full stdout and stderr output\n- Document JSON structure:\n  - Session ID and session metadata\n  - Metrics: duration, tokens used, API calls, model used\n  - Artifacts: files created, modified, deleted\n  - Error details: stack traces, error types, line numbers\n  - Warnings: non-blocking issues or informational messages\n- Identify which fields map to RunOutcome interface and which need new fields\n- Document any variations in output format between different agent types/models\n\n### Expected Deliverables\n- Complete documentation of OpenCode CLI JSON output format\n- Mapping of output fields to RunOutcome interface\n- Identification of missing fields to add","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T23:19:32.1296+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:11:07.670342+01:00","closed_at":"2026-01-07T03:11:07.670342+01:00","close_reason":"Documented OpenCode CLI JSON output format with complete event structure, mapping to RunOutcome, and parsing strategy","dependencies":[{"issue_id":"agent-shepherd-alg8.5.1","depends_on_id":"agent-shepherd-alg8.5","type":"parent-child","created_at":"2026-01-06T23:19:32.168656+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.5.3","title":"1.2.3 Enhance OpenCode Output Parsing","description":"Parse comprehensive execution data from OpenCode CLI JSON output.\n\n### Implementation\n- Modify opencode.ts:extractSessionId() to handle full JSON structure extraction\n- Create new parseRunOutput(stdout: string, stderr: string): RunOutcome method that:\n  - Parses all JSON objects from stdout (handles multi-line JSONL output)\n  - Combines information from multiple JSON lines\n  - Extracts:\n    - Session ID from any session metadata object\n    - Duration from start/end timestamps or explicit duration field\n    - Token usage (input, output, total tokens)\n    - Artifacts list with operation types\n    - Error details with stack traces and context\n    - Warnings and informational messages\n    - Tool calls with inputs, outputs, timing\n    - Model name actually used\n    - API call count\n- Handle multi-line JSON output (OpenCode may emit multiple JSON objects as agent progresses)\n- Add robust error handling:\n  - Gracefully skip malformed JSON lines\n  - Log parsing warnings but continue processing\n  - Handle missing fields (use undefined/null defaults)\n  - Validate data types before assignment\n- Support both stdout and stderr JSON (some errors go to stderr)\n- Parse stderr separately and merge into result\n\n### Expected Deliverables\n- parseRunOutput() method implemented\n- Robust JSON parsing with error handling\n- Support for multi-line JSONL output\n- Test cases for various input formats","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T23:19:55.525276+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:24:27.780961+01:00","closed_at":"2026-01-07T03:24:27.780961+01:00","close_reason":"Implemented parseRunOutput() method with comprehensive JSONL parsing, event handling for all OpenCode event types, and graceful error handling for malformed JSON and missing fields.","dependencies":[{"issue_id":"agent-shepherd-alg8.5.3","depends_on_id":"agent-shepherd-alg8.5","type":"parent-child","created_at":"2026-01-06T23:19:55.564669+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.5.4","title":"1.2.2 Extend RunOutcome Interface","description":"Add fields to capture all available OpenCode execution data.\n\n### Implementation\n- Add session_id: string field to track the OpenCode session\n- Extend metrics object to include:\n  - start_time_ms?: number - When agent started execution\n  - end_time_ms?: number - When agent finished execution\n  - api_calls_count?: number - Number of API calls made\n  - model_name?: string - Model actually used (may differ from requested)\n- Extend artifacts to support structured data:\n  - Change from string[] to Artifact[] where Artifact = {path: string, operation: 'created'|'modified'|'deleted', size?: number}\n- Add warnings?: string[] field for non-blocking issues or information messages\n- Add error_details?: ErrorDetails field for structured error information:\n  - type?: string - Error type (e.g., \"TimeoutError\", \"ValidationError\")\n  - stack_trace?: string - Full stack trace\n  - file_path?: string - File where error occurred\n  - line_number?: number - Line number of error\n- Add tool_calls?: ToolCall[] field for tracking tool usage:\n  - name: string - Tool name\n  - inputs: any - Tool inputs\n  - outputs: any - Tool outputs\n  - duration_ms?: number - Tool execution time\n\n### Expected Deliverables\n- Extended RunOutcome interface with all new fields\n- TypeScript type definitions for Artifact, ErrorDetails, ToolCall\n- Documentation of all new fields","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T23:20:29.273234+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:15:04.910566+01:00","closed_at":"2026-01-07T03:15:04.910566+01:00","close_reason":"Extended RunOutcome interface with Artifact, ErrorDetails, ToolCall types and new metrics fields (start_time_ms, end_time_ms, api_calls_count, model_name). Updated JSON schema with complete type definitions.","dependencies":[{"issue_id":"agent-shepherd-alg8.5.4","depends_on_id":"agent-shepherd-alg8.5","type":"parent-child","created_at":"2026-01-06T23:20:29.325504+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.5.5","title":"1.2.4 Calculate Duration Metrics","description":"Track precise execution time for performance monitoring and timeout detection.\n\n### Implementation\n- Track start timestamp before launching agent in worker-engine.ts:launchAgent()\n  - Add const startTimestamp = Date.now(); at line 290 (before opencode.runAgentCLI call)\n- Capture end timestamp after agent completes\n  - Add const endTimestamp = Date.now(); at line 310 (after opencode.runAgentCLI completes)\n- Calculate duration_ms = endTimestamp - startTimestamp\n- Store in RunOutcome.metrics.duration_ms\n- Add timeout detection:\n  - Get timeout from policy using policyEngine.calculateTimeout(policy, phase)\n  - Compare actual duration vs policy timeout\n  - If duration \u003e policy timeout, mark as timeout failure\n  - Add timeout_reason to RunOutcome.error: \"Execution exceeded timeout of X ms\"\n- Log both wall-clock time and capture any CPU time if OpenCode provides it\n\n### Expected Deliverables\n- Duration calculation implemented in worker engine\n- Timeout detection logic\n- Duration and timeout metadata stored in RunOutcome\n- Documentation of timeout handling","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T23:20:40.580947+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:28:05.547402+01:00","closed_at":"2026-01-07T03:28:05.547402+01:00","close_reason":"Implemented duration metrics calculation with wall-clock time tracking, timeout detection using policyEngine.calculateTimeout(), and integration of parseRunOutput() results into RunOutcome","dependencies":[{"issue_id":"agent-shepherd-alg8.5.5","depends_on_id":"agent-shepherd-alg8.5","type":"parent-child","created_at":"2026-01-06T23:20:40.634133+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.5.6","title":"1.2.5 Integrate Enhanced Output into Worker Engine","description":"Populate RunOutcome with all available OpenCode execution data.\n\n### Implementation\n- Update worker-engine.ts:launchAgent() (lines 258-316):\n  - After opencode.runAgentCLI() completes, call parseRunOutput(result.stdout, result.stderr)\n  - Extract all enhanced RunOutcome fields: session_id, metrics, artifacts, warnings, error_details, tool_calls\n  - Handle cases where CLI output is missing expected fields (graceful degradation)\n  - Store session_id in run record metadata for later reference and debugging\n  - Merge parsed result with existing outcome object\n- Update run outcome handling to use enriched data in logging and decision-making\n\n### Expected Deliverables\n- Worker engine integrates parseRunOutput()\n- All enhanced fields populated in RunOutcome\n- Graceful degradation for missing fields\n- Session ID tracking for debugging","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T23:20:40.673622+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:31:27.066815+01:00","closed_at":"2026-01-07T03:31:27.066815+01:00","close_reason":"Integrated parseRunOutput() into worker engine, storing session_id in metadata for debugging, and merging all parsed fields into RunOutcome with graceful degradation for missing data","dependencies":[{"issue_id":"agent-shepherd-alg8.5.6","depends_on_id":"agent-shepherd-alg8.5","type":"parent-child","created_at":"2026-01-06T23:20:40.674317+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.5.7","title":"1.2.6 Update Logging to Store Enhanced Data","description":"Ensure logging system preserves all new RunOutcome fields.\n\n### Implementation\n- Ensure logger.updateRun() preserves all new RunOutcome fields without data loss\n- Add JSONL and SQLite schema validation for new fields:\n  - Verify complex objects (artifacts, error_details, tool_calls) serialize correctly to JSON\n  - Verify arrays (warnings) serialize correctly\n- Test JSON serialization/deserialization preserves all data types\n- Ensure SQLite TEXT columns can store JSON strings of complex objects\n- Verify backward compatibility: existing run records without new fields still load correctly\n\n### Expected Deliverables\n- JSONL and SQLite schemas support new fields\n- Serialization/deserialization preserves all data\n- Backward compatibility verified\n- Test suite for data persistence","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T23:20:47.151573+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:33:21.575594+01:00","closed_at":"2026-01-07T03:33:21.575594+01:00","close_reason":"Verified logging system correctly handles all new RunOutcome fields through JSON.stringify/parse serialization. SQLite TEXT columns properly store JSON strings. Backward compatibility maintained through optional fields.","dependencies":[{"issue_id":"agent-shepherd-alg8.5.7","depends_on_id":"agent-shepherd-alg8.5","type":"parent-child","created_at":"2026-01-06T23:20:47.187794+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.5.8","title":"1.2.7 Add Tests for Output Parsing","description":"Comprehensive unit and integration tests for output parsing.\n\n### Unit Tests for parseRunOutput()\n- Test parsing single JSON object output\n- Test parsing multi-line JSONL output\n- Test extraction of session_id from various positions\n- Test extraction of all metric fields\n- Test parsing artifacts with different operation types\n- Test parsing error details with stack traces\n- Test parsing tool calls with nested structures\n- Test parsing warnings array\n- Test handling of missing fields (graceful degradation)\n- Test handling of malformed JSON (skip with warning, continue)\n- Test combining data from multiple JSON lines\n- Test stderr error parsing and merging\n\n### Integration Test\n- Full agent execution with OpenCode CLI\n- Verify RunOutcome is fully populated\n- Verify all fields are stored in JSONL and SQLite\n- Verify data can be retrieved and deserialized correctly\n\n### Expected Deliverables\n- Complete unit test suite for parseRunOutput()\n- Integration test for full agent execution\n- Test coverage for all parsing scenarios","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T23:20:47.220059+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:39:01.515165+01:00","closed_at":"2026-01-07T03:39:01.515165+01:00","close_reason":"Created comprehensive test suite for parseRunOutput() with 27 tests covering session ID extraction, metrics parsing, artifacts, tool calls, errors, warnings, multi-line JSONL, malformed JSON, graceful degradation, command execution, and combined scenarios. All 190 tests pass.","dependencies":[{"issue_id":"agent-shepherd-alg8.5.8","depends_on_id":"agent-shepherd-alg8.5","type":"parent-child","created_at":"2026-01-06T23:20:47.220925+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6","title":"PHASE 2: Enhanced Workflows","description":"## PHASE 2: Enhanced Workflows\n**Estimated Duration: 3-4 weeks**\n\n### Overview\nThis phase extends the workflow system with intelligent transition types, conditional routing, loop prevention, and AI-powered decision agents. Enables complex workflows with non-linear progression and automated decision-making.\n\n### Scope\n\n#### 2.1 Extend Transition Types\n- Add jump_back and dynamic_decision transition types\n- Extend PhaseTransition interface with new fields\n- Implement transition validation and safety checks\n- Update worker engine to handle new transition types\n\n#### 2.2 Add Conditional Transition Configuration Schema\n- Extend PhaseConfig with optional transitions block\n- Add TransitionConfig interface for AI-based routing\n- Update policy YAML schema with validation\n- Implement conditional transition parsing and validation\n\n#### 2.3 Implement Loop Prevention System\n- Add phase visit tracking and limits\n- Implement transition pattern detection\n- Add cycle detection for oscillating workflows\n- Integrate loop prevention into determineTransition()\n\n#### 2.4 Create Decision Agent Capability System\n- Define decision agent capabilities (test-decision, validation-decision, complex-decision)\n- Update agent registry with decision agents\n- Implement buildDecisionInstructions() for comprehensive prompts\n- Create DecisionResult interface and parseDecisionResponse()\n\n#### 2.5 Add Decision Prompt Building and Response Parsing\n- Create standardized prompt templates for decision contexts\n- Enhance buildDecisionInstructions() with rich context\n- Implement response validation and sanitization\n- Add retry logic for decision agents and decision analytics\n\n### Dependencies\n- Depends on Phase 1 completion for stable foundation\n- 2.2 depends on 2.1 (transition types)\n- 2.3 depends on 2.2 (conditional transitions)\n- 2.4 depends on 2.2 (transition config)\n- 2.5 depends on 2.4 (decision agents)\n\n### Execution Notes\nWhen assigned this epic, consume the overall context and select the next available child issue to work on, rather than working on the epic directly.\n\n### Scratchpad\nDetailed implementation plan with all subtasks breakdown preserved for reference.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:29:49.399934+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:45:56.886858+01:00","closed_at":"2026-01-07T18:45:56.886858+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-alg8.6","depends_on_id":"agent-shepherd-alg8","type":"parent-child","created_at":"2026-01-07T00:29:49.400672+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.1","title":"2.1 Extend Transition Types","description":"## 2.1 Extend Transition Types\n**Priority: HIGH | Dependency: Phase 1**\n\n### Overview\nExtend the transition system beyond linear advance/retry/block/close to support complex workflows with backward jumps and AI decision-making.\n\n### Implementation Plan\n\n#### 2.1.1 Analyze Current Transition System\n- Document existing transition types and their limitations\n- Review PhaseTransition interface (lines 53-57)\n- Review determineTransition() implementation (lines 263-327)\n- Document current types: advance, retry, block, close\n- Identify limitations: only linear forward progression\n\n#### 2.1.2 Design Enhanced Transition Interface\n- Extend PhaseTransition with new types: jump_back, dynamic_decision\n- Add jump_target_phase and dynamic_agent fields\n- Maintain backward compatibility with existing fields\n- Design rationale for each new field\n\n#### 2.1.3 Implement determineTransition() Enhancements\n- Add logic to handle jump_back transitions\n- Add logic to handle dynamic_decision transitions\n- Maintain existing logic for advance/retry/block/close\n- Return enhanced transition object with all fields\n\n#### 2.1.4 Add Transition Validation\n- Create validateTransition() method\n- Validate jump_target_phase exists in policy\n- Validate no circular jumps (phase to itself)\n- Validate dynamic_agent has available agents\n- Throw descriptive errors on invalid transitions\n\n#### 2.1.5 Update Worker Engine Transition Handling\n- Extend applyTransition() to handle jump_back and dynamic_decision\n- Add case for jump_back: update phase label, clear HITL\n- Add case for dynamic_decision: execute decision agent\n- Ensure backward compatibility with existing types\n\n#### 2.1.6 Add Unit Tests for Transition Logic\n- Comprehensive tests for all transition types\n- Test transition validation catches errors\n- Test backward compatibility\n- Test dynamic_decision triggers agent execution","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:29:52.879528+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T06:03:50.381779+01:00","closed_at":"2026-01-07T06:03:50.381779+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.1","depends_on_id":"agent-shepherd-alg8.6","type":"parent-child","created_at":"2026-01-07T00:29:52.880307+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.1.1","title":"2.1.1 Analyze Current Transition System","description":"### 2.1.1 Analyze Current Transition System\n- **WHAT**: Document existing transition types and their limitations\n- **WHY**: Current system only supports linear advance/retry/block/close - need more flexibility\n- **HOW**: Review code and identify all transition scenarios\n- Review `policy.ts:PhaseTransition` interface (lines 53-57)\n- Current types: \"advance\" | \"retry\" | \"block\" | \"close\"\n- Fields: type, next_phase (optional), reason (optional)\n- Review `policy.ts:determineTransition()` implementation (lines 263-327)\n- Document current logic flow\n- Identify where transitions are determined\n- Identify limitations: only linear forward progression\n- Document current transition types:\n  - `advance`: Move to next phase in sequence\n  - `retry`: Retry current phase (with backoff)\n  - `block`: Block issue (requires HITL)\n  - `close`: Close issue (workflow complete)\n- Identify limitations:\n  - No way to jump backward to previous phase\n  - No way to delegate transition decision to AI\n  - Only linear forward progression supported\n  - No conditional routing based on outcome type","notes":"**Analysis Complete**\n\nCurrent System Documentation:\n\n**PhaseTransition Interface** (policy.ts:53-57):\n```typescript\nexport type PhaseTransition = {\n  type: \"advance\" | \"retry\" | \"block\" | \"close\";\n  next_phase?: string;\n  reason?: string;\n};\n```\n\n**determineTransition() Method** (policy.ts:263-327):\n- Checks for approval requirements (requires_approval flag or phase config)\n- Handles success: advances to next phase or closes if last phase\n- Handles failure: retries if under max_attempts, otherwise blocks\n- Returns transition with type, optional next_phase, and optional reason\n\n**Current Transition Types:**\n1. **advance**: Move to next phase in sequence\n2. **retry**: Retry current phase (with backoff)\n3. **block**: Block issue (requires HITL)\n4. **close**: Close issue (workflow complete)\n\n**Where transitions are used:**\n- worker-engine.ts:261-277 - determineTransition() called after agent execution\n- worker-engine.ts:280 - applyTransition() called to update Beads state\n- worker-engine.ts:443-495 - applyTransition() method handles each transition type\n\n**Limitations:**\n1. No way to jump backward to previous phase\n2. No way to delegate transition decision to AI\n3. Only linear forward progression supported\n4. No conditional routing based on outcome type","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:30:09.295323+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:57:03.212939+01:00","closed_at":"2026-01-07T05:57:03.212939+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.1.1","depends_on_id":"agent-shepherd-alg8.6.1","type":"parent-child","created_at":"2026-01-07T00:30:09.296427+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.1.2","title":"2.1.2 Design Enhanced Transition Interface","description":"### 2.1.2 Design Enhanced Transition Interface\n- **WHAT**: Extend PhaseTransition to support new transition types\n- **WHY**: Enables complex workflows with non-linear progression and AI decision-making\n- **HOW**: Add new fields while maintaining backward compatibility\n- Add new transition types to PhaseTransition:\n  ```typescript\n  export type PhaseTransition = {\n    type: \"advance\" | \"retry\" | \"block\" | \"close\" | \"jump_back\" | \"dynamic_decision\";\n    next_phase?: string;        // For advance, jump_back\n    reason?: string;            // Explanation\n    jump_target_phase?: string;  // For jump_back transitions (backward compatible with next_phase)\n    dynamic_agent?: string;      // For dynamic_decision (capability name)\n    decision_config?: any;       // For dynamic_decision (full transition config)\n  };\n  ```\n- Design rationale:\n  - `jump_back`: Jump to previous phase (useful for fix-validation cycles)\n  - `dynamic_decision`: Delegate to AI decision agent (enables intelligent routing)\n  - `jump_target_phase`: Specific phase to jump back to (e.g., from validate back to develop)\n  - `dynamic_agent`: Capability name for selecting decision agent (e.g., \"test-decision\")\n  - `decision_config`: Full configuration passed to decision agent (prompt, thresholds, etc.)\n- Maintain backward compatibility:\n  - All existing fields preserved\n  - New fields optional (default undefined)\n  - Existing transition types unchanged","notes":"**Implementation Complete**\n\nEnhanced PhaseTransition interface added to policy.ts:53-59:\n\n```typescript\nexport type PhaseTransition = {\n  type: \"advance\" | \"retry\" | \"block\" | \"close\" | \"jump_back\" | \"dynamic_decision\";\n  next_phase?: string;\n  reason?: string;\n  jump_target_phase?: string;\n  dynamic_agent?: string;\n  decision_config?: any;\n};\n```\n\n**New Transition Types:**\n- `jump_back`: Jump to previous phase (useful for fix-validation cycles)\n- `dynamic_decision`: Delegate to AI decision agent (enables intelligent routing)\n\n**New Fields:**\n- `jump_target_phase`: Specific phase to jump back to (e.g., from validate back to develop)\n- `dynamic_agent`: Capability name for selecting decision agent (e.g., \"test-decision\")\n- `decision_config`: Full configuration passed to decision agent (prompt, thresholds, etc.)\n\n**Backward Compatibility:**\n- All existing fields preserved\n- New fields optional (default undefined)\n- Existing transition types unchanged","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:30:12.027656+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:57:35.428976+01:00","closed_at":"2026-01-07T05:57:35.390777+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.1.2","depends_on_id":"agent-shepherd-alg8.6.1","type":"parent-child","created_at":"2026-01-07T00:30:12.028687+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.1.3","title":"2.1.3 Implement determineTransition() Enhancements","description":"### 2.1.3 Implement determineTransition() Enhancements\n- **WHAT**: Extend determineTransition() to support new transition types\n- **WHY**: Core method that decides next phase based on outcome\n- **HOW**: Add logic to handle jump_back and dynamic_decision types\n- Add support for `jump_back` transition type:\n  - If transition.type === \"jump_back\":\n    - Validate jump_target_phase exists in policy phase sequence\n    - Return transition with jump_target_phase as next phase\n    - Reason: \"Jumping back to phase X for rework\"\n- Add support for `dynamic_decision` transition type:\n  - If transition.type === \"dynamic_decision\":\n    - Validate dynamic_agent maps to valid capability in agent registry\n    - Return transition with decision_config for agent execution\n    - Reason: \"Delegating transition decision to AI agent\"\n- Maintain existing logic for advance, retry, block, close\n- Return enhanced transition object with all fields","notes":"**Implementation Complete**\n\nEnhanced determineTransition() method in policy.ts:\n\n1. **Added validateTransition() method** (policy.ts:405-444):\n   - Validates jump_target_phase exists in policy phase sequence\n   - Validates no circular jumps (phase jumping to itself)\n   - Validates dynamic_agent is provided for dynamic_decision transitions\n   - Throws descriptive errors for invalid transitions\n\n2. **Updated determineTransition() to call validation** (policy.ts:263-327):\n   - All transition types now validated before being returned\n   - Maintains existing logic for advance, retry, block, close\n   - Prepared to handle jump_back and dynamic_decision when they are returned by future conditional transition logic\n\n3. **Backward Compatibility**:\n   - Existing transition types unchanged\n   - Validation only adds safety checks\n   - No breaking changes to current behavior\n\n**Note**: Actual logic to return jump_back and dynamic_decision transitions will be added in task 2.2 (Conditional Transition Configuration Schema), which will add transition blocks to PhaseConfig that can specify these transition types based on outcome types.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:30:13.798518+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:58:55.876069+01:00","closed_at":"2026-01-07T05:58:55.871017+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.1.3","depends_on_id":"agent-shepherd-alg8.6.1","type":"parent-child","created_at":"2026-01-07T00:30:13.799562+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.1.4","title":"2.1.4 Add Transition Validation","description":"### 2.1.4 Add Transition Validation\n- **WHAT**: Validate transitions before returning them to ensure safety\n- **WHY**: Prevents invalid transitions from breaking workflows\n- **HOW**: Create validation method called before returning transition\n- Create `validateTransition(policy: PolicyConfig, transition: PhaseTransition): void` method:\n  - Validate jump_target_phase exists in policy:\n    - If type === \"jump_back\" or transition.jump_target_phase:\n    - Check if jump_target_phase is in policy.phases array\n    - Throw error if phase not found: \"Target phase 'X' not found in policy\"\n  - Validate no circular jumps (phase jumping to itself):\n    - Check if jump_target_phase === currentPhase\n    - Throw error if same: \"Cannot jump from phase 'X' to itself\"\n  - Validate dynamic_agent is valid capability:\n    - If type === \"dynamic_decision\":\n    - Check agent registry has agents with this capability\n    - Throw error if no agents: \"No agents found with capability 'X'\"\n- Call validation before returning transition in determineTransition()\n- Throw descriptive errors on invalid transitions","notes":"**Implementation Complete**\n\nEnhanced validateTransition() method in policy.ts:405-463:\n\n**Validation Logic:**\n\n1. **jump_back transition validation**:\n   - Validates that jump_target_phase or next_phase is provided\n   - Checks if target phase exists in policy phase sequence\n   - Prevents circular jumps (phase jumping to itself)\n   - Throws descriptive errors for invalid transitions\n\n2. **dynamic_decision transition validation**:\n   - Validates that dynamic_agent is provided\n   - Checks agent registry for active agents with specified capability\n   - Uses getAgentRegistry().getAgentsByCapability() to find matching agents\n   - Filters for active agents (active !== false)\n   - Throws error if no active agents found with the capability\n\n**Integration:**\n- Called from determineTransition() before returning any transition\n- Provides safety checks for all transition types\n- Maintains backward compatibility\n\n**Error Messages:**\n- \"jump_back transition requires jump_target_phase or next_phase\"\n- \"Target phase 'X' not found in policy 'Y'\"\n- \"Cannot jump from phase 'X' to itself\"\n- \"dynamic_decision transition requires dynamic_agent\"\n- \"No active agents found with capability 'X'\"","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:30:15.799005+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T06:00:43.916476+01:00","closed_at":"2026-01-07T06:00:43.916476+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.1.4","depends_on_id":"agent-shepherd-alg8.6.1","type":"parent-child","created_at":"2026-01-07T00:30:15.799994+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.1.5","title":"2.1.5 Update Worker Engine Transition Handling","description":"### 2.1.5 Update Worker Engine Transition Handling\n- **WHAT**: Extend applyTransition() to handle new transition types\n- **WHY**: Worker engine executes transitions by updating Beads state\n- **HOW**: Add cases for jump_back and dynamic_decision in switch statement\n- Extend `worker-engine.ts:applyTransition()` (lines 356-408):\n  - Add case for `jump_back`:\n    ```typescript\n    case \"jump_back\":\n      await updateIssue(issueId, { status: \"open\" });\n      // Update phase label to jump_target_phase\n      const targetPhase = transition.jump_target_phase || transition.next_phase;\n      if (targetPhase) {\n        await setPhaseLabel(issueId, targetPhase);\n        await clearHITLLabels(issueId);\n      }\n      console.log(`Jumped back to phase: ${targetPhase}`);\n      break;\n    ```\n  - Add case for `dynamic_decision`:\n    ```typescript\n    case \"dynamic_decision\":\n      // Execute AI decision agent to determine actual transition\n      const finalTransition = await this.executeDecisionAgent(issueId, transition);\n      // Apply the final transition returned by decision agent\n      await this.applyTransition(issueId, finalTransition);\n      console.log(`Dynamic decision resulted in: ${finalTransition.type}`);\n      break;\n    ```\n- Ensure backward compatibility with existing transition types\n- Add error handling for invalid dynamic_decision results","notes":"**Implementation Complete (Fixed)**\n\nUpdated applyTransition() method in worker-engine.ts:443-533:\n\n**New Transition Handling:**\n\n1. **jump_back case** (worker-engine.ts:495-503):\n   - Sets issue status to \"open\"\n   - Updates phase label to jump_target_phase (or next_phase as fallback)\n   - Clears HITL labels\n   - Logs phase jump\n\n2. **dynamic_decision case** (worker-engine.ts:505-519):\n   - Calls executeDecisionAgent() to get final transition\n   - Applies the final transition returned by decision agent\n   - Logs the result\n   - Handles failures by blocking issue and setting HITL label\n\n3. **executeDecisionAgent() placeholder** (worker-engine.ts:527-533):\n   - Stub method that will be fully implemented in task 2.4\n   - Currently throws informative error\n   - Logs decision agent execution attempt\n\n4. **Updated method signature** (worker-engine.ts:443-445):\n   - Added jump_target_phase, dynamic_agent, decision_config fields\n   - Maintains backward compatibility with existing fields\n\n**Backward Compatibility:**\n- All existing transition types (advance, retry, block, close) unchanged\n- New transition types handled without breaking existing behavior\n- Error handling ensures graceful degradation if decision agent fails\n\n**Code Quality:**\n- Fixed lint issue with lexical declarations in case blocks\n- Both lint and type-check pass successfully\n- All 307 tests pass","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:30:18.047981+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:32:27.24867+01:00","closed_at":"2026-01-07T06:01:41.491274+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.1.5","depends_on_id":"agent-shepherd-alg8.6.1","type":"parent-child","created_at":"2026-01-07T00:30:18.048789+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.1.6","title":"2.1.6 Add Unit Tests for Transition Logic","description":"### 2.1.6 Add Unit Tests for Transition Logic\n- **WHAT**: Comprehensive tests for all transition types\n- **WHY**: Ensures transitions work correctly and validation catches errors\n- **HOW**: Test each transition type with various scenarios\n- Test all transition types:\n  - `advance`: Moves to next phase, updates Beads label\n  - `retry`: Retries current phase, clears HITL labels\n  - `block`: Sets issue to blocked, triggers HITL\n  - `close`: Closes issue, removes labels\n  - `jump_back`: Jumps to specified previous phase\n  - `dynamic_decision`: Executes decision agent\n- Test transition validation:\n  - Validates jump_target_phase exists in policy\n  - Throws error for invalid phase\n  - Detects circular jumps (phase to itself)\n  - Validates dynamic_agent has available agents\n  - Throws error if no agents with capability\n- Test backward compatibility:\n  - Existing policies without enhanced transitions still work\n  - Transition types advance/retry/block/close unchanged\n  - Missing optional fields handled gracefully\n- Test dynamic_decision triggers agent execution (covered in detail in 2.4)","notes":"**Implementation Complete**\n\nCreated comprehensive unit tests for enhanced transition logic in tests/transition-logic.test.ts:\n\n**Test Coverage:**\n\n1. **Backward Compatibility Tests** (8 tests):\n   - Advance transition: Moves to next phase, updates Beads label\n   - Retry transition: Retries current phase with count\n   - Block transition: For approval and max retries scenarios\n   - Close transition: Closes issue when all phases complete\n\n2. **Jump Back Transition Validation** (5 tests):\n   - Validates jump_back requires target phase\n   - Validates jump_target_phase exists in policy\n   - Detects and prevents circular jumps (phase to itself)\n   - Accepts valid jump_back transitions\n   - Supports both jump_target_phase and next_phase fields\n\n3. **Dynamic Decision Transition Validation** (2 tests):\n   - Validates dynamic_decision requires dynamic_agent\n   - Validates dynamic_agent capability has active agents\n   - Checks agent registry for agents with specified capability\n\n4. **Transition Field Validation** (3 tests):\n   - Handles missing optional fields gracefully\n   - Accepts all new transition fields\n   - Supports both jump_target_phase and next_phase\n\n5. **Phase Sequence Validation** (3 tests):\n   - Validates phase sequences for multiple policies\n   - Gets next phase correctly throughout sequence\n   - Returns null for last phase\n\n6. **Transition Type Support** (1 test):\n   - Validates all six transition types (advance, retry, block, close, jump_back, dynamic_decision)\n\n7. **Policy Validation** (2 tests):\n   - Handles nonexistent policies gracefully\n   - Handles nonexistent phases gracefully\n\n**Test Results:**\n- Total: 22 new tests\n- All passing: 22/22\n- Overall test suite: 307/307 passing\n\n**Test File:** tests/transition-logic.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:30:20.13105+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T06:03:43.672873+01:00","closed_at":"2026-01-07T06:03:43.670489+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.1.6","depends_on_id":"agent-shepherd-alg8.6.1","type":"parent-child","created_at":"2026-01-07T00:30:20.131951+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.2","title":"2.2 Add Conditional Transition Configuration Schema","description":"## 2.2 Add Conditional Transition Configuration Schema\n**Priority: HIGH | Dependency: 2.1**\n\n### Overview\nAdd optional transitions block to PhaseConfig enabling phases to opt into complex routing while maintaining backward compatibility.\n\n### Implementation Plan\n\n#### 2.2.1 Extend PhaseConfig Interface\n- Add optional transitions?: TransitionBlock field\n- Design TransitionBlock with on_success/on_failure/on_partial_success/on_unclear\n- Allow string (direct jump) or object (AI decision) for on_success/on_failure\n- Require object (AI decision) for on_partial_success/on_unclear\n- Include allowed_destinations safety constraint\n\n#### 2.2.2 Update Policy YAML Schema\n- Extend schemas/policies.schema.json with transition validation\n- Add TransitionConfig and TransitionBlock definitions\n- Add validation rules for confidence thresholds (0.0-1.0)\n- Add validation for allowed_destinations subset of policy phases\n\n#### 2.2.3 Implement Transition Config Parsing\n- Extend loadPolicies() to parse transitions block\n- Add validation for transitions block in validatePolicy()\n- Parse transition block for each phase if present\n- Provide helpful error messages for invalid configs\n\n#### 2.2.4 Add getTransitionKey() Helper\n- Map outcome types to transition configuration keys\n- Handle success/failure/partial_success/unclear outcomes\n- Support backward compatibility with boolean success field\n\n#### 2.2.5 Update determineTransition() to Use Conditional Transitions\n- Check for transitions block first (optional)\n- Use getTransitionKey() to map outcome to config\n- Handle string transitions (direct jump)\n- Handle object transitions (AI decision)\n- Fall back to default linear behavior if no transitions block\n\n#### 2.2.6 Create Example Policies with Conditional Transitions\n- Add enhanced-dev policy with test-based routing\n- Add quality-gate policy with validation phase\n- Add flexible-workflow policy with multiple transitions\n- Document each policy's use case and when to use it\n\n#### 2.2.7 Add Configuration Tests\n- Test policy configuration parsing and validation\n- Test valid transition config parsing (string and object)\n- Test invalid config throws error (missing fields, invalid destinations)\n- Test string transitions work (backward compatible)\n- Test object transitions with AI decision config\n- Test default linear behavior when transitions not specified","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:29:56.675529+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:56:01.907959+01:00","closed_at":"2026-01-07T14:56:01.907959+01:00","close_reason":"Implemented conditional transition configuration schema with all subtasks completed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.2","depends_on_id":"agent-shepherd-alg8.6","type":"parent-child","created_at":"2026-01-07T00:29:56.676302+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.2.1","title":"2.2.1 Extend PhaseConfig Interface","description":"### 2.2.1 Extend PhaseConfig Interface\n- **WHAT**: Add optional transitions block to PhaseConfig\n- **WHY**: Enables phases to opt into complex routing while maintaining backward compatibility\n- **HOW**: Add transitions field as optional property\n- **CRITICAL**: Transitions block is OPTIONAL - if not provided, use default linear behavior\n- Add `transitions?: TransitionBlock` field to PhaseConfig in policy.ts (line 12)\n- Design TransitionBlock interface:\n  ```typescript\n  export interface TransitionBlock {\n    // DIRECT JUMPS (backward compatible with existing string-based transitions)\n    on_success?: string | TransitionConfig;  // \"next_phase\" or AI config object\n    on_failure?: string | TransitionConfig;\n    \n    // AI-BASED CONDITIONAL ROUTING (new capability for complex decisions)\n    on_partial_success?: TransitionConfig;  // Only object, no string\n    on_unclear?: TransitionConfig;\n  }\n  \n  export interface TransitionConfig {\n    capability: string;                    // Decision agent capability (e.g., \"test-decision\")\n    prompt: string;                        // Decision instructions for agent\n    allowed_destinations: string[];        // Safety constraint - valid phases to jump to\n    messaging?: boolean;                   // Enable phase messenger for complex data exchange\n    confidence_thresholds?: {\n      auto_advance: number;                // e.g., 0.8 - high confidence allows auto progression\n      require_approval: number;            // e.g., 0.6 - medium confidence triggers review\n    };\n  }\n  ```\n- Key design decisions:\n  - `transitions` is optional - phases without it use default linear behavior\n  - `on_success`/`on_failure` can be string (direct jump) OR object (AI decision)\n  - `on_partial_success`/`on_unclear` must be object (always AI decision)\n  - `allowed_destinations` provides safety constraint preventing invalid jumps\n  - `messaging` flag enables phase messenger for complex data exchange\n  - `confidence_thresholds` enable automatic vs manual routing based on AI confidence","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:30:22.929325+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:55:57.721775+01:00","closed_at":"2026-01-07T14:55:57.721778+01:00","dependencies":[{"issue_id":"agent-shepherd-alg8.6.2.1","depends_on_id":"agent-shepherd-alg8.6.2","type":"parent-child","created_at":"2026-01-07T00:30:22.930124+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.2.2","title":"2.2.2 Update Policy YAML Schema","description":"### 2.2.2 Update Policy YAML Schema\n- **WHAT**: Add transition definitions to policies schema for validation\n- **WHY**: Ensures policy configurations are valid before use\n- **HOW**: Extend schemas/policies.schema.json with transition validation\n- Extend `schemas/policies.schema.json` with transition definitions:\n  ```json\n  {\n    \"definitions\": {\n      \"TransitionConfig\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"capability\": { \"type\": \"string\" },\n          \"prompt\": { \"type\": \"string\" },\n          \"allowed_destinations\": {\n            \"type\": \"array\",\n            \"items\": { \"type\": \"string\" }\n          },\n          \"messaging\": { \"type\": \"boolean\" },\n          \"confidence_thresholds\": {\n            \"type\": \"object\",\n            \"properties\": {\n              \"auto_advance\": { \"type\": \"number\", \"minimum\": 0, \"maximum\": 1 },\n              \"require_approval\": { \"type\": \"number\", \"minimum\": 0, \"maximum\": 1 }\n            }\n          }\n        },\n        \"required\": [\"capability\", \"prompt\", \"allowed_destinations\"]\n      },\n      \"TransitionBlock\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"on_success\": { \"oneOf\": [{ \"type\": \"string\" }, { \"\": \"#/definitions/TransitionConfig\" }] },\n          \"on_failure\": { \"oneOf\": [{ \"type\": \"string\" }, { \"\": \"#/definitions/TransitionConfig\" }] },\n          \"on_partial_success\": { \"\": \"#/definitions/TransitionConfig\" },\n          \"on_unclear\": { \"\": \"#/definitions/TransitionConfig\" }\n        }\n      }\n    },\n    \"properties\": {\n      \"phases\": {\n        \"type\": \"array\",\n        \"items\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"name\": { \"type\": \"string\" },\n            \"transitions\": { \"\": \"#/definitions/TransitionBlock\" }\n            // ... other phase properties\n          }\n        }\n      }\n    }\n  }\n  ```\n- Add validation rules:\n  - `on_success`/`on_failure` can be string or object\n  - `on_partial_success`/`on_unclear` must be object (not string)\n  - `allowed_destinations` must be subset of policy phases\n  - `confidence_thresholds` values must be 0.0-1.0\n  - `capability` must be valid (check against agent registry if possible)\n- Add examples to schema documentation for common patterns","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:30:26.55411+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:55:57.733994+01:00","closed_at":"2026-01-07T14:55:57.733995+01:00","dependencies":[{"issue_id":"agent-shepherd-alg8.6.2.2","depends_on_id":"agent-shepherd-alg8.6.2","type":"parent-child","created_at":"2026-01-07T00:30:26.55497+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.2.3","title":"2.2.3 Implement Transition Config Parsing","description":"### 2.2.3 Implement Transition Config Parsing\n- **WHAT**: Parse transition blocks from YAML with validation\n- **WHY**: Loads and validates transition configuration from policy files\n- **HOW**: Extend loadPolicies() to parse transitions\n- Modify `policy.ts:loadPolicies()` (lines 78-110):\n  - Add validation for transitions block in validatePolicy()\n  - Parse transition block for each phase if present\n  - Validate transition config structure on load\n  - Provide helpful error messages for invalid configs\n- Add validation function:\n  ```typescript\n  private validateTransitionBlock(phaseName: string, transitions: TransitionBlock, policyPhases: string[]): void {\n    // Validate each transition type\n    for (const [key, transition] of Object.entries(transitions)) {\n      if (typeof transition === 'string') {\n        // String transition - validate phase exists\n        if (!policyPhases.includes(transition)) {\n          throw new Error(`Invalid ${key} transition in phase '${phaseName}': phase '${transition}' not found in policy`);\n        }\n      } else if (typeof transition === 'object') {\n        // Object transition - validate TransitionConfig structure\n        if (!transition.capability || !transition.prompt || !transition.allowed_destinations) {\n          throw new Error(`Invalid ${key} transition in phase '${phaseName}': missing required fields`);\n        }\n        \n        // Validate allowed_destinations\n        for (const dest of transition.allowed_destinations) {\n          if (!policyPhases.includes(dest)) {\n            throw new Error(`Invalid ${key} transition in phase '${phaseName}': destination '${dest}' not found in policy`);\n          }\n        }\n        \n        // Validate confidence thresholds\n        if (transition.confidence_thresholds) {\n          if (transition.confidence_thresholds.auto_advance \u003c 0 || transition.confidence_thresholds.auto_advance \u003e 1) {\n            throw new Error(`Invalid auto_advance threshold in ${key}: must be 0.0-1.0`);\n          }\n          if (transition.confidence_thresholds.require_approval \u003c 0 || transition.confidence_thresholds.require_approval \u003e 1) {\n            throw new Error(`Invalid require_approval threshold in ${key}: must be 0.0-1.0`);\n          }\n        }\n      }\n    }\n  }\n  ```","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:30:29.436566+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:55:57.729932+01:00","closed_at":"2026-01-07T14:55:57.729933+01:00","dependencies":[{"issue_id":"agent-shepherd-alg8.6.2.3","depends_on_id":"agent-shepherd-alg8.6.2","type":"parent-child","created_at":"2026-01-07T00:30:29.437441+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.2.4","title":"2.2.4 Add getTransitionKey() Helper","description":"### 2.2.4 Add getTransitionKey() Helper\n- **WHAT**: Map outcome types to transition configuration keys\n- **WHY**: Enables different handling for partial_success vs clear failure\n- **HOW**: Create helper function that determines which transition config to use\n- Implement `getTransitionKey()` function (from spec):\n  ```typescript\n  function getTransitionKey(outcome: {\n    success: boolean;\n    result_type?: 'success' | 'failure' | 'partial_success' | 'unclear';\n  }): string {\n    if (outcome.result_type) {\n      return `on_${outcome.result_type}`;  // on_partial_success, on_unclear, etc.\n    }\n    return outcome.success ? 'on_success' : 'on_failure';  // Backward compatible\n  }\n  ```\n- Map outcome types to transition keys:\n  - `success` or `result_type: 'success'` → `on_success`\n  - `failure` or `result_type: 'failure'` → `on_failure`\n  - `result_type: 'partial_success'` → `on_partial_success`\n  - `result_type: 'unclear'` → `on_unclear`\n- Handle backward compatibility:\n  - If no result_type, fall back to success boolean\n  - Existing code using only success/failure still works","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:30:31.545556+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:55:57.72195+01:00","closed_at":"2026-01-07T14:55:57.721951+01:00","dependencies":[{"issue_id":"agent-shepherd-alg8.6.2.4","depends_on_id":"agent-shepherd-alg8.6.2","type":"parent-child","created_at":"2026-01-07T00:30:31.546477+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.2.5","title":"2.2.5 Update determineTransition() to Use Conditional Transitions","description":"### 2.2.5 Update determineTransition() to Use Conditional Transitions\n- **WHAT**: Use transition configuration when available, fall back to default\n- **WHY**: Enables dynamic routing while maintaining backward compatibility\n- **HOW**: Check for transitions block, use if present, otherwise use default\n- **CRITICAL**: If transitions block not provided, use default linear behavior (backward compatible)\n- Modify `policy.ts:determineTransition()` (lines 263-327):\n  ```typescript\n  determineTransition(\n    policyName: string,\n    currentPhase: string, \n    outcome: {\n      success: boolean;\n      requires_approval?: boolean;\n      retry_count?: number;\n      result_type?: 'success' | 'failure' | 'partial_success' | 'unclear';\n    }\n  ): PhaseTransition {\n    const policy = this.getPolicy(policyName);\n    const phaseConfig = policy.phases.find(p =\u003e p.name === currentPhase);\n    \n    // Check for custom transitions (OPTIONAL - only if defined)\n    if (phaseConfig.transitions) {\n      // Map outcome to transition key (success/failure/partial_success/unclear)\n      const transitionKey = getTransitionKey(outcome);\n      const transitionConfig = phaseConfig.transitions[transitionKey];\n      \n      if (transitionConfig) {\n        if (typeof transitionConfig === 'string') {\n          // DIRECT JUMP: on_success: \"validate\"\n          // Backward compatible string-based transitions\n          return {\n            type: 'advance',\n            next_phase: transitionConfig,\n            reason: `Direct transition to ${transitionConfig}`\n          };\n        } else {\n          // AI ROUTING: on_failure: {capability: \"...\", prompt: \"...\"}\n          // Routes to capability-based agent selection\n          return {\n            type: 'dynamic_decision',\n            dynamic_agent: transitionConfig.capability,\n            decision_config: transitionConfig,\n            reason: `AI routing for ${transitionKey}`\n          };\n        }\n      }\n    }\n    \n    // DEFAULT LINEAR BEHAVIOR (no transitions block)\n    // Falls back to original advance/retry/block/close logic\n    return getDefaultTransition(policy, currentPhase, outcome);\n  }\n  ```\n- Design rationale:\n  - Check `phaseConfig.transitions` first (optional)\n  - If present, use `getTransitionKey()` to map outcome to config\n  - Handle string transitions (direct jump)\n  - Handle object transitions (AI decision)\n  - If no transitions block or no matching key, use default linear behavior\n  - This maintains 100% backward compatibility","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:30:34.704005+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:55:57.734405+01:00","closed_at":"2026-01-07T14:55:57.734406+01:00","dependencies":[{"issue_id":"agent-shepherd-alg8.6.2.5","depends_on_id":"agent-shepherd-alg8.6.2","type":"parent-child","created_at":"2026-01-07T00:30:34.704953+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.2.6","title":"2.2.6 Create Example Policies with Conditional Transitions","description":"### 2.2.6 Create Example Policies with Conditional Transitions\n- **WHAT**: Add example policies demonstrating various transition patterns\n- **WHY**: Provides users with templates and use case examples\n- **HOW**: Add policies to config/policies.yaml with different transition patterns\n- Add `enhanced-dev` policy:\n  ```yaml\n  enhanced-dev:\n    name: Enhanced Development Workflow\n    description: Workflow with intelligent test-based routing\n    phases:\n      - name: develop\n        capabilities: [coding]\n        transitions:\n          on_success: test  # Direct jump to test\n          on_failure: develop  # Retry on failure\n    \n      - name: test\n        capabilities: [testing, qa]\n        transitions:\n          on_success:\n            capability: test-decision\n            prompt: |\n              Tests passed. Assess code quality:\n              - Are there any flaky tests?\n              - Is test coverage sufficient?\n              - Are edge cases covered?\n            allowed_destinations: [validate, develop, test]\n            confidence_thresholds:\n              auto_advance: 0.8\n              require_approval: 0.6\n          on_failure:\n            capability: test-decision\n            prompt: |\n              Tests failed. Analyze failures:\n              - Are test failures due to code bugs or test issues?\n              - Should we fix code or fix tests?\n            allowed_destinations: [develop, test]\n            messaging: true  # Enable phase messenger for test results\n    \n      - name: validate\n        capabilities: [validation]\n        transitions:\n          on_success: close\n          on_partial_success:\n            capability: validation-decision\n            prompt: |\n              Validation partially passed. Assess quality:\n              - Coverage gaps?\n              - Severity of remaining issues?\n              - Business requirements met?\n            allowed_destinations: [develop, validate, close]\n  ```\n- Add `quality-gate` policy with validation phase using partial_success handling\n- Add `flexible-workflow` policy with multiple conditional transitions\n- Document each policy's use case and when to use it","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:30:37.559255+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:55:57.732114+01:00","closed_at":"2026-01-07T14:55:57.732116+01:00","dependencies":[{"issue_id":"agent-shepherd-alg8.6.2.6","depends_on_id":"agent-shepherd-alg8.6.2","type":"parent-child","created_at":"2026-01-07T00:30:37.560307+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.2.7","title":"2.2.7 Add Configuration Tests","description":"### 2.2.7 Add Configuration Tests\n- **WHAT**: Test policy configuration parsing and validation\n- **WHY**: Ensures policies load correctly and invalid configs are caught\n- **HOW**: Test valid and invalid configurations\n- Test valid transition config parsing:\n  - Load policy with string transitions\n  - Load policy with object transitions\n  - Load policy with mixed string/object transitions\n  - Verify transitions block parsed correctly\n- Test invalid transition config throws error:\n  - Missing required fields in TransitionConfig\n  - Invalid allowed_destinations (phase not in policy)\n  - Invalid confidence thresholds (outside 0.0-1.0)\n  - on_partial_success as string (should only be object)\n- Test string transitions work (backward compatible):\n  - on_success: \"validate\" → direct jump\n  - on_failure: \"develop\" → direct jump\n- Test object transitions with AI decision config:\n  - Parse capability, prompt, allowed_destinations\n  - Parse optional fields: messaging, confidence_thresholds\n- Test default linear behavior when transitions not specified:\n  - Policy without transitions block uses default logic\n  - Existing policies continue to work unchanged\n- Test allowed_destinations validation:\n  - Verify destinations subset of policy phases\n  - Reject invalid destinations","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:30:39.829022+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T15:12:36.208198+01:00","closed_at":"2026-01-07T15:12:36.208198+01:00","close_reason":"Fixed validation bugs and added all missing test cases:\n- Added validation to reject string values for on_partial_success/on_unclear\n- Added test for on_partial_success as string (should fail)\n- Added test for on_unclear as string (should fail)\n- Added test for missing required fields in TransitionConfig\n- Added test for mixed string/object transitions\n- Added comprehensive schema validation tests using AJV\n- Updated schema documentation to clarify object-only requirement","dependencies":[{"issue_id":"agent-shepherd-alg8.6.2.7","depends_on_id":"agent-shepherd-alg8.6.2","type":"parent-child","created_at":"2026-01-07T00:30:39.829785+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.3","title":"2.3 Implement Loop Prevention System","description":"## 2.3 Implement Loop Prevention System\n**Priority: HIGH | Dependency: 2.2**\n\n### Overview\nPrevent infinite loops in dynamic workflows through phase visit tracking, transition limits, and cycle detection.\n\n### Implementation Plan\n\n#### 2.3.1 Phase Visit Tracking\n- Add getPhaseVisitCount() using runs.db queries\n- Count executions per issue+phase combination\n- Add max_visits?: number field to PhaseConfig (default 10)\n- Add database index for performance\n\n#### 2.3.2 Implement validatePhaseLimits()\n- Check count before allowing phase execution\n- Trigger HITL when max_visits exceeded\n- Block further execution of that phase\n- Add comprehensive unit tests\n\n#### 2.3.3 Transition Limit Tracking\n- Add getTransitionCount() for specific phase→phase patterns\n- Query decision log for transition patterns\n- More granular than phase visits for systemic issues\n- Add metadata fields to decision logging\n\n#### 2.3.4 Implement validateTransitionLimits()\n- Check specific transition pattern limits\n- Trigger HITL when transition limits exceeded\n- Configurable per transition pair\n- Proactive escalation before patterns become infinite loops\n\n#### 2.3.5 Cycle Detection\n- Detect oscillating patterns (develop→test→develop→test)\n- Analyze recent transition sequences for repeating patterns\n- Configurable cycle length sensitivity\n- Catches complex loops that single limits miss\n\n#### 2.3.6 Integrate Loop Prevention into determineTransition()\n- Call all loop prevention checks before transitions\n- Apply BEFORE any transition decision\n- Return block transition if any validation fails\n- Log all loop prevention decisions with details\n\n#### 2.3.7 Configuration for Loop Prevention\n- Add loop_prevention section to config/config.yaml\n- Configure enabled, max_visits_default, max_transitions_default\n- Allow per-phase override of max_visits\n- Document all configuration options\n\n#### 2.3.8 Integration Tests\n- Test phase visit limit enforcement\n- Test excessive transition usage blocking\n- Test oscillating phases cycle detection\n- Verify HITL escalation in all cases","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:29:59.929546+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T17:27:33.662802+01:00","closed_at":"2026-01-07T17:27:33.662802+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.3","depends_on_id":"agent-shepherd-alg8.6","type":"parent-child","created_at":"2026-01-07T00:29:59.930371+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.3.1","title":"2.3.1 Phase Visit Tracking","description":"### 2.3.1 Phase Visit Tracking\n- **WHAT**: Count how many times a phase has been executed for an issue\n- **WHY**: Enables enforcement of max_visits limits to prevent phase overuse\n- **HOW**: Query runs.db for existing run records counting visits\n- Add `getPhaseVisitCount(issueId: string, phaseName: string): Promise\u003cnumber\u003e` to Logger:\n  ```typescript\n  async getPhaseVisitCount(issueId: string, phaseName: string): Promise\u003cnumber\u003e {\n    const runs = await this.queryRuns({\n      issue_id: issueId,\n      phase: phaseName\n    });\n    return runs.length;  // Each run record = one phase visit\n  }\n  ```\n- **Design rationale**:\n  - Query existing logging system for run history\n  - Reuses established audit trail instead of creating new tracking mechanism\n  - Run records already track issue_id and phase, perfect for counting\n  - Count all runs regardless of status (pending, running, completed, failed)\n  - Each execution of a phase = one visit\n- Add index to runs.db on (issue_id, phase) for performance:\n  ```sql\n  CREATE INDEX IF NOT EXISTS idx_runs_issue_phase ON runs(issue_id, phase);\n  ```\n- Add `max_visits?: number` field to PhaseConfig (default 10):\n  - Configurable per phase\n  - Default limit prevents infinite loops\n  - Can be increased for phases expected to repeat (e.g., iterative development)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:30:42.333569+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T17:27:07.036567+01:00","closed_at":"2026-01-07T17:27:07.036567+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.3.1","depends_on_id":"agent-shepherd-alg8.6.3","type":"parent-child","created_at":"2026-01-07T00:30:42.33436+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.3.2","title":"2.3.2 Implement validatePhaseLimits()","description":"### 2.3.2 Implement validatePhaseLimits()\n- **WHAT**: Check if phase can be executed based on visit limits\n- **WHY**: Prevents infinite loops where phases get stuck repeating\n- **HOW**: Check count before allowing phase execution, trigger HITL if exceeded\n- Create `validatePhaseLimits(issueId: string, phaseName: string): Promise\u003cboolean\u003e`:\n  ```typescript\n  async validatePhaseLimits(issueId: string, phaseName: string): Promise\u003cboolean\u003e {\n    const visitCount = await this.getPhaseVisitCount(issueId, phaseName);\n    const maxVisits = this.getPhaseConfig(phaseName).max_visits || 10;\n    \n    if (visitCount \u003e= maxVisits) {\n      // Escalate to human when limits exceeded\n      await this.triggerHITL(issueId, `Phase '${phaseName}' exceeded ${maxVisits} visits`);\n      return false;  // Block further execution\n    }\n    return true;  // Allow execution\n  }\n  ```\n- **Design rationale**:\n  - Calls getPhaseVisitCount() to check history\n  - Uses configurable max_visits per phase (default 10)\n  - Triggers HITL when limit exceeded\n  - Blocks further execution of that phase\n  - Human must manually intervene to unblock\n- Add unit tests:\n  - Test phase visit count calculated correctly\n  - Test max_visits enforcement blocks execution\n  - Test HITL triggered when limit exceeded\n  - Test default max_visits = 10 used when not configured\n  - Test per-phase override of max_visits","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:30:44.736762+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T17:27:06.858481+01:00","closed_at":"2026-01-07T17:27:06.858481+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.3.2","depends_on_id":"agent-shepherd-alg8.6.3","type":"parent-child","created_at":"2026-01-07T00:30:44.737587+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.3.3","title":"2.3.3 Transition Limit Tracking","description":"### 2.3.3 Transition Limit Tracking\n- **WHAT**: Track how many times specific phase→phase transitions occur\n- **WHY**: Prevents overuse of particular decision patterns\n- **HOW**: Analyze decision log for transition patterns\n- Add `getTransitionCount(issueId: string, fromPhase: string, toPhase: string): Promise\u003cnumber\u003e` to Logger:\n  ```typescript\n  async getTransitionCount(issueId: string, fromPhase: string, toPhase: string): Promise\u003cnumber\u003e {\n    const decisions = await this.getDecisionsForIssue(issueId);\n    return decisions.filter(d =\u003e \n      d.type === 'phase_transition' \u0026\u0026 \n      d.metadata?.from_phase === fromPhase \u0026\u0026\n      d.metadata?.to_phase === toPhase\n    ).length;\n  }\n  ```\n- **Design rationale**:\n  - Queries decision log for transition patterns\n  - Counts how many times specific phase→phase jump occurred\n  - More granular than phase visits - targets specific problematic patterns\n  - Catches systemic issues (e.g., too many develop→test jumps suggests testing problems)\n- Need to ensure decision metadata includes from_phase and to_phase:\n  - Update decision logging to include these fields\n  - Add to phase_transition decision metadata","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:30:46.921642+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T17:27:06.671391+01:00","closed_at":"2026-01-07T17:27:06.671391+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.3.3","depends_on_id":"agent-shepherd-alg8.6.3","type":"parent-child","created_at":"2026-01-07T00:30:46.922421+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.3.4","title":"2.3.4 Implement validateTransitionLimits()","description":"### 2.3.4 Implement validateTransitionLimits()\n- **WHAT**: Validate specific transition doesn't exceed limits\n- **WHY**: Catches systemic issues where certain jumps happen too frequently\n- **HOW**: Check transition count vs configured limit, trigger HITL if exceeded\n- Create `validateTransitionLimits(issueId: string, fromPhase: string, toPhase: string): Promise\u003cboolean\u003e`:\n  ```typescript\n  async validateTransitionLimits(issueId: string, fromPhase: string, toPhase: string): Promise\u003cboolean\u003e {\n    const transitionCount = await this.getTransitionCount(issueId, fromPhase, toPhase);\n    const maxTransitions = this.getTransitionLimit(fromPhase, toPhase);  // Configurable\n    \n    if (transitionCount \u003e= maxTransitions) {\n      await this.triggerHITL(issueId, `Transition ${fromPhase}→${toPhase} exceeded ${maxTransitions} times`);\n      return false;\n    }\n    return true;\n  }\n  ```\n- **Design rationale**:\n  - Checks specific transition pattern (e.g., develop→test)\n  - Configurable per transition pair\n  - Triggers HITL when limit exceeded\n  - Proactive escalation before patterns become infinite loops\n- Add configuration for transition limits:\n  - Add to policy config or global config\n  - Default limit: 5 (configurable)\n  - Can override per transition pair","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:30:50.245385+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T17:27:06.496106+01:00","closed_at":"2026-01-07T17:27:06.496106+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.3.4","depends_on_id":"agent-shepherd-alg8.6.3","type":"parent-child","created_at":"2026-01-07T00:30:50.246358+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.3.5","title":"2.3.5 Cycle Detection","description":"### 2.3.5 Cycle Detection\n- **WHAT**: Detect oscillating patterns like develop→test→develop→test\n- **WHY**: Catches complex loops that visit/transition limits might miss\n- **HOW**: Analyze recent transition sequences for repeating patterns\n- Add `detectCycles(issueId: string, cycleLength: number = 3): Promise\u003cboolean\u003e`:\n  ```typescript\n  async detectCycles(issueId: string, cycleLength: number = 3): Promise\u003cboolean\u003e {\n    const recentDecisions = await this.getDecisionsForIssue(issueId, { limit: 20 });\n    \n    // Extract transition sequence from decision log\n    const transitions = recentDecisions\n      .filter(d =\u003e d.type === 'phase_transition')\n      .map(d =\u003e `${d.metadata?.from_phase}→${d.metadata?.to_phase}`)\n      .slice(-10);  // Analyze last 10 transitions\n    \n    // Look for A→B→A repeating patterns\n    for (let i = 0; i \u003c= transitions.length - cycleLength; i++) {\n      const pattern = transitions.slice(i, i + cycleLength);\n      const reversePattern = [...pattern].reverse();\n      \n      // If pattern matches its reverse, it's oscillating\n      if (pattern.join(',') === reversePattern.join(',')) {\n        return true;  // Cycle detected\n      }\n    }\n    return false;\n  }\n  ```\n- **Design rationale**:\n  - Analyzes recent transition sequences\n  - Looks for patterns that reverse themselves (oscillation)\n  - Cycle length 3 catches develop→test→develop patterns\n  - Configurable sensitivity via cycleLength parameter\n  - More sophisticated than simple visit/transition counting\n  - Catches complex loops that single limits miss\n- Add configuration:\n  - `cycle_detection_enabled: true`\n  - `cycle_detection_length: 3` (configurable)\n  - Can tune sensitivity for different workflow types","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:30:53.159212+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T17:27:06.315552+01:00","closed_at":"2026-01-07T17:27:06.315552+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.3.5","depends_on_id":"agent-shepherd-alg8.6.3","type":"parent-child","created_at":"2026-01-07T00:30:53.160033+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.3.6","title":"2.3.6 Integrate Loop Prevention into determineTransition()","description":"### 2.3.6 Integrate Loop Prevention into determineTransition()\n- **WHAT**: Call all loop prevention checks before allowing transitions\n- **WHY**: Prevents infinite routing loops in dynamic workflows\n- **HOW**: Add validation steps at beginning of determineTransition()\n- **CRITICAL**: Apply loop prevention BEFORE any transition decision\n- Modify `policy.ts:determineTransition()`:\n  ```typescript\n  determineTransition(policyName: string, currentPhase: string, outcome: {...}): PhaseTransition {\n    // ... existing code ...\n    \n    // LOOP PREVENTION CHECKS\n    if (outcome.success) {\n      // Only check limits on success (prevents infinite retry loops)\n      await this.validatePhaseLimits(issueId, currentPhase);\n    }\n    \n    // Check transition limits for jump transitions\n    if (transition.type === 'advance' || transition.type === 'jump_back') {\n      const nextPhase = transition.next_phase || transition.jump_target_phase;\n      await this.validateTransitionLimits(issueId, currentPhase, nextPhase);\n    }\n    \n    // Check for oscillating cycles\n    await this.detectCycles(issueId);\n    \n    // ... rest of transition logic ...\n  }\n  ```\n- Add early return if any validation fails:\n  - If any loop prevention check fails, return `{ type: 'block', reason: 'Loop detected' }`\n  - Log all loop prevention decisions with details\n  - Include which check failed and why","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:30:55.418947+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T17:27:06.133707+01:00","closed_at":"2026-01-07T17:27:06.133707+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.3.6","depends_on_id":"agent-shepherd-alg8.6.3","type":"parent-child","created_at":"2026-01-07T00:30:55.419764+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.3.7","title":"2.3.7 Configuration for Loop Prevention","description":"### 2.3.7 Configuration for Loop Prevention\n- **WHAT**: Add configuration for loop prevention settings\n- **WHY**: Makes loop prevention configurable per policy or globally\n- **HOW**: Add config section in config/config.yaml or per-policy\n- Add loop_prevention section to config:\n  ```yaml\n  loop_prevention:\n    enabled: true\n    max_visits_default: 10\n    max_transitions_default: 5\n    cycle_detection_enabled: true\n    cycle_detection_length: 3\n    trigger_hitl: true\n  ```\n- Allow per-phase override via PhaseConfig:\n  ```yaml\n  phases:\n    - name: develop\n      max_visits: 20  # Override default\n      transitions:\n        # ...\n  ```\n- Document configuration options:\n  - `enabled`: Enable/disable loop prevention\n  - `max_visits_default`: Default limit for phase visits\n  - `max_transitions_default`: Default limit for specific transitions\n  - `cycle_detection_enabled`: Enable cycle detection\n  - `cycle_detection_length`: Sensitivity for pattern detection\n  - `trigger_hitl`: Automatically trigger HITL when limits exceeded","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:30:57.527776+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T17:27:05.957205+01:00","closed_at":"2026-01-07T17:27:05.957205+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.3.7","depends_on_id":"agent-shepherd-alg8.6.3","type":"parent-child","created_at":"2026-01-07T00:30:57.528563+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.3.8","title":"2.3.8 Integration Tests","description":"### 2.3.8 Integration Tests\n- **WHAT**: Test loop prevention in full workflow scenarios\n- **WHY**: Verifies loop prevention catches real-world looping patterns\n- **HOW**: Create scenarios that trigger each loop prevention mechanism\n- Create scenario that hits phase visit limit:\n  - Configure phase with max_visits: 3\n  - Force phase to execute 4 times\n  - Verify HITL triggered on 4th attempt\n  - Verify phase blocked from further execution\n- Create scenario with excessive same-transition usage:\n  - Configure transition limit develop→test: 3\n  - Force develop→test transition 4 times\n  - Verify HITL triggered on 4th transition\n  - Verify transition blocked\n- Create scenario with oscillating phases:\n  - Force workflow to oscillate: develop→test→develop→test\n  - Verify cycle detection identifies pattern\n  - Verify HITL triggered when cycle detected\n  - Verify workflow blocked\n- Verify HITL escalation in all cases:\n  - Human can review and unblock\n  - Loop prevention details logged\n  - Clear reason provided for escalation","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:30:59.734781+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T17:27:05.784593+01:00","closed_at":"2026-01-07T17:27:05.784593+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.3.8","depends_on_id":"agent-shepherd-alg8.6.3","type":"parent-child","created_at":"2026-01-07T00:30:59.735611+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.4","title":"2.4 Create Decision Agent Capability System","description":"## 2.4 Create Decision Agent Capability System\n**Priority: HIGH | Dependency: 2.2, 2.3**\n\n### Overview\nCreate specialized AI agents for different decision contexts to enable intelligent workflow routing.\n\n### Implementation Plan\n\n#### 2.4.1 Define Decision Agent Capabilities\n- Define test-decision: analyze test results and quality\n- Define validation-decision: evaluate validation results and metrics\n- Define complex-decision: handle multi-factor workflow decisions\n- Document each capability's purpose and required sub-capabilities\n\n#### 2.4.2 Update Agent Registry with Decision Agents\n- Add sample decision agents to config/agents.yaml\n- Add test-quality-decider, validation-gatekeeper, workflow-orchestrator\n- Test agent selection with new capabilities\n- Verify priority ordering and active status\n\n#### 2.4.3 Implement buildDecisionInstructions()\n- Build comprehensive prompt combining issue data, previous results, decision parameters\n- Include issue context, previous phase result, allowed destinations\n- Provide structured JSON response format\n- Include reasoning and confidence score requirements\n\n#### 2.4.4 Create DecisionResult Interface\n- Define structure for parsed decision agent responses\n- Include action, target_phase, reasoning, confidence, requires_approval\n- Add to type definitions in policy.ts\n\n#### 2.4.5 Implement parseDecisionResponse()\n- Parse and validate AI decision responses\n- Extract target phase from action format\n- Critical safety check against allowed_destinations\n- Calculate requires_approval based on confidence thresholds\n\n#### 2.4.6 Execute Decision Agent in Worker Engine\n- Extend worker-engine.ts to handle dynamic_decision transitions\n- Select agent based on capability, build instructions, launch via OpenCode CLI\n- Parse response, log decision with metadata, return PhaseTransition\n- Handle require_approval by blocking for HITL\n\n#### 2.4.7 Handle Decision Agent Failures\n- Gracefully handle execution failures\n- Default to safe fallback (require_approval)\n- Trigger HITL with failure context\n- Log errors with full details\n\n#### 2.4.8 Add Decision Metadata Logging\n- Log comprehensive metadata for all decisions\n- Include agent info, configuration, result, context\n- Add indexes for decision analysis queries\n\n#### 2.4.9 Add Confidence Threshold Configuration\n- Extend TransitionConfig with confidence_thresholds\n- Implement auto-approval logic based on confidence levels\n- Test various confidence levels and threshold behaviors","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:30:03.353269+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T17:44:27.587621+01:00","closed_at":"2026-01-07T17:44:27.587621+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.4","depends_on_id":"agent-shepherd-alg8.6","type":"parent-child","created_at":"2026-01-07T00:30:03.354025+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.4.1","title":"2.4.1 Define Decision Agent Capabilities","description":"### 2.4.1 Define Decision Agent Capabilities\n- **WHAT**: Define capability names for decision-making contexts\n- **WHY**: Enables specialized agents for different decision types\n- **HOW**: Design capability naming and document purpose\n- Design capability names for decision contexts:\n  - `test-decision`: For analyzing test results and quality\n    - Purpose: Decide whether to advance, fix code, or fix tests\n    - Capabilities needed: testing, qa, analysis\n  - `validation-decision`: For quality gate decisions\n    - Purpose: Evaluate validation results and quality metrics\n    - Capabilities needed: validation, code-analysis\n  - `complex-decision`: For multi-factor workflow decisions\n    - Purpose: Handle complex orchestration across multiple phases\n    - Capabilities needed: planning, complex-analysis\n- Document each capability:\n  - Name and purpose\n  - Required sub-capabilities\n  - Typical use cases\n  - Expected output format\n- Design rationale:\n  - Capability-based instead of dedicated phases\n  - Leverages existing agent selection mechanism\n  - Multiple agents per capability allows competition/optimization\n  - Easy to extend with new decision types","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:31:01.869081+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T17:44:15.313711+01:00","closed_at":"2026-01-07T17:44:15.313711+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.4.1","depends_on_id":"agent-shepherd-alg8.6.4","type":"parent-child","created_at":"2026-01-07T00:31:01.869991+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.4.2","title":"2.4.2 Update Agent Registry with Decision Agents","description":"### 2.4.2 Update Agent Registry with Decision Agents\n- **WHAT**: Add sample decision agents to agent registry\n- **WHY**: Provides concrete examples and enables testing\n- **HOW**: Add agents to config/agents.yaml with decision capabilities\n- Add decision agents to config/agents.yaml:\n  ```yaml\n  agents:\n    - id: test-quality-decider\n      name: Test Quality Decider\n      description: Analyzes test results and decides next workflow phase\n      capabilities: [test-decision, analysis]\n      model: gpt-4\n      priority: 8\n      active: true\n      constraints:\n        performance_tier: balanced\n      \n    - id: validation-gatekeeper\n      name: Validation Gatekeeper\n      description: Reviews validation results and quality metrics\n      capabilities: [validation-decision, code-analysis]\n      model: claude-3\n      priority: 9\n      active: true\n      constraints:\n        performance_tier: balanced\n      \n    - id: workflow-orchestrator\n      name: Workflow Orchestrator\n      description: Handles complex multi-factor workflow decisions\n      capabilities: [complex-decision, planning]\n      model: gpt-4-turbo\n      priority: 10\n      active: true\n      constraints:\n        performance_tier: balanced\n  ```\n- Test agent selection with new capabilities:\n  - Verify test-decision capability selects test-quality-decider\n  - Verify validation-decision capability selects validation-gatekeeper\n  - Verify complex-decision capability selects workflow-orchestrator\n  - Test priority ordering (higher priority selected first)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:31:04.307295+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T17:44:15.326946+01:00","closed_at":"2026-01-07T17:44:15.326946+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.4.2","depends_on_id":"agent-shepherd-alg8.6.4","type":"parent-child","created_at":"2026-01-07T00:31:04.308124+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.4.3","title":"2.4.3 Implement buildDecisionInstructions()","description":"### 2.4.3 Implement buildDecisionInstructions()\n- **WHAT**: Build comprehensive prompt for decision agents\n- **WHY**: Agents need full context to make intelligent routing decisions\n- **HOW**: Combine issue data, previous results, and decision parameters\n- Create `buildDecisionInstructions()` in policy engine:\n  ```typescript\n  private buildDecisionInstructions(\n    issue: BeadsIssue,\n    transitionConfig: TransitionConfig,\n    previousOutcome: RunOutcome,\n    policyName: string,\n    currentPhase: string\n  ): string {\n    return `\n  # WORKFLOW DECISION TASK\n  \n  ## Issue Context:\n  - **Title**: ${issue.title}\n  - **Description**: ${issue.description}\n  - **Type**: ${issue.issue_type}\n  - **Priority**: P${issue.priority}\n  - **Current Status**: ${issue.status}\n  \n  ## Previous Phase Result:\n  - **Phase**: ${currentPhase}\n  - **Outcome**: ${previousOutcome.success ? 'SUCCESS' : 'FAILED'}\n  - **Message**: ${previousOutcome.message || 'No details'}\n  - **Duration**: ${previousOutcome.metrics?.duration_ms || 'unknown'}ms\n  - **Error**: ${previousOutcome.error || 'None'}\n  ${previousOutcome.warnings ? `- **Warnings**: ${previousOutcome.warnings.join(', ')}` : ''}\n  \n  ## Decision Instructions:\n  ${transitionConfig.prompt}\n  \n  ## Allowed Next Phases:\n  ${transitionConfig.allowed_destinations.map(dest =\u003e `- **${dest}**`).join('\\n')}\n  \n  ## Response Format:\n  ```json\n  {\n    \"decision\": \"jump_to_phase_name\" | \"advance_to_phase_name\" | \"require_approval\",\n    \"reasoning\": \"Brief explanation of decision logic\",\n    \"confidence\": 0.0-1.0,\n    \"recommendations\": [\"Optional additional suggestions\"]\n  }\n  ```\n  \n  Make your decision based on the context above.\n    `.trim();\n  }\n  ```\n- **Design rationale**:\n  - Provides issue grounding (what we're deciding about)\n  - Provides historical context (previous outcomes inform current decision)\n  - Provides clear instructions (specific guidance for decision type)\n  - Provides safety bounds (allowed destinations prevent invalid jumps)\n  - Provides structured output format (JSON for reliable parsing)\n  - Includes duration, warnings, errors for complete picture","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:31:07.620942+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T17:44:15.319594+01:00","closed_at":"2026-01-07T17:44:15.319594+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.4.3","depends_on_id":"agent-shepherd-alg8.6.4","type":"parent-child","created_at":"2026-01-07T00:31:07.62177+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.4.4","title":"2.4.4 Create DecisionResult Interface","description":"### 2.4.4 Create DecisionResult Interface\n- **WHAT**: Define structure for parsed decision agent responses\n- **WHY**: Type-safe handling of decision results\n- **HOW**: Define TypeScript interface with all fields\n- Define DecisionResult interface:\n  ```typescript\n  interface DecisionResult {\n    action: string;                    // \"jump_to_X\", \"advance_to_X\", \"require_approval\"\n    target_phase?: string;             // Extracted from action (e.g., \"develop\" from \"jump_to_develop\")\n    reasoning: string;                // Explanation of decision logic\n    confidence: number;               // 0.0-1.0 confidence score\n    requires_approval: boolean;        // Auto-triggered for low confidence\n    recommendations?: string[];       // Optional additional suggestions\n  }\n  ```\n- Add to type definitions in policy.ts\n- Document each field and its purpose","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:31:09.630381+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T17:44:15.317184+01:00","closed_at":"2026-01-07T17:44:15.317184+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.4.4","depends_on_id":"agent-shepherd-alg8.6.4","type":"parent-child","created_at":"2026-01-07T00:31:09.631323+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.4.5","title":"2.4.5 Implement parseDecisionResponse()","description":"### 2.4.5 Implement parseDecisionResponse()\n- **WHAT**: Parse and validate AI decision responses\n- **WHY**: Ensure decisions are safe, valid, and actionable\n- **HOW**: Strict validation prevents malformed decisions from breaking workflow\n- Create `parseDecisionResponse()` method in policy engine:\n  ```typescript\n  private parseDecisionResponse(\n    response: string,\n    transitionConfig: TransitionConfig\n  ): DecisionResult {\n    try {\n      const parsed = JSON.parse(response);\n      \n      // Validate required fields exist\n      if (!parsed.decision || !parsed.reasoning) {\n        throw new Error('Invalid decision response: missing required fields (decision, reasoning)');\n      }\n      \n      // Extract target phase from decision format\n      let targetPhase: string | undefined;\n      if (parsed.decision.startsWith('jump_to_')) {\n        targetPhase = parsed.decision.replace('jump_to_', '');\n      } else if (parsed.decision.startsWith('advance_to_')) {\n        targetPhase = parsed.decision.replace('advance_to_', '');\n      }\n      \n      // Critical safety check - validate against allowed destinations\n      if (targetPhase \u0026\u0026 !transitionConfig.allowed_destinations.includes(targetPhase)) {\n        throw new Error(`Decision attempted unauthorized jump to: ${targetPhase}. Allowed: ${transitionConfig.allowed_destinations.join(', ')}`);\n      }\n      \n      // Calculate requires_approval based on confidence thresholds\n      const confidenceThresholds = transitionConfig.confidence_thresholds || {\n        auto_advance: 0.8,\n        require_approval: 0.6\n      };\n      \n      const requiresApproval = \n        parsed.decision === 'require_approval' ||\n        (parsed.confidence \u003c confidenceThresholds.require_approval);\n      \n      return {\n        action: parsed.decision,\n        target_phase: targetPhase,\n        reasoning: parsed.reasoning,\n        confidence: parsed.confidence || 0.5,\n        requires_approval: requiresApproval,\n        recommendations: parsed.recommendations\n      };\n      \n    } catch (error) {\n      // Handle malformed JSON or validation failures\n      console.error('Failed to parse decision response:', error);\n      return {\n        action: 'require_approval',\n        reasoning: 'Failed to parse AI decision response',\n        confidence: 0,\n        requires_approval: true\n      };\n    }\n  }\n  ```\n- **Design rationale**:\n  - Validates required fields (decision, reasoning)\n  - Extracts target phase from action format (jump_to_X or advance_to_X)\n  - **Critical safety check**: validates against allowed_destinations\n  - Calculates requires_approval based on confidence thresholds:\n    - auto_advance: 0.8 - High confidence allows automatic progression\n    - require_approval: 0.6 - Medium confidence triggers human review\n  - Graceful error handling with safe fallback (require_approval)\n  - Logs parsing errors for debugging","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:31:13.013223+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T17:44:15.317431+01:00","closed_at":"2026-01-07T17:44:15.317431+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.4.5","depends_on_id":"agent-shepherd-alg8.6.4","type":"parent-child","created_at":"2026-01-07T00:31:13.014163+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.4.6","title":"2.4.6 Execute Decision Agent in Worker Engine","description":"### 2.4.6 Execute Decision Agent in Worker Engine\n- **WHAT**: Launch and execute decision agent for dynamic transitions\n- **WHY**: Enables AI-based intelligent workflow routing\n- **HOW**: Extend worker engine to handle dynamic_decision transitions\n- Extend `worker-engine.ts` to handle dynamic_decision transitions:\n  ```typescript\n  private async executeDecisionAgent(\n    issueId: string,\n    transition: PhaseTransition\n  ): Promise\u003cPhaseTransition\u003e {\n    // Select agent based on transitionConfig.capability\n    const agent = this.agentRegistry.selectAgent({\n      required_capabilities: [transition.dynamic_agent],  // e.g., \"test-decision\"\n      tags: ['decision']\n    });\n    \n    if (!agent) {\n      throw new Error(`No decision agent found with capability: ${transition.dynamic_agent}`);\n    }\n    \n    // Get issue details\n    const issue = await getIssue(issueId);\n    \n    // Build decision instructions\n    const instructions = this.policyEngine.buildDecisionInstructions(\n      issue,\n      transition.decision_config,\n      this.logger.getRun(this.currentRunId).outcome,\n      this.currentPolicy,\n      this.currentPhase\n    );\n    \n    // Launch decision agent with OpenCode CLI\n    const result = await this.opencode.runAgentCLI({\n      directory: process.cwd(),\n      title: `Decision: ${transition.dynamic_agent}`,\n      agent: agent.id,\n      message: instructions,\n    });\n    \n    if (!result.success) {\n      throw new Error(`Decision agent execution failed: ${result.error}`);\n    }\n    \n    // Parse decision response\n    const decision = this.policyEngine.parseDecisionResponse(\n      result.output,\n      transition.decision_config\n    );\n    \n    // Log decision\n    this.logger.logDecision({\n      run_id: this.currentRunId,\n      type: 'dynamic_decision',\n      decision: decision.action,\n      reasoning: decision.reasoning,\n      metadata: {\n        capability: transition.dynamic_agent,\n        confidence: decision.confidence,\n        target_phase: decision.target_phase,\n        requires_approval: decision.requires_approval\n      }\n    });\n    \n    // Return resulting transition based on decision\n    if (decision.requires_approval) {\n      return {\n        type: 'block',\n        reason: `Decision requires approval: ${decision.reasoning}`\n      };\n    } else if (decision.target_phase) {\n      return {\n        type: decision.action.startsWith('jump_to_') ? 'jump_back' : 'advance',\n        next_phase: decision.target_phase,\n        reason: decision.reasoning\n      };\n    } else {\n      return {\n        type: 'close',\n        reason: decision.reasoning\n      };\n    }\n  }\n  ```\n- **Design rationale**:\n  - Selects agent based on capability (e.g., test-decision)\n  - Builds comprehensive decision instructions\n  - Launches decision agent via OpenCode CLI\n  - Parses and validates response\n  - Logs decision with full metadata\n  - Returns PhaseTransition based on decision result\n  - Handles require_approval by blocking for HITL","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:31:16.715321+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T17:44:15.317188+01:00","closed_at":"2026-01-07T17:44:15.317188+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.4.6","depends_on_id":"agent-shepherd-alg8.6.4","type":"parent-child","created_at":"2026-01-07T00:31:16.716258+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.4.7","title":"2.4.7 Handle Decision Agent Failures","description":"### 2.4.7 Handle Decision Agent Failures\n- **WHAT**: Gracefully handle failures in decision agent execution\n- **WHY**: Prevents decision agent failures from breaking workflows\n- **HOW**: Default to safe fallback when decision agent fails\n- If decision agent execution fails:\n  - Log error with full details (error, stack trace, context)\n  - Default to safe fallback: require_approval\n  - Trigger HITL with decision failure context\n  - Include error details in HITL reason\n  - Block issue to prevent uncontrolled progression\n- Test failure scenarios:\n  - Decision agent crashes\n  - Decision agent returns malformed response\n  - No agent available with required capability\n  - Network timeout during decision execution","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:31:18.440505+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T17:44:15.330688+01:00","closed_at":"2026-01-07T17:44:15.330688+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.4.7","depends_on_id":"agent-shepherd-alg8.6.4","type":"parent-child","created_at":"2026-01-07T00:31:18.441395+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.4.8","title":"2.4.8 Add Decision Metadata Logging","description":"### 2.4.8 Add Decision Metadata Logging\n- **WHAT**: Log comprehensive metadata for all decisions\n- **WHY**: Provides audit trail and enables decision analysis\n- **HOW**: Store decision metadata in decisions.jsonl and decisions.db\n- Log decision metadata:\n  ```typescript\n  this.logger.logDecision({\n    run_id: runId,\n    type: 'dynamic_decision',\n    decision: decision.action,\n    reasoning: decision.reasoning,\n    metadata: {\n      // Agent information\n      decision_agent_id: agent.id,\n      capability: transition.dynamic_agent,\n      \n      // Decision configuration\n      prompt: transition.decision_config.prompt,\n      allowed_destinations: transition.decision_config.allowed_destinations,\n      confidence_thresholds: transition.decision_config.confidence_thresholds,\n      \n      // Decision result\n      confidence: decision.confidence,\n      target_phase: decision.target_phase,\n      requires_approval: decision.requires_approval,\n      \n      // Context\n      issue_id: issue.id,\n      from_phase: currentPhase,\n      raw_response: result.output,  // Full agent response\n      parsed_decision: decision      // Parsed decision object\n    }\n  });\n  ```\n- Add indexes for decision analysis queries:\n  - Index on type='dynamic_decision'\n  - Index on metadata.capability\n  - Index on metadata.confidence","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:31:20.841147+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T17:44:15.330768+01:00","closed_at":"2026-01-07T17:44:15.330768+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.4.8","depends_on_id":"agent-shepherd-alg8.6.4","type":"parent-child","created_at":"2026-01-07T00:31:20.842074+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.4.9","title":"2.4.9 Add Confidence Threshold Configuration","description":"### 2.4.9 Add Confidence Threshold Configuration\n- **WHAT**: Allow configuration of confidence thresholds\n- **WHY**: Different workflows may need different sensitivity\n- **HOW**: Extend TransitionConfig with confidence thresholds\n- Extend TransitionConfig with confidence thresholds:\n  ```typescript\n  interface TransitionConfig {\n    // ... existing fields ...\n    confidence_thresholds?: {\n      auto_advance: number;      // High confidence allows automatic progression\n      require_approval: number;  // Medium confidence triggers review\n    };\n  }\n  ```\n- Implement confidence-based auto-approval logic:\n  - If confidence \u003e= auto_advance: Automatic progression (no HITL)\n  - If confidence \u003e= require_approval and \u003c auto_advance: Require approval\n  - If confidence \u003c require_approval: Require approval with warning\n- Test confidence thresholds at various levels:\n  - Test high confidence (0.9) allows automatic progression\n  - Test medium confidence (0.7) requires approval\n  - Test low confidence (0.3) requires approval with warning\n  - Test missing confidence defaults to 0.5 (middle ground)\n- Add configuration examples:\n  ```yaml\n  transitions:\n    on_success:\n      capability: test-decision\n      confidence_thresholds:\n        auto_advance: 0.8    # High bar for auto-approval\n        require_approval: 0.6 # Medium bar triggers review\n  ```","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:31:23.465033+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T17:44:15.3394+01:00","closed_at":"2026-01-07T17:44:15.3394+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.4.9","depends_on_id":"agent-shepherd-alg8.6.4","type":"parent-child","created_at":"2026-01-07T00:31:23.465865+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.5","title":"2.5 Add Decision Prompt Building and Response Parsing","description":"## 2.5 Add Decision Prompt Building and Response Parsing\n**Priority: HIGH | Dependency: 2.4**\n\n### Overview\nCreate standardized prompt templates and robust response parsing for reliable decision-making.\n\n### Implementation Plan\n\n#### 2.5.1 Standardize Prompt Templates\n- Create prompt templates for test-decision, validation-decision, complex-decision\n- Store templates in config/decision-prompts.yaml\n- Support variable substitution ({{issue.title}}, {{phase.name}}, etc.)\n- Design rationale for centralized prompt management\n\n#### 2.5.2 Enhance buildDecisionInstructions()\n- Use prompt templates with rich context\n- Load capability-specific templates, substitute variables\n- Include recent decisions and phase history\n- Add custom instructions from transition config\n\n#### 2.5.3 Add Contextual Information to Prompts\n- Include recent decisions (last 5) for consistency\n- Include average phase durations for performance context\n- Include previous agent outputs and artifacts\n- Include relevant Beads labels and policy constraints\n- Format as well-structured markdown sections\n\n#### 2.5.4 Implement Response Validation\n- Validate JSON structure and required fields\n- Validate action format (jump_to_, advance_to_, require_approval)\n- Validate target phase against allowed_destinations\n- Return detailed validation errors with suggestions\n\n#### 2.5.5 Add Response Sanitization\n- Strip markdown code blocks, handle extra whitespace\n- Handle escaped quotes and Unicode characters\n- Apply sanitization before JSON.parse()\n- Log sanitization steps for debugging\n\n#### 2.5.6 Add Retry Logic for Decision Agents\n- Retry with clarifying instructions if parsing fails\n- Max 2 retries, then fallback to require_approval\n- Test retry behavior with malformed responses\n- Verify fallback to safe default\n\n#### 2.5.7 Add Decision Analytics\n- Track confidence distribution across decision types\n- Track most common target phases per capability\n- Track approval rate vs confidence score\n- Track decision agent performance metrics\n\n#### 2.5.8 Comprehensive Tests\n- Test prompt generation with various data\n- Test response parsing and validation\n- Test sanitization and retry logic\n- Test decision analytics queries","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:30:06.426247+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:09:51.990749+01:00","closed_at":"2026-01-07T18:09:51.990749+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.5","depends_on_id":"agent-shepherd-alg8.6","type":"parent-child","created_at":"2026-01-07T00:30:06.427069+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.5.1","title":"2.5.1 Standardize Prompt Templates","description":"### 2.5.1 Standardize Prompt Templates\n- **WHAT**: Create prompt templates for each decision context\n- **WHY**: Ensures consistency and simplifies prompt management\n- **HOW**: Store templates in config file with variable substitution\n- Create prompt templates for each decision context:\n  - Test decision template\n  - Validation decision template\n  - Complex workflow decision template\n- Store templates in config/decision-prompts.yaml:\n  ```yaml\n  decision_prompts:\n    test-decision: |\n      # TEST QUALITY DECISION\n      \n      Analyze the test results and decide the next step:\n      \n      ## Considerations:\n      - Are test failures due to code bugs or test issues?\n      - Is test coverage adequate for the feature?\n      - Are there flaky or intermittent tests?\n      - Should we fix code, fix tests, or proceed?\n      \n      ## Options:\n      {{#if allow_fix_code}}\n      - **fix_code**: Return to development phase to fix bugs\n      {{/if}}\n      {{#if allow_fix_tests}}\n      - **fix_tests**: Fix test infrastructure or test cases\n      {{/if}}\n      {{#if allow_proceed}}\n      - **proceed**: Tests are good enough to advance\n      {{/if}}\n      {{#if require_approval}}\n      - **require_approval**: Uncertain, needs human review\n      {{/if}}\n      \n      {{#with warnings}}\n      ## Warnings:\n      {{#each this}}\n      - {{this}}\n      {{/each}}\n      {{/with}}\n      \n    validation-decision: |\n      # VALIDATION GATE DECISION\n      \n      Evaluate validation results and quality metrics:\n      \n      ## Considerations:\n      - Does the implementation meet requirements?\n      - Are there critical or blocker issues?\n      - Is code quality acceptable?\n      - Are edge cases handled properly?\n      \n      ## Options:\n      - **approve**: Pass validation, advance to next phase\n      - **iterate**: Return to development for improvements\n      - **block**: Critical issues, block for human review\n      \n      {{#with quality_metrics}}\n      ## Quality Metrics:\n      - Coverage: {{coverage}}%\n      - Complexity: {{complexity}}\n      - Issues: {{issue_count}}\n      {{/with}}\n      \n    complex-decision: |\n      # COMPLEX WORKFLOW DECISION\n      \n      Analyze the complete workflow context and determine next steps:\n      \n      ## Considerations:\n      - Current phase outcome and implications\n      - Overall progress toward goal\n      - Resource constraints and priorities\n      - Alternative paths and their trade-offs\n      \n      ## Context:\n      {{previous_decisions}}\n      {{phase_history}}\n      {{resource_usage}}\n      \n      Make a recommendation based on this comprehensive analysis.\n  ```\n- Support variable substitution:\n  - `{{issue.title}}` - Issue title\n  - `{{phase.name}}` - Current phase name\n  - `{{outcome.message}}` - Previous outcome message\n  - `{{allowed_destinations}}` - Array of allowed next phases\n- Design rationale:\n  - Centralized prompt management\n  - Template syntax for flexibility\n  - Context-aware variable substitution\n  - Reusable across policies","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:31:27.408589+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:09:52.038823+01:00","closed_at":"2026-01-07T18:09:52.038823+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.5.1","depends_on_id":"agent-shepherd-alg8.6.5","type":"parent-child","created_at":"2026-01-07T00:31:27.409382+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.5.2","title":"2.5.2 Enhance buildDecisionInstructions()","description":"### 2.5.2 Enhance buildDecisionInstructions()\n- **WHAT**: Use prompt templates with rich context\n- **WHY**: Provides decision agents with comprehensive information\n- **HOW**: Load templates, substitute variables, include context\n- Enhance `buildDecisionInstructions()` method:\n  ```typescript\n  private buildDecisionInstructions(\n    issue: BeadsIssue,\n    transitionConfig: TransitionConfig,\n    previousOutcome: RunOutcome,\n    policyName: string,\n    currentPhase: string\n  ): string {\n    // Load template based on capability\n    const template = this.loadDecisionTemplate(transitionConfig.capability);\n    \n    // Build context object for template substitution\n    const context = {\n      issue: {\n        id: issue.id,\n        title: issue.title,\n        description: issue.description,\n        type: issue.issue_type,\n        priority: issue.priority\n      },\n      phase: {\n        name: currentPhase,\n        description: this.getPhaseConfig(policyName, currentPhase)?.description\n      },\n      outcome: {\n        success: previousOutcome.success,\n        message: previousOutcome.message,\n        error: previousOutcome.error,\n        warnings: previousOutcome.warnings || [],\n        duration_ms: previousOutcome.metrics?.duration_ms\n      },\n      policy: {\n        name: policyName\n      },\n      allowed_destinations: transitionConfig.allowed_destinations,\n      confidence_thresholds: transitionConfig.confidence_thresholds,\n      custom_instructions: transitionConfig.prompt\n    };\n    \n    // Substitute variables in template\n    const instructions = substituteVariables(template, context);\n    \n    // Include additional context\n    const recentDecisions = this.getRecentDecisionsForIssue(issue.id, 5);\n    const phaseHistory = this.getPhaseHistoryForIssue(issue.id);\n    \n    return `\n  ${instructions}\n  \n  ## Recent Decisions:\n  ${recentDecisions.map(d =\u003e `- ${d.type}: ${d.decision}`).join('\\n')}\n  \n  ## Phase History:\n  ${phaseHistory.map(r =\u003e `- ${r.phase}: ${r.status} (${r.duration_ms}ms)`).join('\\n')}\n    `.trim();\n  }\n  ```\n- **Design rationale**:\n  - Loads capability-specific templates\n  - Substitutes variables with actual data\n  - Adds recent decisions for consistency\n  - Adds phase history for context\n  - Includes custom instructions from transition config","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:31:30.495115+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:09:52.003198+01:00","closed_at":"2026-01-07T18:09:52.003198+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.5.2","depends_on_id":"agent-shepherd-alg8.6.5","type":"parent-child","created_at":"2026-01-07T00:31:30.495951+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.5.3","title":"2.5.3 Add Contextual Information to Prompts","description":"### 2.5.3 Add Contextual Information to Prompts\n- **WHAT**: Include rich context in decision prompts\n- **WHY**: Better decisions with more information\n- **HOW**: Gather and format various data sources\n- Include in decision prompts:\n  - **Recent decisions** (last 5):\n    - Shows decision history for consistency\n    - Helps agent understand previous choices\n  - **Average phase durations**:\n    - Performance context\n    - Identifies slow phases\n  - **Previous agent outputs**:\n    - Full execution results\n    - Artifacts and warnings\n  - **Relevant Beads issue labels**:\n    - Custom labels with context\n    - Priority and type information\n  - **Policy constraints**:\n    - Max attempts, timeouts, requirements\n    - Any phase-specific constraints\n- Format as well-structured markdown sections\n- Ensure prompts don't exceed agent context limits\n- Truncate or summarize very long histories if needed","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:31:32.462909+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:09:52.019914+01:00","closed_at":"2026-01-07T18:09:52.019914+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.5.3","depends_on_id":"agent-shepherd-alg8.6.5","type":"parent-child","created_at":"2026-01-07T00:31:32.463832+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.5.4","title":"2.5.4 Implement Response Validation","description":"### 2.5.4 Implement Response Validation\n- **WHAT**: Validate decision agent responses against schema\n- **WHY**: Prevents malformed decisions from breaking workflow\n- **HOW**: Strict validation of structure and content\n- Validate JSON structure:\n  ```typescript\n  function validateDecisionResponse(parsed: any, transitionConfig: TransitionConfig): void {\n    // Validate required fields\n    if (!parsed.decision) {\n      throw new Error('Missing required field: decision');\n    }\n    if (!parsed.reasoning) {\n      throw new Error('Missing required field: reasoning');\n    }\n    if (parsed.confidence !== undefined) {\n      if (typeof parsed.confidence !== 'number') {\n        throw new Error('Field \"confidence\" must be a number');\n      }\n      if (parsed.confidence \u003c 0 || parsed.confidence \u003e 1) {\n        throw new Error('Field \"confidence\" must be between 0.0 and 1.0');\n      }\n    }\n    \n    // Validate action format\n    const validActions = ['jump_to_', 'advance_to_', 'require_approval'];\n    const isValidAction = validActions.some(prefix =\u003e parsed.decision.startsWith(prefix)) || parsed.decision === 'require_approval';\n    if (!isValidAction) {\n      throw new Error(`Invalid action: ${parsed.decision}. Must start with jump_to_, advance_to_, or be require_approval`);\n    }\n    \n    // Validate target phase if specified\n    const targetPhase = extractTargetPhase(parsed.decision);\n    if (targetPhase \u0026\u0026 !transitionConfig.allowed_destinations.includes(targetPhase)) {\n      throw new Error(`Invalid target phase: ${targetPhase}. Allowed: ${transitionConfig.allowed_destinations.join(', ')}`);\n    }\n  }\n  ```\n- Return detailed validation errors:\n  - Field name\n  - Expected format\n  - Actual value\n  - Suggested fix","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:31:35.06608+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:09:52.011642+01:00","closed_at":"2026-01-07T18:09:52.011642+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.5.4","depends_on_id":"agent-shepherd-alg8.6.5","type":"parent-child","created_at":"2026-01-07T00:31:35.066871+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.5.5","title":"2.5.5 Add Response Sanitization","description":"### 2.5.5 Add Response Sanitization\n- **WHAT**: Clean and normalize decision agent responses\n- **WHY**: Handles various response formats from different agents\n- **HOW**: Apply sanitization before parsing\n- Sanitization steps:\n  - Strip markdown code blocks:\n    ```typescript\n    response = response.replace(/```json\\s*/, '').replace(/```\\s*$/, '');\n    ```\n  - Handle extra whitespace:\n    ```typescript\n    response = response.trim();\n    ```\n  - Handle escaped quotes:\n    ```typescript\n    response = response.replace(/\\\\\"/g, '\"');\n    ```\n  - Handle Unicode characters:\n    ```typescript\n    response = response.normalize('NFC');\n    ```\n  - Ensure valid UTF-8 encoding\n- Apply sanitization before JSON.parse()\n- Log sanitization steps for debugging","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:31:37.350889+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:09:52.004602+01:00","closed_at":"2026-01-07T18:09:52.004602+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.5.5","depends_on_id":"agent-shepherd-alg8.6.5","type":"parent-child","created_at":"2026-01-07T00:31:37.35166+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.5.6","title":"2.5.6 Add Retry Logic for Decision Agents","description":"### 2.5.6 Add Retry Logic for Decision Agents\n- **WHAT**: Retry decision agent if response parsing fails\n- **WHY**: Some decision agents may need clarification on format\n- **HOW**: Retry with clarifying instructions, then fallback\n- If decision parsing fails:\n  - Log failure with details\n  - Retry with clarifying instructions:\n    ```typescript\n    const clarifyingPrompt = `\nYour previous response could not be parsed. Please respond with valid JSON in exactly this format:\n\n{\n  \"decision\": \"jump_to_phase_name\" | \"advance_to_phase_name\" | \"require_approval\",\n  \"reasoning\": \"Brief explanation\",\n  \"confidence\": 0.0-1.0,\n  \"recommendations\": [\"Optional suggestions\"]\n}\n\nYour decision must be one of the allowed destinations: ${transitionConfig.allowed_destinations.join(', ')}\n    `.trim();\n    ```\n  - Max 2 retries for decision parsing\n  - Default to require_approval after retries exhausted\n  - Log all attempts and reasons\n- Test retry behavior:\n  - First attempt: malformed JSON\n  - Second attempt: clarified, valid JSON\n  - Verify retry with clarifying prompt\n  - Verify max retries enforced\n  - Verify fallback to require_approval","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:31:39.828303+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:09:52.008326+01:00","closed_at":"2026-01-07T18:09:52.008326+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.5.6","depends_on_id":"agent-shepherd-alg8.6.5","type":"parent-child","created_at":"2026-01-07T00:31:39.829317+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.5.7","title":"2.5.7 Add Decision Analytics","description":"### 2.5.7 Add Decision Analytics\n- **WHAT**: Track and analyze decision patterns\n- **WHY**: Provides insights into decision agent performance\n- **HOW**: Add queries and metrics for decision analysis\n- Track decision confidence distribution:\n  - Query decisions where type='dynamic_decision'\n  - Group by confidence ranges: \u003c0.3, 0.3-0.5, 0.5-0.7, 0.7-0.9, \u003e0.9\n  - Count decisions in each range\n  - Helps identify confidence calibration issues\n- Track most common target phases per decision type:\n  - Query decisions by capability (test-decision, validation-decision, etc.)\n  - Count occurrences of each target_phase\n  - Identify routing patterns\n- Track approval rate vs confidence score:\n  - Correlate confidence with requires_approval\n  - Verify thresholds are appropriate\n  - Adjust if needed\n- Track decision agent performance:\n  - Success rate per decision agent\n  - Average confidence per agent\n  - Most common decisions per agent\n  - Time spent per decision\n- Add queries to Logger:\n  ```typescript\n  getDecisionConfidenceDistribution(capability?: string): Promise\u003c{range: string, count: number}[]\u003e\n  getTargetPhaseCounts(capability: string): Promise\u003c{phase: string, count: number}[]\u003e\n  getDecisionAgentPerformance(agentId: string): Promise\u003c{success: number, avgConfidence: number}\u003e\n  ```","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:31:42.943093+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:09:52.023394+01:00","closed_at":"2026-01-07T18:09:52.023394+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.5.7","depends_on_id":"agent-shepherd-alg8.6.5","type":"parent-child","created_at":"2026-01-07T00:31:42.943946+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.6.5.8","title":"2.5.8 Comprehensive Tests","description":"### 2.5.8 Comprehensive Tests\n- **WHAT**: Test all aspects of decision prompt building and response parsing\n- **WHY**: Ensures reliable decision-making system\n- **HOW**: Unit and integration tests for all components\n- Test prompt generation:\n  - Test prompt for each decision context (test, validation, complex)\n  - Test variable substitution with various data\n  - Test recent decisions included in prompt\n  - Test phase history included in prompt\n  - Test template loading and rendering\n- Test response parsing:\n  - Test valid JSON with all fields\n  - Test valid JSON with minimal fields (decision, reasoning only)\n  - Test extraction of target phase from action\n  - Test confidence calculation\n  - Test requires_approval calculation\n- Test response validation:\n  - Test missing required fields caught\n  - Test invalid action format caught\n  - Test invalid target phase caught\n  - Test confidence range validation\n  - Test detailed error messages\n- Test response sanitization:\n  - Test markdown code blocks stripped\n  - Test extra whitespace removed\n  - Test escaped quotes handled\n  - Test Unicode characters handled\n- Test retry logic:\n  - Test first failure triggers retry\n  - Test retry with clarifying prompt\n  - Test max retries enforced\n  - Test fallback to require_approval\n- Test decision analytics:\n  - Test confidence distribution query\n  - Test target phase counts query\n  - Test decision agent performance query","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T00:31:45.216545+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:09:52.02382+01:00","closed_at":"2026-01-07T18:09:52.02382+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-alg8.6.5.8","depends_on_id":"agent-shepherd-alg8.6.5","type":"parent-child","created_at":"2026-01-07T00:31:45.217356+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.7","title":"Phase 3: Infrastructure","description":"## PHASE 3: Infrastructure\n**Estimated Duration: 2-3 weeks**\n\n### 3.1 Implement Garbage Collection with Retention Policies\n**Priority: HIGH | Dependency: Phase 1**\n\n#### 3.1.1 Design Retention Policy Interface\n- **WHAT**: Define structure for retention policy configuration\n- **WHY**: Enables configurable data retention based on age and usage\n- **HOW**: Create TypeScript interface with graduated retention tiers\n- Define RetentionPolicy interface:\n  ```typescript\n  interface RetentionPolicy {\n    active_window_days: number;      // Keep active + recent data (default 30)\n    archive_threshold_days: number; // Move to slow archive (default 90)\n    delete_threshold_days: number;   // Delete very old data (default 365)\n  }\n  ```\n- Define DEFAULT_POLICY constant:\n  ```typescript\n  const DEFAULT_POLICY: RetentionPolicy = {\n    active_window_days: 30,\n    archive_threshold_days: 90,\n    delete_threshold_days: 365\n  };\n  ```\n- **Design rationale**:\n  - **Active window** (0-30 days): Keep in fast database for active workflows\n  - **Archive window** (30-90 days): Move to slower but accessible archive\n  - **Delete window** (90-365 days): Keep for historical analysis and compliance\n  - **Beyond 365 days**: Delete to prevent unbounded growth\n  - Graduated approach balances performance, access, and storage\n\n#### 3.1.2 Add Retention Policy Configuration\n- **WHAT**: Add retention settings to main configuration\n- **WHY**: Makes retention policy configurable per installation\n- **HOW**: Add retention section to config/config.yaml\n- Add retention section to config/config.yaml:\n  ```yaml\n  retention:\n    active_window_days: 30      # Keep recent data in fast DB\n    archive_threshold_days: 90   # Move older data to archive\n    delete_threshold_days: 365   # Delete very old data\n    enabled: true               # Enable/disable garbage collection\n    schedule_interval_hours: 24  # Run cleanup daily\n  ```\n- Add validation for thresholds:\n  - Verify delete_threshold \u003e archive_threshold \u003e active_window\n  - Throw error if invalid: \"delete_threshold must be \u003e archive_threshold \u003e active_window\"\n- Create `loadRetentionPolicy(): RetentionPolicy` function:\n  ```typescript\n  function loadRetentionPolicy(): RetentionPolicy {\n    const config = loadConfig();\n    return {\n      active_window_days: config.retention?.active_window_days || 30,\n      archive_threshold_days: config.retention?.archive_threshold_days || 90,\n      delete_threshold_days: config.retention?.delete_threshold_days || 365\n    };\n  }\n  ```\n\n#### 3.1.3 Implement archiveOldRuns()\n- **WHAT**: Move old runs and decisions to archive database\n- **WHY**: Maintain performance while preserving audit capability\n- **HOW**: Periodic job based on age thresholds\n- Create `archiveOldRuns(): Promise\u003cvoid\u003e` in Logger:\n  ```typescript\n  async archiveOldRuns(): Promise\u003cvoid\u003e {\n    const policy = loadRetentionPolicy();\n    const now = Date.now();\n    \n    // Calculate timestamps\n    const archiveCutoff = now - (policy.archive_threshold_days * 24 * 60 * 60 * 1000);\n    const deleteCutoff = now - (policy.delete_threshold_days * 24 * 60 * 60 * 1000);\n    \n    // Find runs to archive (90-365 days old)\n    const runsToArchive = await this.queryRuns({\n      completed_before: archiveCutoff,\n      completed_after: deleteCutoff\n    });\n    \n    console.log(`Archiving ${runsToArchive.length} runs`);\n    \n    // Copy to archive database (slower, larger storage OK)\n    for (const run of runsToArchive) {\n      // Copy run to archive\n      await this.archiveDb.run(`\n        INSERT OR REPLACE INTO runs_archive \n        SELECT * FROM runs WHERE id = ?\n      `, [run.id]);\n      \n      // Copy decisions to archive\n      const decisions = await this.getDecisions(run.id);\n      for (const decision of decisions) {\n        await this.archiveDb.run(`\n          INSERT OR REPLACE INTO decisions_archive \n          VALUES (?, ?, ?, ?, ?, ?, ?)\n        `, [\n          decision.id, decision.run_id, decision.timestamp,\n          decision.type, decision.decision, decision.reasoning,\n          JSON.stringify(decision.metadata)\n        ]);\n      }\n      \n      // Remove from active database\n      await this.activeDb.run('DELETE FROM runs WHERE id = ?', [run.id]);\n    }\n    \n    console.log(`Archived ${runsToArchive.length} runs and associated decisions`);\n  }\n  ```\n- **Design rationale**:\n  - Keeps recent data fast (30 days in active DB)\n  - Preserves historical data (90-365 days in archive DB)\n  - Active DB stays lean for current operations\n  - Archive can use slower storage (compression OK)\n  - Data accessible but optimized for recent queries\n\n#### 3.1.4 Create Archive Database Schema\n- **WHAT**: Initialize archive database with same schema as active\n- **WHY**: Enables seamless data movement between databases\n- **HOW**: Initialize archive DB with identical tables\n- Initialize `runs_archive.db` with archive tables:\n  ```typescript\n  private initializeArchiveSchema(): void {\n    this.archiveDb.run(`\n      CREATE TABLE IF NOT EXISTS runs_archive (\n        id TEXT PRIMARY KEY,\n        issue_id TEXT NOT NULL,\n        session_id TEXT NOT NULL,\n        agent_id TEXT NOT NULL,\n        policy_name TEXT NOT NULL,\n        phase TEXT NOT NULL,\n        status TEXT NOT NULL,\n        created_at INTEGER NOT NULL,\n        updated_at INTEGER NOT NULL,\n        completed_at INTEGER,\n        outcome TEXT,\n        metadata TEXT\n      )\n    `);\n    \n    this.archiveDb.run(`\n      CREATE INDEX IF NOT EXISTS idx_runs_archive_issue_id ON runs_archive(issue_id)\n    `);\n    \n    this.archiveDb.run(`\n      CREATE INDEX IF NOT EXISTS idx_runs_archive_phase ON runs_archive(phase)\n    `);\n    \n    this.archiveDb.run(`\n      CREATE TABLE IF NOT EXISTS decisions_archive (\n        id TEXT PRIMARY KEY,\n        run_id TEXT NOT NULL,\n        timestamp INTEGER NOT NULL,\n        type TEXT NOT NULL,\n        decision TEXT NOT NULL,\n        reasoning TEXT,\n        metadata TEXT\n      )\n    `);\n    \n    this.archiveDb.run(`\n      CREATE INDEX IF NOT EXISTS idx_decisions_archive_run_id ON decisions_archive(run_id)\n    `);\n  }\n  ```\n- Ensure schema matches active database exactly\n- Create indexes for archive queries (same as active)\n- Use separate file: runs_archive.db\n\n#### 3.1.5 Implement deleteAncientData()\n- **WHAT**: Delete data older than retention limit\n- **WHY**: Prevents unbounded growth over system lifetime\n- **HOW**: Delete from archive database based on age\n- Create `deleteAncientData(): Promise\u003cvoid\u003e` method:\n  ```typescript\n  async deleteAncientData(): Promise\u003cvoid\u003e {\n    const policy = loadRetentionPolicy();\n    const now = Date.now();\n    const deleteCutoff = now - (policy.delete_threshold_days * 24 * 60 * 60 * 1000);\n    \n    // Delete from archive database\n    const deletedRuns = await this.archiveDb.run(`\n      DELETE FROM runs_archive WHERE completed_at \u003c ?\n    `, [deleteCutoff]);\n    \n    const deletedDecisions = await this.archiveDb.run(`\n      DELETE FROM decisions_archive WHERE timestamp \u003c ?\n    `, [deleteCutoff]);\n    \n    // Also check active database (shouldn't have data this old)\n    await this.activeDb.run('DELETE FROM runs WHERE completed_at \u003c ?', [deleteCutoff]);\n    await this.activeDb.run('DELETE FROM decisions WHERE timestamp \u003c ?', [deleteCutoff]);\n    \n    console.log(`Deleted ${deletedRuns} runs and ${deletedDecisions} decisions older than ${policy.delete_threshold_days} days`);\n  }\n  ```\n- **Design rationale**:\n  - Deletes data beyond 365 days (configurable)\n  - Prevents unlimited database growth\n  - Frees disk space\n  - Can use soft delete first for recovery\n  - Log all deletions for audit trail\n\n#### 3.1.6 Add Startup Cleanup\n- **WHAT**: Clean up on system start to maintain performance\n- **WHY**: Startup is good time for maintenance tasks\n- **HOW**: Remove very old data, rebuild indexes\n- Create `performStartupCleanup(): Promise\u003cvoid\u003e` method:\n  ```typescript\n  async performStartupCleanup(): Promise\u003cvoid\u003e {\n    const policy = loadRetentionPolicy();\n    const now = Date.now();\n    const deleteCutoff = now - (policy.delete_threshold_days * 24 * 60 * 60 * 1000);\n    \n    console.log('Performing startup cleanup...');\n    \n    // Archive old data\n    await this.archiveOldRuns();\n    \n    // Delete ancient data\n    await this.deleteAncientData();\n    \n    // Rebuild indexes after bulk deletion\n    await this.activeDb.run('REINDEX');\n    await this.archiveDb.run('REINDEX');\n    \n    // Vacuum databases to reclaim space\n    await this.activeDb.run('VACUUM');\n    await this.archiveDb.run('VACUUM');\n    \n    console.log('Startup cleanup completed');\n  }\n  ```\n- Call in Logger constructor:\n  ```typescript\n  constructor(dataDir?: string) {\n    // ... existing initialization ...\n    \n    // Perform startup cleanup on first init\n    if (this.isFirstRun) {\n      this.performStartupCleanup();\n    }\n  }\n  ```\n- **Design rationale**:\n  - Predictable timing: happens when system load is low\n  - Consistency: every restart ensures clean state\n  - Safety: no impact on running workflows\n  - REINDEX and VACUUM maintain query performance\n\n#### 3.1.7 Add Scheduled Cleanup\n- **WHAT**: Implement periodic cleanup job\n- **WHY**: Automated maintenance without manual intervention\n- **HOW**: Background timer runs cleanup at configured interval\n- Implement periodic cleanup job:\n  ```typescript\n  startScheduledCleanup(): void {\n    const config = loadConfig();\n    if (!config.retention?.enabled) {\n      return;\n    }\n    \n    const intervalHours = config.retention.schedule_interval_hours || 24;\n    const intervalMs = intervalHours * 60 * 60 * 1000;\n    \n    setInterval(async () =\u003e {\n      console.log('Running scheduled cleanup...');\n      await this.archiveOldRuns();\n      await this.deleteAncientData();\n      await this.archiveDb.run('REINDEX');\n      await this.archiveDb.run('VACUUM');\n      console.log('Scheduled cleanup completed');\n    }, intervalMs);\n  }\n  ```\n- Track last cleanup time in database:\n  ```typescript\n  async getLastCleanupTime(): Promise\u003cnumber\u003e {\n    const result = await this.activeDb.get('SELECT last_cleanup_time FROM metadata WHERE key = \"last_cleanup\"');\n    return result?.last_cleanup_time || 0;\n  }\n  \n  async setLastCleanupTime(timestamp: number): Promise\u003cvoid\u003e {\n    await this.activeDb.run(`\n      INSERT OR REPLACE INTO metadata (key, value) VALUES (\"last_cleanup\", ?)\n    `, [timestamp]);\n  }\n  ```\n- Only run if sufficient time elapsed (prevent double runs)\n\n#### 3.1.8 Add Size Limit Enforcement\n- **WHAT**: Monitor and enforce database size limits\n- **WHY**: Prevents long-term performance degradation\n- **HOW**: Check size on startup, trigger cleanup if exceeded\n- Add size limits to config:\n  ```yaml\n  retention:\n    max_db_size_mb: 100          # Maximum active DB size\n    max_archive_db_size_mb: 1000  # Maximum archive DB size\n    max_jsonl_size_mb: 500       # Maximum JSONL size\n  ```\n- Check database size on startup:\n  ```typescript\n  async enforceSizeLimits(): Promise\u003cvoid\u003e {\n    const config = loadConfig();\n    const stats = await this.getDatabaseStats();\n    \n    if (stats.active_db_size_mb \u003e config.retention.max_db_size_mb) {\n      console.warn(`Active database (${stats.active_db_size_mb}MB) exceeds limit (${config.retention.max_db_size_mb}MB)`);\n      await this.enforceSizeLimits();\n    }\n    \n    if (stats.archive_db_size_mb \u003e config.retention.max_archive_db_size_mb) {\n      console.warn(`Archive database (${stats.archive_db_size_mb}MB) exceeds limit`);\n      await this.pruneArchive();\n    }\n    \n    if (stats.jsonl_size_mb \u003e config.retention.max_jsonl_size_mb) {\n      console.warn(`JSONL files (${stats.jsonl_size_mb}MB) exceed limit`);\n      await this.archiveOldJSONL();\n    }\n  }\n  ```\n- Get database statistics:\n  ```typescript\n  async getDatabaseStats(): Promise\u003c{\n    active_db_size_mb: number;\n    archive_db_size_mb: number;\n    jsonl_size_mb: number;\n  }\u003e {\n    const activeDbStats = await this.activeDb.get('SELECT page_count * page_size as size FROM pragma_page_count(), pragma_page_size()');\n    const archiveDbStats = await this.archiveDb.get('SELECT page_count * page_size as size FROM pragma_page_count(), pragma_page_size()');\n    \n    const jsonlSize = await getJSONLSize(this.jsonlPath) + await getJSONLSize(this.decisionsPath);\n    \n    return {\n      active_db_size_mb: activeDbStats.size / (1024 * 1024),\n      archive_db_size_mb: archiveDbStats.size / (1024 * 1024),\n      jsonl_size_mb: jsonlSize / (1024 * 1024)\n    };\n  }\n  ```\n\n#### 3.1.9 Add Cleanup Metrics\n- **WHAT**: Track cleanup operations for monitoring\n- **WHY**: Provides visibility into garbage collection effectiveness\n- **HOW**: Store cleanup statistics in database\n- Track cleanup metrics:\n  ```typescript\n  interface CleanupMetrics {\n    timestamp: number;\n    runs_archived: number;\n    runs_deleted: number;\n    decisions_archived: number;\n    decisions_deleted: number;\n    db_size_before_mb: number;\n    db_size_after_mb: number;\n    duration_ms: number;\n  }\n  ```\n- Store metrics after each cleanup:\n  ```typescript\n  async recordCleanupMetrics(metrics: CleanupMetrics): Promise\u003cvoid\u003e {\n    await this.activeDb.run(`\n      INSERT INTO cleanup_metrics (timestamp, runs_archived, runs_deleted, decisions_archived, \n                                   decisions_deleted, db_size_before_mb, db_size_after_mb, duration_ms)\n      VALUES (?, ?, ?, ?, ?, ?, ?, ?)\n    `, [\n      metrics.timestamp, metrics.runs_archived, metrics.runs_deleted,\n      metrics.decisions_archived, metrics.decisions_deleted,\n      metrics.db_size_before_mb, metrics.db_size_after_mb, metrics.duration_ms\n    ]);\n  }\n  ```\n- Export metrics:\n  - Log summary after each cleanup\n  - Add CLI command: `ashep cleanup-stats`\n  - Query last N cleanup operations\n  - Calculate trends (e.g., average reduction, frequency)\n\n#### 3.1.10 Tests for Garbage Collection\n- **WHAT**: Comprehensive tests for garbage collection system\n- **WHY**: Ensures reliable cleanup without data loss\n- **HOW**: Test archival, deletion, startup, and scheduled cleanup\n- Test archival process:\n  - Create runs older than 90 days\n  - Verify runs copied to archive database\n  - Verify runs removed from active database\n  - Verify decisions also archived\n  - Verify all data preserved in archive\n- Test deletion process:\n  - Create runs older than 365 days\n  - Verify runs deleted from archive database\n  - Verify decisions deleted from archive database\n  - Verify JSONL also cleaned up\n- Test startup cleanup:\n  - Initialize Logger with old data\n  - Verify cleanup runs on startup\n  - Verify archival and deletion happen\n  - Verify indexes rebuilt\n  - Verify VACUUM runs\n- Test scheduled cleanup:\n  - Start scheduled cleanup timer\n  - Wait for interval to elapse\n  - Verify cleanup runs automatically\n  - Verify cleanup doesn't run if recently run\n- Test size limit enforcement:\n  - Create database exceeding max size\n  - Verify size check triggers cleanup\n  - Verify archival reduces size\n  - Verify deletion reduces size if archival insufficient\n- Test cleanup metrics:\n  - Verify metrics recorded after cleanup\n  - Test cleanup-stats CLI command\n  - Verify trends calculated correctly\n\n### 3.2 Create Archival System\n**Priority: HIGH | Dependency: 3.1**\n\n#### 3.2.1 Design Dual Database Architecture\n- **WHAT**: Separate active and archive databases\n- **WHY**: Maintains performance while preserving historical data\n- **HOW**: Use two SQLite databases with different access patterns\n- Design architecture:\n  - **Active database** (runs.db):\n    - Fast queries for current and recent data\n    - Indexes optimized for common queries\n    - Aggressive caching\n    - Small dataset (30 days)\n  - **Archive database** (runs_archive.db):\n    - Slower but larger storage\n    - Same schema for compatibility\n    - Historical data (30-365 days)\n    - Can use compression or different storage\n- Separate file paths:\n  - Active: `.agent-shepherd/runs.db`\n  - Archive: `.agent-shepherd/runs_archive.db`\n- Maintain identical schema for seamless data movement\n\n#### 3.2.2 Implement Archive Database Class\n- **WHAT**: Create ArchiveLogger for archive database access\n- **WHY**: Separate interface for archive data\n- **HOW**: Extend Logger or create separate class for archive\n- Create ArchiveLogger class:\n  ```typescript\n  class ArchiveLogger {\n    private db: Database;\n    \n    constructor(dataDir?: string) {\n      const dir = dataDir || join(process.cwd(), '.agent-shepherd');\n      const dbPath = join(dir, 'runs_archive.db');\n      this.db = new Database(dbPath);\n      this.initializeArchiveSchema();\n      this.syncFromJSONL();\n    }\n    \n    // Read-only methods (no modifications to archive)\n    async getRun(runId: string): Promise\u003cRunRecord | null\u003e {\n      // Query archive database\n    }\n    \n    async queryRuns(query: RunQuery): Promise\u003cRunRecord[]\u003e {\n      // Query archive database\n    }\n    \n    async getDecisions(runId: string): Promise\u003cDecisionRecord[]\u003e {\n      // Query archive database\n    }\n    \n    // Analytics methods\n    async getHistoricalStats(issueId: string): Promise\u003cany\u003e {\n      // Aggregate historical data\n    }\n  }\n  ```\n- Uses archive database file\n- Provides read-only access (no modifications)\n- Queries same as active database (consistent API)\n\n#### 3.2.3 Add Cross-Database Querying\n- **WHAT**: Query both active and archive databases together\n- **WHY**: Seamless access to all data regardless of location\n- **HOW**: Combine results from both databases\n- Implement `queryAllRuns(issue_id)`:\n  ```typescript\n  async queryAllRuns(issue_id: string): Promise\u003cRunRecord[]\u003e {\n    // Query active database\n    const activeRuns = await this.logger.queryRuns({ issue_id });\n    \n    // Query archive database\n    const archiveRuns = await this.archiveLogger.queryRuns({ issue_id });\n    \n    // Combine and deduplicate (active takes precedence)\n    const allRuns = new Map();\n    activeRuns.forEach(run =\u003e allRuns.set(run.id, run));\n    archiveRuns.forEach(run =\u003e {\n      if (!allRuns.has(run.id)) {\n        allRuns.set(run.id, run);\n      }\n    });\n    \n    // Sort by created_at DESC\n    return Array.from(allRuns.values()).sort((a, b) =\u003e b.created_at - a.created_at);\n  }\n  ```\n- Implement `getRunHistory(issue_id)`:\n  ```typescript\n  async getRunHistory(issue_id: string): Promise\u003cArray\u003c{phase: string, status: string, duration_ms: number, timestamp: number}\u003e\u003e {\n    const allRuns = await this.queryAllRuns(issue_id);\n    return allRuns.map(run =\u003e ({\n      phase: run.phase,\n      status: run.status,\n      duration_ms: run.outcome?.metrics?.duration_ms,\n      timestamp: run.created_at\n    }));\n  }\n  ```\n- Implement `getRunWithArchival(run_id)`:\n  ```typescript\n  async getRunWithArchival(run_id: string): Promise\u003cRunRecord | null\u003e {\n    // Try active database first\n    let run = await this.logger.getRun(run_id);\n    \n    // If not found, try archive\n    if (!run) {\n      run = await this.archiveLogger.getRun(run_id);\n    }\n    \n    return run;\n  }\n  ```\n- Maintain consistent API between active and archive\n\n#### 3.2.4 Implement JSONL Archival\n- **WHAT**: Archive JSONL files alongside database\n- **WHY**: JSONL is source of truth, must also be archived\n- **HOW**: Create archive JSONL files and append old records\n- Create runs_archive.jsonl and decisions_archive.jsonl:\n  ```typescript\n  async archiveOldJSONL(): Promise\u003cvoid\u003e {\n    const policy = loadRetentionPolicy();\n    const now = Date.now();\n    const archiveCutoff = now - (policy.archive_threshold_days * 24 * 60 * 60 * 1000);\n    \n    // Read active JSONL\n    const activeRuns = await readJSONL(this.jsonlPath);\n    const activeDecisions = await readJSONL(this.decisionsPath);\n    \n    // Filter runs to archive\n    const runsToArchive = activeRuns.filter(run =\u003e run.completed_at \u0026\u0026 run.completed_at \u003c archiveCutoff);\n    \n    // Archive runs\n    for (const run of runsToArchive) {\n      await appendJSONL(this.jsonlArchivePath, run);\n    }\n    \n    // Archive decisions\n    const runIdsToArchive = new Set(runsToArchive.map(run =\u003e run.id));\n    const decisionsToArchive = activeDecisions.filter(dec =\u003e runIdsToArchive.has(dec.run_id));\n    \n    for (const decision of decisionsToArchive) {\n      await appendJSONL(this.decisionsArchivePath, decision);\n    }\n    \n    console.log(`Archived ${runsToArchive.length} runs and ${decisionsToArchive.length} decisions to JSONL`);\n  }\n  ```\n- Maintain JSONL as source of truth for archive too\n- Append to archive files (don't modify active files)\n- Remove archived records from active JSONL periodically\n\n#### 3.2.5 Add Archive Sync on Startup\n- **WHAT**: Sync archive JSONL to archive database on startup\n- **WHY**: Ensures archive database is up to date\n- **HOW**: Same sync logic as active database\n- On ArchiveLogger construction:\n  ```typescript\n  constructor(dataDir?: string) {\n    // ... initialize database ...\n    \n    // Sync archive JSONL to database\n    this.syncFromJSONL();\n  }\n  \n  private syncFromJSONL(): void {\n    // Same sync logic as Logger\n    // Load archive JSONL, insert into archive database\n  }\n  ```\n- Ensure archive schema initialized before sync\n- Handle duplicate records (INSERT OR REPLACE)\n\n#### 3.2.6 Implement Archive Pruning\n- **WHAT**: Delete data from archive after retention expires\n- **WHY**: Archive can grow unbounded over time\n- **HOW**: Periodic deletion based on archive retention period\n- Configure archive retention:\n  ```yaml\n  retention:\n    archive_retention_days: 730  # Keep in archive for 2 years total\n  ```\n- Implement `pruneArchive()`:\n  ```typescript\n  async pruneArchive(): Promise\u003cvoid\u003e {\n    const config = loadConfig();\n    const now = Date.now();\n    const archiveRetentionCutoff = now - (config.retention.archive_retention_days * 24 * 60 * 60 * 1000);\n    \n    // Delete from archive database\n    const deletedRuns = await this.archiveDb.run(`\n      DELETE FROM runs_archive WHERE completed_at \u003c ?\n    `, [archiveRetentionCutoff]);\n    \n    const deletedDecisions = await this.archiveDb.run(`\n      DELETE FROM decisions_archive WHERE timestamp \u003c ?\n    `, [archiveRetentionCutoff]);\n    \n    // Delete from archive JSONL\n    await this.pruneArchiveJSONL(archiveRetentionCutoff);\n    \n    console.log(`Pruned ${deletedRuns} runs and ${deletedDecisions} decisions from archive`);\n  }\n  ```\n- Archive to cold storage (optional):\n  - Export very old data to compressed archives\n  - Store in separate location\n  - Can import if needed\n\n#### 3.2.7 Add Archive Queries\n- **WHAT**: Provide queries specific to archive data\n- **WHY**: Historical analysis needs different access patterns\n- **HOW**: Add specialized queries for archive\n- Add `getArchivedRuns(issue_id)`:\n  ```typescript\n  async getArchivedRuns(issue_id: string): Promise\u003cRunRecord[]\u003e {\n    return await this.archiveLogger.queryRuns({ issue_id });\n  }\n  ```\n- Add `getArchivedRunCount()`:\n  ```typescript\n  async getArchivedRunCount(): Promise\u003cnumber\u003e {\n    const result = await this.archiveDb.get('SELECT COUNT(*) as count FROM runs_archive');\n    return result.count;\n  }\n  ```\n- Add `getArchiveSize()`:\n  ```typescript\n  async getArchiveSize(): Promise\u003cnumber\u003e {\n    const stats = await this.archiveDb.get('SELECT page_count * page_size as size FROM pragma_page_count(), pragma_page_size()');\n    return stats.size;\n  }\n  ```\n- Add `cleanupArchive()`:\n  ```typescript\n  async cleanupArchive(): Promise\u003cvoid\u003e {\n    await this.pruneArchive();\n    await this.archiveDb.run('REINDEX');\n    await this.archiveDb.run('VACUUM');\n  }\n  ```\n\n#### 3.2.8 Performance Optimization\n- **WHAT**: Optimize archive database for different access patterns\n- **WHY**: Archive data queried less frequently, can optimize for storage\n- **HOW**: Adjust pragmas and storage settings\n- Archive database pragmas:\n  ```typescript\n  private initializeArchiveSchema(): void {\n    // Less aggressive caching for archive\n    this.archiveDb.run('PRAGMA cache_size = -2000');  // 2MB cache (smaller than active)\n    this.archiveDb.run('PRAGMA journal_mode = WAL');  // WAL for performance\n    this.archiveDb.run('PRAGMA synchronous = NORMAL');  // Relaxed sync for archive\n    \n    // Create tables...\n  }\n  ```\n- Consider compression for archive database:\n  ```typescript\n  // Enable compression if SQLite supports it\n  this.archiveDb.run('PRAGMA page_size = 4096');\n  ```\n- Optimize indexes for archive query patterns:\n  - Archive queries are mostly by issue_id for historical lookup\n  - Fewer indexes than active database\n  - Index on (issue_id, completed_at) for range queries\n\n#### 3.2.9 Tests for Archival System\n- **WHAT**: Test all archival operations\n- **WHY**: Ensures data is preserved during archival\n- **HOW**: Create test scenarios with various data ages\n- Test archival preserves all run and decision data:\n  - Create runs with various outcomes and metadata\n  - Run archival\n  - Verify all data in archive database matches active\n  - Verify JSONL archive has same records\n- Test cross-database queries:\n  - Create data in both active and archive\n  - Test queryAllRuns returns combined results\n  - Test getRunHistory includes both sources\n  - Test getRunWithArchival finds in correct location\n- Test JSONL archival syncs correctly:\n  - Create archive JSONL with records\n  - Initialize ArchiveLogger\n  - Verify database synced from JSONL\n  - Verify no duplicates\n- Test archive pruning:\n  - Create data older than archive retention\n  - Run pruneArchive\n  - Verify old data deleted\n  - Verify recent data preserved\n- Test archive database works with same queries:\n  - Query archive with same API as active\n  - Verify results returned correctly\n  - Verify consistent data types\n- Test performance difference:\n  - Benchmark queries on active vs archive\n  - Verify active is faster\n  - Verify archive still acceptable\n\n### 3.3 Complete OpenCode CLI Output Parsing\n**Priority: MEDIUM | Dependency: Phase 1**\n\n#### 3.3.1 Comprehensive Field Extraction\n- **WHAT**: Parse all available fields from OpenCode output\n- **WHY**: Capture maximum value from agent execution\n- **HOW**: Extract all fields from JSON output\n- Parse all fields from OpenCode JSON output:\n  - **Session metadata**:\n    - session_id: Unique identifier for the session\n    - start_time: When session started\n    - end_time: When session ended\n    - model: Model actually used\n  - **Agent information**:\n    - agent_id: Agent that executed\n    - provider_id: AI provider (anthropic, openai, etc.)\n    - model_id: Specific model used\n  - **Message history**:\n    - Full conversation array\n    - Each message: role, content, timestamp\n    - Distinguish human vs agent messages\n  - **Tool calls**:\n    - Tool name and inputs\n    - Tool outputs and execution time\n    - Sequential order of tool usage\n  - **File operations**:\n    - Files read, created, modified, deleted\n    - File paths and sizes\n    - Operation timestamps\n  - **Token usage**:\n    - Input tokens (prompt)\n    - Output tokens (completion)\n    - Total tokens\n    - Cost calculation if available\n  - **Error details**:\n    - Error type and message\n    - Stack trace with file paths and line numbers\n    - Context around error\n  - **Warnings**:\n    - Non-blocking issues\n    - Informational messages\n    - Deprecation warnings\n\n#### 3.3.2 Handle Multiple Output Formats\n- **WHAT**: Support various OpenCode output formats\n- **WHY**: Different agent runs may produce different output structures\n- **HOW**: Detect and handle multiple format variations\n- Support multiple output formats:\n  - **Single JSON object**:\n    - One complete JSON with all fields\n    - Typical for simple agent runs\n  - **JSONL (multiple JSON lines)**:\n    - Multiple JSON objects, one per line\n    - Typical for long-running agents with progress updates\n    - Combine information from multiple lines\n  - **Mixed stdout/stderr JSON**:\n    - Some JSON in stdout, some in stderr\n    - Merge both sources\n  - **Unstructured output**:\n    - Plain text without JSON\n    - Fallback to basic parsing\n- Detect output format automatically:\n  ```typescript\n  function detectOutputFormat(output: string): 'json' | 'jsonl' | 'mixed' | 'unstructured' {\n    const lines = output.trim().split('\\n');\n    \n    // Check if all lines are valid JSON\n    const allJSON = lines.every(line =\u003e {\n      try {\n        JSON.parse(line);\n        return true;\n      } catch {\n        return false;\n      }\n    });\n    \n    if (allJSON) {\n      return lines.length \u003e 1 ? 'jsonl' : 'json';\n    }\n    \n    // Check for mixed JSON and text\n    const hasJSON = lines.some(line =\u003e {\n      try {\n        JSON.parse(line);\n        return true;\n      } catch {\n        return false;\n      }\n    });\n    \n    if (hasJSON) {\n      return 'mixed';\n    }\n    \n    return 'unstructured';\n  }\n  ```\n\n#### 3.3.3 Extract Session Messages\n- **WHAT**: Parse full message history from CLI output\n- **WHY**: Provides complete conversation context\n- **HOW**: Extract messages array from JSON output\n- Extract and parse message history:\n  ```typescript\n  interface Message {\n    role: 'user' | 'assistant' | 'system';\n    content: string;\n    timestamp?: number;\n    tokens_used?: number;\n  }\n  \n  function extractMessages(output: string): Message[] {\n    const messages: Message[] = [];\n    \n    // Parse JSON lines\n    const lines = output.trim().split('\\n');\n    for (const line of lines) {\n      try {\n        const data = JSON.parse(line);\n        if (data.messages) {\n          // Full message history array\n          messages.push(...data.messages);\n        } else if (data.message) {\n          // Single message object\n          messages.push({\n            role: data.role || 'assistant',\n            content: data.message,\n            timestamp: data.timestamp\n          });\n        }\n      } catch {\n        // Skip non-JSON lines\n      }\n    }\n    \n    return messages;\n  }\n  ```\n- Store in RunOutcome.metadata.messages:\n  - Full conversation history\n  - Timestamps for each message\n  - Role information (human vs agent)\n  - Token usage per message if available\n\n#### 3.3.4 Extract Tool Usage\n- **WHAT**: Parse tool calls from CLI output\n- **WHY**: Tracks which tools were used and their performance\n- **HOW**: Extract tool information from JSON\n- Define ToolCall interface:\n  ```typescript\n  interface ToolCall {\n    name: string;\n    inputs: any;\n    outputs?: any;\n    duration_ms?: number;\n    timestamp: number;\n    success: boolean;\n    error?: string;\n  }\n  ```\n- Extract tool calls:\n  ```typescript\n  function extractToolCalls(output: string): ToolCall[] {\n    const toolCalls: ToolCall[] = [];\n    const lines = output.trim().split('\\n');\n    \n    for (const line of lines) {\n      try {\n        const data = JSON.parse(line);\n        if (data.tool_calls) {\n          // Array of tool calls\n          toolCalls.push(...data.tool_calls);\n        } else if (data.tool_name) {\n          // Single tool call\n          toolCalls.push({\n            name: data.tool_name,\n            inputs: data.tool_inputs,\n            outputs: data.tool_outputs,\n            duration_ms: data.tool_duration_ms,\n            timestamp: data.timestamp || Date.now(),\n            success: data.tool_success !== false,\n            error: data.tool_error\n          });\n        }\n      } catch {\n        // Skip non-JSON lines\n      }\n    }\n    \n    return toolCalls;\n  }\n  ```\n- Store in RunOutcome.metadata.tool_calls:\n  - All tools used during execution\n  - Inputs, outputs, timing\n  - Success/failure status\n\n#### 3.3.5 Extract File Operations\n- **WHAT**: Parse file operations from CLI output\n- **WHY**: Tracks which files were accessed/modified\n- **HOW**: Extract file operation information\n- Define FileOperation interface:\n  ```typescript\n  interface FileOperation {\n    path: string;\n    operation: 'read' | 'created' | 'modified' | 'deleted';\n    size?: number;\n    timestamp: number;\n    line_changes?: { added: number, deleted: number };\n  }\n  ```\n- Extract file operations:\n  ```typescript\n  function extractFileOperations(output: string): FileOperation[] {\n    const fileOps: FileOperation[] = [];\n    const lines = output.trim().split('\\n');\n    \n    for (const line of lines) {\n      try {\n        const data = JSON.parse(line);\n        if (data.file_operations) {\n          // Array of file operations\n          fileOps.push(...data.file_operations);\n        } else if (data.file_path) {\n          // Single file operation\n          fileOps.push({\n            path: data.file_path,\n            operation: data.operation,\n            size: data.file_size,\n            timestamp: data.timestamp || Date.now(),\n            line_changes: data.line_changes\n          });\n        }\n      } catch {\n        // Skip non-JSON lines\n      }\n    }\n    \n    return fileOps;\n  }\n  ```\n- Store in RunOutcome.metadata.file_operations:\n  - All files accessed during execution\n  - Type of operation\n  - Size and line changes\n\n#### 3.3.6 Extract Error Details\n- **WHAT**: Parse detailed error information\n- **WHY**: Provides debugging context for failures\n- **HOW**: Extract error details from JSON output\n- Define ErrorDetails interface:\n  ```typescript\n  interface ErrorDetails {\n    type?: string;\n    message: string;\n    stack_trace?: string;\n    file_path?: string;\n    line_number?: number;\n    column?: number;\n    context?: string;\n  }\n  ```\n- Extract error details:\n  ```typescript\n  function extractErrorDetails(output: string, stderr: string): ErrorDetails | null {\n    // Check stdout first\n    const lines = output.trim().split('\\n');\n    for (const line of lines) {\n      try {\n        const data = JSON.parse(line);\n        if (data.error) {\n          return {\n            type: data.error_type,\n            message: data.error.message || data.error,\n            stack_trace: data.error.stack_trace,\n            file_path: data.error.file_path,\n            line_number: data.error.line_number,\n            column: data.error.column,\n            context: data.error.context\n          };\n        }\n      } catch {\n        // Skip non-JSON lines\n      }\n    }\n    \n    // Check stderr for errors\n    if (stderr) {\n      const errorLines = stderr.trim().split('\\n');\n      for (const line of errorLines) {\n        try {\n          const data = JSON.parse(line);\n          if (data.error) {\n            return {\n              message: data.error.message || data.error,\n              stack_trace: data.error.stack_trace\n            };\n          }\n        } catch {\n          // Check for unstructured error\n          if (line.toLowerCase().includes('error')) {\n            return { message: line };\n          }\n        }\n      }\n    }\n    \n    return null;\n  }\n  ```\n- Store in RunOutcome.error_details:\n  - Full error context\n  - Stack trace for debugging\n  - File location if available\n\n#### 3.3.7 Implement Robust Error Handling\n- **WHAT**: Handle all error conditions gracefully\n- **WHY**: Parsing failures shouldn't crash the system\n- **HOW**: Add comprehensive error handling\n- Handle missing fields:\n  ```typescript\n  function safeGet(obj: any, path: string, defaultValue: any = undefined): any {\n    const keys = path.split('.');\n    let current = obj;\n    \n    for (const key of keys) {\n      if (current \u0026\u0026 typeof current === 'object' \u0026\u0026 key in current) {\n        current = current[key];\n      } else {\n        return defaultValue;\n      }\n    }\n    \n    return current;\n  }\n  \n  // Use when parsing\n  const sessionId = safeGet(data, 'session_id', 'unknown');\n  const duration = safeGet(data, 'metrics.duration_ms', 0);\n  ```\n- Handle malformed JSON:\n  ```typescript\n  try {\n    const data = JSON.parse(line);\n    // Process data\n  } catch (error) {\n    console.warn(`Failed to parse JSON line: ${error.message}`);\n    console.debug(`Line content: ${line.substring(0, 100)}...`);\n    // Continue to next line\n  }\n  ```\n- Handle partial output (incomplete execution):\n  - Detect incomplete JSON (missing closing brace)\n  - Still extract what's available\n  - Mark RunOutcome as partial: `outcome.metadata.incomplete = true`\n- Validate all extracted data:\n  ```typescript\n  function validateRunOutcome(outcome: RunOutcome): ValidationError[] {\n    const errors: ValidationError[] = [];\n    \n    if (outcome.metrics?.duration_ms \u003c 0) {\n      errors.push({ field: 'metrics.duration_ms', message: 'Duration cannot be negative' });\n    }\n    \n    if (outcome.session_id \u0026\u0026 typeof outcome.session_id !== 'string') {\n      errors.push({ field: 'session_id', message: 'Session ID must be a string' });\n    }\n    \n    // ... more validations\n    \n    return errors;\n  }\n  ```\n- Log parsing issues:\n  - Log warnings for missing optional fields\n  - Log errors for invalid required fields\n  - Log debug info for troubleshooting\n\n#### 3.3.8 Add Caching for CLI Output\n- **WHAT**: Cache raw CLI output for later analysis\n- **WHY**: Enables re-parsing without re-executing\n- **HOW**: Store raw output in run metadata\n- Cache full CLI output in run metadata:\n  ```typescript\n  // In worker-engine.ts after opencode.runAgentCLI\n  const result = await this.opencode.runAgentCLI({...});\n  \n  // Store raw output in metadata\n  this.logger.updateRun(run.id, {\n    metadata: {\n      ...run.metadata,\n      cli_output: {\n        stdout: result.output,\n        stderr: result.error,\n        exit_code: result.exitCode\n      }\n    }\n  });\n  ```\n- Benefits:\n  - Can re-parse output with updated logic\n  - Debugging: inspect raw output\n  - Audit trail: exact CLI output\n- Include in JSONL for audit trail:\n  - Stored in metadata (TEXT column in SQLite)\n  - Preserved in JSONL (source of truth)\n\n#### 3.3.9 Comprehensive Tests\n- **WHAT**: Test all aspects of output parsing\n- **WHY**: Ensures reliable extraction of all data\n- **HOW**: Unit tests with various input formats\n- Test parsing all output formats:\n  - Single JSON object\n  - Multiple JSON lines (JSONL)\n  - Mixed stdout/stderr JSON\n  - Unstructured output (fallback)\n- Test extraction of all field types:\n  - Session metadata (session_id, timestamps)\n  - Agent information (agent_id, model)\n  - Message history (full conversation)\n  - Tool usage (tools, inputs, outputs)\n  - File operations (files read/written)\n  - Error details (stack traces, locations)\n- Test error handling:\n  - Missing fields (use defaults)\n  - Malformed JSON (skip with warning)\n  - Partial output (extract what's available)\n  - Invalid data types (log error, use default)\n- Test caching:\n  - Verify raw output stored in metadata\n  - Verify can re-parse from cached output\n  - Verify JSONL contains raw output\n- Test with real OpenCode output:\n  - Run actual agent task\n  - Capture real CLI output\n  - Verify all fields extracted\n  - Verify RunOutcome fully populated\n\n### 3.4 Add Startup Cleanup and Size Limit Enforcement\n**Priority: MEDIUM | Dependency: 3.1, 3.2**\n\n#### 3.4.1 Integrate Startup Cleanup into Logger\n- **WHAT**: Trigger cleanup on Logger initialization\n- **WHY**: Ensures system starts in clean state\n- **HOW**: Call performStartupCleanup() in constructor\n- Modify Logger constructor:\n  ```typescript\n  constructor(dataDir?: string) {\n    // ... existing initialization ...\n    \n    // Perform startup cleanup if enabled\n    const config = loadConfig();\n    if (config.retention?.enabled !== false) {\n      this.performStartupCleanup().catch(error =\u003e {\n        console.error('Startup cleanup failed:', error);\n        // Don't block initialization on cleanup failure\n      });\n    }\n  }\n  ```\n- Async execution:\n  - Cleanup runs in background\n  - Doesn't block Logger construction\n  - Errors logged but don't crash\n- Log cleanup results:\n  - Number of runs archived\n  - Number of runs deleted\n  - Time taken\n  - Database size before/after\n\n#### 3.4.2 Add Cleanup Configuration\n- **WHAT**: Add configuration for cleanup behavior\n- **WHY**: Allows disabling or customizing cleanup\n- **HOW**: Add cleanup section to config\n- Add cleanup section to config/config.yaml:\n  ```yaml\n  cleanup:\n    enabled: true                # Enable/disable cleanup\n    run_on_startup: true         # Run cleanup on system startup\n    schedule_interval_hours: 24  # Run cleanup every N hours\n    archive_on_startup: true     # Archive old data on startup\n    delete_on_startup: false     # Don't delete on startup (only archive)\n  ```\n- Support disabling cleanup if needed:\n  - Set `enabled: false` to skip all cleanup\n  - Useful for debugging or special scenarios\n- Load configuration:\n  ```typescript\n  function loadCleanupConfig(): CleanupConfig {\n    const config = loadConfig();\n    return {\n      enabled: config.cleanup?.enabled !== false,\n      runOnStartup: config.cleanup?.run_on_startup !== false,\n      scheduleIntervalHours: config.cleanup?.schedule_interval_hours || 24,\n      archiveOnStartup: config.cleanup?.archive_on_startup !== false,\n      deleteOnStartup: config.cleanup?.delete_on_startup || false\n    };\n  }\n  ```\n\n#### 3.4.3 Implement Scheduled Cleanup Timer\n- **WHAT**: Background timer runs cleanup periodically\n- **WHY**: Automated maintenance without manual intervention\n- **HOW**: Start timer in Logger constructor\n- Implement scheduled cleanup:\n  ```typescript\n  startScheduledCleanup(): void {\n    const config = loadCleanupConfig();\n    \n    if (!config.enabled || config.scheduleIntervalHours === 0) {\n      return;  // Cleanup disabled\n    }\n    \n    const intervalMs = config.scheduleIntervalHours * 60 * 60 * 1000;\n    \n    console.log(`Starting scheduled cleanup (interval: ${config.scheduleIntervalHours}h)`);\n    \n    setInterval(async () =\u003e {\n      try {\n        // Check if cleanup recently run\n        const lastCleanup = await this.getLastCleanupTime();\n        const timeSinceLastCleanup = Date.now() - lastCleanup;\n        \n        if (timeSinceLastCleanup \u003c intervalMs * 0.9) {\n          console.log('Cleanup ran recently, skipping this interval');\n          return;\n        }\n        \n        console.log('Running scheduled cleanup...');\n        await this.performCleanupTasks();\n        \n        // Record cleanup time\n        await this.setLastCleanupTime(Date.now());\n        \n        console.log('Scheduled cleanup completed');\n      } catch (error) {\n        console.error('Scheduled cleanup failed:', error);\n      }\n    }, intervalMs);\n  }\n  \n  async performCleanupTasks(): Promise\u003cvoid\u003e {\n    const config = loadCleanupConfig();\n    \n    // Archive old data\n    if (config.archiveOnStartup) {\n      await this.archiveOldRuns();\n    }\n    \n    // Delete very old data (only if configured)\n    if (config.deleteOnStartup) {\n      await this.deleteAncientData();\n    }\n    \n    // Rebuild indexes\n    await this.activeDb.run('REINDEX');\n    await this.archiveDb.run('REINDEX');\n    \n    // Vacuum databases\n    await this.activeDb.run('VACUUM');\n    await this.archiveDb.run('VACUUM');\n  }\n  ```\n\n#### 3.4.4 Add Size Monitoring\n- **WHAT**: Periodically check database and file sizes\n- **WHY**: Alert when approaching limits\n- **HOW**: Monitor sizes, trigger cleanup if needed\n- Implement size monitoring:\n  ```typescript\n  startSizeMonitoring(): void {\n    const config = loadConfig();\n    const checkIntervalMs = 60 * 60 * 1000;  // Check every hour\n    \n    setInterval(async () =\u003e {\n      try {\n        const stats = await this.getDatabaseStats();\n        \n        // Log current sizes\n        console.log(`Database sizes - Active: ${stats.active_db_size_mb.toFixed(2)}MB, Archive: ${stats.archive_db_size_mb.toFixed(2)}MB, JSONL: ${stats.jsonl_size_mb.toFixed(2)}MB`);\n        \n        // Check against limits\n        if (stats.active_db_size_mb \u003e config.retention.max_db_size_mb * 0.9) {\n          console.warn(`Active database approaching limit: ${stats.active_db_size_mb.toFixed(2)}MB / ${config.retention.max_db_size_mb}MB`);\n          await this.enforceSizeLimits();\n        }\n        \n        if (stats.archive_db_size_mb \u003e config.retention.max_archive_db_size_mb * 0.9) {\n          console.warn(`Archive database approaching limit: ${stats.archive_db_size_mb.toFixed(2)}MB / ${config.retention.max_archive_db_size_mb}MB`);\n          await this.pruneArchive();\n        }\n        \n        if (stats.jsonl_size_mb \u003e config.retention.max_jsonl_size_mb * 0.9) {\n          console.warn(`JSONL files approaching limit: ${stats.jsonl_size_mb.toFixed(2)}MB / ${config.retention.max_jsonl_size_mb}MB`);\n          await this.archiveOldJSONL();\n        }\n      } catch (error) {\n        console.error('Size monitoring failed:', error);\n      }\n    }, checkIntervalMs);\n  }\n  ```\n- Track size trends:\n  - Store size history in database\n  - Plot size over time\n  - Predict when limits will be reached\n\n#### 3.4.5 Implement Emergency Cleanup\n- **WHAT**: More aggressive cleanup when limits exceeded\n- **WHY**: Prevents system from becoming unusable\n- **HOW**: Archive younger data, delete immediately\n- Implement emergency cleanup:\n  ```typescript\n  async emergencyCleanup(): Promise\u003cvoid\u003e {\n    console.warn('Emergency cleanup triggered - database size critical');\n    \n    const config = loadConfig();\n    const stats = await this.getDatabaseStats();\n    \n    // Aggressive archival (archive data younger than threshold)\n    if (stats.active_db_size_mb \u003e config.retention.max_db_size_mb) {\n      const now = Date.now();\n      const emergencyArchiveCutoff = now - (30 * 24 * 60 * 60 * 1000);  // Archive 30+ days old (normally 90)\n      \n      const runsToArchive = new Set();\n      const runs = await this.queryRuns({\n        completed_before: emergencyArchiveCutoff\n      });\n      \n      console.log(`Emergency archival: ${runs.length} runs`);\n      \n      for (const run of runs) {\n        await this.archiveDb.run('INSERT INTO runs_archive SELECT * FROM runs WHERE id = ?', [run.id]);\n        await this.activeDb.run('DELETE FROM runs WHERE id = ?', [run.id]);\n      }\n    }\n    \n    // Immediate deletion if still over limit\n    const newStats = await this.getDatabaseStats();\n    if (newStats.active_db_size_mb \u003e config.retention.max_db_size_mb) {\n      const now = Date.now();\n      const emergencyDeleteCutoff = now - (60 * 24 * 60 * 60 * 1000);  // Delete 60+ days old (normally 365)\n      \n      const deleted = await this.activeDb.run('DELETE FROM runs WHERE completed_at \u003c ?', [emergencyDeleteCutoff]);\n      console.log(`Emergency deletion: ${deleted} runs`);\n    }\n    \n    // Force vacuum\n    await this.activeDb.run('VACUUM');\n    \n    console.log('Emergency cleanup completed');\n  }\n  ```\n- Trigger emergency cleanup when:\n  - Size exceeds hard limit (e.g., 110% of max)\n  - Normal cleanup fails to reduce size\n  - Manual trigger via CLI command\n\n#### 3.4.6 Add Cleanup Health Checks\n- **WHAT**: Verify cleanup actually worked correctly\n- **WHY**: Ensures cleanup is effective and doesn't corrupt data\n- **HOW**: Run checks after each cleanup\n- Implement health checks:\n  ```typescript\n  async performCleanupHealthChecks(): Promise\u003cHealthCheckResult\u003e {\n    const result: HealthCheckResult = {\n      healthy: true,\n      issues: [],\n      metrics: {}\n    };\n    \n    const config = loadConfig();\n    const stats = await this.getDatabaseStats();\n    \n    // Check size reduction\n    const sizeBefore = result.metrics.db_size_before_mb;\n    const sizeAfter = stats.active_db_size_mb;\n    const sizeReduced = sizeBefore \u003e sizeAfter;\n    \n    if (!sizeReduced \u0026\u0026 this.lastCleanupType === 'archive') {\n      result.healthy = false;\n      result.issues.push('Archive did not reduce database size');\n    }\n    \n    // Check database integrity\n    try {\n      await this.activeDb.run('PRAGMA integrity_check');\n    } catch (error) {\n      result.healthy = false;\n      result.issues.push(`Database integrity check failed: ${error.message}`);\n    }\n    \n    // Check queries still work\n    try {\n      const testQuery = await this.queryRuns({ limit: 1 });\n      result.metrics.query_works = Array.isArray(testQuery);\n    } catch (error) {\n      result.healthy = false;\n      result.issues.push(`Query test failed: ${error.message}`);\n    }\n    \n    // Check archive exists and is accessible\n    try {\n      const archiveCount = await this.archiveDb.get('SELECT COUNT(*) as count FROM runs_archive');\n      result.metrics.archive_accessible = true;\n      result.metrics.archive_count = archiveCount.count;\n    } catch (error) {\n      result.healthy = false;\n      result.issues.push(`Archive not accessible: ${error.message}`);\n    }\n    \n    return result;\n  }\n  ```\n- Rollback on failure:\n  - If cleanup corrupts database, restore from backup\n  - Keep backups before cleanup operations\n\n#### 3.4.7 Add Cleanup Metrics Export\n- **WHAT**: Track and export cleanup metrics\n- **WHY**: Provides visibility into cleanup effectiveness\n- **HOW**: Store metrics in database, expose via API/logs\n- Track cleanup metrics:\n  ```typescript\n  interface CleanupMetrics {\n    timestamp: number;\n    type: 'startup' | 'scheduled' | 'emergency';\n    runs_archived: number;\n    runs_deleted: number;\n    decisions_archived: number;\n    decisions_deleted: number;\n    db_size_before_mb: number;\n    db_size_after_mb: number;\n    archive_size_before_mb: number;\n    archive_size_after_mb: number;\n    jsonl_size_before_mb: number;\n    jsonl_size_after_mb: number;\n    duration_ms: number;\n    health_check: HealthCheckResult;\n  }\n  ```\n- Store metrics after each cleanup:\n  ```typescript\n  async recordCleanupMetrics(metrics: CleanupMetrics): Promise\u003cvoid\u003e {\n    await this.activeDb.run(`\n      INSERT INTO cleanup_metrics (timestamp, type, runs_archived, runs_deleted,\n                                   decisions_archived, decisions_deleted,\n                                   db_size_before_mb, db_size_after_mb,\n                                   duration_ms)\n      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)\n    `, [\n      metrics.timestamp, metrics.type, metrics.runs_archived, metrics.runs_deleted,\n      metrics.decisions_archived, metrics.decisions_deleted,\n      metrics.db_size_before_mb, metrics.db_size_after_mb,\n      metrics.duration_ms\n    ]);\n  }\n  ```\n- Export metrics:\n  - Log summary after each cleanup\n  - Add CLI command: `ashep cleanup-stats`\n  - Query last N cleanup operations\n  - Calculate trends (e.g., average reduction, frequency)\n\n#### 3.4.8 Tests for Cleanup System\n- **WHAT**: Test all cleanup scenarios\n- **WHY**: Ensures cleanup works reliably without data loss\n- **HOW**: Create test scenarios with various data states\n- Test startup cleanup runs automatically:\n  - Initialize Logger with old data\n  - Verify cleanup runs on startup\n  - Verify archival happens if configured\n  - Verify deletion happens if configured\n- Test scheduled cleanup timing:\n  - Start scheduled cleanup timer\n  - Wait for interval to elapse\n  - Verify cleanup runs when interval elapsed\n  - Verify cleanup skipped if recently run\n- Test size monitoring triggers cleanup:\n  - Create database exceeding max size\n  - Wait for monitoring check\n  - Verify cleanup triggered\n  - Verify size reduced\n- Test emergency cleanup:\n  - Create database at 110% of max size\n  - Trigger emergency cleanup\n  - Verify aggressive archival\n  - Verify immediate deletion if needed\n  - Verify force vacuum runs\n- Test health checks:\n  - Run cleanup and verify health checks pass\n  - Intentionally corrupt database, verify health check fails\n  - Verify rollback on failure\n- Test cleanup metrics:\n  - Verify metrics recorded after each cleanup\n  - Test cleanup-stats CLI command\n  - Verify trends calculated correctly","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T00:50:24.475675+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T00:54:24.160336+01:00","dependencies":[{"issue_id":"agent-shepherd-alg8.7","depends_on_id":"agent-shepherd-alg8","type":"parent-child","created_at":"2026-01-07T00:50:24.477043+01:00","created_by":"daemon"}],"deleted_at":"2026-01-07T00:54:24.160336+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-alg8.8","title":"3.1 Implement Garbage Collection with Retention Policies","description":"Implement comprehensive garbage collection system with configurable retention policies to manage database size and maintain performance.\n\n## Overview\nCreate a modular garbage collection system that automatically archives old data and deletes ancient data based on configurable time and size thresholds. This ensures the system maintains performance while preserving historical data for analysis.\n\n## Key Components\n- RetentionPolicyManager: Manages data retention policies and rules\n- GarbageCollector: Handles archiving and deletion of old run data\n- CleanupEngine: Orchestrates startup and scheduled cleanup operations\n- Archive database: Separate storage for historical data\n- Automatic cleanup on startup and scheduled intervals\n- Size limit enforcement and emergency cleanup\n- Cleanup metrics and monitoring\n\n## Architecture\n- **RetentionPolicyManager**: Policy evaluation and metrics tracking\n- **GarbageCollector**: Core cleanup operations (archive/delete/size limits)\n- **CleanupEngine**: Lifecycle management and scheduling\n- **Logger**: Pure logging (no cleanup responsibilities)\n\n## Dependencies\n- Phase 1 logging system (for data to clean up)\n- Phase 2 enhanced output parsing (for data structure understanding)\n\n## Priority: HIGH","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-07T01:31:59.883126+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T20:58:49.295582+01:00","closed_at":"2026-01-07T20:58:49.295582+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.8","depends_on_id":"agent-shepherd-alg8","type":"parent-child","created_at":"2026-01-07T01:31:59.884005+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.8.1","title":"3.1.1 Design Retention Policy Interface","description":"Define structure for retention policy configuration to enable configurable data retention based on age and usage.\n\n## WHAT\nDefine TypeScript interface for retention policy configuration with graduated retention tiers.\n\n## WHY\nEnables configurable data retention based on age and usage patterns, allowing installations to balance performance, storage, and compliance needs.\n\n## HOW\nCreate TypeScript interface with graduated retention tiers:\n- Active window (0-age_days): Keep in fast database for active workflows\n- Archive window (age_days-archive_after_days): Move to slower archive for historical access\n- Delete window (archive_after_days-delete_after_days): Keep for compliance, then delete\n\n## Implementation\nDefine RetentionPolicy interface:\n```typescript\ninterface RetentionPolicy {\n  name: string;\n  description?: string;\n  enabled: boolean;\n  \n  age_days: number;           // Age threshold for considering runs for cleanup\n  archive_after_days?: number; // Archive runs after this many days (defaults to age_days)\n  delete_after_days?: number;  // Delete runs after this many days\n  \n  max_runs?: number;          // Maximum number of runs to keep\n  max_size_mb?: number;       // Maximum total size in MB\n  \n  archive_enabled?: boolean;  // Whether archiving is enabled\n  // ... additional filtering options\n}\n```\n\n## Design Rationale\n- **age_days**: Base threshold for cleanup consideration\n- **archive_after_days**: When to move data to slower archive storage\n- **delete_after_days**: When to permanently delete data\n- **max_runs/max_size_mb**: Size-based cleanup triggers\n- Flexible configuration allows different retention needs per installation","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:32:07.22452+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T20:58:49.149014+01:00","closed_at":"2026-01-07T20:58:49.149014+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.8.1","depends_on_id":"agent-shepherd-alg8.8","type":"parent-child","created_at":"2026-01-07T01:32:07.225338+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.8.10","title":"3.1.10 Tests for Garbage Collection","description":"Comprehensive tests for garbage collection system to ensure reliable cleanup without data loss.\n\n## WHAT\nCreate test suite for all garbage collection operations.\n\n## WHY\nEnsures cleanup works reliably and safely without corrupting or losing data.\n\n## HOW\nTest all scenarios:\n- Archival process preserves all data\n- Deletion removes correct data\n- Startup cleanup runs automatically\n- Scheduled cleanup timing works\n- Size limits trigger cleanup\n- Emergency cleanup handles critical situations\n- Metrics recorded accurately\n\n## Test Cases\n- Test archival with various data ages\n- Test deletion boundaries\n- Test startup and scheduled timing\n- Test size limit enforcement\n- Test emergency cleanup\n- Test metrics recording and querying","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:32:29.60421+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T20:58:47.628888+01:00","closed_at":"2026-01-07T20:58:47.628888+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.8.10","depends_on_id":"agent-shepherd-alg8.8","type":"parent-child","created_at":"2026-01-07T01:32:29.605076+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.8.2","title":"3.1.2 Add Retention Policy Configuration","description":"Add retention settings to main configuration to make retention policy configurable per installation.\n\n## WHAT\nAdd retention section to config/config.yaml with configurable policies and settings.\n\n## WHY\nMakes retention policy configurable per installation, allowing different environments to have different retention needs.\n\n## HOW\nAdd retention section to config/config.yaml:\n```yaml\nretention:\n  enabled: true\n  cleanup_on_startup: false\n  cleanup_interval_ms: 3600000\n  archive_enabled: true\n  policies:\n    - name: default\n      description: Default retention policy for all runs\n      enabled: true\n      age_days: 90\n      max_runs: 1000\n      max_size_mb: 100\n      archive_enabled: true\n      archive_after_days: 30\n      delete_after_days: 365\n      keep_successful_runs: false\n      keep_failed_runs: true\n```\n\nAdd validation for policy configuration:\n- Verify delete_after_days \u003e archive_after_days \u003e age_days (if specified)\n- Throw error if invalid: \"delete_after_days must be \u003e archive_after_days \u003e age_days\"\n- Validate policy names are unique\n\nCreate loadRetentionConfig(): RetentionConfig function to load and validate configuration.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:32:10.157517+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T20:58:48.983993+01:00","closed_at":"2026-01-07T20:58:48.983993+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.8.2","depends_on_id":"agent-shepherd-alg8.8","type":"parent-child","created_at":"2026-01-07T01:32:10.158391+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.8.3","title":"3.1.3 Implement archiveOldRuns()","description":"Implement archiveOldRuns() method in GarbageCollector class to move old runs and decisions to archive database based on age thresholds.\n\n## WHAT\nCreate archiveOldRuns(): Promise\u003cCleanupResult\u003e method in GarbageCollector class.\n\n## WHY\nMaintains performance by keeping active database lean while preserving historical data for analysis.\n\n## HOW\nImplement archiveOldRuns() in GarbageCollector:\n- Calculate archive cutoffs based on retention policy\n- Find runs to archive using RetentionPolicyManager.shouldArchiveRun()\n- Copy runs and decisions to archive database\n- Remove from active database\n- Record cleanup metrics\n\n## Design Rationale\n- Keeps recent data fast (active DB stays lean)\n- Preserves historical data (archive DB for analysis)\n- Archive can use slower storage (compression OK)\n- Data accessible but optimized for recent queries\n- Metrics tracked for monitoring effectiveness","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:32:12.473323+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T20:58:48.805341+01:00","closed_at":"2026-01-07T20:58:48.805341+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.8.3","depends_on_id":"agent-shepherd-alg8.8","type":"parent-child","created_at":"2026-01-07T01:32:12.474324+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.8.4","title":"3.1.4 Create Archive Database Schema","description":"Initialize archive database with same schema as active database to enable seamless data movement.\n\n## WHAT\nInitialize archive.db with identical tables and indexes as active database.\n\n## WHY\nEnables seamless data movement between databases without schema conversion issues.\n\n## HOW\nInitialize archive database with:\n- runs_archive table (identical to runs table)\n- decisions_archive table (identical to decisions table)\n- Same indexes for query performance\n- Separate file: archive.db\n\nEnsure schema matches active database exactly for compatibility.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:32:15.6082+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T20:58:48.642251+01:00","closed_at":"2026-01-07T20:58:48.642251+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.8.4","depends_on_id":"agent-shepherd-alg8.8","type":"parent-child","created_at":"2026-01-07T01:32:15.609228+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.8.5","title":"3.1.5 Implement deleteAncientData()","description":"Implement deleteAncientData() method in GarbageCollector class to delete data older than retention limit from archive database.\n\n## WHAT\nCreate deleteAncientData(): Promise\u003cCleanupResult\u003e method in GarbageCollector class.\n\n## WHY\nPrevents unlimited database growth over system lifetime while maintaining compliance windows.\n\n## HOW\nImplement deleteAncientData() in GarbageCollector:\n- Calculate delete cutoffs based on retention policy\n- Find runs to delete using RetentionPolicyManager.shouldDeleteRun()\n- Delete from archive database based on delete_after_days\n- Also check active database (should not have data this old)\n- Record cleanup metrics and log deletion statistics\n\n## Design Rationale\n- Deletes data beyond retention limit (prevents unbounded growth)\n- Frees disk space and maintains performance\n- Maintains audit trail of deletions\n- Can use soft delete first for recovery if needed\n- Metrics tracked for compliance and monitoring","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:32:18.273897+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T20:58:48.472102+01:00","closed_at":"2026-01-07T20:58:48.472102+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.8.5","depends_on_id":"agent-shepherd-alg8.8","type":"parent-child","created_at":"2026-01-07T01:32:18.274741+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.8.6","title":"3.1.6 Add Startup Cleanup","description":"Integrate startup cleanup into application lifecycle via CleanupEngine.\n\n## WHAT\nEnsure CleanupEngine starts automatically and runs startup cleanup when the application initializes.\n\n## WHY\nStartup is good time for maintenance tasks when system load is low, ensuring clean state.\n\n## HOW\nIntegrate CleanupEngine into application startup:\n- Initialize CleanupEngine in worker/monitor engine startup\n- Enable runOnStartup flag to trigger cleanup on application start\n- Run cleanup in background (non-blocking) during initialization\n- Log cleanup results and handle errors gracefully\n\n## Design Rationale\n- Predictable timing: happens when system load is low\n- Consistency: every restart ensures clean state\n- Safety: no impact on running workflows\n- REINDEX and VACUUM maintain query performance\n- Background execution doesn't block application startup","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:32:20.635275+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T20:58:48.29952+01:00","closed_at":"2026-01-07T20:58:48.29952+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.8.6","depends_on_id":"agent-shepherd-alg8.8","type":"parent-child","created_at":"2026-01-07T01:32:20.63639+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.8.7","title":"3.1.7 Add Scheduled Cleanup","description":"Implement scheduled cleanup timer in CleanupEngine for periodic maintenance.\n\n## WHAT\nCreate background timer in CleanupEngine that runs cleanup at configured intervals.\n\n## WHY\nAutomated maintenance ensures system stays clean without manual intervention.\n\n## HOW\nImplement scheduled cleanup in CleanupEngine:\n- Start background timer during CleanupEngine initialization\n- Run cleanup every cleanup_interval_ms (configurable)\n- Track last cleanup time to prevent double runs\n- Execute full cleanup cycle: archive + delete + size limits\n- Log cleanup operations and record metrics\n\n## Design Rationale\n- Automated maintenance without manual intervention\n- Configurable intervals (default 1 hour)\n- Prevents duplicate runs with timing checks\n- Full cleanup cycle ensures comprehensive maintenance\n- Metrics and logging for monitoring and troubleshooting","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:32:22.860996+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T20:58:48.120985+01:00","closed_at":"2026-01-07T20:58:48.120985+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.8.7","depends_on_id":"agent-shepherd-alg8.8","type":"parent-child","created_at":"2026-01-07T01:32:22.861752+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.8.8","title":"3.1.8 Implement Size Limit Enforcement","description":"Implement size limit enforcement in GarbageCollector to prevent long-term performance degradation.\n\n## WHAT\nAdd size monitoring and enforcement to GarbageCollector to prevent databases from growing too large.\n\n## WHY\nPrevents performance degradation from oversized databases.\n\n## HOW\nImplement size limits in GarbageCollector:\n- Monitor database sizes periodically during cleanup\n- Check against max_db_size_mb and max_archive_db_size_mb limits\n- Trigger emergency cleanup when approaching limits\n- Use RetentionPolicyManager.needsCleanup() for size-based decisions\n- Record size metrics and cleanup effectiveness\n\n## Design Rationale\n- Prevents performance degradation from oversized databases\n- Emergency cleanup for critical size violations\n- Configurable limits per installation needs\n- Size trends tracked for capacity planning\n- Integrated with existing cleanup cycle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:32:25.380062+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T20:58:47.976065+01:00","closed_at":"2026-01-07T20:58:47.976065+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.8.8","depends_on_id":"agent-shepherd-alg8.8","type":"parent-child","created_at":"2026-01-07T01:32:25.380985+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.8.9","title":"3.1.9 Add Cleanup Metrics","description":"Track cleanup operations for monitoring and analysis of garbage collection effectiveness.\n\n## WHAT\nStore cleanup statistics in database for monitoring and troubleshooting.\n\n## WHY\nProvides visibility into cleanup effectiveness and helps diagnose issues.\n\n## HOW\nTrack cleanup metrics:\n- Runs archived/deleted counts\n- Database sizes before/after\n- Cleanup duration\n- Health check results\n\nStore metrics after each cleanup operation and provide queries for analysis.\n\n## Implementation\n- Record metrics in cleanup_metrics table\n- Query for cleanup statistics and trends\n- Export metrics via CLI/logs\n- Calculate effectiveness metrics","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:32:27.494079+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T20:58:47.811838+01:00","closed_at":"2026-01-07T20:58:47.811838+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.8.9","depends_on_id":"agent-shepherd-alg8.8","type":"parent-child","created_at":"2026-01-07T01:32:27.496651+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.9","title":"3.2 Create Archival System","description":"Create dual database architecture with separate active and archive databases for optimal performance and historical data access.\n\n## Overview\nImplement a dual database system where recent data stays in a fast active database and older data is moved to a slower but larger archive database. This maintains query performance for current operations while preserving historical data.\n\n## Key Components\n- Dual database architecture (active + archive)\n- Archive database class for historical queries\n- Cross-database querying capabilities\n- JSONL archival alongside database\n- Archive pruning and maintenance\n- Performance optimizations for archive\n\n## Dependencies\n- 3.1 Garbage Collection (uses archival for cleanup)\n- Phase 1 logging system (data to archive)\n\n## Priority: HIGH","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-07T01:32:31.929939+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:31:32.080824+01:00","closed_at":"2026-01-07T21:31:32.080824+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.9","depends_on_id":"agent-shepherd-alg8","type":"parent-child","created_at":"2026-01-07T01:32:31.93078+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.9.1","title":"3.2.1 Design Dual Database Architecture","description":"Design separate active and archive databases with different access patterns and storage optimizations.\n\n## WHAT\nDesign architecture with two SQLite databases optimized for different use cases.\n\n## WHY\nMaintains performance for current operations while preserving historical data access.\n\n## HOW\nDesign architecture:\n- **Active database** (runs.db): Fast queries for current/recent data, aggressive caching, small dataset\n- **Archive database** (runs_archive.db): Slower but larger storage, historical data, can use compression\n\nSeparate file paths and identical schemas for seamless data movement.\n\n## Design Considerations\n- Active DB: Optimized for speed, current operations\n- Archive DB: Optimized for storage, historical analysis\n- Same schema ensures compatibility\n- Different pragmas for different optimization goals","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:32:35.092745+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:31:31.891778+01:00","closed_at":"2026-01-07T21:31:31.891778+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.9.1","depends_on_id":"agent-shepherd-alg8.9","type":"parent-child","created_at":"2026-01-07T01:32:35.09363+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.9.2","title":"3.2.2 Implement Archive Database Class","description":"Create ArchiveLogger class for archive database access with read-only operations.\n\n## WHAT\nCreate ArchiveLogger class that extends Logger functionality for archive data.\n\n## WHY\nSeparate interface for archive data access with appropriate optimizations.\n\n## HOW\nCreate ArchiveLogger class:\n- Uses archive database file\n- Provides read-only access (no modifications)\n- Queries same as active database (consistent API)\n- Optimized for historical query patterns\n\n## Implementation\n- Constructor initializes archive database\n- Methods: getRun(), queryRuns(), getDecisions()\n- Read-only operations only\n- Consistent API with active Logger","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:32:37.340436+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:31:31.726083+01:00","closed_at":"2026-01-07T21:31:31.726083+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.9.2","depends_on_id":"agent-shepherd-alg8.9","type":"parent-child","created_at":"2026-01-07T01:32:37.341317+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.9.3","title":"3.2.3 Add Cross-Database Querying","description":"Implement querying across both active and archive databases for seamless data access.\n\n## WHAT\nCreate methods to query both databases together and return combined results.\n\n## WHY\nSeamless access to all data regardless of location (active vs archive).\n\n## HOW\nImplement cross-database queries:\n- queryAllRuns(): Combine results from active and archive\n- getRunHistory(): Include data from both sources\n- getRunWithArchival(): Find in correct location\n\nMaintain consistent API between active and archive databases.\n\n## Implementation\n- Deduplication logic (active takes precedence)\n- Sorting and pagination across combined results\n- Performance considerations for large datasets","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:32:39.928683+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:31:31.574163+01:00","closed_at":"2026-01-07T21:31:31.574163+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.9.3","depends_on_id":"agent-shepherd-alg8.9","type":"parent-child","created_at":"2026-01-07T01:32:39.929651+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.9.4","title":"3.2.4 Implement JSONL Archival","description":"Archive JSONL files alongside database archival to maintain source of truth.\n\n## WHAT\nCreate archive JSONL files and move old records from active to archive JSONL.\n\n## WHY\nJSONL is source of truth, must also be archived for data integrity.\n\n## HOW\nCreate runs_archive.jsonl and decisions_archive.jsonl:\n- Append old records to archive files\n- Remove archived records from active JSONL periodically\n- Maintain JSONL as source of truth for archive too\n\n## Implementation\n- Filter records by age\n- Append to archive JSONL files\n- Sync archive JSONL to archive database\n- Periodic cleanup of active JSONL","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:32:42.03329+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:31:31.330404+01:00","closed_at":"2026-01-07T21:31:31.330404+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.9.4","depends_on_id":"agent-shepherd-alg8.9","type":"parent-child","created_at":"2026-01-07T01:32:42.03409+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.9.5","title":"3.2.5 Add Archive Sync on Startup","description":"Sync archive JSONL to archive database on startup to ensure archive database is up to date.\n\n## WHAT\nImplement syncFromJSONL() for archive database on ArchiveLogger construction.\n\n## WHY\nEnsures archive database stays synchronized with archive JSONL source of truth.\n\n## HOW\nOn ArchiveLogger construction:\n- Sync archive JSONL to database\n- Handle duplicate records (INSERT OR REPLACE)\n- Ensure archive schema initialized first\n\n## Implementation\n- Same sync logic as active database\n- Load archive JSONL records\n- Insert into archive database\n- Handle existing records appropriately","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:32:44.046423+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:31:31.130123+01:00","closed_at":"2026-01-07T21:31:31.130123+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.9.5","depends_on_id":"agent-shepherd-alg8.9","type":"parent-child","created_at":"2026-01-07T01:32:44.047322+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.9.6","title":"3.2.6 Implement Archive Pruning","description":"Delete data from archive after retention expires to prevent archive from growing unbounded.\n\n## WHAT\nImplement pruneArchive() to delete very old data from archive database and JSONL.\n\n## WHY\nArchive can grow unbounded over time, needs its own retention policy.\n\n## HOW\nConfigure archive retention (default 2 years total):\n- Delete from archive database based on archive_retention_days\n- Delete from archive JSONL\n- Optional: Archive to cold storage\n\n## Implementation\n- Separate retention for archive (longer than active)\n- Delete old data from archive\n- Maintain archive size limits\n- Log pruning operations","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:32:46.320447+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:31:30.971149+01:00","closed_at":"2026-01-07T21:31:30.971149+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.9.6","depends_on_id":"agent-shepherd-alg8.9","type":"parent-child","created_at":"2026-01-07T01:32:46.32156+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.9.7","title":"3.2.7 Add Archive Queries","description":"Provide specialized queries for archive data access and historical analysis.\n\n## WHAT\nAdd queries specific to archive data with appropriate optimizations.\n\n## WHY\nHistorical analysis needs different access patterns than current operations.\n\n## HOW\nAdd archive-specific queries:\n- getArchivedRuns(): Query archive database\n- getArchivedRunCount(): Count archive records\n- getArchiveSize(): Get archive database size\n- cleanupArchive(): Maintenance operations\n\n## Implementation\n- Queries optimized for historical patterns\n- Analytics methods for historical data\n- Archive size and health monitoring\n- Specialized indexes for archive queries","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:32:48.606882+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:31:30.760902+01:00","closed_at":"2026-01-07T21:31:30.760902+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.9.7","depends_on_id":"agent-shepherd-alg8.9","type":"parent-child","created_at":"2026-01-07T01:32:48.6078+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.9.8","title":"3.2.8 Performance Optimization","description":"Optimize archive database for different access patterns and storage efficiency.\n\n## WHAT\nAdjust pragmas and storage settings for archive database optimization.\n\n## WHY\nArchive data queried less frequently, can optimize for storage over speed.\n\n## HOW\nArchive database optimizations:\n- Smaller cache size than active\n- Relaxed synchronous mode\n- Compression if available\n- Indexes optimized for historical query patterns\n\n## Implementation\n- Different pragmas for archive vs active\n- Storage optimizations (compression, different page size)\n- Query pattern analysis for index optimization\n- Performance benchmarking vs active database","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:32:50.813044+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:31:30.633953+01:00","closed_at":"2026-01-07T21:31:30.633953+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.9.8","depends_on_id":"agent-shepherd-alg8.9","type":"parent-child","created_at":"2026-01-07T01:32:50.8139+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alg8.9.9","title":"3.2.9 Tests for Archival System","description":"Test all archival operations to ensure data is preserved during archival and accessible afterwards.\n\n## WHAT\nCreate comprehensive test suite for archival system operations.\n\n## WHY\nEnsures data integrity during archival and proper functioning of dual database system.\n\n## HOW\nTest all archival scenarios:\n- Archival preserves all run and decision data\n- Cross-database queries return combined results\n- JSONL archival syncs correctly\n- Archive pruning removes correct data\n- Archive database works with same API\n- Performance differences between active and archive\n\n## Test Cases\n- Data preservation during archival\n- Cross-database query correctness\n- JSONL sync and archival\n- Archive pruning boundaries\n- API consistency between databases\n- Performance benchmarking","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T01:32:53.310331+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:31:30.367902+01:00","closed_at":"2026-01-07T21:31:30.367902+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-alg8.9.9","depends_on_id":"agent-shepherd-alg8.9","type":"parent-child","created_at":"2026-01-07T01:32:53.311198+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-alqb","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T20:36:37.397148+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T20:36:37.449145+01:00","deleted_at":"2026-01-07T20:36:37.449145+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-am1y3","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-11T00:31:32.524071+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:31:33.480457+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-11T00:31:33.480457+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-amal","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:44:01.002838+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:44:01.063574+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T02:44:01.063574+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-anl95","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:16:31.656525+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:16:31.758213+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-09T20:16:31.758213+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ar5g","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-06T23:35:16.606283+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:35:16.668351+01:00","deleted_at":"2026-01-06T23:35:16.668351+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-arbk","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T06:03:26.310051+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T06:03:26.376832+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T06:03:26.376832+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-as6o","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T20:36:35.805383+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T20:36:35.900757+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T20:36:35.900757+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-atyb","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:29:37.971762+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:29:38.037168+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T18:29:38.037168+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-auth-system","title":"Authentication System","description":"Complete authentication system implementation with backend and frontend","status":"tombstone","priority":2,"issue_type":"epic","created_at":"2026-01-07T01:19:20.051093+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:30:48.506265+01:00","deleted_at":"2026-01-07T01:30:48.506265+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"agent-shepherd-auth-system-ui","title":"UI Components","description":"Authentication UI components (login, register, reset)","status":"tombstone","priority":2,"issue_type":"epic","created_at":"2026-01-07T01:19:20.260096+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:30:48.506265+01:00","deleted_at":"2026-01-07T01:30:48.506265+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"agent-shepherd-auth-system-ui-login","title":"Login Form Component","description":"Implement login form with validation and error handling","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:19:20.952917+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:30:48.506265+01:00","deleted_at":"2026-01-07T01:30:48.506265+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-auth-system-ui-register","title":"Register Form Component","description":"Implement user registration form with validation","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:19:20.973493+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:30:48.506265+01:00","deleted_at":"2026-01-07T01:30:48.506265+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-auth-system-ui-reset","title":"Password Reset Component","description":"Implement password reset functionality","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:19:21.325302+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:30:48.506265+01:00","deleted_at":"2026-01-07T01:30:48.506265+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-av8e","title":"3.3.4 Extract Tool Usage","description":"Parse tool calls from CLI output. Define ToolCall interface, extract tool name, inputs, outputs, duration, timestamp, success status, and store in RunOutcome.metadata.tool_calls.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:09:44.451416+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:12:27.938938+01:00","deleted_at":"2026-01-07T01:12:27.938938+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-av8ei","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:16:32.144725+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:16:32.249179+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-09T20:16:32.249179+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-axgir","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:20:29.223641+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:29.300114+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-09T01:20:29.300114+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-aym","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-06T04:36:26.505516+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:36:26.880055+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-06T04:36:26.880055+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-azey","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T22:55:50.861519+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:55:51.046824+01:00","deleted_at":"2026-01-08T22:55:51.046824+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-azgj","title":"2.5.8 Comprehensive Tests","description":"Test all aspects of decision prompt building and response parsing.\n\n## Tasks\n- Test prompt generation:\n  - Test prompt for each decision context (test, validation, complex)\n  - Test variable substitution with various data\n  - Test recent decisions included in prompt\n  - Test phase history included in prompt\n  - Test template loading and rendering\n- Test response parsing:\n  - Test valid JSON with all fields\n  - Test valid JSON with minimal fields (decision, reasoning only)\n  - Test extraction of target phase from action\n  - Test confidence calculation\n  - Test requires_approval calculation\n- Test response validation:\n  - Test missing required fields caught\n  - Test invalid action format caught\n  - Test invalid target phase caught\n  - Test confidence range validation\n  - Test detailed error messages\n- Test response sanitization:\n  - Test markdown code blocks stripped\n  - Test extra whitespace removed\n  - Test escaped quotes handled\n  - Test Unicode characters handled\n- Test retry logic:\n  - Test first failure triggers retry\n  - Test retry with clarifying prompt\n  - Test max retries enforced\n  - Test fallback to require_approval\n- Test decision analytics:\n  - Test confidence distribution query\n  - Test target phase counts query\n  - Test decision agent performance query\n\n## Expected Deliverables\n- Complete test suite for prompt building\n  - All prompt generation tests passing\n  - All response parsing tests passing\n  - All validation tests passing\n  - All sanitization tests passing\n  - All retry logic tests passing\n  - All analytics tests passing","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:53:38.114639+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-azh6","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T22:07:38.387514+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T22:07:38.451368+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T22:07:38.451368+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-azl9","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:29:39.223905+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:29:39.263883+01:00","deleted_at":"2026-01-07T18:29:39.263883+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-azpb5","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:52:27.705238+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:52:27.95706+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-11T00:52:27.95706+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-azvb","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T21:46:04.967445+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:46:05.126557+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T21:46:05.126557+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-b0l2","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T14:26:25.113418+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:26:25.528372+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T14:26:25.528372+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-b12","title":"2.4 Implement Agent Registry (YAML loading, capability matching)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-19T03:52:40.868957+01:00","updated_at":"2025-12-19T04:02:51.934268+01:00","deleted_at":"2025-12-19T04:02:51.934268+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-b1510","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-11T00:52:26.884082+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:52:27.23891+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-11T00:52:27.23891+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-b15z6","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:52:29.15314+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:52:29.323023+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-11T00:52:29.323023+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-b18e","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T14:32:17.872473+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:32:17.937322+01:00","deleted_at":"2026-01-07T14:32:17.937322+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-b2d7","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:05:09.843406+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:05:10.026792+01:00","deleted_at":"2026-01-07T19:05:10.026792+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-b3a9","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:00:16.150138+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:00:16.193641+01:00","deleted_at":"2026-01-07T19:00:16.193641+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-b3py","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T20:36:36.445243+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T20:36:36.521405+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T20:36:36.521405+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-b3uk","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T04:53:55.642984+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T04:53:55.726367+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T04:53:55.726367+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-b3zu8","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:17:05.703508+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:17:05.749478+01:00","deleted_at":"2026-01-08T23:17:05.749478+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-b5d6","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T02:41:58.830128+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:41:58.894583+01:00","deleted_at":"2026-01-07T02:41:58.894583+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-b6vqw","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:20:53.517985+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:53.59665+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T01:20:53.59665+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-b7yq","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:03:07.063858+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:03:07.128427+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T19:03:07.128427+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-b8l","title":"label-workflow-test: Feature priority test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-06T04:32:29.515305+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:29.576462+01:00","deleted_at":"2026-01-06T04:32:29.576462+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-b8m0","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:24:24.879728+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:24:25.007369+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T18:24:25.007369+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-b9et","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:33:23.046243+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:23.224235+01:00","deleted_at":"2026-01-07T18:33:23.224235+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ba25","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:40:15.029183+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:40:15.211933+01:00","deleted_at":"2026-01-07T18:40:15.211933+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ba8","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:32:30.010362+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:30.224373+01:00","deleted_at":"2026-01-06T04:32:30.224373+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-bcep","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T05:46:20.471899+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:46:20.548536+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T05:46:20.548536+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-bcr","title":"Phase 1: Cross-Platform Fixes","description":"Make current code work on Windows by replacing Unix-specific commands with Node APIs in .agent-shepherd/src/cli/index.ts: add imports for cpSync, rmSync from fs and homedir, platform from os; replace execSync commands: line 667 cp -r → cpSync with recursive, line 755 rm -rf → rmSync with recursive/force, line 792 $HOME → homedir(); OS-aware Beads install in quickstart: if platform === 'win32' manual install, else curl.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T03:18:59.487435+01:00","created_by":"tonyhartmann","updated_at":"2025-12-30T03:33:23.839211+01:00","closed_at":"2025-12-30T03:33:23.839211+01:00","close_reason":"Closed via update","dependencies":[{"issue_id":"agent-shepherd-bcr","depends_on_id":"agent-shepherd-7gt","type":"parent-child","created_at":"2025-12-30T03:20:09.769594+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-bcze","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:54:02.214301+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:54:02.308351+01:00","deleted_at":"2026-01-06T15:54:02.308351+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-bd3n6","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-09T20:46:37.558829+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:46:37.632435+01:00","deleted_at":"2026-01-09T20:46:37.632435+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-beio","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:28:07.456738+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:28:07.518798+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-06T23:28:07.518798+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-bfcf","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T02:57:15.376485+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T02:57:15.450328+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-08T02:57:15.450328+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-bgsa","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:36:02.762081+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:36:02.859983+01:00","deleted_at":"2026-01-07T02:36:02.859983+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-bgwr","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:42:00.681932+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:42:00.793877+01:00","deleted_at":"2026-01-07T02:42:00.793877+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-bhbj0","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-09T20:06:40.519227+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:06:40.589817+01:00","deleted_at":"2026-01-09T20:06:40.589817+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-bj9","title":"Phase 2: Schema \u0026 Configuration","description":"**Effort:** ~3 hours | **Risk:** Low\n\nAdd trigger system and HITL configuration to schemas and default config.\n\n## Tasks\n\n1. Update `config.schema.json` with workflow section (invalid_label_strategy field)\n2. Update `config.schema.json` with hitl section (allowed_reasons configuration)\n3. Update `policies.schema.json` with issue_types field\n4. Update `policies.schema.json` with priority field (1-100, default 50)\n5. Remove or deprecate old trigger fields from policies.schema.json\n6. Update `cmdInit()` to add workflow section to default config.yaml\n7. Update `cmdInit()` to add hitl section to default config.yaml\n8. Write config loading tests\n\n## Files Modified\n- `.agent-shepherd/schemas/config.schema.json`\n- `.agent-shepherd/schemas/policies.schema.json`\n- `.agent-shepherd/src/cli/index.ts` (cmdInit function)\n\n## Acceptance Criteria\n- [ ] config.schema.json includes workflow section\n- [ ] config.schema.json includes hitl section\n- [ ] policies.schema.json includes issue_types field\n- [ ] policies.schema.json includes priority field\n- [ ] cmdInit() adds workflow and hitl to default config\n- [ ] Config validation accepts all new fields\n- [ ] Deprecated trigger fields handled appropriately\n\n## Code Preview (config.schema.json)\n```json\n{\n  \"properties\": {\n    \"workflow\": {\n      \"type\": \"object\",\n      \"description\": \"Workflow selection behavior\",\n      \"properties\": {\n        \"invalid_label_strategy\": {\n          \"type\": \"string\",\n          \"enum\": [\"error\", \"warning-fallback\"],\n          \"default\": \"warning-fallback\",\n          \"description\": \"How to handle issues with invalid workflow labels\"\n        }\n      },\n      \"additionalProperties\": false\n    },\n    \"hitl\": {\n      \"type\": \"object\",\n      \"description\": \"Human-in-the-loop configuration\",\n      \"properties\": {\n        \"allowed_reasons\": {\n          \"type\": \"object\",\n          \"description\": \"HITL reason configuration\",\n          \"properties\": {\n            \"predefined\": {\n              \"type\": \"array\",\n              \"items\": { \"type\": \"string\" },\n              \"default\": [\"approval\", \"manual-intervention\", \"timeout\", \"error\", \"review-request\"]\n            },\n            \"allow_custom\": {\n              \"type\": \"boolean\",\n              \"default\": true\n            },\n            \"custom_validation\": {\n              \"type\": \"string\",\n              \"enum\": [\"none\", \"alphanumeric\", \"alphanumeric-dash-underscore\"],\n              \"default\": \"alphanumeric-dash-underscore\"\n            }\n          },\n          \"required\": []\n        }\n      },\n      \"additionalProperties\": false\n    }\n  }\n}\n```\n\n## Code Preview (config.yaml default)\n```yaml\nworkflow:\n  invalid_label_strategy: warning-fallback  # error | warning-fallback\n\nhitl:\n  allowed_reasons:\n    predefined:\n      - approval\n      - manual-intervention\n      - timeout\n      - error\n      - review-request\n    allow_custom: true\n    custom_validation: alphanumeric-dash-underscore\n```","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T17:08:20.256736+01:00","updated_at":"2026-01-05T17:22:58.178182+01:00","close_reason":"Removed as requested by user","dependencies":[{"issue_id":"agent-shepherd-bj9","depends_on_id":"agent-shepherd-3of","type":"parent-child","created_at":"2026-01-05T17:08:25.668213+01:00","created_by":"daemon"},{"issue_id":"agent-shepherd-bj9","depends_on_id":"agent-shepherd-834","type":"blocks","created_at":"2026-01-05T17:09:58.803374+01:00","created_by":"daemon"}],"deleted_at":"2026-01-05T17:22:58.178182+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-bjic","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:29:38.157084+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:29:38.222489+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T18:29:38.222489+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-bjwp","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:54:01.183409+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:54:01.255922+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-06T15:54:01.255922+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-bkyk","title":"2.3.8 Integration Tests","description":"Test loop prevention in full workflow scenarios.\n\n## Tasks\n- Create scenario that hits phase visit limit:\n  - Configure phase with max_visits: 3\n  - Force phase to execute 4 times\n  - Verify HITL triggered on 4th attempt\n  - Verify phase blocked from further execution\n- Create scenario with excessive same-transition usage:\n  - Configure transition limit develop→test: 3\n  - Force develop→test transition 4 times\n  - Verify HITL triggered on 4th transition\n  - Verify transition blocked\n- Create scenario with oscillating phases:\n  - Force workflow to oscillate: develop→test→develop→test\n  - Verify cycle detection identifies pattern\n  - Verify HITL triggered when cycle detected\n  - Verify workflow blocked\n- Verify HITL escalation in all cases:\n  - Human can review and unblock\n  - Loop prevention details logged\n  - Clear reason provided for escalation\n\n## Expected Deliverables\n- Integration tests for loop prevention\n- Phase visit limit tests\n- Transition limit tests\n- Cycle detection tests\n- HITL escalation verification","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:52:01.700045+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-bl48b","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:31:32.042305+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:31:32.142011+01:00","deleted_at":"2026-01-11T00:31:32.142011+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-blbw","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T06:03:27.314756+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T06:03:27.743557+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T06:03:27.743557+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-bn0f","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:14:39.313374+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:14:39.381411+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T18:14:39.381411+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-bngb","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:31:18.917607+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:31:18.962859+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T18:31:18.962859+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-bnuo","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T16:34:51.727252+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T16:34:51.795511+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T16:34:51.795511+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-bo4","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-06T04:42:31.629773+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:42:32.027403+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-06T04:42:32.027403+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-bqxk","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T21:46:03.503164+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:46:03.616318+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T21:46:03.616318+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-br3","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:42:30.624927+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:42:30.69365+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-06T04:42:30.69365+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-brts8","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:17:05.294369+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:17:05.362928+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-08T23:17:05.362928+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-bruzn","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:46:37.234624+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:46:37.3087+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T20:46:37.3087+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-brx0g","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T23:03:55.844019+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:03:55.99883+01:00","labels":["label2","label3"],"deleted_at":"2026-01-09T23:03:55.99883+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-bslop","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T01:20:53.63243+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:53.704712+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-09T01:20:53.704712+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-btsu8","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:06:41.669321+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:06:41.788639+01:00","deleted_at":"2026-01-09T20:06:41.788639+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-btvs","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:18:30.751256+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:18:30.857532+01:00","deleted_at":"2026-01-07T19:18:30.857532+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-bu9dv","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:41:43.159131+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:41:43.232935+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-09T04:41:43.232935+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-bubq","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T03:57:13.596478+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T03:57:13.746637+01:00","labels":["label2","label3"],"deleted_at":"2026-01-08T03:57:13.746637+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-bxn","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:24:43.013866+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:28.952539+01:00","deleted_at":"2026-01-06T04:32:28.952539+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-bya8","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T04:53:56.156514+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T04:53:56.218396+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T04:53:56.218396+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-byhf","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T16:34:52.784907+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T16:34:52.916077+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T16:34:52.916077+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-bysfs","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:41:44.456688+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:41:44.669452+01:00","labels":["label2","label3"],"deleted_at":"2026-01-09T04:41:44.669452+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-c12","title":"label-workflow-test: Bug issue type test","status":"tombstone","priority":2,"issue_type":"bug","created_at":"2026-01-06T04:32:29.423093+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:29.484961+01:00","deleted_at":"2026-01-06T04:32:29.484961+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"bug"}
{"id":"agent-shepherd-c14i","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T05:46:20.912705+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:46:21.107529+01:00","deleted_at":"2026-01-07T05:46:21.107529+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-c1ue","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:41:59.135054+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:41:59.303092+01:00","deleted_at":"2026-01-07T02:41:59.303092+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-c1wz","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:44:00.792715+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:44:00.970695+01:00","deleted_at":"2026-01-07T02:44:00.970695+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-c5xq","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:11:45.396666+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:11:45.485413+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T18:11:45.485413+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-c84","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:24:43.14306+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:28.873938+01:00","deleted_at":"2026-01-06T04:32:28.873938+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-c88sr","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T01:38:37.910175+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:38:38.382098+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T01:38:38.382098+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-c8r","title":"Update docs/architecture.md with fallback system","description":"File: .agent-shepherd/docs/architecture.md\n\nTask: Explain fallback system in architecture overview and add to diagrams\n\nRequired Changes:\n\n1. Add \"Fallback Agent System\" section to architecture overview\n\n2. Explain how fallback fits into the architecture:\n   - Where fallback is checked (agent-registry.ts)\n   - How it integrates with policy engine\n   - How it affects workflow execution\n\n3. Update or create architecture diagrams to include fallback:\n\nExample diagram:\n```\n┌─────────────────────────────┐\n│   Worker Engine              │\n│   (Issue Processing)         │\n└─────────────┬───────────────┘\n              │\n              v\n┌─────────────────────────────┐\n│   Agent Selection            │\n│   1. Check capability       │\n│   2. No agent? Use fallback │\n│   3. Cascading hierarchy    │\n└─────────────┬───────────────┘\n              │\n              v\n      ┌───────┴────────┐\n      │                │\n┌─────▼─────┐   ┌──────▼──────┐\n│   Agents  │   │   Fallback  │\n│   (Match  │   │   Agent     │\n│   Cap)    │   │   (Config)  │\n└───────────┘   └─────────────┘\n```\n\n4. Document the fallback data flow:\n   - Config loaded from config.yaml\n   - Policy loaded from policies.yaml\n   - Agent selection checks capability → checks fallback\n   - Cascading hierarchy determines final fallback agent\n\n5. Add to component descriptions:\n   - Agent Registry: Handles agent selection and fallback logic\n   - Policy Engine: Defines fallback configuration at policy/phase level\n   - Config: Defines global fallback configuration\n\n6. Add interaction diagrams showing:\n   - How fallback is checked during agent selection\n   - How validation checks fallback agents\n   - How CLI displays fallback information\n\nAcceptance Criteria:\n- [ ] Fallback system section added\n- [ ] Architecture explained clearly\n- [ ] Diagrams include fallback components\n- [ ] Data flow documented\n- [ ] Component descriptions updated\n- [ ] Interaction diagrams included\n- [ ] Diagrams are clear and accurate","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-05T02:44:34.427815+01:00","updated_at":"2026-01-05T03:26:18.254384+01:00","closed_at":"2026-01-05T03:26:18.254384+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-c8r","depends_on_id":"agent-shepherd-uj0","type":"parent-child","created_at":"2026-01-05T02:45:00.601058+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-c8vi1","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T01:38:36.31937+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:38:36.392125+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-09T01:38:36.392125+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-c9vu","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:14:39.694874+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:14:39.778741+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T18:14:39.778741+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-cbhz","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T03:38:11.881679+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:38:11.970012+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T03:38:11.970012+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ccr","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-06T04:24:42.920297+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:29.012987+01:00","deleted_at":"2026-01-06T04:32:29.012987+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-ccu5y","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:20:28.99368+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:29.076867+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T01:20:29.076867+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-cijj","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T05:04:24.037897+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:04:24.087185+01:00","deleted_at":"2026-01-07T05:04:24.087185+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ck1.1","title":"1. Test Section","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-19T03:57:55.81101+01:00","updated_at":"2025-12-19T04:02:51.934268+01:00","deleted_at":"2025-12-19T04:02:51.934268+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-ck1.1.1","title":"1.1 Test subtask 1","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-19T03:58:00.958648+01:00","updated_at":"2025-12-19T04:02:51.934268+01:00","deleted_at":"2025-12-19T04:02:51.934268+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-ck1.1.2","title":"1.2 Test subtask 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-19T03:58:06.112352+01:00","updated_at":"2025-12-19T04:02:51.934268+01:00","deleted_at":"2025-12-19T04:02:51.934268+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-ck1.2","title":"2. Another Section","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-19T03:58:11.529273+01:00","updated_at":"2025-12-19T04:02:51.934268+01:00","deleted_at":"2025-12-19T04:02:51.934268+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-ck1.2.1","title":"2.1 Another subtask","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-19T03:58:16.762993+01:00","updated_at":"2025-12-19T04:02:51.934268+01:00","deleted_at":"2025-12-19T04:02:51.934268+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-ck1wi","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:11:02.590234+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:11:02.802617+01:00","deleted_at":"2026-01-09T20:11:02.802617+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ckmj","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T20:36:36.072074+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T20:36:36.153559+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T20:36:36.153559+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-cls4o","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:20:29.443893+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:29.542868+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-09T01:20:29.542868+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-clzge","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:15:58.304923+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:58.507463+01:00","deleted_at":"2026-01-09T01:15:58.507463+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-cmj0","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T18:39:59.34764+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:39:59.415194+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T18:39:59.415194+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-cmub","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:36:02.60734+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:36:02.653931+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T02:36:02.653931+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-cnnh","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:29:38.341197+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:29:38.423775+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T18:29:38.423775+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-cow","title":"2.5 Implement Logging (JSONL + SQLite dual storage)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-19T03:52:51.166643+01:00","updated_at":"2025-12-19T04:02:51.934268+01:00","deleted_at":"2025-12-19T04:02:51.934268+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-cpb","title":"Implement Agent Shepherd Orchestration System","description":"Complete implementation of Agent Shepherd - a TypeScript/Bun orchestration layer for AI coding agents using Beads and OpenCode. Includes CLI, worker/monitor engines, policy management, agent registry, logging, UI, and integrations.","status":"tombstone","priority":0,"issue_type":"epic","created_at":"2025-12-18T05:17:29.675596+01:00","updated_at":"2025-12-19T03:35:39.675983+01:00","labels":["agent-shepherd","epic","implementation"],"deleted_at":"2025-12-19T03:35:39.675983+01:00","deleted_by":"tonyhartmann","delete_reason":"manual delete","original_type":"epic"}
{"id":"agent-shepherd-cpb.1","title":"Create package.json with Bun, TypeScript, dependencies","description":"Set up package.json with latest Bun runtime, TypeScript compiler, and core dependencies including @opencode-ai/sdk, react, reactflow, yaml parser, sqlite3, commander for CLI","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-18T05:17:37.878493+01:00","updated_at":"2025-12-19T03:39:26.986607+01:00","close_reason":"Completed","labels":["dependencies","project-setup"],"deleted_at":"2025-12-19T03:39:26.986607+01:00","deleted_by":"tonyhartmann","delete_reason":"manual delete","original_type":"task"}
{"id":"agent-shepherd-cpb.10","title":"Implement Worker Engine","description":"Autonomous worker loop: query ready issues, resolve policies/phases, select agents, create runs, launch in OpenCode, handle outcomes","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-18T05:18:31.920155+01:00","updated_at":"2025-12-19T03:39:28.421831+01:00","close_reason":"Completed","labels":["engines","worker"],"deleted_at":"2025-12-19T03:39:28.421831+01:00","deleted_by":"tonyhartmann","delete_reason":"manual delete","original_type":"task"}
{"id":"agent-shepherd-cpb.11","title":"Implement Monitor Engine","description":"Supervision loop: track running runs, detect stalls/timeouts, handle HITL, detect human takeover, apply policy rules","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-18T05:18:38.953232+01:00","updated_at":"2025-12-19T03:39:28.56075+01:00","close_reason":"Completed","labels":["engines","monitor"],"deleted_at":"2025-12-19T03:39:28.56075+01:00","deleted_by":"tonyhartmann","delete_reason":"manual delete","original_type":"task"}
{"id":"agent-shepherd-cpb.12","title":"Implement CLI commands","description":"ashep worker, monitor, work, init, install, sync-agents, ui commands with proper argument parsing and help","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-18T05:18:44.114397+01:00","updated_at":"2025-12-19T03:39:28.731905+01:00","close_reason":"Completed","labels":["cli","engines"],"deleted_at":"2025-12-19T03:39:28.731905+01:00","deleted_by":"tonyhartmann","delete_reason":"manual delete","original_type":"task"}
{"id":"agent-shepherd-cpb.13","title":"Create placeholder ReactFlow UI","description":"Minimal ReactFlow-based visualization showing workflow phases, runs, and transitions with node/edge display","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-18T05:18:51.634612+01:00","updated_at":"2025-12-19T03:39:28.898246+01:00","close_reason":"Completed","labels":["reactflow","ui"],"deleted_at":"2025-12-19T03:39:28.898246+01:00","deleted_by":"tonyhartmann","delete_reason":"manual delete","original_type":"task"}
{"id":"agent-shepherd-cpb.14","title":"Implement UI server","description":"Tiny HTTP server for UI with configurable port, serving React app and providing API endpoints for run data","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-18T05:18:56.803258+01:00","updated_at":"2025-12-19T03:39:29.050281+01:00","close_reason":"Completed","labels":["server","ui"],"deleted_at":"2025-12-19T03:39:29.050281+01:00","deleted_by":"tonyhartmann","delete_reason":"manual delete","original_type":"task"}
{"id":"agent-shepherd-cpb.15","title":"Implement installer","description":"ashep install command: check Beads/OpenCode availability, suggest installations, validate environment","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-18T05:19:01.963766+01:00","updated_at":"2025-12-19T03:39:29.22335+01:00","close_reason":"Completed","labels":["installer","setup"],"deleted_at":"2025-12-19T03:39:29.22335+01:00","deleted_by":"tonyhartmann","delete_reason":"manual delete","original_type":"task"}
{"id":"agent-shepherd-cpb.16","title":"Implement init command","description":"ashep init: create .agent-shepherd directory with default policies.yaml, agents.yaml, config.yaml configurations","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-18T05:19:07.125742+01:00","updated_at":"2025-12-19T03:39:29.390609+01:00","close_reason":"Completed","labels":["config","installer"],"deleted_at":"2025-12-19T03:39:29.390609+01:00","deleted_by":"tonyhartmann","delete_reason":"manual delete","original_type":"task"}
{"id":"agent-shepherd-cpb.17","title":"Create JSON schemas","description":"JSON schemas for config.yaml, policies.yaml, agents.yaml, run outcomes, and other configuration files","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-18T05:19:14.371161+01:00","updated_at":"2025-12-19T03:39:29.534004+01:00","close_reason":"Completed","labels":["config","schemas"],"deleted_at":"2025-12-19T03:39:29.534004+01:00","deleted_by":"tonyhartmann","delete_reason":"manual delete","original_type":"task"}
{"id":"agent-shepherd-cpb.18","title":"Create default configurations","description":"Default config.yaml, policies.yaml, agents.yaml with working starter configurations for immediate use","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-18T05:19:19.521405+01:00","updated_at":"2025-12-19T03:39:29.702218+01:00","close_reason":"Completed","labels":["config","defaults"],"deleted_at":"2025-12-19T03:39:29.702218+01:00","deleted_by":"tonyhartmann","delete_reason":"manual delete","original_type":"task"}
{"id":"agent-shepherd-cpb.19","title":"Validate configurations","description":"Runtime validation of all YAML configurations at startup with helpful error messages","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-18T05:19:24.672541+01:00","updated_at":"2025-12-19T03:39:29.879458+01:00","close_reason":"Completed","labels":["config","validation"],"deleted_at":"2025-12-19T03:39:29.879458+01:00","deleted_by":"tonyhartmann","delete_reason":"manual delete","original_type":"task"}
{"id":"agent-shepherd-cpb.2","title":"Create tsconfig.json and bunfig.toml","description":"Configure TypeScript compiler options for strict type checking and Bun-specific settings for fast compilation and bundling","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-18T05:17:45.13496+01:00","updated_at":"2025-12-19T03:39:27.124337+01:00","close_reason":"Completed","labels":["project-setup","typescript"],"deleted_at":"2025-12-19T03:39:27.124337+01:00","deleted_by":"tonyhartmann","delete_reason":"manual delete","original_type":"task"}
{"id":"agent-shepherd-cpb.20","title":"Add unit tests","description":"Unit tests for core modules: Beads integration, OpenCode integration, Policy Engine, Agent Registry, Logging","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-18T05:19:31.627518+01:00","updated_at":"2025-12-19T03:39:30.021401+01:00","close_reason":"Completed","labels":["testing","unit"],"deleted_at":"2025-12-19T03:39:30.021401+01:00","deleted_by":"tonyhartmann","delete_reason":"manual delete","original_type":"task"}
{"id":"agent-shepherd-cpb.21","title":"Add integration tests","description":"Integration tests for CLI commands with mocked dependencies and end-to-end command workflows","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-18T05:19:38.964551+01:00","updated_at":"2025-12-19T03:39:30.208732+01:00","close_reason":"Completed","labels":["integration","testing"],"deleted_at":"2025-12-19T03:39:30.208732+01:00","deleted_by":"tonyhartmann","delete_reason":"manual delete","original_type":"task"}
{"id":"agent-shepherd-cpb.22","title":"Validate with linting and type checking","description":"Configure ESLint, Prettier, and ensure TypeScript strict mode passes on all code","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-18T05:19:44.168837+01:00","updated_at":"2025-12-19T03:39:30.354545+01:00","close_reason":"Completed","labels":["linting","testing"],"deleted_at":"2025-12-19T03:39:30.354545+01:00","deleted_by":"tonyhartmann","delete_reason":"manual delete","original_type":"task"}
{"id":"agent-shepherd-cpb.23","title":"Test end-to-end workflow","description":"Mock Beads and OpenCode services for complete workflow testing: issue creation → agent selection → run execution → outcome processing","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-18T05:19:49.382738+01:00","updated_at":"2025-12-19T03:39:30.522029+01:00","close_reason":"Completed","labels":["e2e","testing"],"deleted_at":"2025-12-19T03:39:30.522029+01:00","deleted_by":"tonyhartmann","delete_reason":"manual delete","original_type":"task"}
{"id":"agent-shepherd-cpb.24","title":"Create README.md","description":"Comprehensive README with setup instructions, CLI usage, configuration guide, and architecture overview","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-18T05:19:56.334286+01:00","updated_at":"2025-12-19T03:39:30.712538+01:00","close_reason":"Completed","labels":["docs","readme"],"deleted_at":"2025-12-19T03:39:30.712538+01:00","deleted_by":"tonyhartmann","delete_reason":"manual delete","original_type":"task"}
{"id":"agent-shepherd-cpb.25","title":"Expand architecture docs","description":"Detailed docs/architecture.md explaining the three-layer design, integration points, and workflow orchestration","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-18T05:20:01.503349+01:00","updated_at":"2025-12-19T03:39:30.851396+01:00","close_reason":"Completed","labels":["architecture","docs"],"deleted_at":"2025-12-19T03:39:30.851396+01:00","deleted_by":"tonyhartmann","delete_reason":"manual delete","original_type":"task"}
{"id":"agent-shepherd-cpb.26","title":"Document CLI commands and configs","description":"Complete reference for all CLI commands, configuration options, policy format, and agent registry structure","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-18T05:20:06.678639+01:00","updated_at":"2025-12-19T03:39:31.028687+01:00","close_reason":"Completed","labels":["docs","reference"],"deleted_at":"2025-12-19T03:39:31.028687+01:00","deleted_by":"tonyhartmann","delete_reason":"manual delete","original_type":"task"}
{"id":"agent-shepherd-cpb.3","title":"Set up directory structure","description":"Create src/cli, src/core, src/utils, .agent-shepherd, docs, schemas, ui directories with proper organization","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-18T05:17:50.283583+01:00","updated_at":"2025-12-19T03:39:27.295649+01:00","close_reason":"Completed","labels":["project-setup","structure"],"deleted_at":"2025-12-19T03:39:27.295649+01:00","deleted_by":"tonyhartmann","delete_reason":"manual delete","original_type":"task"}
{"id":"agent-shepherd-cpb.4","title":"Initialize git repo if not present","description":"Ensure git repository is initialized and configured for the project","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-18T05:17:55.442761+01:00","updated_at":"2025-12-19T03:39:27.47929+01:00","close_reason":"Completed","labels":["git","project-setup"],"deleted_at":"2025-12-19T03:39:27.47929+01:00","deleted_by":"tonyhartmann","delete_reason":"manual delete","original_type":"task"}
{"id":"agent-shepherd-cpb.5","title":"Implement Beads integration","description":"Shell commands for bd CLI, JSON parsing, issue status updates, label management, dependency checking, and comment posting","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-18T05:18:02.441585+01:00","updated_at":"2025-12-19T03:39:27.669884+01:00","close_reason":"Completed","labels":["beads","core-modules","integration"],"deleted_at":"2025-12-19T03:39:27.669884+01:00","deleted_by":"tonyhartmann","delete_reason":"manual delete","original_type":"task"}
{"id":"agent-shepherd-cpb.6","title":"Implement OpenCode integration","description":"@opencode-ai/sdk integration for session creation, message sending/receiving, agent management, and session lifecycle handling","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-18T05:18:09.735002+01:00","updated_at":"2025-12-19T03:39:27.786316+01:00","close_reason":"Completed","labels":["core-modules","integration","opencode"],"deleted_at":"2025-12-19T03:39:27.786316+01:00","deleted_by":"tonyhartmann","delete_reason":"manual delete","original_type":"task"}
{"id":"agent-shepherd-cpb.7","title":"Implement Policy Engine","description":"YAML parsing for policies, phase transitions, retry logic, timeout management, and HITL workflow handling","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-18T05:18:14.888439+01:00","updated_at":"2025-12-19T03:39:27.942789+01:00","close_reason":"Completed","labels":["core-modules","policy"],"deleted_at":"2025-12-19T03:39:27.942789+01:00","deleted_by":"tonyhartmann","delete_reason":"manual delete","original_type":"task"}
{"id":"agent-shepherd-cpb.8","title":"Implement Agent Registry","description":"YAML loading for agents.yaml, capability matching, priority selection, constraint filtering, and OpenCode sync","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-18T05:18:20.040282+01:00","updated_at":"2025-12-19T03:39:28.088513+01:00","close_reason":"Completed","labels":["core-modules","registry"],"deleted_at":"2025-12-19T03:39:28.088513+01:00","deleted_by":"tonyhartmann","delete_reason":"manual delete","original_type":"task"}
{"id":"agent-shepherd-cpb.9","title":"Implement Logging system","description":"JSONL append-only logs for runs with SQLite cache for fast queries, audit trail maintenance, and dual storage sync","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-18T05:18:25.195693+01:00","updated_at":"2025-12-19T03:39:28.261959+01:00","close_reason":"Completed","labels":["core-modules","logging"],"deleted_at":"2025-12-19T03:39:28.261959+01:00","deleted_by":"tonyhartmann","delete_reason":"manual delete","original_type":"task"}
{"id":"agent-shepherd-cq1f","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:03:07.788097+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:03:07.855079+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T19:03:07.855079+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-cqm","title":"Update config.ts to load and parse fallback section","description":"File: .agent-shepherd/src/core/config.ts\n\nTask: Load and parse fallback configuration from config.yaml\n\nRequired Changes:\n\n1. Add TypeScript interface for fallback configuration:\n```typescript\ninterface FallbackConfig {\n  enabled: boolean;\n  default_agent?: string;\n  mappings?: Record\u003cstring, string\u003e;\n}\n```\n\n2. Add fallback property to Config interface:\n```typescript\ninterface Config {\n  // ... existing properties\n  fallback?: FallbackConfig;\n}\n```\n\n3. Update loadConfig() to parse fallback section:\n   - Read fallback section from config.yaml\n   - Provide default values if not present:\n     - enabled: false (backward compatibility)\n     - No default_agent\n     - No mappings\n\n4. Ensure backward compatibility:\n   - If config doesn't have fallback section, treat as disabled\n   - If fallback section exists but is incomplete, use partial config with defaults\n\nExample Default:\n```typescript\nconst defaultFallback: FallbackConfig = {\n  enabled: false,\n  default_agent: undefined,\n  mappings: undefined\n};\n```\n\nAcceptance Criteria:\n- [ ] Fallback section loads correctly from config.yaml\n- [ ] Default values applied when fallback section missing\n- [ ] Partial fallback config handled gracefully\n- [ ] TypeScript types match schema structure\n- [ ] Backward compatibility maintained (no fallback = disabled)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T02:43:57.869734+01:00","updated_at":"2026-01-05T02:53:05.101312+01:00","closed_at":"2026-01-05T02:53:05.101312+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-cqm","depends_on_id":"agent-shepherd-uj0","type":"parent-child","created_at":"2026-01-05T02:45:00.507672+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-cqwou","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:24:06.123269+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:24:06.242293+01:00","deleted_at":"2026-01-09T01:24:06.242293+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-crlx","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T16:34:52.947989+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T16:34:53.056167+01:00","deleted_at":"2026-01-07T16:34:53.056167+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-cru","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:36:26.908786+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:36:27.022328+01:00","labels":["label2","label3"],"deleted_at":"2026-01-06T04:36:27.022328+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-cs9c","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T22:55:50.221599+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:55:50.292331+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-08T22:55:50.292331+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-csds","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T21:46:03.657616+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:46:03.740894+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T21:46:03.740894+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-csml","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T21:46:04.423467+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:46:04.931382+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T21:46:04.931382+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-ctyf","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:31:19.062131+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:31:19.161732+01:00","deleted_at":"2026-01-07T18:31:19.161732+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-cu2n5","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:23:32.990202+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:23:33.064889+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-09T01:23:33.064889+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-cwsy","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:51:18.29871+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:51:18.361423+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T02:51:18.361423+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-cxuw","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T02:57:16.649284+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T02:57:16.764887+01:00","deleted_at":"2026-01-08T02:57:16.764887+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-cxwc","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T22:55:51.081678+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:55:51.182469+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-08T22:55:51.182469+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-cxzq","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T16:34:51.608129+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T16:34:51.69513+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T16:34:51.69513+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-cy2","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:24:43.181407+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:28.852597+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-06T04:32:28.852597+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-cyuu","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:00:15.782145+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:00:15.84421+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T19:00:15.84421+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-d0nt","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-06T15:58:04.549806+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:58:04.60716+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-06T15:58:04.60716+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-d28m","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:26:24.428287+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:26:24.512401+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T14:26:24.512401+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-d2x4d","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:41:42.674865+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:41:42.776764+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-09T04:41:42.776764+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-d544","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:33:22.388427+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:22.477746+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T18:33:22.477746+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-d5b0w","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:39:42.102193+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:39:42.169724+01:00","deleted_at":"2026-01-09T04:39:42.169724+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-dai4","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:41:59.908129+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:42:00.026268+01:00","deleted_at":"2026-01-07T02:42:00.026268+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-db80","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T05:04:22.63186+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:04:22.701998+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T05:04:22.701998+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-dc8dm","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-09T04:41:41.787612+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:41:41.889537+01:00","deleted_at":"2026-01-09T04:41:41.889537+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-dcjf","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T21:44:08.932025+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:44:09.013825+01:00","deleted_at":"2026-01-07T21:44:09.013825+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-dd8p","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:33:24.174467+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:24.287941+01:00","deleted_at":"2026-01-07T18:33:24.287941+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-df2m","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T05:46:20.246175+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:46:20.32181+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T05:46:20.32181+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-df5b","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T18:14:39.603281+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:14:39.666265+01:00","deleted_at":"2026-01-07T18:14:39.666265+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-df8","title":"Phase 6: Update ashep init","description":"Modify cmdInit() in .agent-shepherd/src/cli/index.ts to always create local config in ./.agent-shepherd/config/ in current directory, regardless of whether global install exists, to support hybrid mode.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T03:19:14.815987+01:00","created_by":"tonyhartmann","updated_at":"2025-12-30T03:36:30.931374+01:00","closed_at":"2025-12-30T03:36:30.931374+01:00","close_reason":"Closed via update","dependencies":[{"issue_id":"agent-shepherd-df8","depends_on_id":"agent-shepherd-7gt","type":"parent-child","created_at":"2025-12-30T03:20:19.914049+01:00","created_by":"daemon"},{"issue_id":"agent-shepherd-df8","depends_on_id":"agent-shepherd-mca","type":"blocks","created_at":"2025-12-30T03:20:34.752542+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-dfa3y","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:17:04.733027+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:17:04.820967+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-08T23:17:04.820967+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-dfq","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:42:31.335919+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:42:31.398552+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-06T04:42:31.398552+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-dgab","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:44:00.087869+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:44:00.175543+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T02:44:00.175543+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-dh77","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:44:00.208468+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:44:00.279234+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T02:44:00.279234+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-dj02c","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:13:54.177895+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:13:54.317068+01:00","deleted_at":"2026-01-09T01:13:54.317068+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-dj9r","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T19:05:09.289543+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:05:09.35622+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T19:05:09.35622+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-djcv","title":"2.1.1 Analyze Current Transition System","description":"Document existing transition types and their limitations.\n\n## Tasks\n- Review policy.ts:PhaseTransition interface (lines 53-57)\n  - Current types: \"advance\" | \"retry\" | \"block\" | \"close\"\n  - Fields: type, next_phase (optional), reason (optional)\n- Review policy.ts:determineTransition() implementation (lines 263-327)\n  - Document current logic flow\n  - Identify where transitions are determined\n  - Identify limitations: only linear forward progression\n- Document current transition types:\n  - advance: Move to next phase in sequence\n  - retry: Retry current phase (with backoff)\n  - block: Block issue (requires HITL)\n  - close: Close issue (workflow complete)\n- Identify limitations:\n  - No way to jump backward to previous phase\n  - No way to delegate transition decision to AI\n  - Only linear forward progression supported\n  - No conditional routing based on outcome type\n\n## Expected Deliverables\n- Documentation of PhaseTransition interface\n- Documentation of determineTransition() logic\n- List of current limitations to address","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:51:07.833385+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-dkahs","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:38:36.643021+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:38:36.739254+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-09T01:38:36.739254+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-dl5s2","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T20:16:31.315779+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:16:31.391375+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-09T20:16:31.391375+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-dmno","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:00:16.804412+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:00:16.934441+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T19:00:16.934441+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-dmst","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T03:38:11.340281+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:38:11.412482+01:00","deleted_at":"2026-01-07T03:38:11.412482+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-dmv3v","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:40:53.28086+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:40:53.404074+01:00","deleted_at":"2026-01-09T20:40:53.404074+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-dn3nv","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T20:40:51.80321+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:40:51.878489+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-09T20:40:51.878489+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-dn4zx","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T01:06:43.221059+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T01:06:43.32454+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-11T01:06:43.32454+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-do2","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:36:25.354577+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:36:25.512453+01:00","deleted_at":"2026-01-06T04:36:25.512453+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-dp4f","title":"2.3.3 Transition Limit Tracking","description":"Track how many times specific phase→phase transitions occur.\n\n## Tasks\n- Add getTransitionCount(issueId: string, fromPhase: string, toPhase: string): Promise\u003cnumber\u003e to Logger:\n  - Queries decision log for transition patterns\n  - Counts how many times specific phase→phase jump occurred\n  - More granular than phase visits - targets specific problematic patterns\n  - Catches systemic issues (e.g., too many develop→test jumps suggests testing problems)\n- Design rationale:\n  - Queries decision log for transition patterns\n  - Counts how many times specific phase→phase transition occurred\n  - More granular than phase visits - targets specific problematic patterns\n  - Catches systemic issues (e.g., too many develop→test jumps)\n- Need to ensure decision metadata includes from_phase and to_phase:\n  - Update decision logging to include these fields\n  - Add to phase_transition decision metadata\n\n## Expected Deliverables\n- getTransitionCount() method implemented\n- Decision metadata updated with from_phase/to_phase\n- Transition pattern tracking working","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:51:51.401846+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-dpab9","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T01:20:30.75861+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:31.275444+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T01:20:31.275444+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-dphb","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T18:24:22.930711+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:24:22.996138+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T18:24:22.996138+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-dpxz","title":"2.2.2 Update Policy YAML Schema","description":"Extend schemas/policies.schema.json with transition definitions and validation rules. Add TransitionConfig and TransitionBlock schemas with proper validation.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-07T00:05:15.958269+01:00","updated_at":"2026-01-07T00:06:15.832092+01:00","deleted_at":"2026-01-07T00:06:15.832092+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-dq7h","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:59:44.346209+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:59:44.464562+01:00","deleted_at":"2026-01-07T02:59:44.464562+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-dqb7","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T05:56:17.880074+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:56:17.970428+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-08T05:56:17.970428+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-drl0","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T22:55:51.328327+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:55:51.538791+01:00","deleted_at":"2026-01-08T22:55:51.538791+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ds4","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:34:14.220142+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:14.377284+01:00","deleted_at":"2026-01-06T04:34:14.377284+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-dsdk","title":"3.2.8 Performance Optimization","description":"Optimize archive database for different access patterns. Adjust pragmas and storage settings for archive (smaller cache, relaxed sync), optimize indexes for archive query patterns.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:09:33.919222+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:12:28.128095+01:00","deleted_at":"2026-01-07T01:12:28.128095+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-dt3uv","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:15:32.469367+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:32.596857+01:00","deleted_at":"2026-01-09T01:15:32.596857+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-dt6d1","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:11:04.133342+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:11:04.276377+01:00","labels":["label2","label3"],"deleted_at":"2026-01-09T20:11:04.276377+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-dtbi","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T03:38:11.446399+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:38:11.542736+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T03:38:11.542736+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-dths","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:24:23.220648+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:24:23.304319+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T18:24:23.304319+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-dtuh","title":"3.3 Complete OpenCode CLI Output Parsing","description":"Parse all available fields from OpenCode output for maximum value capture. Includes comprehensive field extraction, multiple output format handling, session message parsing, tool usage extraction, file operation parsing, error detail extraction, robust error handling, CLI output caching, and comprehensive tests.","status":"tombstone","priority":2,"issue_type":"epic","created_at":"2026-01-07T01:09:37.630746+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:12:27.938938+01:00","deleted_at":"2026-01-07T01:12:27.938938+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"agent-shepherd-dv6f","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T05:54:20.890436+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:54:20.935786+01:00","deleted_at":"2026-01-08T05:54:20.935786+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-dwztn","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T01:06:45.467231+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T01:06:45.76629+01:00","deleted_at":"2026-01-11T01:06:45.76629+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-dxi6","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:11:45.614092+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:11:45.937258+01:00","deleted_at":"2026-01-07T18:11:45.937258+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-dxl3","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T06:03:25.897919+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T06:03:25.964061+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T06:03:25.964061+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-dzjy","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T03:57:11.898394+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T03:57:11.972156+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-08T03:57:11.972156+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-e167","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:33:23.257977+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:23.303523+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T18:33:23.303523+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-e2hgd","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:06:41.588837+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:06:41.636103+01:00","deleted_at":"2026-01-09T20:06:41.636103+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-e2lat","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:31:31.424258+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:31:31.820012+01:00","deleted_at":"2026-01-11T00:31:31.820012+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-e4ee8","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:12:16.247219+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:12:16.346691+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-08T23:12:16.346691+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-e5t1i","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:20:29.687694+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:29.893237+01:00","deleted_at":"2026-01-09T01:20:29.893237+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-e60p","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T05:04:23.967079+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:04:24.008838+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T05:04:24.008838+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-e6f1","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:36:02.359365+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:36:02.572322+01:00","deleted_at":"2026-01-07T02:36:02.572322+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-e6t","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-06T04:36:24.889975+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:36:24.9524+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-06T04:36:24.9524+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-e9ie","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T14:30:22.064988+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:30:22.478777+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T14:30:22.478777+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-eaf","title":"Phase 3: Trigger System","description":"**Effort:** ~6 hours | **Risk:** Medium\n\nImplement automatic workflow selection based on labels and issue types.\n\n## Tasks\n\n1. Update PolicyConfig interface with issue_types and priority fields\n2. Implement `matchPolicy(issue: BeadsIssue)` method in PolicyEngine class\n3. Update `processIssue()` in WorkerEngine to use `matchPolicy()` instead of `getDefaultPolicyName()`\n4. Implement invalid workflow label handling based on config (error vs warning-fallback)\n5. Implement priority-based selection with tie-breaking (config order)\n6. Write unit tests for trigger system\n\n## Files Modified\n- `.agent-shepherd/src/core/policy.ts`\n- `.agent-shepherd/src/core/worker-engine.ts`\n- `tests/trigger-system.test.ts` (new file)\n\n## Acceptance Criteria\n- [ ] matchPolicy() method exists and works correctly\n- [ ] Explicit workflow label takes precedence\n- [ ] Issue type matching works correctly\n- [ ] Priority-based selection works (higher wins)\n- [ ] Config order breaks priority ties correctly\n- [ ] Default policy used when no match\n- [ ] Invalid workflow label handled according to invalid_label_strategy\n- [ ] Worker Engine uses matchPolicy() method\n- [ ] All unit tests passing\n\n## Code Preview (policy.ts)\n```typescript\nexport interface PolicyConfig {\n  name: string;\n  description?: string;\n  issue_types?: string[];  // NEW\n  priority?: number;       // NEW: 1-100, default 50\n  phases: PhaseConfig[];\n  retry?: RetryConfig;\n  timeout_base_ms?: number;\n  stall_threshold_ms?: number;\n  require_hitl?: boolean;\n  fallback_enabled?: boolean;\n  fallback_agent?: string;\n  fallback_mappings?: Record\u003cstring, string\u003e;\n}\n\n// Add to PolicyEngine class\nmatchPolicy(issue: BeadsIssue): string {\n  const config = getConfig();\n  const policyNames = this.getPolicyNames();\n  \n  // 1. Check for explicit workflow label (ashep-workflow:xxx)\n  const workflowLabel = issue.labels?.find(l =\u003e l.startsWith('ashep-workflow:'));\n  if (workflowLabel) {\n    const workflowName = workflowLabel.split(':')[1];\n    \n    if (this.policies.has(workflowName)) {\n      console.log(`Using explicitly assigned workflow: ${workflowName}`);\n      return workflowName;\n    }\n    \n    // Handle invalid workflow label\n    const strategy = config.workflow?.invalid_label_strategy || 'warning-fallback';\n    \n    if (strategy === 'error') {\n      console.error(`Workflow label '${workflowName}' not found (invalid_label_strategy: error)`);\n      throw new Error(`Workflow '${workflowName}' does not exist`);\n    } else {\n      console.warn(`Workflow label '${workflowName}' not found (invalid_label_strategy: warning-fallback), falling back to type matching`);\n    }\n  }\n  \n  // 2. Match by issue type\n  const matchingPolicies: Array\u003c{name: string, priority: number, index: number}\u003e = [];\n  \n  for (let i = 0; i \u003c policyNames.length; i++) {\n    const name = policyNames[i];\n    const policy = this.policies.get(name);\n    if (!policy || !policy.issue_types) continue;\n    \n    if (policy.issue_types.includes(issue.issue_type)) {\n      matchingPolicies.push({\n        name,\n        priority: policy.priority || 50,\n        index: i  // Track config order for tie-breaking\n      });\n    }\n  }\n  \n  // Sort by priority (highest first), then by config order\n  if (matchingPolicies.length \u003e 0) {\n    matchingPolicies.sort((a, b) =\u003e {\n      if (b.priority !== a.priority) {\n        return b.priority - a.priority; // Higher priority first\n      }\n      return a.index - b.index; // Config order for ties\n    });\n    \n    const selected = matchingPolicies[0].name;\n    console.log(`Matched policy '${selected}' by issue type '${issue.issue_type}' (priority: ${matchingPolicies[0].priority})`);\n    return selected;\n  }\n  \n  // 3. Fallback to default\n  console.log(`No policy matched issue type '${issue.issue_type}', using default: ${this.defaultPolicy}`);\n  return this.defaultPolicy;\n}\n```","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T17:08:42.518166+01:00","updated_at":"2026-01-05T17:22:58.058895+01:00","close_reason":"Removed as requested by user","dependencies":[{"issue_id":"agent-shepherd-eaf","depends_on_id":"agent-shepherd-3of","type":"parent-child","created_at":"2026-01-05T17:08:49.962297+01:00","created_by":"daemon"},{"issue_id":"agent-shepherd-eaf","depends_on_id":"agent-shepherd-bj9","type":"blocks","created_at":"2026-01-05T17:10:01.829694+01:00","created_by":"daemon"}],"deleted_at":"2026-01-05T17:22:58.058895+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-eal","title":"2.2 Implement OpenCode integration (@opencode-ai/sdk, sessions, messages)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-19T03:55:10.869243+01:00","updated_at":"2025-12-19T04:02:51.934268+01:00","deleted_at":"2025-12-19T04:02:51.934268+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-edhzr","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:24:05.193108+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:24:05.241329+01:00","deleted_at":"2026-01-09T01:24:05.241329+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-eej49","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:11:02.343974+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:11:02.440365+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-09T20:11:02.440365+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-egi.2","title":"Create package.json with Bun, TypeScript, dependencies","description":"Set up package.json with latest Bun runtime, TypeScript compiler, and core dependencies including @opencode-ai/sdk, react, reactflow, yaml parser, sqlite3, commander for CLI","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-18T04:57:12.156631+01:00","updated_at":"2025-12-18T05:21:46.930572+01:00","labels":["dependencies","project-setup"],"deleted_at":"2025-12-18T05:21:46.930572+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-egi.4","title":"Create tsconfig.json and bunfig.toml","description":"Configure TypeScript compiler options for strict type checking and Bun-specific settings for fast compilation and bundling","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-18T04:57:25.128803+01:00","updated_at":"2025-12-18T05:21:46.930572+01:00","labels":["project-setup","typescript"],"deleted_at":"2025-12-18T05:21:46.930572+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-egi.5","title":"Set up directory structure","description":"Create src/cli, src/core, src/utils, .agent-shepherd, docs, schemas, ui directories with proper organization","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-18T04:57:31.731885+01:00","updated_at":"2025-12-18T05:21:46.930572+01:00","labels":["project-setup","structure"],"deleted_at":"2025-12-18T05:21:46.930572+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-egi.6","title":"Initialize git repo if not present","description":"Ensure git repository is initialized and configured for the project","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-18T04:57:38.155893+01:00","updated_at":"2025-12-18T05:21:46.930572+01:00","labels":["git","project-setup"],"deleted_at":"2025-12-18T05:21:46.930572+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-eh3g","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T03:43:26.904424+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:43:27.075551+01:00","deleted_at":"2026-01-07T03:43:27.075551+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ehnk","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T02:36:01.473736+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:36:01.538574+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T02:36:01.538574+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-ej31h","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:12:18.185565+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:12:18.308104+01:00","deleted_at":"2026-01-08T23:12:18.308104+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ejem","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:31:19.779486+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:31:19.880509+01:00","deleted_at":"2026-01-07T18:31:19.880509+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-eojck","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T04:39:42.418117+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:39:43.12103+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T04:39:43.12103+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-eonb","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:03:06.870131+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:03:06.93916+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T19:03:06.93916+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-eregt","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T04:49:40.214956+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:49:41.030619+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T04:49:41.030619+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-erj7","title":"2.1.6 Add Unit Tests for Transition Logic","description":"Comprehensive tests for all transition types.\n\n## Tasks\n- Test all transition types:\n  - advance: Moves to next phase, updates Beads label\n  - retry: Retries current phase, clears HITL labels\n  - block: Sets issue to blocked, triggers HITL\n  - close: Closes issue, removes labels\n  - jump_back: Jumps to specified previous phase\n  - dynamic_decision: Executes decision agent\n- Test transition validation:\n  - Validates jump_target_phase exists in policy\n  - Throws error for invalid phase\n  - Detects circular jumps (phase to itself)\n  - Validates dynamic_agent has available agents\n  - Throws error if no agents with capability\n- Test backward compatibility:\n  - Existing policies without enhanced transitions still work\n  - Transition types advance/retry/block/close unchanged\n  - Missing optional fields handled gracefully\n- Test dynamic_decision triggers agent execution (covered in detail in 2.4)\n\n## Expected Deliverables\n- Complete unit test suite for transitions\n- Tests for all transition types\n- Validation tests\n- Backward compatibility tests","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:51:09.171318+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-esi9","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T22:07:37.842107+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T22:07:37.944208+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T22:07:37.944208+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-esssa","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:06:41.071042+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:06:41.163359+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-09T20:06:41.163359+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-eu3b","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:51:19.518236+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:51:19.561171+01:00","deleted_at":"2026-01-07T02:51:19.561171+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-evu","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:36:24.981493+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:36:25.041728+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-06T04:36:25.041728+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ew69o","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-10T00:11:56.414853+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T00:11:56.484594+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-10T00:11:56.484594+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-exam","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:51:19.591089+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:51:19.694771+01:00","deleted_at":"2026-01-07T02:51:19.694771+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-exd3y","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:52:28.848266+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:52:29.077485+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-11T00:52:29.077485+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ey7","title":"Test issue with label","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T15:39:52.328754+01:00","created_by":"tonyhartmann","updated_at":"2026-01-05T15:40:06.262193+01:00","labels":["ashep:excluded","priority:high"],"deleted_at":"2026-01-05T15:40:06.262193+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-ey8a","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-06T16:00:25.239424+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T16:00:25.299679+01:00","deleted_at":"2026-01-06T16:00:25.299679+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-ez1d","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:35:17.117845+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:35:17.201671+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-06T23:35:17.201671+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-f2n7","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T18:29:38.251695+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:29:38.312668+01:00","deleted_at":"2026-01-07T18:29:38.312668+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-f3evj","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:20:53.738485+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:53.817952+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-09T01:20:53.817952+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-f5z","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:34:14.908272+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:15.010176+01:00","deleted_at":"2026-01-06T04:34:15.010176+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-f6n3","title":"2.2.7 Add Configuration Tests","description":"Test policy configuration parsing and validation for transition configs. Test valid/invalid configurations, string/object transitions, and backward compatibility with existing policies.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-07T00:05:26.630589+01:00","updated_at":"2026-01-07T00:06:15.832092+01:00","deleted_at":"2026-01-07T00:06:15.832092+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-f6nm","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T21:46:03.786244+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:46:04.012344+01:00","deleted_at":"2026-01-07T21:46:04.012344+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-f7ag","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:58:05.794106+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:58:05.896244+01:00","deleted_at":"2026-01-06T15:58:05.896244+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-f8b3e","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:40:53.195249+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:40:53.245869+01:00","deleted_at":"2026-01-09T20:40:53.245869+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-f8wt","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T03:38:11.675519+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:38:11.851462+01:00","deleted_at":"2026-01-07T03:38:11.851462+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-fcj2","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:54:00.395314+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:54:00.452265+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-06T15:54:00.452265+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-fegt7","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:24:04.422463+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:24:04.611876+01:00","deleted_at":"2026-01-09T01:24:04.611876+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ffatr","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:23:33.452696+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:23:33.525854+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-09T01:23:33.525854+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ffot","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T05:04:24.74067+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:04:24.872464+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T05:04:24.872464+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-fg8k4","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-09T01:20:53.853408+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:53.929095+01:00","deleted_at":"2026-01-09T01:20:53.929095+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-fgjzd","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:49:39.78968+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:49:39.858007+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-09T04:49:39.858007+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-fh4c","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:58:05.34651+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:58:05.410511+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-06T15:58:05.410511+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-fhk8","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T16:00:26.163622+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T16:00:26.201438+01:00","deleted_at":"2026-01-06T16:00:26.201438+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-fhmw","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-06T15:58:05.924565+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:58:06.278918+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-06T15:58:06.278918+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-fiff","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T20:36:36.802124+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T20:36:36.903363+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T20:36:36.903363+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-fise","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:39:59.772348+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:39:59.839464+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T18:39:59.839464+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-fky","title":"2.3 Implement Policy Engine (YAML parsing, phase transitions)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-19T03:55:21.214175+01:00","updated_at":"2025-12-19T04:02:51.934268+01:00","deleted_at":"2025-12-19T04:02:51.934268+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-flhfs","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T05:10:42.375039+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T05:10:42.54975+01:00","deleted_at":"2026-01-09T05:10:42.54975+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-flyr","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T03:38:11.575834+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:38:11.643372+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T03:38:11.643372+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-fnogv","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-09T01:20:29.335914+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:29.40943+01:00","deleted_at":"2026-01-09T01:20:29.40943+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-fqw0","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:40:01.329565+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:40:01.464381+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T18:40:01.464381+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-fs7","title":"label-workflow-test: Bug issue type test","status":"tombstone","priority":2,"issue_type":"bug","created_at":"2026-01-06T04:24:42.860639+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:29.055576+01:00","deleted_at":"2026-01-06T04:32:29.055576+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"bug"}
{"id":"agent-shepherd-ftb","title":"1.3 Set up directory structure (src/cli, src/core, src/utils, .agent-shepherd, docs, schemas, ui)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-19T03:51:38.984194+01:00","updated_at":"2025-12-19T04:02:51.934268+01:00","deleted_at":"2025-12-19T04:02:51.934268+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-fvn8d","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T05:10:43.379912+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T05:10:43.596472+01:00","labels":["label2","label3"],"deleted_at":"2026-01-09T05:10:43.596472+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-fw52","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T21:46:03.116661+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:46:03.202125+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T21:46:03.202125+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-fwy2","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T03:57:12.822518+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T03:57:12.871278+01:00","deleted_at":"2026-01-08T03:57:12.871278+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-fz5d","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:32:19.718221+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:32:19.828524+01:00","deleted_at":"2026-01-07T14:32:19.828524+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-fzop","title":"3.1.3 Implement archiveOldRuns()","description":"Move old runs and decisions to archive database based on age thresholds. Create archiveOldRuns() method that calculates timestamps, finds runs to archive (90-365 days old), copies to archive database, and removes from active database.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:09:05.255045+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:12:28.950967+01:00","deleted_at":"2026-01-07T01:12:28.950967+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-g0tqw","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:15:58.688368+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:58.771256+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-09T01:15:58.771256+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-g43","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-06T04:36:25.069101+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:36:25.126357+01:00","deleted_at":"2026-01-06T04:36:25.126357+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-g4bw","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T05:46:20.68521+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:46:20.778869+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T05:46:20.778869+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-g4i","title":"Phase 7: Documentation Updates","description":"Update .agent-shepherd/README.md with new installation instructions: quick install via curl/irm, hybrid vs local explanation, update command usage, developer setup (git clone for contributors).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T03:20:22.41018+01:00","created_by":"tonyhartmann","updated_at":"2025-12-30T03:36:48.642054+01:00","closed_at":"2025-12-30T03:36:48.642054+01:00","close_reason":"Closed via update","dependencies":[{"issue_id":"agent-shepherd-g4i","depends_on_id":"agent-shepherd-7gt","type":"parent-child","created_at":"2025-12-30T03:20:24.370006+01:00","created_by":"daemon"},{"issue_id":"agent-shepherd-g4i","depends_on_id":"agent-shepherd-df8","type":"blocks","created_at":"2025-12-30T03:20:36.935571+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-g5m3","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:36:01.357262+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:36:01.442011+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T02:36:01.442011+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-g6l7","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T05:54:20.396124+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:54:20.484919+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-08T05:54:20.484919+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-g6qc","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:32:18.954473+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:32:19.06474+01:00","deleted_at":"2026-01-07T14:32:19.06474+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-g72k","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:59:45.17553+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:59:45.285924+01:00","deleted_at":"2026-01-07T02:59:45.285924+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-g7bx0","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:06:41.510528+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:06:41.556945+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-09T20:06:41.556945+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-g7k9","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T02:57:15.825423+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T02:57:16.011978+01:00","deleted_at":"2026-01-08T02:57:16.011978+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-g7vk6","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-11T00:52:30.74116+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:52:31.867998+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-11T00:52:31.867998+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-g7wxn","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-09T04:50:40.103166+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:50:40.205931+01:00","deleted_at":"2026-01-09T04:50:40.205931+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-g8ws","title":"2.1.1 Analyze Current Transition System","description":"Document existing transition types and their limitations. Review PhaseTransition interface, determineTransition() implementation, and identify gaps in current linear progression model.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-07T00:04:46.758048+01:00","updated_at":"2026-01-07T00:06:15.832092+01:00","deleted_at":"2026-01-07T00:06:15.832092+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-g98er","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:24:04.312153+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:24:04.387702+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-09T01:24:04.387702+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-gaimu","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:24:03.966927+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:24:04.041862+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-09T01:24:04.041862+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-gc6k","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:40:14.370921+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:40:14.468794+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T18:40:14.468794+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-gcidh","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:17:05.170872+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:17:05.262324+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-08T23:17:05.262324+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-gdb9","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T22:07:38.26779+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T22:07:38.355786+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T22:07:38.355786+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-gdx6h","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:16:32.724999+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:16:32.778177+01:00","deleted_at":"2026-01-09T20:16:32.778177+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-gfez","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:59:44.200803+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:59:44.242554+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T02:59:44.242554+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-gh8","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:36:27.049975+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:36:27.154189+01:00","deleted_at":"2026-01-06T04:36:27.154189+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-glui","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T16:00:25.435233+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T16:00:25.4937+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-06T16:00:25.4937+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-glws","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:18:30.28741+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:18:30.353342+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T19:18:30.353342+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-gmjwm","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-11T00:08:08.627536+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:08:08.743409+01:00","deleted_at":"2026-01-11T00:08:08.743409+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-gnac","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T06:03:27.176314+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T06:03:27.283976+01:00","deleted_at":"2026-01-07T06:03:27.283976+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-gohb","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:59:44.274062+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:59:44.315613+01:00","deleted_at":"2026-01-07T02:59:44.315613+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-gp6cg","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:17:05.62337+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:17:05.670834+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-08T23:17:05.670834+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-gq2r","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:28:07.131479+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:28:07.20497+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-06T23:28:07.20497+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-grxdw","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:23:33.099447+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:23:33.28933+01:00","deleted_at":"2026-01-09T01:23:33.28933+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-gsw","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:32:30.787096+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:30.883734+01:00","deleted_at":"2026-01-06T04:32:30.883734+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-gtk0","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T15:02:08.566102+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T15:02:08.633196+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T15:02:08.633196+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-guf","title":"label-workflow-test: Feature priority test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-06T04:24:42.88875+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:29.035145+01:00","deleted_at":"2026-01-06T04:32:29.035145+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-guj5","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T05:04:22.934784+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:04:23.002639+01:00","deleted_at":"2026-01-07T05:04:23.002639+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-gvmja","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:38:36.773707+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:38:36.851733+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-09T01:38:36.851733+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-gvo","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:32:29.33088+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:29.393015+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-06T04:32:29.393015+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-gw38","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:03:08.238412+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:03:08.345604+01:00","deleted_at":"2026-01-07T19:03:08.345604+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-gxtzp","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-10T00:11:56.965643+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T00:11:57.150171+01:00","deleted_at":"2026-01-10T00:11:57.150171+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-gzhe","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:11:45.206289+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:11:45.271354+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T18:11:45.271354+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-h0ba","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:26:25.721964+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:26:25.826206+01:00","deleted_at":"2026-01-07T14:26:25.826206+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-h1g3","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:33:24.010558+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:24.142245+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T18:33:24.142245+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-h24a","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T22:07:37.74832+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T22:07:37.812673+01:00","deleted_at":"2026-01-07T22:07:37.812673+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-h69no","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:50:39.959998+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:50:40.064212+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-09T04:50:40.064212+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-h7w","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:42:31.497837+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:42:31.600356+01:00","deleted_at":"2026-01-06T04:42:31.600356+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-h8pg","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T15:02:10.624228+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T15:02:10.732663+01:00","deleted_at":"2026-01-07T15:02:10.732663+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-h94","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:35:53.557731+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:35:53.620364+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-06T04:35:53.620364+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-h9c44","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:38:37.12145+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:38:37.218473+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-09T01:38:37.218473+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-h9p7","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T03:38:12.306322+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:38:12.349787+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T03:38:12.349787+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-hazoy","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:13:55.085008+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:13:55.203706+01:00","deleted_at":"2026-01-09T01:13:55.203706+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-hb0o","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:58:06.445953+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:58:06.541539+01:00","deleted_at":"2026-01-06T15:58:06.541539+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-hb3d2","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-09T23:23:27.292154+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:23:27.361487+01:00","deleted_at":"2026-01-09T23:23:27.361487+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-hbpqz","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:50:41.067465+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:50:41.169645+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-09T04:50:41.169645+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-hfho","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:33:44.41866+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:44.509506+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T18:33:44.509506+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-hfiob","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-10T00:11:55.985297+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T00:11:56.054722+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-10T00:11:56.054722+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-hfxp","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-08T23:12:15.854149+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:12:15.957235+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-08T23:12:15.957235+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-hgfv","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T03:43:26.593849+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:43:26.658246+01:00","deleted_at":"2026-01-07T03:43:26.658246+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-hhl6p","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:46:37.792602+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:46:37.93364+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-09T20:46:37.93364+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-hiy","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-06T04:42:30.413743+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:42:30.475048+01:00","deleted_at":"2026-01-06T04:42:30.475048+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-hj0o","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:33:21.929314+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:22.037875+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T18:33:22.037875+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-hlzv","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T05:56:18.313021+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:56:18.402764+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-08T05:56:18.402764+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-hmba","title":"2.1.2 Design Enhanced Transition Interface","description":"Extend PhaseTransition to support new transition types.\n\n## Tasks\n- Add new transition types to PhaseTransition:\n  - jump_back: Jump to previous phase (useful for fix-validation cycles)\n  - dynamic_decision: Delegate to AI decision agent (enables intelligent routing)\n  - jump_target_phase: Specific phase to jump back to (e.g., from validate back to develop)\n  - dynamic_agent: Capability name for selecting decision agent (e.g., \"test-decision\")\n  - decision_config: Full configuration passed to decision agent (prompt, thresholds, etc.)\n- Maintain backward compatibility:\n  - All existing fields preserved\n  - New fields optional (default undefined)\n  - Existing transition types unchanged\n\n## Expected Deliverables\n- Extended PhaseTransition interface definition\n- Documentation of new transition types\n- Backward compatibility notes","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:51:07.849292+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-hp4j","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:11:45.985204+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:11:46.155259+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T18:11:46.155259+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-hq9i0","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-08T23:43:41.189433+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:43:41.260092+01:00","deleted_at":"2026-01-08T23:43:41.260092+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-hrsro","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-11T01:06:40.98509+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T01:06:41.101749+01:00","deleted_at":"2026-01-11T01:06:41.101749+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-hrzq","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:31:19.625431+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:31:19.751158+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T18:31:19.751158+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-hs2a","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:35:17.531535+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:35:17.57482+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-06T23:35:17.57482+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-hsyd","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:00:16.963083+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:00:17.069998+01:00","deleted_at":"2026-01-07T19:00:17.069998+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-htms","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:18:29.864424+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:18:29.929037+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T19:18:29.929037+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-hvb","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:32:30.717199+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:30.756704+01:00","deleted_at":"2026-01-06T04:32:30.756704+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-hw5x","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T05:46:22.586394+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:46:22.704488+01:00","deleted_at":"2026-01-07T05:46:22.704488+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-hwda","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:39:11.086633+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:39:11.169239+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T14:39:11.169239+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-hxxya","title":"Add Per-Phase Custom Prompts Feature","description":"Implement per-phase custom prompts with backward compatibility. This feature allows users to specify custom prompts for each phase in policies, with variable substitution for dynamic content. Falls back to generic prompts when not specified.\n\nScratchpad:\nBased on our discussion, here's a detailed implementation plan for adding per-phase custom prompts (item 2) while keeping prompts optional. This follows the KISS principle with minimal changes, full backward compatibility, and focuses on extending the existing prompt system without overhauling it.\nI'll break this down into What, Why, How, Testing, and Documentation Updates. The plan assumes we're building on the current codebase structure (e.g., policy.ts, worker-engine.ts, policies.schema.json).\n\nWhat: Core Feature Addition\n- Add an optional custom_prompt field to the PhaseConfig interface in policy.ts.\n- Modify the buildInstructions() method in worker-engine.ts to use custom prompts when provided, with simple variable substitution for dynamic content (e.g., issue details).\n- If no custom prompt is specified, fall back to the existing generic prompt template.\n- Update the JSON schema (policies.schema.json) to validate the new field.\n- Supported substitution variables: {{issue.title}}, {{issue.description}}, {{issue.id}}, {{issue.type}}, {{phase}}, {{capabilities}} (comma-separated list).\n\nWhy: Benefits and Rationale\n- User Flexibility: Enables tailored prompts per phase (e.g., a specific instruction for \"review\" vs. \"implement\"), improving agent performance without rewriting core logic.\n- KISS \u0026 Minimal Impact: Builds on existing code with one new optional field and conditional logic—no new dependencies, session management, or complex state.\n- Backward Compatibility: Existing policies work unchanged; new field is purely additive.\n- Safety: Prompts are user-defined in config files, reducing risk of injection or misuse compared to runtime prompt building.\n- Tradeoff Consideration: Substitution is simple (string replacement) to avoid complexity, but it limits advanced templating. If you want richer templating (e.g., conditionals), we could discuss expanding this later.\n\nHow: Step-by-Step Implementation\n1. Update Type Definitions (policy.ts):\n   - Add custom_prompt?: string; to the PhaseConfig interface.\n   - No other changes to the interface—keep it optional.\n2. Modify Prompt Building Logic (worker-engine.ts):\n   - In buildInstructions(), add a check: If phaseConfig?.custom_prompt exists, use it with substitution.\n   - Substitution logic: Use .replace() for each variable (e.g., custom_prompt.replace(/{{issue\\.title}}/g, issue.title)).\n   - If no custom prompt, use the existing generic template (no change to current behavior).\n   - Handle edge cases: Empty custom prompt → fall back to generic; invalid variables → leave as-is (no errors).\n3. Update Schema Validation (policies.schema.json):\n   - Add \"custom_prompt\": { \"type\": \"string\" } to the phase object properties (as optional).\n4. Config Example:\n   - In config/policies.yaml, users can add:\n          phases:\n       - name: implement\n         custom_prompt: \"Implement the feature for issue {{issue.title}}. Use these capabilities: {{capabilities}}. Ensure code follows best practices.\"\n       - name: review  # No custom_prompt → uses generic\n        - Variables are substituted at runtime using actual issue data.\n\nTesting: Verification Steps\n- Unit Tests (extend existing policy-engine.test.ts or add new):\n  - Test PhaseConfig with/without custom_prompt.\n  - Test buildInstructions(): Verify substitution works (e.g., {{issue.title}} becomes actual title); fallback to generic when absent; handles missing variables gracefully.\n  - Edge cases: Empty prompt, invalid variables, long prompts.\n- Integration Tests (basic.test.ts or new):\n  - Create a test policy with custom prompts in config/policies.yaml.\n  - Simulate worker processing: Run a full phase and verify the prompt sent to OpenCode matches the substituted custom prompt.\n  - Test phase progression: Ensure custom prompts don't affect other phases.\n- Manual Testing:\n  - Use ashep work \u003cissue-id\u003e with a policy containing custom prompts.\n  - Check OpenCode session logs to confirm the correct prompt was used.\n  - Verify backward compatibility: Run existing policies without custom prompts.\n- Regression Checks: Run full test suite (bun test) to ensure no breakage.\n\nDocumentation Updates\n- Config Reference (docs/policies-config.md):\n  - Add a new section: \"Per-Phase Custom Prompts\".\n  - Explain the custom_prompt field, supported variables, and examples.\n  - Note: Optional, falls back to generic prompt if absent.\n- Architecture Doc (docs/architecture.md or docs/enhanced-transitions.md):\n  - Briefly mention prompt customization in the \"Policy Engine\" section as an extension for phase-specific instructions.\n- CLI Reference (docs/cli-reference.md):\n  - If relevant, add a note under workflow commands that custom prompts can be configured per phase.\n\nWhen assigned this epic, consume the overall context and select the next available child issue to work on, rather than working on the epic directly.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-09T01:04:47.604949+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:23:42.25276+01:00","closed_at":"2026-01-09T01:23:42.25276+01:00","close_reason":"Completed"}
{"id":"agent-shepherd-hxxya.1","title":"Update Type Definitions in policy.ts","description":"Add optional custom_prompt?: string; field to the PhaseConfig interface in policy.ts. Keep it optional for backward compatibility.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T01:04:49.880568+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:08:32.89417+01:00","closed_at":"2026-01-09T01:08:32.89417+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-hxxya.1","depends_on_id":"agent-shepherd-hxxya","type":"parent-child","created_at":"2026-01-09T01:04:49.889965+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-hxxya.2","title":"Modify Prompt Building Logic in worker-engine.ts","description":"In buildInstructions(), add check for phaseConfig?.custom_prompt. If exists, use it with variable substitution ({{issue.title}}, {{issue.description}}, etc.). Fall back to generic template if not specified. Handle edge cases gracefully.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T01:04:51.594768+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:09:15.95861+01:00","closed_at":"2026-01-09T01:09:15.95861+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-hxxya.2","depends_on_id":"agent-shepherd-hxxya","type":"parent-child","created_at":"2026-01-09T01:04:51.601771+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-hxxya.3","title":"Update Schema Validation in policies.schema.json","description":"Add 'custom_prompt': { 'type': 'string' } to the phase object properties as an optional field.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T01:04:53.113304+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:10:00.625477+01:00","closed_at":"2026-01-09T01:10:00.625477+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-hxxya.3","depends_on_id":"agent-shepherd-hxxya","type":"parent-child","created_at":"2026-01-09T01:04:53.118198+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-hxxya.4","title":"Implement Testing for Custom Prompts","description":"Comprehensive testing including unit tests, integration tests, manual testing, and regression checks to verify the custom prompts feature works correctly and maintains backward compatibility.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T01:04:54.499865+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:21:51.170148+01:00","closed_at":"2026-01-09T01:21:51.170148+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-hxxya.4","depends_on_id":"agent-shepherd-hxxya","type":"parent-child","created_at":"2026-01-09T01:04:54.505325+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-hxxya.4.1","title":"Unit Tests for Custom Prompts","description":"Extend existing policy-engine.test.ts or add new tests: Test PhaseConfig with/without custom_prompt, buildInstructions() substitution, fallback behavior, edge cases (empty prompt, invalid variables, long prompts).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T01:04:55.875394+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:12:51.585497+01:00","closed_at":"2026-01-09T01:12:51.585497+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-hxxya.4.1","depends_on_id":"agent-shepherd-hxxya.4","type":"parent-child","created_at":"2026-01-09T01:04:55.882505+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-hxxya.4.2","title":"Integration Tests for Custom Prompts","description":"Create test policy with custom prompts in config/policies.yaml. Simulate worker processing to verify prompt sent to OpenCode matches substituted custom prompt. Test phase progression.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T01:04:56.983021+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:12:51.592178+01:00","closed_at":"2026-01-09T01:12:51.592178+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-hxxya.4.2","depends_on_id":"agent-shepherd-hxxya.4","type":"parent-child","created_at":"2026-01-09T01:04:56.99014+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-hxxya.4.3","title":"Manual Testing for Custom Prompts","description":"Use ashep work \u003cissue-id\u003e with policy containing custom prompts. Check OpenCode session logs for correct prompt usage. Verify backward compatibility with existing policies. Run full test suite for regression.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T01:04:58.106022+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:21:51.164834+01:00","closed_at":"2026-01-09T01:21:51.164834+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-hxxya.4.3","depends_on_id":"agent-shepherd-hxxya.4","type":"parent-child","created_at":"2026-01-09T01:04:58.112023+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-hxxya.5","title":"Update Documentation for Custom Prompts","description":"Update relevant documentation files to include information about the new per-phase custom prompts feature, including configuration examples and usage notes.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T01:04:59.263367+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:23:42.241653+01:00","closed_at":"2026-01-09T01:23:42.241653+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-hxxya.5","depends_on_id":"agent-shepherd-hxxya","type":"parent-child","created_at":"2026-01-09T01:04:59.268243+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-hxxya.5.1","title":"Update docs/policies-config.md","description":"Add 'Per-Phase Custom Prompts' section explaining the custom_prompt field, supported variables ({{issue.title}}, etc.), examples, and note that it's optional with fallback to generic prompt.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T01:05:00.927307+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:23:42.249407+01:00","closed_at":"2026-01-09T01:23:42.249407+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-hxxya.5.1","depends_on_id":"agent-shepherd-hxxya.5","type":"parent-child","created_at":"2026-01-09T01:05:00.931083+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-hxxya.5.2","title":"Update docs/architecture.md or docs/enhanced-transitions.md","description":"Briefly mention prompt customization in the 'Policy Engine' section as an extension for phase-specific instructions.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T01:05:01.985237+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:23:42.24617+01:00","closed_at":"2026-01-09T01:23:42.24617+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-hxxya.5.2","depends_on_id":"agent-shepherd-hxxya.5","type":"parent-child","created_at":"2026-01-09T01:05:01.989+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-hxxya.5.3","title":"Update docs/cli-reference.md","description":"Add note under workflow commands that custom prompts can be configured per phase.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T01:05:03.126754+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:23:42.253188+01:00","closed_at":"2026-01-09T01:23:42.253188+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-hxxya.5.3","depends_on_id":"agent-shepherd-hxxya.5","type":"parent-child","created_at":"2026-01-09T01:05:03.130304+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-hynd7","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:08:11.266766+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:08:11.541847+01:00","deleted_at":"2026-01-11T00:08:11.541847+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-hyoi","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T18:14:39.412113+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:14:39.474415+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T18:14:39.474415+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-hyr9","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:26:24.541607+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:26:24.604674+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T14:26:24.604674+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-i08b","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T18:33:43.874981+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:43.942768+01:00","deleted_at":"2026-01-07T18:33:43.942768+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-i0uh","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T05:46:21.915553+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:46:22.372862+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T05:46:22.372862+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-i1d9","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:40:00.547189+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:40:00.592258+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T18:40:00.592258+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-i2nr7","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:39:43.410585+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:39:43.577135+01:00","deleted_at":"2026-01-09T04:39:43.577135+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-i39w","title":"2.2.4 Add getTransitionKey() Helper","description":"Create helper function to map outcome types to transition configuration keys. Handle success/failure/partial_success/unclear outcomes and maintain backward compatibility.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-07T00:05:20.847176+01:00","updated_at":"2026-01-07T00:06:15.832092+01:00","deleted_at":"2026-01-07T00:06:15.832092+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-i98z","title":"3.2.3 Add Cross-Database Querying","description":"Query both active and archive databases together seamlessly. Implement queryAllRuns(), getRunHistory(), getRunWithArchival() methods that combine results from both databases with consistent API.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:09:23.83961+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:12:28.303182+01:00","deleted_at":"2026-01-07T01:12:28.303182+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-ia9w","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T22:07:39.560992+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T22:07:39.759682+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T22:07:39.759682+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-iasd","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-06T15:58:04.721067+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:58:04.775578+01:00","deleted_at":"2026-01-06T15:58:04.775578+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-id2l","title":"2.3 Implement Loop Prevention System","description":"Add comprehensive loop prevention to avoid infinite workflows. Track phase visits, transition patterns, detect cycles, and escalate to HITL when limits exceeded.\n\n## Scope\n- Phase visit tracking using runs.db\n- validatePhaseLimits() with HITL escalation\n- Transition limit tracking and validation\n- Cycle detection for oscillating patterns\n- Integrate loop prevention into determineTransition()\n- Add configuration for loop prevention settings\n- Integration tests for loop prevention scenarios\n\n## Dependencies\n- Depends on 2.2 (conditional transitions)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-07T00:05:40.26915+01:00","updated_at":"2026-01-07T00:06:15.832092+01:00","deleted_at":"2026-01-07T00:06:15.832092+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-ifjet","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:15:31.457353+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:31.533525+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-09T01:15:31.533525+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-igd4","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:57:13.179084+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:57:13.263737+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-06T15:57:13.263737+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-igfg","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T03:43:27.32624+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:43:27.497736+01:00","deleted_at":"2026-01-07T03:43:27.497736+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ihsa6","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:23:34.706986+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:23:34.846542+01:00","labels":["label2","label3"],"deleted_at":"2026-01-09T01:23:34.846542+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-iiiw","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T21:46:02.443116+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:46:02.565469+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T21:46:02.565469+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-imf3","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T03:38:11.234281+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:38:11.307095+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T03:38:11.307095+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ioox","title":"2.4.1 Define Decision Agent Capabilities","description":"Define capability names for decision-making contexts.\n\n## Tasks\n- Design capability names for decision contexts:\n  - test-decision: For analyzing test results and quality\n    - Purpose: Decide whether to advance, fix code, or fix tests\n    - Capabilities needed: testing, qa, analysis\n  - validation-decision: For quality gate decisions\n    - Purpose: Evaluate validation results and quality metrics\n    - Capabilities needed: validation, code-analysis\n  - complex-decision: For multi-factor workflow decisions\n    - Purpose: Handle complex orchestration across multiple phases\n    - Capabilities needed: planning, complex-analysis\n- Document each capability:\n  - Name and purpose\n  - Required sub-capabilities\n  - Typical use cases\n  - Expected output format\n- Design rationale:\n  - Capability-based instead of dedicated phases\n  - Leverages existing agent selection mechanism\n  - Multiple agents per capability allows competition/optimization\n  - Easy to extend with new decision types\n\n## Expected Deliverables\n- Decision capability definitions documented\n- Use cases documented for each capability\n- Expected output formats specified","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:53:05.356264+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-ipol","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T14:39:12.19976+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:39:12.650233+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T14:39:12.650233+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-iqoi","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:14:39.909424+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:14:40.080331+01:00","deleted_at":"2026-01-07T18:14:40.080331+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-iqpn7","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-10T00:11:56.863953+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T00:11:56.933001+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-10T00:11:56.933001+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-iqyq","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T18:39:59.549594+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:39:59.619071+01:00","deleted_at":"2026-01-07T18:39:59.619071+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-iri0","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T04:53:55.757213+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T04:53:55.819477+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T04:53:55.819477+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-irsn","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T22:07:38.985772+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T22:07:39.509195+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T22:07:39.509195+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-is0e","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T21:44:08.489098+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:44:08.628874+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T21:44:08.628874+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-itqc","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T05:46:21.382514+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:46:21.57302+01:00","deleted_at":"2026-01-07T05:46:21.57302+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ivn8","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:39:59.874183+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:40:00.061072+01:00","deleted_at":"2026-01-07T18:40:00.061072+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ix8","title":"1.2 Create tsconfig.json and bunfig.toml","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-19T03:51:28.650801+01:00","updated_at":"2025-12-19T04:02:51.934268+01:00","deleted_at":"2025-12-19T04:02:51.934268+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-ixk2","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T22:55:50.640775+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:55:50.730381+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-08T22:55:50.730381+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-iy9h","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T16:00:26.758238+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T16:00:26.884403+01:00","labels":["label2","label3"],"deleted_at":"2026-01-06T16:00:26.884403+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-izk6","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:29:38.866104+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:29:38.932205+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T18:29:38.932205+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-j0wq","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T18:24:23.125445+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:24:23.190041+01:00","deleted_at":"2026-01-07T18:24:23.190041+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-j2g","title":"Update docs/config-config.md with fallback configuration","description":"File: .agent-shepherd/docs/config-config.md\n\nTask: Document fallback configuration section with examples\n\nRequired Changes:\n\n1. Add new section \"Fallback Agent Configuration\" in the config reference\n\n2. Document all fallback configuration fields:\n   - fallback.enabled (boolean): Master switch\n   - fallback.default_agent (string): Default fallback agent\n   - fallback.mappings (object): Capability-specific mappings\n\n3. Provide configuration examples:\n\nBasic Example:\n```yaml\nfallback:\n  enabled: true\n  default_agent: build\n```\n\nAdvanced Example with Mappings:\n```yaml\nfallback:\n  enabled: true\n  default_agent: build\n  mappings:\n    review: summary\n    architecture: plan\n    documentation: summary\n    testing: general\n```\n\nDisabled Example:\n```yaml\nfallback:\n  enabled: false\n```\n\n4. Explain master switch behavior:\n   - When enabled: false, no fallback anywhere in the system\n   - When enabled: true, fallback active unless disabled at lower levels\n   - Why master switch exists (quick disable for troubleshooting)\n\n5. Document how mappings work:\n   - Without mappings: All capabilities use default_agent\n   - With mappings: Specific capabilities use different agents\n   - Remaining capabilities fall back to default_agent\n\n6. Add troubleshooting section:\n   - Common issues (fallback agent doesn't exist, inactive)\n   - How to debug fallback behavior\n   - Validation output examples\n\nAcceptance Criteria:\n- [ ] Fallback section added to config documentation\n- [ ] All fields documented with types and descriptions\n- [ ] Multiple configuration examples provided\n- [ ] Master switch behavior explained\n- [ ] Mappings usage explained clearly\n- [ ] Troubleshooting section added\n- [ ] Examples are well-commented\n- [ ] Documentation is comprehensive and clear","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-05T02:44:34.418196+01:00","updated_at":"2026-01-05T03:22:01.569141+01:00","closed_at":"2026-01-05T03:22:01.569141+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-j2g","depends_on_id":"agent-shepherd-uj0","type":"parent-child","created_at":"2026-01-05T02:45:00.524314+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-j55n","title":"2.3.1 Phase Visit Tracking","description":"Count how many times a phase has been executed for an issue.\n\n## Tasks\n- Add getPhaseVisitCount(issueId: string, phaseName: string): Promise\u003cnumber\u003e to Logger:\n  - Query existing logging system for run history\n  - Query runs.db for records matching issue_id + phase\n  - Return runs.length (each run record = one phase visit)\n  - Count all runs regardless of status (pending, running, completed, failed)\n  - Each execution of a phase = one visit\n- Add index to runs.db on (issue_id, phase) for performance:\n  - CREATE INDEX IF NOT EXISTS idx_runs_issue_phase ON runs(issue_id, phase)\n- Add max_visits?: number field to PhaseConfig (default 10):\n  - Configurable per phase\n  - Default limit prevents infinite loops\n  - Can be increased for phases expected to repeat\n\n## Expected Deliverables\n- getPhaseVisitCount() method implemented\n- Index added to runs.db\n- max_visits field added to PhaseConfig\n- Documentation of visit counting logic","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:51:51.392302+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-j5m1t","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:41:42.816951+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:41:43.111577+01:00","deleted_at":"2026-01-09T04:41:43.111577+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-j5xpo","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:31:33.902229+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:31:34.154308+01:00","deleted_at":"2026-01-11T00:31:34.154308+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-j656","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:24:24.196587+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:24:24.315092+01:00","deleted_at":"2026-01-07T18:24:24.315092+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-j6j5j","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:38:36.201834+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:38:36.283954+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T01:38:36.283954+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-j78m","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T03:38:13.21869+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:38:13.325289+01:00","deleted_at":"2026-01-07T03:38:13.325289+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-j8fj","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:03:08.090435+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:03:08.134144+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T19:03:08.134144+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-j91p","title":"3.2.6 Implement Archive Pruning","description":"Delete data from archive after retention expires. Configure archive_retention_days, implement pruneArchive() method that deletes old data from archive database and JSONL.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:09:30.873804+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:12:28.128095+01:00","deleted_at":"2026-01-07T01:12:28.128095+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-j9cj","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T03:43:27.682186+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:43:27.787177+01:00","deleted_at":"2026-01-07T03:43:27.787177+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-j9r5w","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-08T23:17:04.426662+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:17:04.499783+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-08T23:17:04.499783+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-ja1rl","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:06:40.202659+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:06:40.274555+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T20:06:40.274555+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-jb2x","title":"2.4.5 Implement parseDecisionResponse()","description":"Parse and validate AI decision responses.\n\n## Tasks\n- Create parseDecisionResponse() method in policy engine:\n  - Takes response string and TransitionConfig\n  - Returns validated DecisionResult\n- Implement validation steps:\n  - Validate required fields exist:\n    - Check parsed.decision and parsed.reasoning exist\n    - Throw error if missing\n  - Extract target phase from decision format:\n    - If decision starts with 'jump_to_': extract target\n    - If decision starts with 'advance_to_': extract target\n  - Critical safety check - validate against allowed destinations:\n    - Check if targetPhase in transitionConfig.allowed_destinations\n    - Throw error if not allowed\n  - Calculate requires_approval based on confidence thresholds:\n    - Use default thresholds (auto_advance: 0.8, require_approval: 0.6)\n    - If confidence \u003c require_approval: requires_approval = true\n    - If decision === 'require_approval': requires_approval = true\n- Implement graceful error handling:\n  - If JSON parsing fails:\n    - Return safe fallback (decision: 'require_approval', confidence: 0)\n    - Log parsing error for debugging\n\n## Expected Deliverables\n- parseDecisionResponse() method implemented\n- Validation for all fields\n- Safety check for allowed destinations\n- Confidence-based approval logic\n- Error handling with fallback","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:53:05.40273+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-jbyf","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T22:55:52.610567+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:55:52.73613+01:00","deleted_at":"2026-01-08T22:55:52.73613+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-jd0","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:24:42.832276+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:29.075934+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-06T04:32:29.075934+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-je8a","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:14:41.475679+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:14:41.585151+01:00","deleted_at":"2026-01-07T18:14:41.585151+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-jea5","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T02:51:18.580435+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:51:18.645216+01:00","deleted_at":"2026-01-07T02:51:18.645216+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-jfed","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:30:21.139319+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:30:21.312193+01:00","deleted_at":"2026-01-07T14:30:21.312193+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-jfwsc","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T23:03:54.645355+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:03:54.719876+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-09T23:03:54.719876+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-jhdp","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:54:00.56485+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:54:00.619672+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-06T15:54:00.619672+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-jhujr","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:20:31.310726+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:31.463291+01:00","labels":["label2","label3"],"deleted_at":"2026-01-09T01:20:31.463291+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ji4t","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T03:43:27.530939+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:43:27.575934+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T03:43:27.575934+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-jj2n","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:05:10.285584+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:05:10.472042+01:00","deleted_at":"2026-01-07T19:05:10.472042+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-jl42","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:26:25.560154+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:26:25.6888+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T14:26:25.6888+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-jl79x","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:11:02.475049+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:11:02.551932+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-09T20:11:02.551932+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-jlyc","title":"2.4.6 Execute Decision Agent in Worker Engine","description":"Launch and execute decision agent for dynamic transitions.\n\n## Tasks\n- Extend worker-engine.ts to handle dynamic_decision transitions:\n  - Create executeDecisionAgent() method:\n    - Select agent based on transitionConfig.capability\n    - Get issue details\n    - Build decision instructions\n    - Launch decision agent via OpenCode CLI\n    - Parse decision response\n    - Return resulting PhaseTransition\n- Implementation details:\n  - Select agent: agentRegistry.selectAgent({required_capabilities: [dynamic_agent]})\n  - Build instructions: policyEngine.buildDecisionInstructions(...)\n  - Execute: opencode.runAgentCLI({directory, title, agent: agent.id, message: instructions})\n  - Parse: policyEngine.parseDecisionResponse(result.output, transitionConfig)\n  - Log decision with metadata (capability, confidence, target_phase, requires_approval)\n  - Return PhaseTransition based on decision:\n    - If requires_approval: return {type: 'block', reason}\n    - If target_phase: return {type: 'jump_back' or 'advance', next_phase, reason}\n    - Otherwise: return {type: 'close', reason}\n\n## Expected Deliverables\n- executeDecisionAgent() method implemented\n- Decision agent execution via OpenCode CLI\n- Decision parsing and validation\n- Resulting PhaseTransition generation\n- Decision metadata logging","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:53:05.403795+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-jm7e","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T21:44:08.808243+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:44:08.892075+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T21:44:08.892075+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-jmdk","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:33:43.772628+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:43.843356+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T18:33:43.843356+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-jmja","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T04:53:56.539031+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T04:53:56.590305+01:00","deleted_at":"2026-01-07T04:53:56.590305+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-jnk8","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:40:14.60623+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:40:14.77984+01:00","deleted_at":"2026-01-07T18:40:14.77984+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-jpftr","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:38:37.252903+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:38:37.32532+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-09T01:38:37.32532+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-jq30","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-08T03:57:11.647602+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T03:57:11.723846+01:00","deleted_at":"2026-01-08T03:57:11.723846+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-jqyy","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:51:19.059927+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:51:19.137872+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T02:51:19.137872+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-jrm4f","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:31:29.946133+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:31:30.137341+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-11T00:31:30.137341+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-jrno","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:12:15.661924+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:12:15.792701+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-08T23:12:15.792701+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-js8u2","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T05:10:42.270348+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T05:10:42.335218+01:00","deleted_at":"2026-01-09T05:10:42.335218+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-jv1lf","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:49:37.982537+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:49:38.103557+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T04:49:38.103557+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-jx6i","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T15:02:08.469096+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T15:02:08.534273+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T15:02:08.534273+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-jxsp","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T06:03:27.099926+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T06:03:27.14368+01:00","deleted_at":"2026-01-07T06:03:27.14368+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-jz9pf","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:23:34.881062+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:23:34.999453+01:00","deleted_at":"2026-01-09T01:23:34.999453+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-k0vi","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:54:01.457365+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:54:01.49418+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-06T15:54:01.49418+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-k19gv","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:20:54.589494+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:54.670085+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-09T01:20:54.670085+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-k28","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:35:55.341437+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:35:55.443211+01:00","deleted_at":"2026-01-06T04:35:55.443211+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-k4td","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-06T15:54:00.645609+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:54:00.700818+01:00","deleted_at":"2026-01-06T15:54:00.700818+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-k64u","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:32:18.804016+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:32:18.849263+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T14:32:18.849263+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-k6j","title":"label-workflow-test: Custom workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-06T04:32:29.239713+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:29.299472+01:00","labels":["ashep-workflow:advanced"],"deleted_at":"2026-01-06T04:32:29.299472+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-k6uu4","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T01:20:29.112535+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:29.189282+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-09T01:20:29.189282+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-k77z","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:57:12.802825+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:57:12.878485+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-06T15:57:12.878485+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-k7du","title":"2.3.2 Implement validatePhaseLimits()","description":"Check if phase can be executed based on visit limits.\n\n## Tasks\n- Create validatePhaseLimits(issueId: string, phaseName: string): Promise\u003cboolean\u003e:\n  - Calls getPhaseVisitCount() to check history\n  - Uses configurable max_visits per phase (default 10)\n  - If visitCount \u003e= maxVisits:\n    - Escalate to human when limits exceeded\n    - Trigger HITL with reason about phase visit limit\n    - Return false (block further execution)\n  - Return true (allow execution)\n- Design rationale:\n  - Calls getPhaseVisitCount() to check history\n  - Uses configurable max_visits per phase (default 10)\n  - Triggers HITL when limit exceeded\n  - Blocks further execution of that phase\n  - Human must manually intervene to unblock\n- Add unit tests:\n  - Test phase visit count calculated correctly\n  - Test max_visits enforcement blocks execution\n  - Test HITL triggered when limit exceeded\n  - Test default max_visits = 10 used when not configured\n  - Test per-phase override of max_visits\n\n## Expected Deliverables\n- validatePhaseLimits() method implemented\n- HITL triggering when limits exceeded\n- Phase blocking logic\n- Unit tests for validation","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:51:51.400535+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-k815","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T05:46:20.81085+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:46:20.880335+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T05:46:20.880335+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-k81dk","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:24:03.732022+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:24:03.820099+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T01:24:03.820099+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-k9lp","title":"2.3.5 Cycle Detection","description":"Detect oscillating patterns like develop→test→develop→test.\n\n## Tasks\n- Add detectCycles(issueId: string, cycleLength: number = 3): Promise\u003cboolean\u003e:\n  - Analyzes recent transition sequences\n  - Looks for patterns that reverse themselves (oscillation)\n  - Cycle length 3 catches develop→test→develop patterns\n  - Configurable sensitivity via cycleLength parameter\n- Implementation details:\n  - Get recentDecisions via getDecisionsForIssue(issueId, { limit: 20 })\n  - Extract transition sequence from decision log\n  - Map transitions to \"from→to\" format\n  - Analyze last 10 transitions\n  - Look for A→B→A repeating patterns\n  - If pattern matches its reverse, it's oscillating\n- Design rationale:\n  - Analyzes recent transition sequences\n  - Looks for patterns that reverse themselves (oscillation)\n  - Cycle length 3 catches develop→test→develop patterns\n  - Configurable sensitivity via cycleLength parameter\n  - More sophisticated than simple visit/transition counting\n  - Catches complex loops that single limits miss\n- Add configuration:\n  - cycle_detection_enabled: true\n  - cycle_detection_length: 3 (configurable)\n  - Can tune sensitivity for different workflow types\n\n## Expected Deliverables\n- detectCycles() method implemented\n- Oscillation detection working\n- Configuration for cycle detection","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:52:01.676692+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-kamhh","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:13:53.071898+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:13:53.146781+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-09T01:13:53.146781+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-kbiq2","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:39:41.660922+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:39:41.939442+01:00","deleted_at":"2026-01-09T04:39:41.939442+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-kbmp","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:39:59.445915+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:39:59.516527+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T18:39:59.516527+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-kc6tv","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T04:50:39.816788+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:50:39.922406+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-09T04:50:39.922406+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-kdkhn","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T20:16:32.974754+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:16:33.474979+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T20:16:33.474979+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-kdyd","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T03:57:11.757811+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T03:57:11.862531+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-08T03:57:11.862531+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ke2s","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:33:44.85085+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:44.894381+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T18:33:44.894381+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-kgv6","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-06T15:54:00.47946+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:54:00.536327+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-06T15:54:00.536327+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-kgwg","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:29:38.547721+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:29:38.717785+01:00","deleted_at":"2026-01-07T18:29:38.717785+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-kiia","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:39:59.24349+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:39:59.316224+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T18:39:59.316224+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-kiqxp","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:31:28.866134+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:31:29.066206+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-11T00:31:29.066206+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-kjy7","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:39:10.89593+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:39:10.963492+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T14:39:10.963492+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-kk8n","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:33:22.82473+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:22.912419+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T18:33:22.912419+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-kksng","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:15:33.360741+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:33.486293+01:00","deleted_at":"2026-01-09T01:15:33.486293+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-kktzc","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-10T00:11:56.737264+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T00:11:56.831516+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-10T00:11:56.831516+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-kll9","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:30:21.342533+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:30:21.439419+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T14:30:21.439419+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-kogu","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T16:34:52.174906+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T16:34:52.284602+01:00","deleted_at":"2026-01-07T16:34:52.284602+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-kovs","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T21:44:10.221546+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:44:10.275524+01:00","deleted_at":"2026-01-07T21:44:10.275524+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-kp88","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T05:04:22.841116+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:04:22.905913+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T05:04:22.905913+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-kqki","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:41:59.452257+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:41:59.517016+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T02:41:59.517016+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-kqp","title":"Update cmdQuickstart() with fallback explanation","description":"File: .agent-shepherd/src/cli/index.ts\n\nTask: Add explanation about fallback system to cmdQuickstart() output\n\nRequired Changes:\n\n1. Locate cmdQuickstart() function in src/cli/index.ts\n\n2. After validation runs successfully, add explanation section:\n```\n✓ Agent Shepherd Quickstart Complete!\n\nℹ️  Fallback Agent System\n   Your configuration includes a fallback agent system that allows\n   capabilities without specialized agents to be handled by general agents.\n   \n   This is normal for first-time setup. The following capabilities are using fallback:\n   • testing → Build Agent\n   • review → Build Agent\n   \n   You can customize fallback behavior in .agent-shepherd/config/config.yaml\n```\n\n3. Show which capabilities are using fallback:\n   - Parse validation results for fallback info\n   - Display each capability and its fallback agent\n\n4. Make it clear this is normal for first-time setup:\n   - Add reassurance that fallback usage is expected\n   - Explain that users can add specialized agents later\n   - Reference config-config.md for more details\n\n5. Make the fallback explanation visually distinct:\n   - Use different styling or spacing\n   - Make it stand out from regular output\n\nAcceptance Criteria:\n- [ ] Fallback explanation displayed after quickstart\n- [ ] Shows which capabilities use fallback\n- [ ] Explains that this is normal for first-time setup\n- [ ] Mentions config file location for customization\n- [ ] Output is visually distinct\n- [ ] Message is reassuring to new users","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T02:44:34.381771+01:00","updated_at":"2026-01-05T03:11:24.353857+01:00","closed_at":"2026-01-05T03:11:24.353857+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-kqp","depends_on_id":"agent-shepherd-uj0","type":"parent-child","created_at":"2026-01-05T02:45:00.522143+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-kqsr","title":"2.1.6 Add Unit Tests for Transition Logic","description":"Comprehensive tests for all transition types including jump_back, dynamic_decision, and existing types. Test validation logic, backward compatibility, and edge cases.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-07T00:04:58.028389+01:00","updated_at":"2026-01-07T00:06:15.832092+01:00","deleted_at":"2026-01-07T00:06:15.832092+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-kqvu","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T18:11:45.109199+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:11:45.175131+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T18:11:45.175131+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-krzo","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:39:12.843499+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:39:12.948108+01:00","deleted_at":"2026-01-07T14:39:12.948108+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ksre","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T02:57:17.466656+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T02:57:17.588416+01:00","deleted_at":"2026-01-08T02:57:17.588416+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-kt19","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T05:54:19.979453+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:54:20.071361+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-08T05:54:20.071361+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-kth2a","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T05:10:41.102616+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T05:10:41.395754+01:00","deleted_at":"2026-01-09T05:10:41.395754+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-kuqh","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:03:07.252189+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:03:07.339302+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T19:03:07.339302+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-kut2","title":"2.2.3 Implement Transition Config Parsing","description":"Extend loadPolicies() to parse transitions block for each phase. Add validation for transition config structure and validateTransitionBlock() method.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-07T00:05:18.761974+01:00","updated_at":"2026-01-07T00:06:15.832092+01:00","deleted_at":"2026-01-07T00:06:15.832092+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-kw0u","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T16:34:52.028865+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T16:34:52.071619+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T16:34:52.071619+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-kwiu","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T05:56:19.703369+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:56:19.819116+01:00","deleted_at":"2026-01-08T05:56:19.819116+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-kx0ov","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T01:06:40.725478+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T01:06:40.933944+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-11T01:06:40.933944+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-kxoif","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:16:31.206801+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:16:31.281296+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T20:16:31.281296+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ky9co","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:12:16.382715+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:12:16.458535+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-08T23:12:16.458535+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-kzj8","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T02:57:15.103795+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T02:57:15.232847+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-08T02:57:15.232847+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-kzts","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T14:32:19.097517+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:32:19.524274+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T14:32:19.524274+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-l0493","title":"Agent Shepherd Message Extraction Fix - Implementation Plan","description":"Fix critical bug where agent responses are lost, causing decision agents and phase messaging to receive generic placeholder text instead of actual agent conclusions. Add minimal initial prompt logging while optimizing storage to prevent DB bloat.\n\n## Scratchpad\nAgent Shepherd Message Extraction Fix - Implementation Plan\nOverview\nFix the critical bug where agent responses are lost, causing decision agents and phase messaging to receive generic placeholder text instead of actual agent conclusions. Add minimal initial prompt logging while optimizing storage to prevent DB bloat.\nStep 1: Understand Current Behavior\nWhat: Analyze current message extraction and logging behavior  \nWhy: Establish baseline and confirm the bug exists  \nHow: \n- Review OpenCodeClient.parseRunOutput() method\n- Examine how outcome.message is currently set\n- Check what gets stored in run metadata\n- Verify message.part.updated events are not processed for type: \"text\"\nStep 2: Implement Final Assistant Message Extraction\nWhat: Modify parseRunOutput() to extract text content from assistant message parts  \nWhy: Currently missing agent conclusions needed for decision-making and phase transitions  \nHow:\n- In message.part.updated case, add handling for type: \"text\"\n- Collect text content from final assistant message parts\n- Assemble coherent response and set outcome.message\n- Handle special characters safely for JSON storage\n- Test with sample OpenCode JSONL output\nStep 3: Add Initial Prompt Logging\nWhat: Store phase-specific initial prompt in run metadata  \nWhy: Enable future analysis of agent performance vs. original requirements  \nHow:\n- In WorkerEngine.launchAgent(), capture buildInstructions() output\n- Store as metadata.initial_prompt: string in run record\n- Ensure special characters are handled (JSON escaping)\n- Store immediately after buildInstructions() call, before OpenCode request\nStep 4: Optimize Message Storage\nWhat: Reduce logged data to prevent DB bloat from large sessions  \nWhy: 200k+ token sessions would create massive logs if storing full conversations  \nHow:\n- Keep only: outcome.message, metadata.initial_prompt, session_id, basic metrics\n- Remove: outcome.messages array (full conversation), raw_cli_output, detailed tool calls\n- Consider tool call counts in metrics if easily accessible without performance impact\nStep 5: Handle Special Characters and Edge Cases\nWhat: Ensure prompts and messages with special characters don't break logging  \nWhy: Custom prompts may contain code, quotes, unicode that could corrupt JSON  \nHow:\n- Use proper JSON.stringify() for metadata storage\n- Test with prompts containing: code blocks, quotes, newlines, unicode\n- Handle null/undefined values in message parts\n- Validate JSON parsing doesn't break on malformed content\nStep 6: Update Tests\nWhat: Add tests for message extraction and initial prompt logging  \nWhy: Prevent regressions and ensure reliability  \nHow:\n- Unit tests for parseRunOutput() with text message parts\n- Integration tests for initial prompt storage\n- Test special character handling in prompts/messages\n- Test large prompt scenarios (performance, not truncation)\n- Verify decision agents receive real vs. placeholder messages\nStep 7: Update Documentation\nWhat: Document the message extraction behavior and logging changes  \nWhy: Maintain system understanding and prevent future issues  \nHow:\n- Update docs/opencodel-cli-json-format.md with extraction details\n- Add notes about minimal logging approach\n- Document metadata.initial_prompt field usage\n- Update any API docs mentioning outcome.message content\n- Add troubleshooting notes for message extraction issues\nStep 8: Verify Integration\nWhat: Ensure changes work with existing decision agents and phase messaging  \nWhy: Core functionality depends on meaningful agent responses  \nHow:\n- Test decision agent receives actual conclusions (not \"Task completed by agent\")\n- Verify phase messenger gets real agent summaries\n- Confirm success/failure logic unchanged\n- Test with failed sessions (timeouts, errors) still capture last messages\nSuccess Criteria\n- ✅ outcome.message contains actual agent response text\n- ✅ Initial prompts stored safely per phase\n- ✅ DB storage remains lean (\u003c 50KB per run typical)\n- ✅ Special characters handled without corruption\n- ✅ Decision agents and phase messaging work with real data\n- ✅ No performance degradation on large sessions\nRisk Mitigation\n- Storage bloat: Monitor run metadata sizes, implement compression if needed\n- Parsing errors: Add error handling for malformed message parts\n- Performance: Profile parsing time on large JSONL outputs\n- Backward compatibility: Ensure existing success/failure logic unchanged\nRollback Plan\n- Revert parseRunOutput() changes if parsing becomes unstable\n- Remove initial_prompt logging if storage becomes problematic\n- Keep original minimal logging as fallback\nThis plan prioritizes the core bug fix while being conservative about storage and maintaining system stability. Ready for implementation approval.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-09T19:46:55.864652+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:11:26.74513+01:00","closed_at":"2026-01-09T20:11:26.74513+01:00","close_reason":"Successfully implemented message extraction fix and logging optimization. All 8 subtasks completed: (1) Confirmed bug - outcome.message never set, (2) Extracted text from message.part.updated type 'text' events, (3) Added initial_prompt logging, (4) Optimized storage - removed messages array and raw_cli_output, (5) Handled special characters with type validation and JSON.stringify, (6) Added 12 comprehensive tests, (7) Updated documentation with extraction details and troubleshooting, (8) Verified integration with decision agents and phase messaging. All 525 tests pass."}
{"id":"agent-shepherd-l0493.1","title":"Step 1: Understand Current Behavior","description":"Analyze current message extraction and logging behavior to establish baseline and confirm the bug exists.\n\nHow:\n- Review OpenCodeClient.parseRunOutput() method\n- Examine how outcome.message is currently set\n- Check what gets stored in run metadata\n- Verify message.part.updated events are not processed for type: \"text\"","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T19:46:58.323343+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T19:57:09.749458+01:00","closed_at":"2026-01-09T19:57:09.749458+01:00","close_reason":"Confirmed bug: parseRunOutput() doesn't extract text from message.part.updated events with type 'text', so outcome.message is never set. Falls back to placeholder 'Task completed by agent'. Full messages array and raw CLI output stored causing DB bloat.","dependencies":[{"issue_id":"agent-shepherd-l0493.1","depends_on_id":"agent-shepherd-l0493","type":"parent-child","created_at":"2026-01-09T19:46:58.332584+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-l0493.2","title":"Step 2: Implement Final Assistant Message Extraction","description":"Modify parseRunOutput() to extract text content from assistant message parts. Currently missing agent conclusions needed for decision-making and phase transitions.\n\nHow:\n- In message.part.updated case, add handling for type: \"text\"\n- Collect text content from final assistant message parts\n- Assemble coherent response and set outcome.message\n- Handle special characters safely for JSON storage\n- Test with sample OpenCode JSONL output","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T19:47:00.276715+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T19:58:38.495944+01:00","closed_at":"2026-01-09T19:58:38.495944+01:00","close_reason":"Implemented text extraction from message.part.updated events with type 'text'. Collects text parts for each message ID and assembles final assistant message into outcome.message.","dependencies":[{"issue_id":"agent-shepherd-l0493.2","depends_on_id":"agent-shepherd-l0493","type":"parent-child","created_at":"2026-01-09T19:47:00.283478+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-l0493.3","title":"Step 3: Add Initial Prompt Logging","description":"Store phase-specific initial prompt in run metadata to enable future analysis of agent performance vs. original requirements.\n\nHow:\n- In WorkerEngine.launchAgent(), capture buildInstructions() output\n- Store as metadata.initial_prompt: string in run record\n- Ensure special characters are handled (JSON escaping)\n- Store immediately after buildInstructions() call, before OpenCode request","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T19:47:01.865954+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T19:59:09.999246+01:00","closed_at":"2026-01-09T19:59:09.999246+01:00","close_reason":"Captured initial prompt from buildInstructions() and stored as metadata.initial_prompt in run record. Added before OpenCode request for proper tracking.","dependencies":[{"issue_id":"agent-shepherd-l0493.3","depends_on_id":"agent-shepherd-l0493","type":"parent-child","created_at":"2026-01-09T19:47:01.870052+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-l0493.4","title":"Step 4: Optimize Message Storage","description":"Reduce logged data to prevent DB bloat from large sessions. 200k+ token sessions would create massive logs if storing full conversations.\n\nHow:\n- Keep only: outcome.message, metadata.initial_prompt, session_id, basic metrics\n- Remove: outcome.messages array (full conversation), raw_cli_output, detailed tool calls\n- Consider tool call counts in metrics if easily accessible without performance impact","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T19:47:03.250772+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:00:35.21318+01:00","closed_at":"2026-01-09T20:00:35.21318+01:00","close_reason":"Optimized message storage: removed full messages array and raw_cli_output from metadata, added tool_calls_count to metrics. Keeping only essential data: outcome.message, metadata.initial_prompt, session_id, basic metrics.","dependencies":[{"issue_id":"agent-shepherd-l0493.4","depends_on_id":"agent-shepherd-l0493","type":"parent-child","created_at":"2026-01-09T19:47:03.256661+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-l0493.5","title":"Step 5: Handle Special Characters and Edge Cases","description":"Ensure prompts and messages with special characters don't break logging. Custom prompts may contain code, quotes, unicode that could corrupt JSON.\n\nHow:\n- Use proper JSON.stringify() for metadata storage\n- Test with prompts containing: code blocks, quotes, newlines, unicode\n- Handle null/undefined values in message parts\n- Validate JSON parsing doesn't break on malformed content","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T19:47:05.264336+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:02:06.038585+01:00","closed_at":"2026-01-09T20:02:06.038585+01:00","close_reason":"Special characters and edge cases handled: Added type validation for text content, safeGet() for null/undefined, JSON.stringify() in logging layer handles escaping. Tested with type-check and lint.","dependencies":[{"issue_id":"agent-shepherd-l0493.5","depends_on_id":"agent-shepherd-l0493","type":"parent-child","created_at":"2026-01-09T19:47:05.270085+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-l0493.6","title":"Step 6: Update Tests","description":"Add tests for message extraction and initial prompt logging to prevent regressions and ensure reliability.\n\nHow:\n- Unit tests for parseRunOutput() with text message parts\n- Integration tests for initial prompt storage\n- Test special character handling in prompts/messages\n- Test large prompt scenarios (performance, not truncation)\n- Verify decision agents receive real vs. placeholder messages","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T19:47:06.72039+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:06:53.147165+01:00","closed_at":"2026-01-09T20:06:53.147165+01:00","close_reason":"Added 10 comprehensive tests for text message extraction: single text parts, multiple parts, special characters, unicode, newlines/code blocks, empty handling, message selection, mixed tool/text parts, user message filtering, null/missing handling. Added 2 tests for special characters in worker-engine prompts. All 523 tests pass.","dependencies":[{"issue_id":"agent-shepherd-l0493.6","depends_on_id":"agent-shepherd-l0493","type":"parent-child","created_at":"2026-01-09T19:47:06.724421+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-l0493.7","title":"Step 7: Update Documentation","description":"Document the message extraction behavior and logging changes to maintain system understanding and prevent future issues.\n\nHow:\n- Update docs/opencodel-cli-json-format.md with extraction details\n- Add notes about minimal logging approach\n- Document metadata.initial_prompt field usage\n- Update any API docs mentioning outcome.message content\n- Add troubleshooting notes for message extraction issues","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T19:47:08.191952+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:08:57.625065+01:00","closed_at":"2026-01-09T20:08:57.625065+01:00","close_reason":"Updated opencodel-cli-json-format.md with: message text extraction details, metadata fields mapping, minimal logging approach, validation rules, and comprehensive troubleshooting section covering message extraction issues, special character handling, and database bloat.","dependencies":[{"issue_id":"agent-shepherd-l0493.7","depends_on_id":"agent-shepherd-l0493","type":"parent-child","created_at":"2026-01-09T19:47:08.197298+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-l0493.8","title":"Step 8: Verify Integration","description":"Ensure changes work with existing decision agents and phase messaging. Core functionality depends on meaningful agent responses.\n\nHow:\n- Test decision agent receives actual conclusions (not \"Task completed by agent\")\n- Verify phase messenger gets real agent summaries\n- Confirm success/failure logic unchanged\n- Test with failed sessions (timeouts, errors) still capture last messages","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T19:47:09.710403+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:11:20.728908+01:00","closed_at":"2026-01-09T20:11:20.728908+01:00","close_reason":"Verified integration: Decision agents receive actual conclusions via outcome.message (verified via decision-builder.ts:169), phase messenger gets real summaries (worker-engine.ts:333), success/failure logic unchanged (outcome.success used independently), failed sessions capture last messages (tested). All 525 tests pass.","dependencies":[{"issue_id":"agent-shepherd-l0493.8","depends_on_id":"agent-shepherd-l0493","type":"parent-child","created_at":"2026-01-09T19:47:09.715551+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-l0g","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:24:43.077719+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:28.913448+01:00","deleted_at":"2026-01-06T04:32:28.913448+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-l0q","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-06T04:32:29.606303+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:29.671256+01:00","deleted_at":"2026-01-06T04:32:29.671256+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-l2yl","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:26:24.140068+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:26:24.206472+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T14:26:24.206472+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-l4co6","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-10T00:11:55.882761+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T00:11:55.952527+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-10T00:11:55.952527+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-l4gh","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:59:43.375683+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:59:43.458685+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T02:59:43.458685+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-l4gu3","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:39:40.692003+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:39:40.836291+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-09T04:39:40.836291+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-l4qvv","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:46:38.324039+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:46:38.397656+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-09T20:46:38.397656+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-l4yi","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:44:00.541432+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:44:00.641196+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T02:44:00.641196+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-l51v","title":"2.2.1 Extend PhaseConfig Interface","description":"Add optional transitions block to PhaseConfig interface.\n\n## Tasks\n- Add transitions?: TransitionBlock field to PhaseConfig in policy.ts (line 12)\n- Design TransitionBlock interface:\n  - on_success?: string | TransitionConfig - Direct jump or AI config\n  - on_failure?: string | TransitionConfig\n  - on_partial_success?: TransitionConfig - Only object, no string\n  - on_unclear?: TransitionConfig\n- Design TransitionConfig interface:\n  - capability: string - Decision agent capability (e.g., \"test-decision\")\n  - prompt: string - Decision instructions for agent\n  - allowed_destinations: string[] - Valid phases to jump to\n  - messaging?: boolean - Enable phase messenger for complex data exchange\n  - confidence_thresholds?: {auto_advance: number, require_approval: number}\n- Key design decisions:\n  - transitions is optional - phases without it use default linear behavior\n  - on_success/on_failure can be string (direct jump) OR object (AI decision)\n  - on_partial_success/on_unclear must be object (always AI decision)\n  - allowed_destinations provides safety constraint\n  - messaging flag enables phase messenger for complex data exchange\n  - confidence_thresholds enable automatic vs manual routing\n\n## Expected Deliverables\n- Extended PhaseConfig interface with transitions field\n- TransitionBlock interface definition\n- TransitionConfig interface definition\n- Documentation of design decisions","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:51:25.245126+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-l7ec","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T22:55:50.424361+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:55:50.49619+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-08T22:55:50.49619+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-l7zqh","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T23:03:54.151089+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:03:54.224119+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-09T23:03:54.224119+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-l81h4","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:17:06.426721+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:17:06.56564+01:00","labels":["label2","label3"],"deleted_at":"2026-01-08T23:17:06.56564+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-l8tk","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T18:40:00.84876+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:40:01.298244+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T18:40:01.298244+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-l8xh","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T05:04:23.641755+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:04:23.710922+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T05:04:23.710922+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-l97","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:32:29.915056+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:29.978177+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-06T04:32:29.978177+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-l97v","title":"2.3.7 Configuration for Loop Prevention","description":"Add configuration for loop prevention settings.\n\n## Tasks\n- Add loop_prevention section to config/config.yaml:\n  - enabled: true - Master switch\n  - max_visits_default: 10 - Default limit for phase visits\n  - max_transitions_default: 5 - Default limit for specific transitions\n  - cycle_detection_enabled: true - Enable cycle detection\n  - cycle_detection_length: 3 - Sensitivity for pattern detection\n  - trigger_hitl: true - Automatically trigger HITL when limits exceeded\n- Allow per-phase override via PhaseConfig:\n  - max_visits: 20 - Override default for specific phases\n- Document configuration options:\n  - enabled: Enable/disable loop prevention\n  - max_visits_default: Default limit for phase visits\n  - max_transitions_default: Default limit for specific transitions\n  - cycle_detection_enabled: Enable cycle detection\n  - cycle_detection_length: Sensitivity for pattern detection\n  - trigger_hitl: Automatically trigger HITL when limits exceeded\n\n## Expected Deliverables\n- loop_prevention configuration added to config.yaml\n- Per-phase max_visits override support\n- Configuration options documented","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:52:01.689611+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-l9rl","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:35:17.232618+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:35:17.294699+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-06T23:35:17.294699+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-lass","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T15:02:09.413896+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T15:02:09.478898+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T15:02:09.478898+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-lbgy","title":"2.5.1 Standardize Prompt Templates","description":"Create prompt templates for each decision context.\n\n## Tasks\n- Create prompt templates for each decision context:\n  - test-decision template:\n    - Analyze test results and decide next step\n    - Considerations: test failures (code vs test issues), coverage, flaky tests\n    - Options: fix_code, fix_tests, proceed, require_approval\n  - validation-decision template:\n    - Evaluate validation results and quality metrics\n    - Considerations: requirements met, critical issues, code quality\n    - Options: approve, iterate, block\n  - complex-decision template:\n    - Analyze complete workflow context\n    - Considerations: phase outcome, overall progress, constraints, alternatives\n    - Make recommendation based on comprehensive analysis\n- Store templates in config/decision-prompts.yaml:\n  - Support variable substitution: {{issue.title}}, {{phase.name}}, etc.\n  - Use template syntax: Handlebars-like {{variable}} format\n  - Provide sections for each decision type\n- Support variable substitution:\n  - {{issue.title}} - Issue title\n  - {{phase.name}} - Current phase name\n  - {{outcome.message}} - Previous outcome message\n  - {{allowed_destinations}} - Array of allowed next phases\n\n## Expected Deliverables\n- Prompt templates created for all decision contexts\n- Templates stored in config/decision-prompts.yaml\n  - Variable substitution system implemented\n  - Template syntax working","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:53:23.397432+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-lbq0t","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T01:06:45.048031+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T01:06:45.394357+01:00","labels":["label2","label3"],"deleted_at":"2026-01-11T01:06:45.394357+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-lg5p8","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:39:42.208397+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:39:42.377462+01:00","deleted_at":"2026-01-09T04:39:42.377462+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-lgoy","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T05:04:23.505439+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:04:23.609445+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T05:04:23.609445+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-lhyc","title":"2.5.4 Implement Response Validation","description":"Validate decision agent responses against schema.\n\n## Tasks\n- Implement validateDecisionResponse() function:\n  - Takes parsed JSON object and TransitionConfig\n  - Throws error if validation fails\n- Validate JSON structure:\n  - Validate required fields exist:\n    - Check parsed.decision exists\n    - Check parsed.reasoning exists\n    - Throw error: \"Missing required field: decision\" or \"reasoning\"\n  - Validate confidence field if present:\n    - Check typeof parsed.confidence === 'number'\n    - Check 0.0 \u003c= parsed.confidence \u003c= 1.0\n    - Throw error: \"Field 'confidence' must be between 0.0 and 1.0\"\n- Validate action format:\n  - Valid actions: 'jump_to_X', 'advance_to_X', 'require_approval'\n  - Check if parsed.decision starts with valid prefix or equals 'require_approval'\n  - Throw error with expected format if invalid\n- Validate target phase if specified:\n  - Extract targetPhase from action (after jump_to_ or advance_to_)\n  - Check if targetPhase in transitionConfig.allowed_destinations\n  - Throw error: \"Invalid target phase: [target]. Allowed: [destinations]\"\n- Return detailed validation errors:\n  - Field name\n  - Expected format\n  - Actual value\n  - Suggested fix\n\n## Expected Deliverables\n- validateDecisionResponse() function implemented\n  - All validation checks working\n  - Detailed error messages returned","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:53:38.084863+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-lhyq","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:31:18.12665+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:31:18.194947+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T18:31:18.194947+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-lix4","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T21:46:04.154071+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:46:04.208109+01:00","deleted_at":"2026-01-07T21:46:04.208109+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ljbx","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:32:17.776695+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:32:17.84074+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T14:32:17.84074+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ljelx","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T23:03:54.507191+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:03:54.610651+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-09T23:03:54.610651+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-lm0mh","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:20:29.579002+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:29.652842+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-09T01:20:29.652842+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-lnnhf","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:15:31.81938+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:31.922652+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-09T01:15:31.922652+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-lnpt","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:57:12.631968+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:57:12.689709+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-06T15:57:12.689709+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-lpac","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-06T23:28:07.241254+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:28:07.309339+01:00","deleted_at":"2026-01-06T23:28:07.309339+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-lpmp","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T22:07:38.481393+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T22:07:38.661808+01:00","deleted_at":"2026-01-07T22:07:38.661808+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-lpq3t","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-11T00:08:11.639855+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:08:12.655665+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-11T00:08:12.655665+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-lq9yb","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:13:52.933233+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:13:53.036342+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-09T01:13:53.036342+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-lqhsa","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-08T23:43:40.911567+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:43:40.983637+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-08T23:43:40.983637+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-ls6aj","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T01:24:03.856763+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:24:03.930817+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-09T01:24:03.930817+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-lsp9","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:58:05.232283+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:58:05.315565+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-06T15:58:05.315565+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-lsz8c","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:15:31.957609+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:32.030813+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-09T01:15:32.030813+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-lt8a","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:57:14.404389+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:57:14.500657+01:00","deleted_at":"2026-01-06T15:57:14.500657+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-lt96","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T02:57:17.290871+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T02:57:17.433203+01:00","labels":["label2","label3"],"deleted_at":"2026-01-08T02:57:17.433203+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-lttm","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T04:53:56.449921+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T04:53:56.499693+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T04:53:56.499693+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-lungf","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:15:58.058322+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:58.159487+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-09T01:15:58.159487+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-lvw","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-06T04:34:13.547414+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:13.605596+01:00","deleted_at":"2026-01-06T04:34:13.605596+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-lx838","title":"Extend Agent Shepherd with Workflow Files","description":"Extend agent-shepherd to support individual workflow files for better maintainability of complex workflows. Currently, all workflows are defined in a single large config/policies.yaml file, making it hard to manage complex workflows with embedded prompts and transitions.\n\n## Scratchpad\nGoal: Extend agent-shepherd to support individual workflow files for better maintainability of complex workflows. Currently, all workflows are defined in a single large config/policies.yaml file, making it hard to manage complex workflows with embedded prompts and transitions.\n\nWhy:\n- Scalability: Complex workflows like \"enhanced-dev\" (100+ lines) make policies.yaml unwieldy\n- Maintainability: Separate files allow focused editing without touching unrelated workflows  \n- Organization: Users can organize workflows in folders for large numbers of workflows\n- Backward Compatibility: Existing setups continue working unchanged\n- Flexibility: Simple workflows stay in policies.yaml, complex ones get dedicated files\n\nWhat:\n- Add workflows/enabled/ directory for individual workflow YAML files\n- Add workflows/available/ directory for workflow storage (not loaded)\n- Modify policy loading to scan workflows/enabled/ recursively\n- Maintain same schema for workflow files as policies.yaml entries\n- Add CLI commands for workflow management\n- Update validation, tests, and documentation\n\nHow (Technical Approach)\nDirectory Structure\n.agent-shepherd/\n├── config/policies.yaml  # Unchanged - simple workflows + default_policy\n└── workflows/\n    ├── enabled/         # NEW: Loaded workflow files (recursive)\n    │   └── [nested organization allowed]\n    └── available/       # NEW: Storage only (ignored by system)\n\nLoading Logic\n1. Load policies.yaml as before\n2. Recursively scan workflows/enabled/*.yaml \n3. Each file contains one policy (same schema as policies.yaml entries)\n4. Add to policies map with precedence: policies.yaml wins on conflicts\n5. workflows/available/ ignored completely\n\nSchema\nWorkflow files use identical schema to policies.yaml policy entries:\nname: my-workflow\ndescription: Complex workflow description\nactive: true\nphases:\n  - name: phase1\n    # ... full phase config\nretry:\n  # ... retry config\n# etc.\n\nImplementation Steps\n1. Core Changes\n- File: .agent-shepherd/src/core/policy.ts\n  - Add getWorkflowsPath() utility function\n  - Modify PolicyEngine.loadPolicies() to scan workflows/enabled/ recursively\n  - Add validation for individual workflow files\n  - Handle precedence (policies.yaml \u003e workflow files)\n- File: .agent-shepherd/src/core/path-utils.ts (if exists)\n  - Add workflow path utilities if not already present\n\n2. CLI Commands\n- File: .agent-shepherd/src/cli/index.ts\n  - Add ashep workflow list - List all workflows (policies + enabled/)\n  - Add ashep workflow archive \u003cname\u003e - Move workflow from enabled/ to available/\n  - Add ashep workflow activate \u003cname\u003e - Move workflow from available/ to enabled/\n  - Add ashep workflow create \u003cname\u003e - Create new workflow file template\n\n3. Configuration \u0026 Validation\n- File: .agent-shepherd/schemas/policies.schema.json\n  - Ensure schema works for individual files (should already, as it's per-policy)\n- File: .agent-shepherd/src/core/config-validator.ts\n  - Update to validate individual workflow files in enabled/\n\n4. UI Updates\n- File: .agent-shepherd/src/ui/ui-server.ts\n  - Update /api/policies endpoint to include workflows from enabled/\n\n5. Tests\n- File: .agent-shepherd/tests/policy-engine.test.ts\n  - Add tests for loading workflows from enabled/ directory\n  - Add tests for recursive scanning\n  - Add tests for precedence (policies.yaml wins)\n  - Add tests for invalid workflow files\n  - Add tests for available/ being ignored\n- File: .agent-shepherd/tests/cli-integration.test.ts\n  - Add tests for new workflow CLI commands\n\n6. Documentation Updates\n- File: .agent-shepherd/docs/policies-config.md\n  - Add section on workflow files\n  - Document enabled/ vs available/ folders\n  - Document precedence rules\n  - Add examples of moving complex workflows to files\n- File: .agent-shepherd/docs/cli-reference.md\n  - Document new workflow CLI commands\n- File: .agent-shepherd/README.md\n  - Brief mention of workflow file support\n- File: .agent-shepherd/AGENTS.md\n  - Update architecture section to mention workflow files\n\nEdge Cases \u0026 Considerations\n- Precedence: Document that policies.yaml takes precedence on name conflicts\n- Copy-paste: Users can copy policy entries to workflow files (active flag preserved)\n- Nested folders: Allow unlimited nesting under enabled/ for organization\n- Migration: No automatic migration - users manually move complex workflows\n- Validation: Same validation rules apply to workflow files as policies.yaml entries\n- Performance: Recursive scanning should be fine (workflows are not high-frequency)\n\nTesting Strategy\n- Unit tests for loading logic\n- Integration tests for CLI commands\n- End-to-end tests with actual workflow files\n- Regression tests to ensure policies.yaml still works\n- Test precedence behavior\n- Test invalid file handling\n\nRollout Plan\n1. Implement core loading logic\n2. Add CLI commands  \n3. Update validation\n4. Add comprehensive tests\n5. Update documentation\n6. Test with complex workflows from policies.yaml\n7. Release with backward compatibility note\n\nThis plan maintains full backward compatibility while enabling the requested extensibility.\n\nWhen assigned this epic, consume the overall context and select the next available child issue to work on, rather than working on the epic directly.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-09T02:25:14.17114+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:14.17114+01:00"}
{"id":"agent-shepherd-lx838.1","title":"Implement Core Changes for Workflow Files","description":"Implement the core changes to support loading workflow files from workflows/enabled/ directory.\n\nSubtasks:\n- Add getWorkflowsPath() utility function in .agent-shepherd/src/core/policy.ts\n- Modify PolicyEngine.loadPolicies() to scan workflows/enabled/ recursively\n- Add validation for individual workflow files\n- Handle precedence (policies.yaml \u003e workflow files)\n- Add workflow path utilities in .agent-shepherd/src/core/path-utils.ts if not already present","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:16.70892+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:16.70892+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.1","depends_on_id":"agent-shepherd-lx838","type":"parent-child","created_at":"2026-01-09T02:25:16.72833+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.1.1","title":"Add getWorkflowsPath() utility function in policy.ts","description":"Add a utility function getWorkflowsPath() to .agent-shepherd/src/core/policy.ts that returns the path to the workflows directory.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:18.138539+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:18.138539+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.1.1","depends_on_id":"agent-shepherd-lx838.1","type":"parent-child","created_at":"2026-01-09T02:25:18.146508+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.1.2","title":"Modify PolicyEngine.loadPolicies() to scan workflows/enabled/ recursively","description":"Update the PolicyEngine.loadPolicies() method to recursively scan the workflows/enabled/ directory for YAML files and load them as policies.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:19.46743+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:19.46743+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.1.2","depends_on_id":"agent-shepherd-lx838.1","type":"parent-child","created_at":"2026-01-09T02:25:19.475208+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.1.3","title":"Add validation for individual workflow files","description":"Add validation logic to ensure individual workflow files in workflows/enabled/ conform to the expected schema.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:20.552946+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:20.552946+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.1.3","depends_on_id":"agent-shepherd-lx838.1","type":"parent-child","created_at":"2026-01-09T02:25:20.557573+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.1.4","title":"Handle precedence (policies.yaml \u003e workflow files)","description":"Implement logic to ensure that policies defined in config/policies.yaml take precedence over those in workflow files when there are name conflicts.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:22.05153+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:22.05153+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.1.4","depends_on_id":"agent-shepherd-lx838.1","type":"parent-child","created_at":"2026-01-09T02:25:22.057768+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.1.5","title":"Add workflow path utilities in path-utils.ts if not already present","description":"Check if .agent-shepherd/src/core/path-utils.ts exists and add workflow-related path utilities if not already present.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:23.077976+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:23.077976+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.1.5","depends_on_id":"agent-shepherd-lx838.1","type":"parent-child","created_at":"2026-01-09T02:25:23.082607+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.2","title":"Implement CLI Commands for Workflow Management","description":"Add new CLI commands to .agent-shepherd/src/cli/index.ts for managing workflow files.\n\nSubtasks:\n- Add ashep workflow list - List all workflows (policies + enabled/)\n- Add ashep workflow archive \u003cname\u003e - Move workflow from enabled/ to available/\n- Add ashep workflow activate \u003cname\u003e - Move workflow from available/ to enabled/\n- Add ashep workflow create \u003cname\u003e - Create new workflow file template","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:24.666567+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:24.666567+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.2","depends_on_id":"agent-shepherd-lx838","type":"parent-child","created_at":"2026-01-09T02:25:24.674553+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.2.1","title":"Add ashep workflow list command","description":"Implement the 'ashep workflow list' command to list all workflows from both policies.yaml and workflows/enabled/ directory.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:25.709956+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:25.709956+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.2.1","depends_on_id":"agent-shepherd-lx838.2","type":"parent-child","created_at":"2026-01-09T02:25:25.715355+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.2.2","title":"Add ashep workflow archive \u003cname\u003e command","description":"Implement the 'ashep workflow archive \u003cname\u003e' command to move a workflow file from workflows/enabled/ to workflows/available/.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:26.869041+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:26.869041+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.2.2","depends_on_id":"agent-shepherd-lx838.2","type":"parent-child","created_at":"2026-01-09T02:25:26.874736+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.2.3","title":"Add ashep workflow activate \u003cname\u003e command","description":"Implement the 'ashep workflow activate \u003cname\u003e' command to move a workflow file from workflows/available/ to workflows/enabled/.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:27.97717+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:27.97717+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.2.3","depends_on_id":"agent-shepherd-lx838.2","type":"parent-child","created_at":"2026-01-09T02:25:27.981518+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.2.4","title":"Add ashep workflow create \u003cname\u003e command","description":"Implement the 'ashep workflow create \u003cname\u003e' command to create a new workflow file template in workflows/enabled/.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:29.251347+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:29.251347+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.2.4","depends_on_id":"agent-shepherd-lx838.2","type":"parent-child","created_at":"2026-01-09T02:25:29.256238+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.3","title":"Update Configuration and Validation for Workflow Files","description":"Update configuration validation to support individual workflow files.\n\nSubtasks:\n- Ensure schema in .agent-shepherd/schemas/policies.schema.json works for individual files\n- Update .agent-shepherd/src/core/config-validator.ts to validate individual workflow files in enabled/","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:30.5165+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:30.5165+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.3","depends_on_id":"agent-shepherd-lx838","type":"parent-child","created_at":"2026-01-09T02:25:30.521173+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.3.1","title":"Ensure policies.schema.json works for individual workflow files","description":"Verify that the schema in .agent-shepherd/schemas/policies.schema.json is compatible with individual workflow files (it should be, as it's per-policy).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:31.657631+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:31.657631+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.3.1","depends_on_id":"agent-shepherd-lx838.3","type":"parent-child","created_at":"2026-01-09T02:25:31.661185+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.3.2","title":"Update config-validator.ts to validate workflow files in enabled/","description":"Modify .agent-shepherd/src/core/config-validator.ts to include validation of individual workflow files in the workflows/enabled/ directory.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:32.77331+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:32.77331+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.3.2","depends_on_id":"agent-shepherd-lx838.3","type":"parent-child","created_at":"2026-01-09T02:25:32.777968+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.4","title":"Update UI to Support Workflow Files","description":"Update the UI server to include workflow files in the policies API endpoint.\n\nSubtasks:\n- Update /api/policies endpoint in .agent-shepherd/src/ui/ui-server.ts to include workflows from enabled/","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:34.193249+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:34.193249+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.4","depends_on_id":"agent-shepherd-lx838","type":"parent-child","created_at":"2026-01-09T02:25:34.197843+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.4.1","title":"Update /api/policies endpoint to include workflows from enabled/","description":"Modify the /api/policies endpoint in .agent-shepherd/src/ui/ui-server.ts to return policies from both policies.yaml and workflow files in enabled/.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:35.433629+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:35.433629+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.4.1","depends_on_id":"agent-shepherd-lx838.4","type":"parent-child","created_at":"2026-01-09T02:25:35.437463+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.5","title":"Add Comprehensive Tests for Workflow Files","description":"Add unit and integration tests for the workflow files functionality.\n\nSubtasks:\n- Add tests for loading workflows from enabled/ directory in policy-engine.test.ts\n- Add tests for recursive scanning in policy-engine.test.ts\n- Add tests for precedence (policies.yaml wins) in policy-engine.test.ts\n- Add tests for invalid workflow files in policy-engine.test.ts\n- Add tests for available/ being ignored in policy-engine.test.ts\n- Add tests for new workflow CLI commands in cli-integration.test.ts","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:37.016299+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:37.016299+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.5","depends_on_id":"agent-shepherd-lx838","type":"parent-child","created_at":"2026-01-09T02:25:37.021362+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.5.1","title":"Add tests for loading workflows from enabled/ directory","description":"Add unit tests in .agent-shepherd/tests/policy-engine.test.ts for loading workflow files from the enabled/ directory.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:38.370878+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:38.370878+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.5.1","depends_on_id":"agent-shepherd-lx838.5","type":"parent-child","created_at":"2026-01-09T02:25:38.375119+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.5.2","title":"Add tests for recursive scanning","description":"Add unit tests in .agent-shepherd/tests/policy-engine.test.ts for recursive scanning of nested directories in workflows/enabled/.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:39.670001+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:39.670001+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.5.2","depends_on_id":"agent-shepherd-lx838.5","type":"parent-child","created_at":"2026-01-09T02:25:39.67415+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.5.3","title":"Add tests for precedence (policies.yaml wins)","description":"Add unit tests in .agent-shepherd/tests/policy-engine.test.ts to verify that policies.yaml takes precedence over workflow files on name conflicts.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:40.788068+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:40.788068+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.5.3","depends_on_id":"agent-shepherd-lx838.5","type":"parent-child","created_at":"2026-01-09T02:25:40.793986+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.5.4","title":"Add tests for invalid workflow files","description":"Add unit tests in .agent-shepherd/tests/policy-engine.test.ts for handling invalid workflow files (malformed YAML, schema violations).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:42.155094+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:42.155094+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.5.4","depends_on_id":"agent-shepherd-lx838.5","type":"parent-child","created_at":"2026-01-09T02:25:42.158656+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.5.5","title":"Add tests for available/ being ignored","description":"Add unit tests in .agent-shepherd/tests/policy-engine.test.ts to ensure workflows in available/ directory are not loaded.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:43.344036+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:43.344036+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.5.5","depends_on_id":"agent-shepherd-lx838.5","type":"parent-child","created_at":"2026-01-09T02:25:43.349707+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.5.6","title":"Add tests for new workflow CLI commands","description":"Add integration tests in .agent-shepherd/tests/cli-integration.test.ts for the new workflow CLI commands (list, archive, activate, create).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:44.49492+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:44.49492+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.5.6","depends_on_id":"agent-shepherd-lx838.5","type":"parent-child","created_at":"2026-01-09T02:25:44.501579+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.6","title":"Update Documentation for Workflow Files","description":"Update all relevant documentation to reflect the new workflow files feature.\n\nSubtasks:\n- Add section on workflow files to .agent-shepherd/docs/policies-config.md\n- Document enabled/ vs available/ folders in policies-config.md\n- Document precedence rules in policies-config.md\n- Add examples of moving complex workflows to files in policies-config.md\n- Document new workflow CLI commands in .agent-shepherd/docs/cli-reference.md\n- Brief mention of workflow file support in .agent-shepherd/README.md\n- Update architecture section in .agent-shepherd/AGENTS.md to mention workflow files","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:46.495587+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:46.495587+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.6","depends_on_id":"agent-shepherd-lx838","type":"parent-child","created_at":"2026-01-09T02:25:46.502651+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.6.1","title":"Add section on workflow files to docs/policies-config.md","description":"Add a new section to .agent-shepherd/docs/policies-config.md explaining the workflow files feature.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:47.618389+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:47.618389+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.6.1","depends_on_id":"agent-shepherd-lx838.6","type":"parent-child","created_at":"2026-01-09T02:25:47.623426+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.6.2","title":"Document enabled/ vs available/ folders","description":"Document the difference between workflows/enabled/ and workflows/available/ directories in docs/policies-config.md.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:49.083311+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:49.083311+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.6.2","depends_on_id":"agent-shepherd-lx838.6","type":"parent-child","created_at":"2026-01-09T02:25:49.087208+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.6.3","title":"Document precedence rules","description":"Document the precedence rules (policies.yaml wins over workflow files) in docs/policies-config.md.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:50.443607+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:50.443607+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.6.3","depends_on_id":"agent-shepherd-lx838.6","type":"parent-child","created_at":"2026-01-09T02:25:50.447216+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.6.4","title":"Add examples of moving complex workflows to files","description":"Add examples in docs/policies-config.md showing how to move complex workflows from policies.yaml to individual files.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:51.692736+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:51.692736+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.6.4","depends_on_id":"agent-shepherd-lx838.6","type":"parent-child","created_at":"2026-01-09T02:25:51.696526+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.6.5","title":"Document new workflow CLI commands in docs/cli-reference.md","description":"Add documentation for the new workflow CLI commands (list, archive, activate, create) in .agent-shepherd/docs/cli-reference.md.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:54.679436+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:54.679436+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.6.5","depends_on_id":"agent-shepherd-lx838.6","type":"parent-child","created_at":"2026-01-09T02:25:54.683366+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.6.6","title":"Brief mention of workflow file support in README.md","description":"Add a brief mention of workflow file support in .agent-shepherd/README.md.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:55.908049+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:55.908049+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.6.6","depends_on_id":"agent-shepherd-lx838.6","type":"parent-child","created_at":"2026-01-09T02:25:55.912126+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lx838.6.7","title":"Update architecture section in AGENTS.md to mention workflow files","description":"Update the architecture section in .agent-shepherd/AGENTS.md to mention the new workflow files feature.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T02:25:57.128289+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T02:25:57.128289+01:00","dependencies":[{"issue_id":"agent-shepherd-lx838.6.7","depends_on_id":"agent-shepherd-lx838.6","type":"parent-child","created_at":"2026-01-09T02:25:57.132867+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-lxgk","title":"2.4.9 Add Confidence Threshold Configuration","description":"Allow configuration of confidence thresholds.\n\n## Tasks\n- Extend TransitionConfig with confidence thresholds:\n  - confidence_thresholds?: {\n      auto_advance: number,      // High confidence allows automatic progression\n      require_approval: number    // Medium confidence triggers review\n    }\n- Implement confidence-based auto-approval logic:\n  - If confidence \u003e= auto_advance: Automatic progression (no HITL)\n  - If confidence \u003e= require_approval and \u003c auto_advance: Require approval\n  - If confidence \u003c require_approval: Require approval with warning\n- Test confidence thresholds at various levels:\n  - Test high confidence (0.9) allows automatic progression\n  - Test medium confidence (0.7) requires approval\n  - Test low confidence (0.3) requires approval with warning\n  - Test missing confidence defaults to 0.5 (middle ground)\n- Add configuration examples:\n  - transitions:\n      on_success:\n        capability: test-decision\n        confidence_thresholds:\n          auto_advance: 0.8    # High bar for auto-approval\n          require_approval: 0.6 # Medium bar triggers review\n\n## Expected Deliverables\n- confidence_thresholds field added to TransitionConfig\n- Auto-approval logic implemented\n- Tests for various confidence levels\n- Configuration examples provided","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:53:10.250617+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-lxh5","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-08T02:57:15.482301+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T02:57:15.556422+01:00","deleted_at":"2026-01-08T02:57:15.556422+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-ly58","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:31:17.835689+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:31:17.897532+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T18:31:17.897532+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-lzvg","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T05:54:20.819187+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:54:20.860563+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-08T05:54:20.860563+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-m0i","title":"Phase 4: Phase \u0026 HITL Tracking","description":"**Effort:** ~6 hours | **Risk:** Medium\n\nTrack workflow phases and human-in-the-loop states via labels.\n\n## Tasks\n\n1. Implement `setPhaseLabel(issueId, phaseName)` function in beads.ts\n2. Implement `removePhaseLabels(issueId)` helper in beads.ts\n3. Implement `setHITLLabel(issueId, reason)` function in beads.ts\n4. Implement `clearHITLLabels(issueId)` function in beads.ts\n5. Implement `validateHITLReason(reason, config)` function in policy.ts\n6. Update `processIssue()` in worker-engine.ts to read phase labels and resume from current phase\n7. Update `applyTransition()` to manage phase labels on transitions\n8. Update `applyTransition()` to set/clear HITL labels\n9. Add approval note generation when HITL triggered\n10. Write unit tests for phase and HITL tracking\n\n## Files Modified\n- `.agent-shepherd/src/core/beads.ts`\n- `.agent-shepherd/src/core/policy.ts`\n- `.agent-shepherd/src/core/worker-engine.ts`\n- `tests/phase-tracking.test.ts` (new file)\n- `tests/hitl-tracking.test.ts` (new file)\n\n## Acceptance Criteria\n- [ ] setPhaseLabel() sets correct label format\n- [ ] removePhaseLabels() removes all phase labels\n- [ ] setHITLLabel() sets correct label format\n- [ ] clearHITLLabels() removes all HITL labels\n- [ ] validateHITLReason() validates predefined reasons\n- [ ] validateHITLReason() validates custom reasons based on config\n- [ ] processIssue() reads phase label and resumes correctly\n- [ ] applyTransition() updates phase label on advance\n- [ ] applyTransition() keeps phase label on retry\n- [ ] applyTransition() sets HITL label on approval block\n- [ ] applyTransition() removes all tracking labels on close\n- [ ] Approval note generated when HITL triggered\n- [ ] All unit tests passing\n\n## Code Preview (beads.ts - Phase functions)\n```typescript\nasync function setPhaseLabel(issueId: string, phaseName: string): Promise\u003cvoid\u003e {\n  await removePhaseLabels(issueId);\n  const phaseLabel = `ashep-phase:${phaseName}`;\n  await execBeadsCommand([\"update\", issueId, \"--add-label\", phaseLabel]);\n  console.log(`Set phase label: ${phaseLabel}`);\n}\n\nasync function removePhaseLabels(issueId: string): Promise\u003cvoid\u003e {\n  const labels = await getIssueLabels(issueId);\n  const phaseLabels = labels.filter(l =\u003e l.startsWith('ashep-phase:'));\n  \n  for (const label of phaseLabels) {\n    try {\n      await execBeadsCommand([\"update\", issueId, \"--remove-label\", label]);\n    } catch (error) {\n      if (!error.message.includes(\"not found\")) {\n        throw error;\n      }\n    }\n  }\n}\n```\n\n## Code Preview (beads.ts - HITL functions)\n```typescript\nasync function setHITLLabel(issueId: string, reason: string): Promise\u003cvoid\u003e {\n  const hitlLabel = `ashep-hitl:${reason}`;\n  await execBeadsCommand([\"update\", issueId, \"--add-label\", hitlLabel]);\n  console.log(`Set HITL label: ${hitlLabel}`);\n}\n\nasync function clearHITLLabels(issueId: string): Promise\u003cvoid\u003e {\n  const labels = await getIssueLabels(issueId);\n  const hitlLabels = labels.filter(l =\u003e l.startsWith('ashep-hitl:'));\n  \n  for (const label of hitlLabels) {\n    try {\n      await execBeadsCommand([\"update\", issueId, \"--remove-label\", label]);\n    } catch (error) {\n      if (!error.message.includes(\"not found\")) {\n        throw error;\n      }\n    }\n  }\n  \n  console.log(`Cleared ${hitlLabels.length} HITL labels`);\n}\n```","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T17:09:06.558814+01:00","updated_at":"2026-01-05T17:22:57.927176+01:00","close_reason":"Removed as requested by user","dependencies":[{"issue_id":"agent-shepherd-m0i","depends_on_id":"agent-shepherd-3of","type":"parent-child","created_at":"2026-01-05T17:09:11.624187+01:00","created_by":"daemon"},{"issue_id":"agent-shepherd-m0i","depends_on_id":"agent-shepherd-eaf","type":"blocks","created_at":"2026-01-05T17:10:11.320976+01:00","created_by":"daemon"}],"deleted_at":"2026-01-05T17:22:57.927176+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-m2n9o","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-10T00:11:56.517982+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T00:11:56.705469+01:00","deleted_at":"2026-01-10T00:11:56.705469+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-m2v","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:24:43.110476+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:28.893644+01:00","deleted_at":"2026-01-06T04:32:28.893644+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-m37f6","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:15:59.176776+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:59.228054+01:00","deleted_at":"2026-01-09T01:15:59.228054+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-m3i9","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T18:31:19.190667+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:31:19.594557+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T18:31:19.594557+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-m3rm","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-08T05:54:21.104267+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:54:21.528436+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-08T05:54:21.528436+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-m4g3","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:11:46.652437+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:11:46.709372+01:00","deleted_at":"2026-01-07T18:11:46.709372+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-m5xcc","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T23:23:27.62255+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:23:27.802121+01:00","deleted_at":"2026-01-09T23:23:27.802121+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-m7bl","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:44:00.324494+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:44:00.509656+01:00","deleted_at":"2026-01-07T02:44:00.509656+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-m7bo6","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:49:41.090255+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:49:41.332723+01:00","labels":["label2","label3"],"deleted_at":"2026-01-09T04:49:41.332723+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-m7ju","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:39:11.982548+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:39:12.027135+01:00","deleted_at":"2026-01-07T14:39:12.027135+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-m7ql","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T22:55:51.684447+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:55:51.745406+01:00","deleted_at":"2026-01-08T22:55:51.745406+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-m9kw","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T03:43:27.108111+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:43:27.199583+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T03:43:27.199583+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-m9pz","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T16:34:51.293757+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T16:34:51.358848+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T16:34:51.358848+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-m9tw","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:51:19.257963+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:51:19.418562+01:00","deleted_at":"2026-01-07T02:51:19.418562+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-mba4","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T21:44:09.858278+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:44:10.082905+01:00","deleted_at":"2026-01-07T21:44:10.082905+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-mbgu1","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:43:41.529028+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:43:41.713458+01:00","deleted_at":"2026-01-08T23:43:41.713458+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-mbwk","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:26:24.829937+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:26:24.871819+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T14:26:24.871819+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-mca","title":"Phase 4: Update \u0026 Version Commands","description":"Add 'update' and 'version' to COMMANDS in .agent-shepherd/src/cli/index.ts. Implement cmdUpdate(version?: string) to download new version, preserve config/plugins, reinstall. Implement cmdVersion() to read VERSION file or package.json version. Add getCurrentVersion() helper. Add cases to switch statement.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T03:19:12.485651+01:00","created_by":"tonyhartmann","updated_at":"2025-12-30T03:36:17.481644+01:00","closed_at":"2025-12-30T03:36:17.481644+01:00","close_reason":"Closed via update","dependencies":[{"issue_id":"agent-shepherd-mca","depends_on_id":"agent-shepherd-7gt","type":"parent-child","created_at":"2025-12-30T03:20:18.075885+01:00","created_by":"daemon"},{"issue_id":"agent-shepherd-mca","depends_on_id":"agent-shepherd-5is","type":"blocks","created_at":"2025-12-30T03:20:32.816738+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-mcfwk","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:41:42.154094+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:41:42.449903+01:00","deleted_at":"2026-01-09T04:41:42.449903+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-md5","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:34:52.778849+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:52.837068+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-06T04:34:52.837068+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-meggl","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T01:20:55.293931+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:55.75683+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T01:20:55.75683+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-mexf","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:57:12.904957+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:57:12.960948+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-06T15:57:12.960948+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-mfdo","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:24:24.047909+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:24:24.091246+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T18:24:24.091246+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-mhl6","title":"2.1.3 Implement determineTransition() Enhancements","description":"Extend determineTransition() to support new transition types.\n\n## Tasks\n- Add support for jump_back transition type:\n  - If transition.type === \"jump_back\":\n  - Validate jump_target_phase exists in policy phase sequence\n  - Return transition with jump_target_phase as next phase\n  - Reason: \"Jumping back to phase X for rework\"\n- Add support for dynamic_decision transition type:\n  - If transition.type === \"dynamic_decision\":\n  - Validate dynamic_agent maps to valid capability in agent registry\n  - Return transition with decision_config for agent execution\n  - Reason: \"Delegating transition decision to AI agent\"\n- Maintain existing logic for advance, retry, block, close\n- Return enhanced transition object with all fields\n\n## Expected Deliverables\n- Extended determineTransition() implementation\n- Support for jump_back transitions\n- Support for dynamic_decision transitions\n- Backward compatibility maintained","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:51:07.850767+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-mhld","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T14:39:10.994079+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:39:11.055812+01:00","deleted_at":"2026-01-07T14:39:11.055812+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-miii","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:28:07.739769+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:28:07.820417+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-06T23:28:07.820417+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-mmih","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:36:02.689005+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:36:02.731791+01:00","deleted_at":"2026-01-07T02:36:02.731791+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-mowda","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-11T00:52:27.528084+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:52:27.651584+01:00","deleted_at":"2026-01-11T00:52:27.651584+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-mp2a","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:57:13.743481+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:57:13.849095+01:00","deleted_at":"2026-01-06T15:57:13.849095+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-mpz2j","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:40:52.757587+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:40:52.835149+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-09T20:40:52.835149+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ms9h","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:31:17.643441+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:31:17.709853+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T18:31:17.709853+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-msjc","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:35:16.699188+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:35:16.78382+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-06T23:35:16.78382+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-mudwi","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-10T00:11:57.981606+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T00:11:58.117579+01:00","labels":["label2","label3"],"deleted_at":"2026-01-10T00:11:58.117579+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-munp","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:40:14.929517+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:40:14.997295+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T18:40:14.997295+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-mv8bo","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:12:16.956893+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:12:17.149897+01:00","deleted_at":"2026-01-08T23:12:17.149897+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-mvm40","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:43:42.205069+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:43:42.252243+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-08T23:43:42.252243+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-mwg5","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:28:07.846808+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:28:07.902591+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-06T23:28:07.902591+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-n0nig","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:12:16.494189+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:12:16.688627+01:00","deleted_at":"2026-01-08T23:12:16.688627+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-n13p","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T02:44:01.301578+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:44:01.752021+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T02:44:01.752021+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-n1cg5","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:41:44.710748+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:41:44.894417+01:00","deleted_at":"2026-01-09T04:41:44.894417+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-n1w84","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:49:40.0031+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:49:40.178016+01:00","deleted_at":"2026-01-09T04:49:40.178016+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-n1ypf","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:17:04.532818+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:17:04.602721+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-08T23:17:04.602721+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-n2ru","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T14:39:10.507514+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:39:10.863855+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T14:39:10.863855+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-n2t47","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:31:32.201946+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:31:32.458147+01:00","deleted_at":"2026-01-11T00:31:32.458147+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-n2v3","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:18:31.338205+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:18:31.467577+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T19:18:31.467577+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-n3m7x","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-09T20:40:52.02825+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:40:52.101932+01:00","deleted_at":"2026-01-09T20:40:52.101932+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-n7oz8","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:06:40.414048+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:06:40.485875+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-09T20:06:40.485875+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-n9n","title":"Phase 2: Hybrid Installation Support","description":"Update .agent-shepherd/src/core/path-utils.ts to support hybrid mode (global binary + local config). Replace implementation with: getGlobalInstallDir() using homedir, findLocalAgentShepherdDir() searching upward, findInstallDir() checking local src/ then global, findConfigDir() checking local config/ then global, findPluginsDir() local then global, legacy findAgentShepherdDir for backward compatibility. Update all files using path-utils: config.ts, config-validator.ts, agent-registry.ts, policy.ts, cli/index.ts.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T03:19:05.989806+01:00","created_by":"tonyhartmann","updated_at":"2025-12-30T03:33:56.808923+01:00","closed_at":"2025-12-30T03:33:56.808923+01:00","close_reason":"Closed via update","dependencies":[{"issue_id":"agent-shepherd-n9n","depends_on_id":"agent-shepherd-7gt","type":"parent-child","created_at":"2025-12-30T03:20:13.764001+01:00","created_by":"daemon"},{"issue_id":"agent-shepherd-n9n","depends_on_id":"agent-shepherd-32d","type":"blocks","created_at":"2025-12-30T03:20:28.870494+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-nbgi","title":"2.1.2 Design Enhanced Transition Interface","description":"Extend PhaseTransition to support new transition types: jump_back (backward jumps) and dynamic_decision (AI routing). Add new fields while maintaining backward compatibility.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-07T00:04:50.361091+01:00","updated_at":"2026-01-07T00:06:15.832092+01:00","deleted_at":"2026-01-07T00:06:15.832092+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-nd0","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-06T04:32:30.914833+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:30.977399+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-06T04:32:30.977399+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-nhck","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T15:02:09.294346+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T15:02:09.382545+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T15:02:09.382545+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-nhfd","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:18:31.498479+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:18:31.625652+01:00","deleted_at":"2026-01-07T19:18:31.625652+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-nhmd","title":"2.2.2 Update Policy YAML Schema","description":"Add transition definitions to policies schema for validation.\n\n## Tasks\n- Extend schemas/policies.schema.json with transition definitions:\n  - Add TransitionConfig definition:\n    - type: object\n    - properties: capability (string), prompt (string), allowed_destinations (array)\n    - Optional: messaging (boolean), confidence_thresholds (object)\n    - Required: capability, prompt, allowed_destinations\n  - Add TransitionBlock definition:\n    - type: object\n    - properties: on_success (string or object), on_failure (string or object)\n    - on_partial_success (object only), on_unclear (object only)\n- Add validation rules:\n  - on_success/on_failure can be string or object\n  - on_partial_success/on_unclear must be object (not string)\n  - allowed_destinations must be subset of policy phases\n  - confidence_thresholds values must be 0.0-1.0\n  - capability must be valid (check against agent registry if possible)\n- Add examples to schema documentation for common patterns\n\n## Expected Deliverables\n- Updated policies.schema.json with transition definitions\n- Validation rules for transitions\n- Schema examples and documentation","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:51:25.250815+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-nhxt","title":"3.3.3 Extract Session Messages","description":"Parse full message history from CLI output. Extract messages array from JSON, distinguish human vs agent messages, store in RunOutcome.metadata.messages with timestamps and token usage.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:09:42.922074+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:12:27.938938+01:00","deleted_at":"2026-01-07T01:12:27.938938+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-ni0ge","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T20:11:02.002086+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:11:02.085459+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-09T20:11:02.085459+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-ni74","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T03:43:26.403593+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:43:26.468556+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T03:43:26.468556+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-nj671","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T23:23:28.323596+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:23:28.371764+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-09T23:23:28.371764+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-nlbx","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T05:56:18.104763+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:56:18.2807+01:00","deleted_at":"2026-01-08T05:56:18.2807+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-nlq1","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T21:46:02.604417+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:46:02.69004+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T21:46:02.69004+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-nm2sb","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:23:33.868126+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:23:33.915842+01:00","deleted_at":"2026-01-09T01:23:33.915842+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-nm7","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:35:54.115919+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:35:54.208971+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-06T04:35:54.208971+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-nmwk","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T18:33:43.669239+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:43.739052+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T18:33:43.739052+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-nna8","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:40:01.495984+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:40:01.629049+01:00","deleted_at":"2026-01-07T18:40:01.629049+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-noh1","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T04:53:55.848803+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T04:53:56.013694+01:00","deleted_at":"2026-01-07T04:53:56.013694+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-novuc","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:39:41.019401+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:39:41.303341+01:00","deleted_at":"2026-01-09T04:39:41.303341+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-nplk","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T16:34:51.391694+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T16:34:51.576348+01:00","deleted_at":"2026-01-07T16:34:51.576348+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-npm8v","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:39:41.34152+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:39:41.477072+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-09T04:39:41.477072+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-nqc","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:34:14.132485+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:14.1916+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-06T04:34:14.1916+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-nr35x","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T05:10:40.747663+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T05:10:40.891969+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-09T05:10:40.891969+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-nr59","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:00:15.265147+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:00:15.355376+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T19:00:15.355376+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-nudp","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:32:18.384458+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:32:18.471924+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T14:32:18.471924+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-nv4f","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:41:58.924421+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:41:59.010171+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T02:41:59.010171+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-nvcyq","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:23:32.628349+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:23:32.706225+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-09T01:23:32.706225+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-nxj6","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:29:38.747371+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:29:38.836065+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T18:29:38.836065+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-nxnok","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:39:40.282629+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:39:40.501774+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-09T04:39:40.501774+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-nyt72","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:46:38.731621+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:46:38.780066+01:00","deleted_at":"2026-01-09T20:46:38.780066+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-nz4m","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:31:18.015385+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:31:18.09662+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T18:31:18.09662+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-o0j1","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:59:43.489306+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:59:43.555023+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T02:59:43.555023+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-o14h","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T22:55:50.762412+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:55:50.829777+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-08T22:55:50.829777+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-o1m1","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T05:56:17.687639+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:56:17.755528+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-08T05:56:17.755528+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-o33bl","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T23:23:27.518678+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:23:27.590866+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-09T23:23:27.590866+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-o4lg","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:33:43.562699+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:43.635834+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T18:33:43.635834+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-o4ln","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:36:03.309556+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:36:03.430206+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T02:36:03.430206+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-o5u17","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:50:40.422115+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:50:40.525841+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-09T04:50:40.525841+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-o5ww","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:40:00.623233+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:40:00.672512+01:00","deleted_at":"2026-01-07T18:40:00.672512+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-o5y6","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:31:18.717995+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:31:18.886228+01:00","deleted_at":"2026-01-07T18:31:18.886228+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-o66r","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T22:07:39.793477+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T22:07:39.913824+01:00","deleted_at":"2026-01-07T22:07:39.913824+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-o7eu","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:33:23.411306+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:23.52055+01:00","deleted_at":"2026-01-07T18:33:23.52055+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-o7pq","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T16:34:51.826843+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T16:34:51.997502+01:00","deleted_at":"2026-01-07T16:34:51.997502+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-o98","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:32:30.362846+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:30.420777+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-06T04:32:30.420777+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-o9bi9","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:49:38.303673+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:49:38.452865+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-09T04:49:38.452865+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-o9k","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:35:54.586892+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:35:54.628613+01:00","deleted_at":"2026-01-06T04:35:54.628613+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-oa6i8","title":"Comprehensive Final Implementation Plan: Smart Issue Picker with Heartbeat-Checker","description":"## Executive Summary\nGoal: Implement a dependency-aware issue picker with heartbeat-based crash detection, providing two picker modes (old simple + new smart), using Beads' full dependency capabilities and preparing for OpenCode SDK migration.\n\n## Scratchpad\n### Key Components:\n- Smart Issue Picker (src/core/issue-picker.ts): Dependency-aware selection with epic affinity\n- Heartbeat-Checker Process (src/core/heartbeat-checker.ts): SDK-powered session monitoring\n- OpenCode SDK Module (src/core/opencode_sdk.ts): SDK functions for session activity\n- State-Based Coordination: Using bd set-state for multi-worker safety\n- Config Switch: Between old simple picker and new smart picker\n\n### Architecture Overview\nFile Structure\nsrc/core/\n├── issue-picker.ts           # NEW: Smart picker with dependency logic\n├── heartbeat-checker.ts      # NEW: Background heartbeat monitoring\n├── opencode_sdk.ts           # NEW: SDK functions for session monitoring\n├── opencode.ts               # EXISTING: CLI execution (unchanged)\n├── worker-engine.ts          # UPDATED: Integrate smart picker\n└── beads.ts                  # EXISTING: Add state query functions\n\n### Configuration Switch\nworker:\n  picking:\n    mode: \"simple\"  # \"simple\" | \"smart\"\n  coordination:\n    mode: \"hybrid\"  # \"lease\" | \"heartbeat\" | \"hybrid\"\n  checker:\n    enabled: true\n    poll_interval_ms: 30000\n\n### Picker Logic Flowchart\n[Flowchart details from plan]\n\n### Phases:\n1. Core Infrastructure (2.5 weeks)\n2. Smart Issue Picker Implementation (1.5 weeks)\n3. Crash Detection \u0026 Recovery (1.5 weeks)\n4. Worker Integration (1.5 weeks)\n5. Testing \u0026 Documentation (1 week)\n\n### Risk Mitigation\nFeature Flags:\n- worker.picking.mode: \"simple\" | \"smart\" \n- worker.coordination.mode: \"lease\" | \"heartbeat\" | \"hybrid\"\n- checker.enabled: Independent heartbeat-checker control\n\n### Success Metrics\n- Crash Detection: \u003e95% accuracy within 1 minute of actual crash\n- Coordination: Zero conflicting epic assignments in production\n- Performance: \u003c5% overhead vs simple selection\n- Dependencies: 100% constraint satisfaction in ordering\n- Reliability: \u003c1% heartbeat-checker downtime with automatic recovery\n\n### Implementation Constraints\n- CLI Compatibility: Workers remain CLI-based for execution\n- SDK Isolation: SDK functions separated for clean migration path\n- Beads Dependency: All coordination uses Beads state for reliability\n- Stateless Design: Workers don't maintain session state between runs\n\n## Execution Note\nWhen assigned this epic, consume the overall context and select the next available child issue to work on, rather than working on the epic directly.","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-10T23:47:03.04213+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T23:47:03.04213+01:00"}
{"id":"agent-shepherd-oa6i8.1","title":"Phase 1: Core Infrastructure (2.5 weeks)","description":"Step 1.1: Create OpenCode SDK Module (src/core/opencode_sdk.ts)\nWhat: Dedicated SDK functions for session monitoring\nHow: \n- Install @opencode-ai/sdk dependency\n- Create OpenCodeSDKClient class\n- Implement getLastSessionActivity(sessionId) using client.session.messages()\n- Add checkSessionHeartbeat(sessionId) for activity detection\nWhy: Enables accurate session monitoring for heartbeat-checker\nTests: SDK client mocking and message timestamp extraction\n\nStep 1.2: Implement Heartbeat-Checker Process (src/core/heartbeat-checker.ts)\nWhat: Background daemon monitoring active sessions\nHow:\n- HeartbeatChecker class extending EventEmitter\n- Poll logging system for active runs every 30 seconds\n- For each session: call SDK getLastSessionActivity()\n- Update Beads: bd set-state $EPIC_ID last-heartbeat=$TIMESTAMP\n- Handle SDK failures gracefully\nWhy: Provides real-time heartbeat data without blocking workers\nTests: Daemon lifecycle, polling accuracy, state update reliability\n\nStep 1.3: State-Based Coordination Functions\nWhat: Add state management to beads.ts\nHow:\n- setEpicState(epicId, key, value) → bd set-state\n- getEpicState(epicId, key) → bd state\n- Coordination states: assigned-worker, last-heartbeat, lease-expires\nWhy: Centralized state management for coordination\nTests: State read/write operations with Beads mocking","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-10T23:47:05.935499+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T23:47:05.935499+01:00","dependencies":[{"issue_id":"agent-shepherd-oa6i8.1","depends_on_id":"agent-shepherd-oa6i8","type":"parent-child","created_at":"2026-01-10T23:47:05.93845+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-oa6i8.1.1","title":"Step 1.1: Create OpenCode SDK Module (src/core/opencode_sdk.ts)","description":"What: Dedicated SDK functions for session monitoring\nHow: \n- Install @opencode-ai/sdk dependency\n- Create OpenCodeSDKClient class\n- Implement getLastSessionActivity(sessionId) using client.session.messages()\n- Add checkSessionHeartbeat(sessionId) for activity detection\nWhy: Enables accurate session monitoring for heartbeat-checker\nTests: SDK client mocking and message timestamp extraction","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T23:47:08.493452+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T23:47:08.493452+01:00","dependencies":[{"issue_id":"agent-shepherd-oa6i8.1.1","depends_on_id":"agent-shepherd-oa6i8.1","type":"parent-child","created_at":"2026-01-10T23:47:08.5052+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-oa6i8.1.2","title":"Step 1.2: Implement Heartbeat-Checker Process (src/core/heartbeat-checker.ts)","description":"What: Background daemon monitoring active sessions\nHow:\n- HeartbeatChecker class extending EventEmitter\n- Poll logging system for active runs every 30 seconds\n- For each session: call SDK getLastSessionActivity()\n- Update Beads: bd set-state $EPIC_ID last-heartbeat=$TIMESTAMP\n- Handle SDK failures gracefully\nWhy: Provides real-time heartbeat data without blocking workers\nTests: Daemon lifecycle, polling accuracy, state update reliability","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T23:47:10.459996+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T23:47:10.459996+01:00","dependencies":[{"issue_id":"agent-shepherd-oa6i8.1.2","depends_on_id":"agent-shepherd-oa6i8.1","type":"parent-child","created_at":"2026-01-10T23:47:10.460957+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-oa6i8.1.3","title":"Step 1.3: State-Based Coordination Functions","description":"What: Add state management to beads.ts\nHow:\n- setEpicState(epicId, key, value) → bd set-state\n- getEpicState(epicId, key) → bd state\n- Coordination states: assigned-worker, last-heartbeat, lease-expires\nWhy: Centralized state management for coordination\nTests: State read/write operations with Beads mocking","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T23:47:12.403529+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T23:47:12.403529+01:00","dependencies":[{"issue_id":"agent-shepherd-oa6i8.1.3","depends_on_id":"agent-shepherd-oa6i8.1","type":"parent-child","created_at":"2026-01-10T23:47:12.404557+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-oa6i8.2","title":"Phase 2: Smart Issue Picker Implementation (1.5 weeks)","description":"Step 2.1: Create Issue Picker Module (src/core/issue-picker.ts)\nWhat: Core smart selection logic with mode switching\nHow:\n- IssuePicker class with pickNextIssues() method\n- Configurable mode: \"simple\" (priority sort) vs \"smart\" (dependency-aware)\n- Integrate with coordination state checking\nWhy: Centralizes selection logic with backwards compatibility\nTests: Mode switching, simple vs smart output comparison\n\nStep 2.2: Dependency Graph Builder\nWhat: Query and analyze Beads dependency relationships\nHow:\n- buildDependencyGraph(issues) using bd dep list --json\n- Parse blocks, parent-child, related dependencies\n- Calculate hierarchical depths from issue IDs\n- Handle cross-epic dependencies\nWhy: Foundation for intelligent ordering\nTests: Graph accuracy with various dependency scenarios\n\nStep 2.3: Smart Ordering Algorithm\nWhat: Topological + hierarchical sorting\nHow:\n- Implement Kahn's algorithm for dependency resolution\n- Within dependency levels: sort by hierarchy depth (leaves first)\n- Then priority (P0 \u003e P1 \u003e P2), then ID for determinism\nWhy: Respects prerequisites while optimizing workflow progression\nTests: Complex dependency graphs, priority interactions, cycle handling","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-10T23:47:14.652684+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T23:47:14.652684+01:00","dependencies":[{"issue_id":"agent-shepherd-oa6i8.2","depends_on_id":"agent-shepherd-oa6i8","type":"parent-child","created_at":"2026-01-10T23:47:14.667583+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-oa6i8.2.1","title":"Step 2.2: Dependency Graph Builder","description":"What: Query and analyze Beads dependency relationships\nHow:\n- buildDependencyGraph(issues) using bd dep list --json\n- Parse blocks, parent-child, related dependencies\n- Calculate hierarchical depths from issue IDs\n- Handle cross-epic dependencies\nWhy: Foundation for intelligent ordering\nTests: Graph accuracy with various dependency scenarios","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T23:47:18.631524+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T23:47:18.631524+01:00","dependencies":[{"issue_id":"agent-shepherd-oa6i8.2.1","depends_on_id":"agent-shepherd-oa6i8.2","type":"parent-child","created_at":"2026-01-10T23:47:18.632451+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-oa6i8.2.2","title":"Step 2.3: Smart Ordering Algorithm","description":"What: Topological + hierarchical sorting\nHow:\n- Implement Kahn's algorithm for dependency resolution\n- Within dependency levels: sort by hierarchy depth (leaves first)\n- Then priority (P0 \u003e P1 \u003e P2), then ID for determinism\nWhy: Respects prerequisites while optimizing workflow progression\nTests: Complex dependency graphs, priority interactions, cycle handling","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T23:47:20.389779+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T23:47:20.389779+01:00","dependencies":[{"issue_id":"agent-shepherd-oa6i8.2.2","depends_on_id":"agent-shepherd-oa6i8.2","type":"parent-child","created_at":"2026-01-10T23:47:20.390622+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-oa6i8.2.3","title":"Step 2.1: Create Issue Picker Module (src/core/issue-picker.ts)","description":"What: Core smart selection logic with mode switching\nHow:\n- IssuePicker class with pickNextIssues() method\n- Configurable mode: \"simple\" (priority sort) vs \"smart\" (dependency-aware)\n- Integrate with coordination state checking\nWhy: Centralizes selection logic with backwards compatibility\nTests: Mode switching, simple vs smart output comparison","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T23:47:48.691029+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T23:47:48.691029+01:00","dependencies":[{"issue_id":"agent-shepherd-oa6i8.2.3","depends_on_id":"agent-shepherd-oa6i8.2","type":"parent-child","created_at":"2026-01-10T23:47:48.700031+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-oa6i8.3","title":"Phase 3: Crash Detection \u0026 Recovery (1.5 weeks)","description":"Step 3.1: Heartbeat-Based Abandonment Detection\nWhat: Check session activity via heartbeat timestamps\nHow:\n- Query getEpicState(epicId, 'last-heartbeat')\n- Compare against threshold (5 minutes default)\n- Fallback to lease expiry if heartbeat unavailable\nWhy: Accurate crash detection using real session data\nTests: Heartbeat staleness scenarios, fallback behavior\n\nStep 3.2: Abandoned Task Recovery with Transitions\nWhat: Apply policy transitions to crashed tasks\nHow:\n- Detect abandoned tasks via heartbeat/lease\n- Mark run as failed with crash context\n- Call policyEngine.determineTransition() with failure outcome\n- Constrain transitions: never close, prefer retry/block\n- Update issue status accordingly\nWhy: Maintains audit trail and enables proper recovery paths\nTests: Transition application, constraint enforcement, state updates\n\nStep 3.3: Epic Claim \u0026 Recovery Integration\nWhat: Atomic claim with crash handling\nHow:\n- Check for active assignments and heartbeat staleness\n- Recover abandoned tasks before claiming\n- Set coordination states (assigned-worker, lease-expires)\n- Return epic subtree for processing\nWhy: Prevents conflicts and ensures clean handoffs\nTests: Multi-worker claiming races, recovery integration","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-10T23:47:22.781622+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T23:47:22.781622+01:00","dependencies":[{"issue_id":"agent-shepherd-oa6i8.3","depends_on_id":"agent-shepherd-oa6i8","type":"parent-child","created_at":"2026-01-10T23:47:22.794008+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-oa6i8.3.1","title":"Step 3.1: Heartbeat-Based Abandonment Detection","description":"What: Check session activity via heartbeat timestamps\nHow:\n- Query getEpicState(epicId, 'last-heartbeat')\n- Compare against threshold (5 minutes default)\n- Fallback to lease expiry if heartbeat unavailable\nWhy: Accurate crash detection using real session data\nTests: Heartbeat staleness scenarios, fallback behavior","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T23:47:24.592972+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T23:47:24.592972+01:00","dependencies":[{"issue_id":"agent-shepherd-oa6i8.3.1","depends_on_id":"agent-shepherd-oa6i8.3","type":"parent-child","created_at":"2026-01-10T23:47:24.593929+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-oa6i8.3.2","title":"Step 3.2: Abandoned Task Recovery with Transitions","description":"What: Apply policy transitions to crashed tasks\nHow:\n- Detect abandoned tasks via heartbeat/lease\n- Mark run as failed with crash context\n- Call policyEngine.determineTransition() with failure outcome\n- Constrain transitions: never close, prefer retry/block\n- Update issue status accordingly\nWhy: Maintains audit trail and enables proper recovery paths\nTests: Transition application, constraint enforcement, state updates","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T23:47:26.609787+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T23:47:26.609787+01:00","dependencies":[{"issue_id":"agent-shepherd-oa6i8.3.2","depends_on_id":"agent-shepherd-oa6i8.3","type":"parent-child","created_at":"2026-01-10T23:47:26.610943+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-oa6i8.3.3","title":"Step 3.3: Epic Claim \u0026 Recovery Integration","description":"What: Atomic claim with crash handling\nHow:\n- Check for active assignments and heartbeat staleness\n- Recover abandoned tasks before claiming\n- Set coordination states (assigned-worker, lease-expires)\n- Return epic subtree for processing\nWhy: Prevents conflicts and ensures clean handoffs\nTests: Multi-worker claiming races, recovery integration","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T23:47:28.541486+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T23:47:28.541486+01:00","dependencies":[{"issue_id":"agent-shepherd-oa6i8.3.3","depends_on_id":"agent-shepherd-oa6i8.3","type":"parent-child","created_at":"2026-01-10T23:47:28.54235+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-oa6i8.4","title":"Phase 4: Worker Integration (1.5 weeks)","description":"Step 4.1: Update Worker Engine (src/core/worker-engine.ts)\nWhat: Integrate smart picker with existing execution\nHow:\n- Replace getEligibleIssues() with issuePicker.pickNextIssues()\n- Add worker identity from config or env\n- Maintain CLI execution path unchanged\nWhy: Seamless upgrade with picker abstraction\nTests: Worker lifecycle with smart vs simple modes\n\nStep 4.2: Configuration System Updates\nWhat: Add picker and coordination options\nHow:\n- Extend config/config.yaml with picking and coordination sections\n- Runtime mode detection and validation\n- Worker identity resolution (env var or config)\nWhy: Flexible deployment without code changes\nTests: Configuration parsing, validation, mode switching\n\nStep 4.3: CLI Commands \u0026 Monitoring\nWhat: Add heartbeat and coordination visibility\nHow:\n- ashep heartbeat status: Show checker health and active heartbeats\n- ashep list-active: Display worker assignments and timestamps\n- ashep work --epic \u003cid\u003e: Force epic-focused processing\nWhy: Human observability and debugging capabilities\nTests: CLI output formatting, status accuracy","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-10T23:47:31.162691+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T23:47:31.162691+01:00","dependencies":[{"issue_id":"agent-shepherd-oa6i8.4","depends_on_id":"agent-shepherd-oa6i8","type":"parent-child","created_at":"2026-01-10T23:47:31.176032+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-oa6i8.4.1","title":"Step 4.1: Update Worker Engine (src/core/worker-engine.ts)","description":"What: Integrate smart picker with existing execution\nHow:\n- Replace getEligibleIssues() with issuePicker.pickNextIssues()\n- Add worker identity from config or env\n- Maintain CLI execution path unchanged\nWhy: Seamless upgrade with picker abstraction\nTests: Worker lifecycle with smart vs simple modes","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T23:47:32.950293+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T23:47:32.950293+01:00","dependencies":[{"issue_id":"agent-shepherd-oa6i8.4.1","depends_on_id":"agent-shepherd-oa6i8.4","type":"parent-child","created_at":"2026-01-10T23:47:32.951739+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-oa6i8.4.2","title":"Step 4.2: Configuration System Updates","description":"What: Add picker and coordination options\nHow:\n- Extend config/config.yaml with picking and coordination sections\n- Runtime mode detection and validation\n- Worker identity resolution (env var or config)\nWhy: Flexible deployment without code changes\nTests: Configuration parsing, validation, mode switching","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T23:47:34.437125+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T23:47:34.437125+01:00","dependencies":[{"issue_id":"agent-shepherd-oa6i8.4.2","depends_on_id":"agent-shepherd-oa6i8.4","type":"parent-child","created_at":"2026-01-10T23:47:34.448897+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-oa6i8.4.3","title":"Step 4.3: CLI Commands \u0026 Monitoring","description":"What: Add heartbeat and coordination visibility\nHow:\n- ashep heartbeat status: Show checker health and active heartbeats\n- ashep list-active: Display worker assignments and timestamps\n- ashep work --epic \u003cid\u003e: Force epic-focused processing\nWhy: Human observability and debugging capabilities\nTests: CLI output formatting, status accuracy","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T23:47:36.131474+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T23:47:36.131474+01:00","dependencies":[{"issue_id":"agent-shepherd-oa6i8.4.3","depends_on_id":"agent-shepherd-oa6i8.4","type":"parent-child","created_at":"2026-01-10T23:47:36.144001+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-oa6i8.5","title":"Phase 5: Testing \u0026 Documentation (1 week)","description":"Step 5.1: Comprehensive Test Coverage\nWhat: Validate all components and interactions\nHow:\n- Unit tests: Picker algorithms, dependency graphs, state management\n- Integration tests: Worker + picker + heartbeat-checker interactions\n- Multi-worker simulation: Coordination conflict prevention\n- Failure scenarios: Crash recovery, SDK fallbacks, Beads failures\nWhy: Ensures reliability in complex distributed scenarios\nTests: \u003e90% coverage with automated CI execution\n\nStep 5.2: Documentation Updates\nWhat: Complete user and developer documentation\nHow:\n- AGENTS.md: Smart picker architecture, heartbeat-checker, coordination\n- docs/cli-reference.md: New commands (ashep heartbeat status, coordination options)\n- docs/policies-config.md: Epic affinity, heartbeat configuration, mode switching\n- Add troubleshooting: Heartbeat issues, coordination conflicts, dependency cycles\nWhy: Users can understand, configure, and debug the enhanced system\nTests: Documentation review and user testing validation\n\nStep 5.3: Migration \u0026 Rollout Plan\nWhat: Safe production deployment strategy\nHow:\n- Phase A: Deploy infrastructure (SDK module, heartbeat-checker) with flags disabled\n- Phase B: Enable heartbeat-checker, monitor for 1 week\n- Phase C: Switch coordination mode to hybrid, monitor conflicts\n- Phase D: Enable smart picking mode, gradual rollout with rollback plan\n- Include metrics: Crash detection accuracy, coordination conflicts, performance impact\nWhy: Minimizes risk with staged deployment and monitoring\nTests: Staging environment validation, rollback procedures","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-10T23:47:38.696783+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T23:47:38.696783+01:00","dependencies":[{"issue_id":"agent-shepherd-oa6i8.5","depends_on_id":"agent-shepherd-oa6i8","type":"parent-child","created_at":"2026-01-10T23:47:38.704793+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-oa6i8.5.1","title":"Step 5.1: Comprehensive Test Coverage","description":"What: Validate all components and interactions\nHow:\n- Unit tests: Picker algorithms, dependency graphs, state management\n- Integration tests: Worker + picker + heartbeat-checker interactions\n- Multi-worker simulation: Coordination conflict prevention\n- Failure scenarios: Crash recovery, SDK fallbacks, Beads failures\nWhy: Ensures reliability in complex distributed scenarios\nTests: \u003e90% coverage with automated CI execution","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T23:47:40.63367+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T23:47:40.63367+01:00","dependencies":[{"issue_id":"agent-shepherd-oa6i8.5.1","depends_on_id":"agent-shepherd-oa6i8.5","type":"parent-child","created_at":"2026-01-10T23:47:40.634497+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-oa6i8.5.2","title":"Step 5.2: Documentation Updates","description":"What: Complete user and developer documentation\nHow:\n- AGENTS.md: Smart picker architecture, heartbeat-checker, coordination\n- docs/cli-reference.md: New commands (ashep heartbeat status, coordination options)\n- docs/policies-config.md: Epic affinity, heartbeat configuration, mode switching\n- Add troubleshooting: Heartbeat issues, coordination conflicts, dependency cycles\nWhy: Users can understand, configure, and debug the enhanced system\nTests: Documentation review and user testing validation","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T23:47:42.576449+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T23:47:42.576449+01:00","dependencies":[{"issue_id":"agent-shepherd-oa6i8.5.2","depends_on_id":"agent-shepherd-oa6i8.5","type":"parent-child","created_at":"2026-01-10T23:47:42.577204+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-oa6i8.5.3","title":"Step 5.3: Migration \u0026 Rollout Plan","description":"What: Safe production deployment strategy\nHow:\n- Phase A: Deploy infrastructure (SDK module, heartbeat-checker) with flags disabled\n- Phase B: Enable heartbeat-checker, monitor for 1 week\n- Phase C: Switch coordination mode to hybrid, monitor conflicts\n- Phase D: Enable smart picking mode, gradual rollout with rollback plan\n- Include metrics: Crash detection accuracy, coordination conflicts, performance impact\nWhy: Minimizes risk with staged deployment and monitoring\nTests: Staging environment validation, rollback procedures","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T23:47:45.009872+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T23:47:45.009872+01:00","dependencies":[{"issue_id":"agent-shepherd-oa6i8.5.3","depends_on_id":"agent-shepherd-oa6i8.5","type":"parent-child","created_at":"2026-01-10T23:47:45.02955+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-oabjv","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:31:33.536056+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:31:33.839345+01:00","labels":["label2","label3"],"deleted_at":"2026-01-11T00:31:33.839345+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-obaw","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T14:26:23.740979+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:26:23.802038+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T14:26:23.802038+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-obko","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T02:43:59.961707+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:44:00.051997+01:00","deleted_at":"2026-01-07T02:44:00.051997+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-och0","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T16:00:26.228798+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T16:00:26.323194+01:00","deleted_at":"2026-01-06T16:00:26.323194+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-od1n","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T19:18:30.887305+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:18:31.306702+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T19:18:31.306702+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-odct","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T05:04:24.90149+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:04:25.003917+01:00","deleted_at":"2026-01-07T05:04:25.003917+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ofdn","title":"2.5.5 Add Response Sanitization","description":"Clean and normalize decision agent responses.\n\n## Tasks\n- Implement sanitizeDecisionResponse() function:\n  - Takes raw response string\n  - Returns sanitized string ready for JSON.parse()\n- Sanitization steps:\n  - Strip markdown code blocks:\n    - response = response.replace(/```json\\s*/, '').replace(/```\\s*$/, '')\n  - Handle extra whitespace:\n    - response = response.trim()\n  - Handle escaped quotes:\n    - response = response.replace(/\\\\\"/g, '\"')\n  - Handle Unicode characters:\n    - response = response.normalize('NFC')\n  - Ensure valid UTF-8 encoding:\n    - Try to encode/decode to UTF-8, handle errors\n- Apply sanitization before JSON.parse()\n- Log sanitization steps for debugging:\n  - Log which sanitization steps were applied\n  - Log original vs sanitized response if different\n\n## Expected Deliverables\n- sanitizeDecisionResponse() function implemented\n  - All sanitization steps working\n  - Robust handling of various response formats\n  - Debug logging enabled","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:53:38.097025+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-ofsd","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T18:11:45.300244+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:11:45.365743+01:00","deleted_at":"2026-01-07T18:11:45.365743+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-oh0cd","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:06:41.294243+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:06:41.475919+01:00","deleted_at":"2026-01-09T20:06:41.475919+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ohuhc","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-09T05:10:40.588984+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T05:10:40.694839+01:00","deleted_at":"2026-01-09T05:10:40.694839+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-oibf","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T20:36:37.311022+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T20:36:37.361651+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T20:36:37.361651+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-oiwi8","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-08T23:12:17.504471+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:12:17.968569+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-08T23:12:17.968569+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-ojgh3","title":"This is a very long title that should test how the table formatting handles truncated text with ellipsis when the title exceeds thirty characters","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T05:01:02.469709+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T05:01:44.647827+01:00","closed_at":"2026-01-09T05:01:44.647827+01:00","close_reason":"Test completed","labels":["ashep-managed"]}
{"id":"agent-shepherd-ojou","title":"2.2 Add Conditional Transition Configuration Schema","description":"Add conditional transition configuration to support complex routing.\n\n## Scope\n- Extend PhaseConfig with transitions block\n- Support direct jumps and AI-based routing\n- Create example policies with conditional transitions\n\n## Dependencies\nDepends on 2.1 (Transition Types)\n\n## Estimated Duration\n1 week\n\n## Scratchpad\n### 2.2.1 Extend PhaseConfig Interface\n- Add transitions?: TransitionBlock field\n- Design TransitionBlock with on_success, on_failure, on_partial_success, on_unclear\n- Support string or TransitionConfig for on_success/on_failure\n- on_partial_success/on_unclear must be object\n\n### 2.2.2 Update Policy YAML Schema\n- Add TransitionConfig and TransitionBlock definitions to policies.schema.json\n- Validate capability, prompt, allowed_destinations\n- Add confidence_thresholds validation\n\n### 2.2.3 Implement Transition Config Parsing\n- Add validation for transitions block in validatePolicy()\n- Parse transition block for each phase\n- Validate transition config structure\n\n### 2.2.4 Add getTransitionKey() Helper\n- Map outcome types to transition configuration keys\n- Handle result_type and success boolean\n- Backward compatible\n\n### 2.2.5 Update determineTransition() to Use Conditional Transitions\n- Check for custom transitions first\n- Use getTransitionKey() to map outcome\n- Handle string and object transitions\n- Fall back to default linear behavior\n\n### 2.2.6 Create Example Policies with Conditional Transitions\n- Add enhanced-dev policy\n- Add quality-gate policy\n- Add flexible-workflow policy\n\n### 2.2.7 Add Configuration Tests\n- Test valid and invalid configs\n- Test string transitions\n- Test object transitions\n- Test default behavior","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-06T23:49:43.472371+01:00","updated_at":"2026-01-06T23:56:55.128651+01:00","deleted_at":"2026-01-06T23:56:55.128651+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-ompgo","title":"Implement Session Continuation Between Phases + List-Sessions CLI","description":"Implement session continuation feature allowing workflow phases to reuse OpenCode sessions with keywords (@shared, @previous, @self, @first), thresholds, and fallbacks. Add interactive List-Sessions CLI for HITL session access.\n\nScratchpad:\nDetailed Plan: Session Continuation Between Phases + List-Sessions CLI\nBelow is the complete, finalized plan for implementing session continuation in agent-shepherd, including the interactive List-Sessions CLI add-on. This plan incorporates all refinements: keywords (@shared, @previous, @self, @first), thresholds, policy-level options, and the CLI for HITL session access.\nWhat: Session Continuation Feature + List-Sessions CLI\nDescription: \n- Session Continuation: Allows workflow phases to reuse OpenCode sessions instead of always starting fresh. Supports explicit phase names and keywords (@shared, @previous, @self, @first) for dynamic reuse. Includes configurable token thresholds to prevent context overflow, with automatic fallback to new sessions.\n- List-Sessions CLI: ashep list-sessions \u003cbeads-issue\u003e displays an interactive list of sessions for an issue (including phases and creation times). Users can navigate with keyboard (cursor up/down, enter to select), launching opencode --session \u003cid\u003e to open the TUI directly in that session. Aids HITL for reviewing/editing past sessions.\nScope: \n- Continuation: Per-phase or policy-level config, threshold checks, CLI integration.\n- CLI: Interactive session listing and TUI launch.\n- Backward compatible; optional features.\nWhy: Benefits and Rationale\n- Continuation: Preserves context across phase jumps, reduces token costs, supports complex workflows (e.g., dev ↔ validate loops).\n- CLI Add-On: Enables quick HITL access—select and re-enter sessions for approvals/debugging without manual DB queries.\n- KISS: Builds on existing CLI/DB; minimal changes.\n- Safety: Thresholds + fallbacks prevent failures.\n- Tradeoffs: Token estimates may not be perfect; fallbacks ensure reliability.\nHow: High-Level Approach\n1. Config: Add fields for reuse rules, thresholds, and keywords.\n2. Resolution/Logic: Map keywords to sessions, query DB for reuse checks.\n3. Execution: Pass session to OpenCode CLI; handle fallbacks.\n4. CLI Tool: Query and display sessions interactively; launch TUI on selection.\n5. Test/Docs: Validate all logic and update guides.\nExact Implementation Steps\n1. Config Changes\n- File: src/core/policy.ts\n  - What: Extend interfaces for session reuse options.\n  - Code:\n        export interface PhaseConfig {\n      // Existing fields...\n      reuse_session_from_phase?: string; // \"@shared\", \"@previous\", \"@self\", \"@first\", or phase name\n      context_window_threshold?: number; // 0.0-1.0, default 0.8\n      max_context_tokens?: number; // Default 130000\n    }\n    export interface PolicyConfig {\n      // Existing fields...\n      shared_session?: boolean; // Policy-level default for @shared\n    }\n      - Why: Supports keywords, per-phase overrides, and policy defaults.\n- File: src/core/config.ts\n  - What: Add system-wide defaults.\n  - Code (in Config interface):\n        export interface Config {\n      // Existing fields...\n      session_continuation?: {\n        default_max_context_tokens: number; // 130000\n        default_threshold: number; // 0.8\n      };\n    }\n      - Default Config (config/config.yaml):\n        session_continuation:\n      default_max_context_tokens: 130000\n      default_threshold: 0.8\n      - Why: Provides sensible defaults; configurable.\n2. Keyword Resolution and Session Lookup\n- File: src/core/worker-engine.ts\n  - What: Add resolution and lookup methods.\n  - Code (resolve keyword):\n        private resolveReuseTarget(phaseName: string, keyword: string, policy: PolicyConfig): string | null {\n      switch (keyword) {\n        case \"@shared\": return policy.shared_session ? \"@shared\" : null;\n        case \"@previous\": return this.getPreviousPhase(phaseName, policy);\n        case \"@self\": return phaseName;\n        case \"@first\": return policy.phases[0]?.name || null;\n        default: return keyword; // Phase name\n      }\n    }\n      - Code (find session):\n        private async findReusableSession(issueId: string, target: string): Promise\u003c{ sessionId: string | null; shouldReuse: boolean }\u003e {\n      const runs = target === \"@shared\" \n        ? this.logger.queryRuns({ issue_id: issueId, limit: 1 })\n        : this.logger.queryRuns({ issue_id: issueId, phase: target, status: \"completed\", limit: 1 });\n      \n      if (runs.length === 0) return { sessionId: null, shouldReuse: false };\n      \n      const sessionId = runs[0].session_id;\n      const totalTokens = this.sumTokensForSession(sessionId);\n      const maxTokens = this.getMaxTokens();\n      const shouldReuse = totalTokens \u003c (maxTokens * this.getThreshold());\n      \n      return { sessionId, shouldReuse };\n    }\n      - Helper Methods: sumTokensForSession(), getMaxTokens(), getThreshold() (use config/DB).\n  - Why: Handles keywords; checks thresholds using existing DB.\n3. CLI Integration and Fallback\n- File: src/core/opencode.ts\n  - What: Support session passing.\n  - Code:\n        async runAgentCLI(config: SessionConfig \u0026 { sessionId?: string }): Promise\u003cRunResult\u003e {\n      const args = [\"run\", \"--agent\", config.agent || \"default\", \"--format\", \"json\"];\n      if (config.sessionId) args.push(\"--session\", config.sessionId);\n      // Rest unchanged\n    }\n    \n- File: src/core/worker-engine.ts\n  - What: Integrate in launchAgent() with fallback.\n  - Code:\n        const resolvedTarget = this.resolveReuseTarget(phase, phaseConfig.reuse_session_from_phase, policy);\n    const reuseConfig = resolvedTarget ? await this.findReusableSession(issue.id, resolvedTarget) : { sessionId: null, shouldReuse: false };\n    const sessionId = reuseConfig.shouldReuse ? reuseConfig.sessionId : null;\n    \n    try {\n      result = await this.opencode.runAgentCLI({ ...config, sessionId });\n    } catch (error) {\n      if (sessionId) {\n        console.warn(`Reuse failed, falling back: ${error}`);\n        result = await this.opencode.runAgentCLI(config); // Fresh session\n      }\n    }\n    \n4. List-Sessions CLI Command\n- File: src/cli/index.ts\n  - What: Add interactive command.\n  - Dependencies: Add inquirer for interactivity.\n  - Code (CLI setup):\n        .command(\"list-sessions \u003cissue-id\u003e\")\n    .description(\"List and select sessions for a Beads issue to open in OpenCode TUI\")\n    .action(async (issueId: string) =\u003e {\n      const sessions = await listSessionsForIssue(issueId);\n      if (sessions.length === 0) {\n        console.log(\"No sessions found for issue:\", issueId);\n        return;\n      }\n      \n      const choices = sessions.map(s =\u003e ({\n        name: `${s.sessionId} | Phases: ${s.phases.join(', ')} | Created: ${new Date(s.createdAt).toLocaleString()} | Tokens: ${s.totalTokens}`,\n        value: s.sessionId\n      }));\n      \n      const { selectedSession } = await inquirer.prompt([{\n        type: 'list',\n        name: 'selectedSession',\n        message: 'Select a session to open in OpenCode TUI:',\n        choices\n      }]);\n      \n      if (selectedSession) {\n        spawn(['opencode', '--session', selectedSession], { stdio: 'inherit' });\n      }\n    });\n      - New Function:\n        async function listSessionsForIssue(issueId: string) {\n      const runs = getLogger().queryRuns({ issue_id: issueId });\n      const sessionMap = new Map();\n      \n      for (const run of runs) {\n        if (!sessionMap.has(run.session_id)) {\n          sessionMap.set(run.session_id, { phases: [], createdAt: run.created_at, totalTokens: 0 });\n        }\n        const entry = sessionMap.get(run.session_id);\n        entry.phases.push(run.phase);\n        entry.totalTokens += run.outcome?.metrics?.tokens_used || 0;\n      }\n      \n      return Array.from(sessionMap.entries()).map(([sessionId, data]) =\u003e ({\n        sessionId,\n        phases: [...new Set(data.phases)], // Unique phases\n        createdAt: data.createdAt,\n        totalTokens: data.totalTokens\n      })).sort((a, b) =\u003e b.createdAt - a.createdAt); // Newest first\n    }\n      - Why: Interactive list with keyboard navigation; launches TUI on selection.\n5. Tests\n- Unit Tests (tests/worker-engine.test.ts):\n  - Test keyword resolution, token summing, threshold logic.\n  - Mock DB for \"@shared\" vs. phase-specific.\n- Integration Tests (tests/session-continuation.test.ts):\n  - Simulate workflows with keywords, jumps, thresholds.\n  - Verify reuse and fallbacks.\n- CLI Tests (tests/cli-integration.test.ts):\n  - Mock DB and inquirer; test list display, selection, TUI launch.\n- Run: bun test tests/worker-engine.test.ts tests/session-continuation.test.ts tests/cli-integration.test.ts\n6. Documentation Updates\n- File: docs/policies-config.md\n  - Add Section:\n        ## Session Continuation\n    Reuse OpenCode sessions to preserve context:\n    - `reuse_session_from_phase`: Phase name or keyword (`@shared`, `@previous`, `@self`, `@first`).\n    - `context_window_threshold`: Threshold (default 0.8).\n    - `max_context_tokens`: Token limit (default 130000).\n    Policy-level: `shared_session: true` for global sharing.\n    Examples:\n    - `@shared`: All phases share one session.\n    - `@self`: Reuse own phase's session.\n    - `\"dev\"`: Reuse dev phase's session.\n    - File: docs/cli-reference.md\n  - Add: ashep list-sessions \u003cissue-id\u003e: Interactive list of sessions for HITL. Select to open in OpenCode TUI.\n- File: README.md\n  - Add to Features: \"Session Continuation: Reuse sessions with thresholds.\"\n  - Add to CLI: ashep list-sessions \u003cissue-id\u003e for session access.\nTimeline: 5-6 days (continuation: 4 days; CLI: 1-2 days).\nQuestions for Clarification (Tie Loose Ends)**:\n- For \"@shared\": Policy-level only, or allow per-phase?\n- Threshold: Per-phase or shared for \"@shared\"?\n- CLI: Confirm display format and opencode --session launch?\n- Any other examples or edge cases?\n\nWhen assigned this epic, consume the overall context and select the next available child issue to work on, rather than working on the epic directly.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-09T06:01:07.43007+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T06:01:07.43007+01:00"}
{"id":"agent-shepherd-ompgo.1","title":"Config Changes for Session Continuation","description":"Extend interfaces in policy.ts for reuse options, add defaults in config.ts, and update config.yaml.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T06:01:11.058803+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:41:05.403495+01:00","closed_at":"2026-01-11T00:41:05.403495+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-ompgo.1","depends_on_id":"agent-shepherd-ompgo","type":"parent-child","created_at":"2026-01-09T06:01:11.065062+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-ompgo.1.1","title":"Extend PhaseConfig and PolicyConfig interfaces in src/core/policy.ts","description":"Add reuse_session_from_phase, context_window_threshold, max_context_tokens to PhaseConfig; shared_session to PolicyConfig.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T06:01:12.773112+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:41:05.399737+01:00","closed_at":"2026-01-11T00:41:05.399739+01:00","dependencies":[{"issue_id":"agent-shepherd-ompgo.1.1","depends_on_id":"agent-shepherd-ompgo.1","type":"parent-child","created_at":"2026-01-09T06:01:12.780635+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-ompgo.1.2","title":"Add session_continuation defaults to Config interface in src/core/config.ts","description":"Add session_continuation with default_max_context_tokens and default_threshold to Config interface.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T06:01:14.122428+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:41:05.402043+01:00","closed_at":"2026-01-11T00:41:05.402045+01:00","dependencies":[{"issue_id":"agent-shepherd-ompgo.1.2","depends_on_id":"agent-shepherd-ompgo.1","type":"parent-child","created_at":"2026-01-09T06:01:14.127776+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-ompgo.1.3","title":"Update config/config.yaml with session_continuation defaults","description":"Add session_continuation section with default_max_context_tokens: 130000 and default_threshold: 0.8.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T06:01:15.330316+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:41:05.395205+01:00","closed_at":"2026-01-11T00:41:05.395214+01:00","dependencies":[{"issue_id":"agent-shepherd-ompgo.1.3","depends_on_id":"agent-shepherd-ompgo.1","type":"parent-child","created_at":"2026-01-09T06:01:15.335017+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-ompgo.2","title":"Implement Keyword Resolution and Session Lookup in worker-engine.ts","description":"Add resolveReuseTarget, findReusableSession methods and helpers for keyword mapping and threshold checks.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T06:01:16.595022+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:48:35.565097+01:00","closed_at":"2026-01-11T00:48:35.565097+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-ompgo.2","depends_on_id":"agent-shepherd-ompgo","type":"parent-child","created_at":"2026-01-09T06:01:16.600853+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-ompgo.2.1","title":"Add resolveReuseTarget method to WorkerEngine","description":"Implement private resolveReuseTarget(phaseName, keyword, policy) to map keywords to phase names.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T06:01:18.049704+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:48:35.547859+01:00","closed_at":"2026-01-11T00:48:35.547859+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-ompgo.2.1","depends_on_id":"agent-shepherd-ompgo.2","type":"parent-child","created_at":"2026-01-09T06:01:18.057074+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-ompgo.2.2","title":"Add findReusableSession method to WorkerEngine","description":"Implement private async findReusableSession(issueId, target) to query DB and check thresholds.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T06:01:19.358705+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:48:35.555224+01:00","closed_at":"2026-01-11T00:48:35.555224+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-ompgo.2.2","depends_on_id":"agent-shepherd-ompgo.2","type":"parent-child","created_at":"2026-01-09T06:01:19.363112+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-ompgo.2.3","title":"Add helper methods: sumTokensForSession, getMaxTokens, getThreshold","description":"Implement helper methods to sum tokens, get max tokens from config, and get threshold from config/DB.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T06:01:20.615986+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:48:35.560207+01:00","closed_at":"2026-01-11T00:48:35.560207+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-ompgo.2.3","depends_on_id":"agent-shepherd-ompgo.2","type":"parent-child","created_at":"2026-01-09T06:01:20.617107+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-ompgo.3","title":"Integrate Session Passing and Fallback Logic","description":"Update opencode.ts to support sessionId, integrate reuse logic in worker-engine.ts launchAgent with fallback.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T06:01:21.855306+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T01:04:08.926203+01:00","closed_at":"2026-01-11T01:04:08.926203+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-ompgo.3","depends_on_id":"agent-shepherd-ompgo","type":"parent-child","created_at":"2026-01-09T06:01:21.855864+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-ompgo.3.1","title":"Update runAgentCLI in src/core/opencode.ts to support sessionId","description":"Modify runAgentCLI to accept sessionId and pass --session flag to OpenCode CLI.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T06:01:23.151129+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T01:04:08.913308+01:00","closed_at":"2026-01-11T01:04:08.913308+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-ompgo.3.1","depends_on_id":"agent-shepherd-ompgo.3","type":"parent-child","created_at":"2026-01-09T06:01:23.152094+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-ompgo.3.2","title":"Integrate session reuse in launchAgent with fallback","description":"In launchAgent, resolve target, find session, pass sessionId, handle fallback on error.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T06:01:24.584891+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T01:04:08.920842+01:00","closed_at":"2026-01-11T01:04:08.920842+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-ompgo.3.2","depends_on_id":"agent-shepherd-ompgo.3","type":"parent-child","created_at":"2026-01-09T06:01:24.585543+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-ompgo.4","title":"Implement List-Sessions CLI Command","description":"Add list-sessions command to CLI with inquirer for interactivity, listSessionsForIssue function, and TUI launch.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T06:01:25.709118+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T06:01:25.709118+01:00","dependencies":[{"issue_id":"agent-shepherd-ompgo.4","depends_on_id":"agent-shepherd-ompgo","type":"parent-child","created_at":"2026-01-09T06:01:25.709958+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-ompgo.4.1","title":"Add inquirer dependency for CLI interactivity","description":"Install inquirer package for interactive prompts in list-sessions command.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T06:01:27.053283+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T06:01:27.053283+01:00","dependencies":[{"issue_id":"agent-shepherd-ompgo.4.1","depends_on_id":"agent-shepherd-ompgo.4","type":"parent-child","created_at":"2026-01-09T06:01:27.053981+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-ompgo.4.2","title":"Add list-sessions command to src/cli/index.ts","description":"Add .command('list-sessions \u003cissue-id\u003e') with description and action using inquirer for selection.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T06:01:28.192962+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T06:01:28.192962+01:00","dependencies":[{"issue_id":"agent-shepherd-ompgo.4.2","depends_on_id":"agent-shepherd-ompgo.4","type":"parent-child","created_at":"2026-01-09T06:01:28.193622+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-ompgo.4.3","title":"Implement listSessionsForIssue function","description":"Create async function to query runs, aggregate sessions with phases, tokens, sort by creation time.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T06:01:29.346027+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T06:01:29.346027+01:00","dependencies":[{"issue_id":"agent-shepherd-ompgo.4.3","depends_on_id":"agent-shepherd-ompgo.4","type":"parent-child","created_at":"2026-01-09T06:01:29.346953+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-ompgo.5","title":"Add Tests for Session Continuation and CLI","description":"Create unit tests for worker-engine, integration tests for session continuation, CLI tests, and run them.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T06:01:30.460632+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T06:01:30.460632+01:00","dependencies":[{"issue_id":"agent-shepherd-ompgo.5","depends_on_id":"agent-shepherd-ompgo","type":"parent-child","created_at":"2026-01-09T06:01:30.46134+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-ompgo.5.1","title":"Add unit tests to tests/worker-engine.test.ts","description":"Test keyword resolution, token summing, threshold logic with mocked DB.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T06:01:31.926752+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T06:01:31.926752+01:00","dependencies":[{"issue_id":"agent-shepherd-ompgo.5.1","depends_on_id":"agent-shepherd-ompgo.5","type":"parent-child","created_at":"2026-01-09T06:01:31.927752+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-ompgo.5.2","title":"Add integration tests to tests/session-continuation.test.ts","description":"Simulate workflows with keywords, jumps, thresholds; verify reuse and fallbacks.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T06:01:33.399982+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T06:01:33.399982+01:00","dependencies":[{"issue_id":"agent-shepherd-ompgo.5.2","depends_on_id":"agent-shepherd-ompgo.5","type":"parent-child","created_at":"2026-01-09T06:01:33.400875+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-ompgo.5.3","title":"Add CLI tests to tests/cli-integration.test.ts","description":"Mock DB and inquirer; test list display, selection, TUI launch.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T06:01:34.554161+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T06:01:34.554161+01:00","dependencies":[{"issue_id":"agent-shepherd-ompgo.5.3","depends_on_id":"agent-shepherd-ompgo.5","type":"parent-child","created_at":"2026-01-09T06:01:34.554977+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-ompgo.5.4","title":"Run tests for session continuation","description":"Execute bun test tests/worker-engine.test.ts tests/session-continuation.test.ts tests/cli-integration.test.ts","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T06:01:35.742823+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T06:01:35.742823+01:00","dependencies":[{"issue_id":"agent-shepherd-ompgo.5.4","depends_on_id":"agent-shepherd-ompgo.5","type":"parent-child","created_at":"2026-01-09T06:01:35.743487+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-ompgo.6","title":"Update Documentation for Session Continuation","description":"Add session continuation section to policies-config.md, update cli-reference.md and README.md.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T06:01:36.763145+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T06:01:36.763145+01:00","dependencies":[{"issue_id":"agent-shepherd-ompgo.6","depends_on_id":"agent-shepherd-ompgo","type":"parent-child","created_at":"2026-01-09T06:01:36.764034+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-ompgo.6.1","title":"Add Session Continuation section to docs/policies-config.md","description":"Document reuse_session_from_phase, context_window_threshold, max_context_tokens, shared_session with examples.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T06:01:38.07618+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T06:01:38.07618+01:00","dependencies":[{"issue_id":"agent-shepherd-ompgo.6.1","depends_on_id":"agent-shepherd-ompgo.6","type":"parent-child","created_at":"2026-01-09T06:01:38.077058+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-ompgo.6.2","title":"Update docs/cli-reference.md with list-sessions command","description":"Add description for ashep list-sessions \u003cissue-id\u003e command.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T06:01:39.202531+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T06:01:39.202531+01:00","dependencies":[{"issue_id":"agent-shepherd-ompgo.6.2","depends_on_id":"agent-shepherd-ompgo.6","type":"parent-child","created_at":"2026-01-09T06:01:39.203345+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-ompgo.6.3","title":"Update README.md with session continuation features","description":"Add to Features section and CLI section for session continuation and list-sessions.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T06:01:40.42497+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T06:01:40.42497+01:00","dependencies":[{"issue_id":"agent-shepherd-ompgo.6.3","depends_on_id":"agent-shepherd-ompgo.6","type":"parent-child","created_at":"2026-01-09T06:01:40.425664+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-on2jk","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T01:06:43.391316+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T01:06:43.504231+01:00","deleted_at":"2026-01-11T01:06:43.504231+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-onf1","title":"2.4.4 Create DecisionResult Interface","description":"Define structure for parsed decision agent responses.\n\n## Tasks\n- Define DecisionResult interface:\n  - action: string - \"jump_to_phase_name\" | \"advance_to_phase_name\" | \"require_approval\"\n  - target_phase?: string - Extracted from action (e.g., \"develop\" from \"jump_to_develop\")\n  - reasoning: string - Explanation of decision logic\n  - confidence: number - 0.0-1.0 confidence score\n  - requires_approval: boolean - Auto-triggered for low confidence\n  - recommendations?: string[] - Optional additional suggestions\n- Add to type definitions in policy.ts\n- Document each field and its purpose\n\n## Expected Deliverables\n- DecisionResult interface defined\n- Type definitions added to policy.ts\n- Documentation of all fields","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:53:05.393305+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-oup4","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T21:46:02.728117+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:46:02.807644+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T21:46:02.807644+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ov5b","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T03:38:11.003266+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:38:11.068719+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T03:38:11.068719+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ovkp","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:54:00.909347+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:54:01.055181+01:00","deleted_at":"2026-01-06T15:54:01.055181+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ow6hh","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-10T00:11:57.264318+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T00:11:57.311257+01:00","deleted_at":"2026-01-10T00:11:57.311257+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-own","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:32:30.64096+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:30.688856+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-06T04:32:30.688856+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-oxhy","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:31:18.247121+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:31:18.448546+01:00","deleted_at":"2026-01-07T18:31:18.448546+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-oxq5e","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:08:10.293161+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:08:10.822493+01:00","deleted_at":"2026-01-11T00:08:10.822493+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-oy5h","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-06T15:57:12.717863+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:57:12.776211+01:00","deleted_at":"2026-01-06T15:57:12.776211+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-ozk0","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:35:17.324554+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:35:17.498582+01:00","deleted_at":"2026-01-06T23:35:17.498582+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ozp","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:42:30.317568+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:42:30.384286+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-06T04:42:30.384286+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-p0a2e","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:20:54.100727+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:54.174833+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-09T01:20:54.174833+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-p1re","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:24:25.037083+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:24:25.150499+01:00","deleted_at":"2026-01-07T18:24:25.150499+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-p2mfv","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:52:29.391627+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:52:29.839055+01:00","deleted_at":"2026-01-11T00:52:29.839055+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-p45v","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:33:23.335931+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:23.380409+01:00","deleted_at":"2026-01-07T18:33:23.380409+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-p4f6","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T22:55:51.218586+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:55:51.292711+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-08T22:55:51.292711+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-p5fg","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T18:31:17.925473+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:31:17.986592+01:00","deleted_at":"2026-01-07T18:31:17.986592+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-p8fhg","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T23:03:55.077121+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:03:55.124135+01:00","deleted_at":"2026-01-09T23:03:55.124135+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-p94","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-06T04:35:53.462833+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:35:53.528757+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-06T04:35:53.528757+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-p9sn","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T06:03:26.737522+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T06:03:26.798287+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T06:03:26.798287+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-pa06","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:33:45.607975+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:45.74338+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T18:33:45.74338+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-pb8v","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T03:43:26.501161+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:43:26.56545+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T03:43:26.56545+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-pbcy","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-06T15:57:12.539837+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:57:12.601906+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-06T15:57:12.601906+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-pdykb","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-09T01:38:36.536584+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:38:36.608572+01:00","deleted_at":"2026-01-09T01:38:36.608572+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-pe2ti","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:50:41.208529+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:50:41.501298+01:00","deleted_at":"2026-01-09T04:50:41.501298+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-peo","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:34:54.723899+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:54.816256+01:00","deleted_at":"2026-01-06T04:34:54.816256+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-pgu","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:24:43.046483+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:28.932946+01:00","deleted_at":"2026-01-06T04:32:28.932946+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-phtg","title":"3.2.7 Add Archive Queries","description":"Provide queries specific to archive data for historical analysis. Add getArchivedRuns(), getArchivedRunCount(), getArchiveSize(), cleanupArchive() methods for archive-specific operations.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:09:32.31686+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:12:28.128095+01:00","deleted_at":"2026-01-07T01:12:28.128095+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-pikr","title":"3.2.4 Implement JSONL Archival","description":"Archive JSONL files alongside database for source of truth preservation. Create archiveOldJSONL() method that filters old records, appends to archive JSONL files, and maintains JSONL as audit trail.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:09:25.656842+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:12:28.303182+01:00","deleted_at":"2026-01-07T01:12:28.303182+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-pj16","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T02:51:19.724862+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:51:20.121416+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T02:51:20.121416+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-pk2mw","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:17:04.955872+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:17:05.139021+01:00","deleted_at":"2026-01-08T23:17:05.139021+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-pl7rl","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:31:30.927566+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:31:31.13649+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-11T00:31:31.13649+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-pnaw4","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:50:40.566597+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:50:40.855699+01:00","deleted_at":"2026-01-09T04:50:40.855699+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-pp8a","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:29:39.153358+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:29:39.194812+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T18:29:39.194812+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ppgur","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-10T00:11:56.288629+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T00:11:56.38395+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-10T00:11:56.38395+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ppos","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-06T15:54:01.702174+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:54:02.051113+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-06T15:54:02.051113+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-ppqt","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T18:33:45.141538+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:45.575132+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T18:33:45.575132+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-pqls","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-08T22:55:51.932844+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:55:52.39019+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-08T22:55:52.39019+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-pqtj","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:44:00.674922+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:44:00.758452+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T02:44:00.758452+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ps9w7","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:16:31.793545+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:16:31.87432+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-09T20:16:31.87432+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-pseo","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:29:38.45308+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:29:38.517495+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T18:29:38.517495+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ptkz","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:51:19.166895+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:51:19.228172+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T02:51:19.228172+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ptph","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:14:40.111414+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:14:40.20205+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T18:14:40.20205+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-pujb2","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:52:26.626682+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:52:26.818021+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-11T00:52:26.818021+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-pvqab","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:15:59.263263+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:59.38927+01:00","deleted_at":"2026-01-09T01:15:59.38927+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-pvr3","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:40:00.093323+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:40:00.188645+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T18:40:00.188645+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-pvvue","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T20:40:53.439519+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:40:53.948049+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T20:40:53.948049+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-pw2p","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:42:00.512618+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:42:00.649943+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T02:42:00.649943+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-pwnj","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T16:34:50.987878+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T16:34:51.05211+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T16:34:51.05211+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-pxr3","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:29:39.849993+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:29:39.972997+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T18:29:39.972997+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-py4s","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T20:36:36.559545+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T20:36:36.765664+01:00","deleted_at":"2026-01-07T20:36:36.765664+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-pyjg","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:28:07.341053+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:28:07.425659+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-06T23:28:07.425659+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-q0k5m","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:08:07.693931+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:08:08.002538+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-11T00:08:08.002538+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-q1qw","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T18:29:38.066627+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:29:38.127552+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T18:29:38.127552+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-q22cu","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:08:10.060042+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:08:10.223376+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-11T00:08:10.223376+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-q2ht","title":"2.5.6 Add Retry Logic for Decision Agents","description":"Retry decision agent if response parsing fails.\n\n## Tasks\n- Implement retry logic in executeDecisionAgent():\n  - Track retry count (max 2)\n  - If parsing fails, retry with clarifying prompt\n  - After retries exhausted, fallback to require_approval\n- Clarifying prompt on retry:\n  ```\n  Your previous response could not be parsed. Please respond with valid JSON in exactly this format:\n  \n  {\n    \"decision\": \"jump_to_phase_name\" | \"advance_to_phase_name\" | \"require_approval\",\n    \"reasoning\": \"Brief explanation\",\n    \"confidence\": 0.0-1.0,\n    \"recommendations\": [\"Optional suggestions\"]\n  }\n  \n  Your decision must be one of the allowed destinations: [allowed_destinations]\n  ```\n- Test retry behavior:\n  - First attempt: malformed JSON\n  - Second attempt: clarified, valid JSON\n  - Verify retry with clarifying prompt\n  - Verify max retries enforced (after 2, fallback to require_approval)\n  - Verify fallback works correctly\n\n## Expected Deliverables\n- Retry logic implemented\n  - Clarifying prompt on retries\n  - Max 2 retries enforced\n  - Fallback to require_approval after retries\n  - Tests verifying retry behavior","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:53:38.09847+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-q2sn","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T03:57:11.537124+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T03:57:11.612933+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-08T03:57:11.612933+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-q47zh","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:43:42.284224+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:43:42.33146+01:00","deleted_at":"2026-01-08T23:43:42.33146+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-q5230","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:16:33.511794+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:16:33.662341+01:00","labels":["label2","label3"],"deleted_at":"2026-01-09T20:16:33.662341+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-q5b15","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:15:59.067136+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:59.13872+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-09T01:15:59.13872+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-q6477","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:49:39.104005+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:49:39.262586+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-09T04:49:39.262586+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-q7ng","title":"2.2.5 Update determineTransition() to Use Conditional Transitions","description":"Use transition configuration when available, fall back to default.\n\n## Tasks\n- Modify policy.ts:determineTransition() (lines 263-327):\n  - Check for custom transitions (OPTIONAL - only if defined):\n    - Get phaseConfig from policy\n    - Check if phaseConfig.transitions exists\n  - If transitions present:\n    - Map outcome to transition key using getTransitionKey()\n    - Get transitionConfig from phaseConfig.transitions[transitionKey]\n    - If string: Return {type: 'advance', next_phase: string, reason}\n    - If object: Return {type: 'dynamic_decision', dynamic_agent: string, decision_config: object, reason}\n  - If no transitions or no matching key:\n    - Use default linear behavior (backward compatible)\n    - Call getDefaultTransition(policy, currentPhase, outcome)\n- Design rationale:\n  - Check transitions block first (optional)\n  - Use getTransitionKey() to map outcome to config\n  - Handle string transitions (direct jump)\n  - Handle object transitions (AI decision)\n  - Default linear behavior if no transitions block\n\n## Expected Deliverables\n- Updated determineTransition() with conditional transition support\n- String and object transition handling\n- Default linear behavior fallback\n- 100% backward compatibility maintained","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:51:34.428176+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-q8znc","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-09T01:24:04.075194+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:24:04.145069+01:00","deleted_at":"2026-01-09T01:24:04.145069+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-q9q3","title":"2.2 Add Conditional Transition Configuration Schema","description":"Add optional transitions block to PhaseConfig for conditional routing. Extend policy YAML schema, implement parsing, and create example policies demonstrating various transition patterns.\n\n## Scope\n- Extend PhaseConfig interface with optional transitions block\n- Update policy YAML schema for validation\n- Implement transition config parsing\n- Add getTransitionKey() helper for outcome mapping\n- Update determineTransition() to use conditional transitions\n- Create example policies with various transition patterns\n- Add configuration tests\n\n## Dependencies\n- Depends on 2.1 (transition types)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-07T00:05:08.374305+01:00","updated_at":"2026-01-07T00:06:15.832092+01:00","deleted_at":"2026-01-07T00:06:15.832092+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-qaed","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:30:20.922305+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:30:21.010067+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T14:30:21.010067+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-qajmr","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-10T00:11:57.184168+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T00:11:57.231821+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-10T00:11:57.231821+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-qax0m","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:43:43.193612+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:43:43.309857+01:00","deleted_at":"2026-01-08T23:43:43.309857+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-qcrm","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:36:01.875894+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:36:01.936788+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T02:36:01.936788+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-qd2l","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T22:07:38.694466+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T22:07:38.739701+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T22:07:38.739701+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-qde0","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:30:20.513411+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:30:20.594572+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T14:30:20.594572+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-qdsk","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T21:44:10.512972+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:44:11.047914+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T21:44:11.047914+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-qftz","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:11:46.558165+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:11:46.603916+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T18:11:46.603916+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-qfxe3","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:49:39.441787+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:49:39.74943+01:00","deleted_at":"2026-01-09T04:49:39.74943+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-qgbso","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T23:23:28.648979+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:23:29.183058+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T23:23:29.183058+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-qhsg2","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:13:54.068221+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:13:54.132858+01:00","deleted_at":"2026-01-09T01:13:54.132858+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-qkpw","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T05:04:23.035605+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:04:23.14745+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T05:04:23.14745+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-qku","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:42:30.123386+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:42:30.184126+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-06T04:42:30.184126+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-qkure","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T01:06:43.570772+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T01:06:43.850616+01:00","deleted_at":"2026-01-11T01:06:43.850616+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ql36","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T05:54:20.966894+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:54:21.073677+01:00","deleted_at":"2026-01-08T05:54:21.073677+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-qm5tv","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:20:30.500693+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:30.55331+01:00","deleted_at":"2026-01-09T01:20:30.55331+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-qmax","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:03:07.370573+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:03:07.438328+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T19:03:07.438328+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-qna2e","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-09T01:13:52.824543+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:13:52.897442+01:00","deleted_at":"2026-01-09T01:13:52.897442+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-qoeq","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T03:38:12.097529+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:38:12.275294+01:00","deleted_at":"2026-01-07T03:38:12.275294+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-qpdhy","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:13:52.486705+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:13:52.567865+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T01:13:52.567865+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-qr80","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T02:41:58.632119+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:41:58.697995+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T02:41:58.697995+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-qr9u","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T15:02:08.856954+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T15:02:08.948109+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T15:02:08.948109+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-qs4t","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-08T03:57:13.067066+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T03:57:13.558459+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-08T03:57:13.558459+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-qwarg","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:23:33.324043+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:23:33.418573+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-09T01:23:33.418573+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-qwsb5","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:08:09.074159+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:08:09.232519+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-11T00:08:09.232519+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-qwsw","title":"2.5.3 Add Contextual Information to Prompts","description":"Include rich context in decision prompts.\n\n## Tasks\n- Add to decision prompts:\n  - Recent decisions (last 5):\n    - Shows decision history for consistency\n    - Helps agent understand previous choices\n    - Format: list of recent decision types and actions\n  - Average phase durations:\n    - Performance context\n    - Identifies slow phases\n    - Calculate from phase history\n  - Previous agent outputs:\n    - Full execution results\n    - Artifacts and warnings\n    - Include from previousOutcome\n  - Relevant Beads issue labels:\n    - Custom labels with context\n    - Priority and type information\n    - Extract from issue.labels\n  - Policy constraints:\n    - Max attempts, timeouts, requirements\n    - Any phase-specific constraints\n    - Extract from policy phase config\n- Format as well-structured markdown sections\n- Ensure prompts don't exceed agent context limits:\n  - Truncate or summarize very long histories if needed\n  - Implement smart summarization for large histories\n\n## Expected Deliverables\n- Rich context added to decision prompts\n  - All data sources integrated\n  - Formatted as markdown sections\n  - Context limit handling implemented","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:53:38.070839+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-qz1y7","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T23:23:28.405431+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:23:28.454484+01:00","deleted_at":"2026-01-09T23:23:28.454484+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-qz3ii","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T01:23:32.520907+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:23:32.592626+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-09T01:23:32.592626+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-r2p0b","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:40:52.137267+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:40:52.236814+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-09T20:40:52.236814+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-r3e","title":"Test format check","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T04:30:02.987535+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:41:36.250052+01:00","closed_at":"2026-01-06T23:41:36.250052+01:00","close_reason":"Closed"}
{"id":"agent-shepherd-r3sx6","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:20:53.965181+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:54.064378+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-09T01:20:54.064378+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-r676g","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:16:32.393619+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:16:32.601714+01:00","deleted_at":"2026-01-09T20:16:32.601714+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-r6p","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:36:25.267016+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:36:25.326475+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-06T04:36:25.326475+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-r7dj","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-08T05:56:19.052818+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:56:19.505172+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-08T05:56:19.505172+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-r8m9","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T21:44:09.054453+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:44:09.166592+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T21:44:09.166592+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-r8mr","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T04:53:55.548205+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T04:53:55.613729+01:00","deleted_at":"2026-01-07T04:53:55.613729+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-r9im","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:36:02.269493+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:36:02.330048+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T02:36:02.330048+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ra4p","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:30:22.674065+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:30:22.786044+01:00","deleted_at":"2026-01-07T14:30:22.786044+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-rc67","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:33:44.923773+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:44.96941+01:00","deleted_at":"2026-01-07T18:33:44.96941+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-rcjk","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:14:41.310999+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:14:41.444638+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T18:14:41.444638+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-rcow","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:44:01.937727+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:44:02.041257+01:00","deleted_at":"2026-01-07T02:44:02.041257+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-rcr62","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:40:51.914494+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:40:51.99321+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-09T20:40:51.99321+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-rd0y","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:00:14.890418+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:00:14.955114+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T19:00:14.955114+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-rd7y","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T06:03:26.40758+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T06:03:26.585351+01:00","deleted_at":"2026-01-07T06:03:26.585351+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-rdfv","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T03:43:27.231382+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:43:27.294068+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T03:43:27.294068+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-rdj7","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:28:08.172372+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:28:08.210205+01:00","deleted_at":"2026-01-06T23:28:08.210205+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-rhfm","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:30:21.924704+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:30:22.034226+01:00","deleted_at":"2026-01-07T14:30:22.034226+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ricg","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T21:46:04.061055+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:46:04.115261+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T21:46:04.115261+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-riut4","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:17:04.855396+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:17:04.92238+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-08T23:17:04.92238+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-rix7r","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:41:41.930381+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:41:42.073065+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-09T04:41:42.073065+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-riym","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-06T23:28:06.940422+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:28:07.08379+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-06T23:28:07.08379+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-rke9f","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T01:06:42.46983+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T01:06:42.637598+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-11T01:06:42.637598+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-rlnv","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:59:42.987963+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:59:43.052891+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T02:59:43.052891+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-rltt","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T18:33:23.552982+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:23.978838+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T18:33:23.978838+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-rm5","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:35:55.194397+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:35:55.314564+01:00","labels":["label2","label3"],"deleted_at":"2026-01-06T04:35:55.314564+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-rmqg","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T14:30:20.62798+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:30:20.695551+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T14:30:20.695551+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-rnje","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-06T16:00:26.352124+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T16:00:26.728512+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-06T16:00:26.728512+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-roymr","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-09T20:16:31.542946+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:16:31.62101+01:00","deleted_at":"2026-01-09T20:16:31.62101+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-rrm3","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:51:20.15236+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:51:20.273493+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T02:51:20.273493+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-rs67","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T16:00:26.912734+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T16:00:27.009473+01:00","deleted_at":"2026-01-06T16:00:27.009473+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-rswo","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:39:59.651175+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:39:59.740242+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T18:39:59.740242+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-rsxl0","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:49:38.715329+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:49:38.866979+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-09T04:49:38.866979+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-rtk25","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:15:32.386979+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:32.436382+01:00","deleted_at":"2026-01-09T01:15:32.436382+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-rtvk","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T05:54:19.763971+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:54:19.838716+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-08T05:54:19.838716+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-rv9gz","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T04:41:41.489716+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:41:41.596078+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-09T04:41:41.596078+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-rvwl","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T19:05:10.81485+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:05:11.275036+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T19:05:11.275036+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-rxpq","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:41:59.334348+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:41:59.420382+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T02:41:59.420382+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-rxtcg","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-09T04:39:40.547485+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:39:40.651212+01:00","deleted_at":"2026-01-09T04:39:40.651212+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-ry3a","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:40:16.209573+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:40:16.332941+01:00","deleted_at":"2026-01-07T18:40:16.332941+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-s1eo","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:36:01.76165+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:36:01.844593+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T02:36:01.844593+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-s2d","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:34:13.636825+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:13.718168+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-06T04:34:13.718168+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-s2qd","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T06:03:26.187987+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T06:03:26.274834+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T06:03:26.274834+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-s314","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T18:40:15.543185+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:40:15.979727+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T18:40:15.979727+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-s36q","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T15:02:09.794998+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T15:02:09.839013+01:00","deleted_at":"2026-01-07T15:02:09.839013+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-s41w","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-06T23:35:16.416339+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:35:16.477627+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-06T23:35:16.477627+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-s4t","title":"Phase 5: Exclusion Control","description":"**Effort:** ~2 hours | **Risk:** Low\n\nExclude issues from processing via `ashep-excluded` label.\n\n## Tasks\n\n1. Implement `hasExcludedLabel(issueId)` helper in beads.ts\n2. Update `getEligibleIssues()` in worker-engine.ts to filter by label (not text)\n3. Remove `excluded_tags` from WorkerConfig interface\n4. Update WorkerEngine constructor to remove excluded_tags\n5. Write unit tests for exclusion logic\n\n## Files Modified\n- `.agent-shepherd/src/core/beads.ts`\n- `.agent-shepherd/src/core/worker-engine.ts`\n- `tests/exclusion-control.test.ts` (new file)\n\n## Acceptance Criteria\n- [ ] hasExcludedLabel() correctly identifies excluded issues\n- [ ] getEligibleIssues() filters by label (not text)\n- [ ] excluded_tags removed from WorkerConfig\n- [ ] Constructor doesn't use excluded_tags\n- [ ] Excluded issues are skipped with log message\n- [ ] Unit tests passing\n\n## Code Preview (beads.ts)\n```typescript\nasync function hasExcludedLabel(issueId: string): Promise\u003cboolean\u003e {\n  const labels = await getIssueLabels(issueId);\n  return labels?.includes('ashep-excluded') || false;\n}\n```\n\n## Code Preview (worker-engine.ts)\n```typescript\nexport interface WorkerConfig {\n  poll_interval_ms?: number;\n  max_concurrent_runs?: number;\n  // excluded_tags?: string[];  // REMOVED\n}\n\nconstructor(config?: WorkerConfig) {\n  this.config = {\n    poll_interval_ms: 30000,\n    max_concurrent_runs: 3,\n    // excluded_tags removed\n    ...config,\n  };\n}\n\nprivate async getEligibleIssues(): Promise\u003cBeadsIssue[]\u003e {\n  const readyIssues = await getReadyIssues();\n  \n  // Filter out excluded issues (by label, not text)\n  const eligibleIssues: BeadsIssue[] = [];\n  \n  for (const issue of readyIssues) {\n    const isExcluded = issue.labels?.includes('ashep-excluded') || false;\n    \n    if (isExcluded) {\n      console.log(`Skipping excluded issue: ${issue.id} (${issue.title})`);\n    } else {\n      eligibleIssues.push(issue);\n    }\n  }\n  \n  return eligibleIssues;\n}\n```","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T17:09:21.35749+01:00","updated_at":"2026-01-05T17:22:57.803826+01:00","close_reason":"Removed as requested by user","dependencies":[{"issue_id":"agent-shepherd-s4t","depends_on_id":"agent-shepherd-3of","type":"parent-child","created_at":"2026-01-05T17:09:26.362492+01:00","created_by":"daemon"},{"issue_id":"agent-shepherd-s4t","depends_on_id":"agent-shepherd-m0i","type":"blocks","created_at":"2026-01-05T17:10:25.973667+01:00","created_by":"daemon"}],"deleted_at":"2026-01-05T17:22:57.803826+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-s6859","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:41:42.489932+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:41:42.633351+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-09T04:41:42.633351+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-s7qm","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:30:21.850629+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:30:21.893894+01:00","deleted_at":"2026-01-07T14:30:21.893894+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-s96u","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T18:11:46.914107+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:11:47.437579+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T18:11:47.437579+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-sfvz","title":"3.2.5 Add Archive Sync on Startup","description":"Sync archive JSONL to archive database on startup. Ensure archive database is up to date by syncing from JSONL on ArchiveLogger construction with same logic as active database.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:09:27.530243+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:12:28.128095+01:00","deleted_at":"2026-01-07T01:12:28.128095+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-sg21","title":"3.2 Create Archival System","description":"Create dual database architecture for active and archive data with seamless querying. Includes dual database design, ArchiveLogger class, cross-database querying, JSONL archival, archive sync, archive pruning, archive queries, performance optimization, and comprehensive tests.","status":"tombstone","priority":2,"issue_type":"epic","created_at":"2026-01-07T01:09:18.478614+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:12:28.303182+01:00","deleted_at":"2026-01-07T01:12:28.303182+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"agent-shepherd-sgt74","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:46:39.630942+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:46:39.74873+01:00","deleted_at":"2026-01-09T20:46:39.74873+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-sgzco","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:49:39.895475+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:49:39.962741+01:00","deleted_at":"2026-01-09T04:49:39.962741+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-sh6d6","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:40:54.170692+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:40:54.295699+01:00","deleted_at":"2026-01-09T20:40:54.295699+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-sii1","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:00:15.873534+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:00:16.039012+01:00","deleted_at":"2026-01-07T19:00:16.039012+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-sjlx","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:28:08.910791+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:28:09.03743+01:00","labels":["label2","label3"],"deleted_at":"2026-01-06T23:28:09.03743+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-sjsi","title":"2.2.3 Implement Transition Config Parsing","description":"Parse transition blocks from YAML with validation.\n\n## Tasks\n- Modify policy.ts:loadPolicies() (lines 78-110):\n  - Add validation for transitions block in validatePolicy()\n  - Parse transition block for each phase if present\n  - Validate transition config structure on load\n  - Provide helpful error messages for invalid configs\n- Add validation function:\n  - validateTransitionBlock(phaseName: string, transitions: TransitionBlock, policyPhases: string[]): void\n  - For each transition type (success, failure, partial_success, unclear):\n    - If string: Validate phase exists in policyPhases\n    - If object: Validate capability, prompt, allowed_destinations present\n    - Validate allowed_destinations are in policyPhases\n    - Validate confidence_thresholds are 0.0-1.0 if present\n  - Throw descriptive errors on validation failure\n\n## Expected Deliverables\n- validateTransitionBlock() method implemented\n- loadPolicies() updated to parse transitions\n- Error handling for invalid configs","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:51:34.39871+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-sk1d5","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:15:32.30084+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:32.351266+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-09T01:15:32.351266+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-sk91d","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:52:31.941917+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:52:32.29945+01:00","labels":["label2","label3"],"deleted_at":"2026-01-11T00:52:32.29945+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-skeo","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:43:59.617584+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:43:59.703454+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T02:43:59.703454+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-slmxq","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:31:29.391378+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:31:29.728431+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-11T00:31:29.728431+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-slqu","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T04:53:57.219165+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T04:53:57.347341+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T04:53:57.347341+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-sokq","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:58:04.805896+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:58:04.892429+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-06T15:58:04.892429+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-sp5zz","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:13:53.181361+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:13:53.379866+01:00","deleted_at":"2026-01-09T01:13:53.379866+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-src92","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:43:42.36602+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:43:42.48624+01:00","deleted_at":"2026-01-08T23:43:42.48624+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ss5f","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:40:00.225114+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:40:00.293974+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T18:40:00.293974+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-sspug","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-09T23:03:53.90944+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:03:53.982953+01:00","deleted_at":"2026-01-09T23:03:53.982953+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-stnn","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T20:36:36.940069+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T20:36:37.01721+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T20:36:37.01721+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-sunw","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T05:56:18.435284+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:56:18.508023+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-08T05:56:18.508023+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-svc9","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:58:04.635921+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:58:04.693357+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-06T15:58:04.693357+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-sw0j","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T02:57:16.483145+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T02:57:16.533103+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-08T02:57:16.533103+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-sw8ft","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T23:23:27.974144+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:23:28.056814+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-09T23:23:28.056814+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-sx1t","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:03:07.468908+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:03:07.641174+01:00","deleted_at":"2026-01-07T19:03:07.641174+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-sy25b","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-09T04:49:38.502104+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:49:38.672899+01:00","deleted_at":"2026-01-09T04:49:38.672899+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-sz8x","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-08T02:57:16.799914+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T02:57:17.257+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-08T02:57:17.257+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-t10fq","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:08:09.78937+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:08:09.997089+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-11T00:08:09.997089+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-t2xoz","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:12:16.851544+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:12:16.921311+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-08T23:12:16.921311+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-t3z8","title":"2.1.4 Add Transition Validation","description":"Validate transitions before returning them to ensure safety.\n\n## Tasks\n- Create validateTransition(policy: PolicyConfig, transition: PhaseTransition): void method:\n  - Validate jump_target_phase exists in policy:\n    - If type === \"jump_back\" or transition.jump_target_phase:\n    - Check if jump_target_phase is in policy.phases array\n    - Throw error if phase not found: \"Target phase 'X' not found in policy\"\n  - Validate no circular jumps (phase jumping to itself):\n    - Check if jump_target_phase === currentPhase\n    - Throw error if same: \"Cannot jump from phase 'X' to itself\"\n  - Validate dynamic_agent is valid capability:\n    - If type === \"dynamic_decision\":\n    - Check agent registry has agents with this capability\n    - Throw error if no agents: \"No agents found with capability 'X'\"\n- Call validation before returning transition in determineTransition()\n- Throw descriptive errors on invalid transitions\n\n## Expected Deliverables\n- validateTransition() method implemented\n- Jump target validation\n- Circular jump detection\n- Dynamic agent capability validation\n- Error handling","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:51:07.862033+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-t4ru","title":"2.2.6 Create Example Policies with Conditional Transitions","description":"Add example policies demonstrating various transition patterns.\n\n## Tasks\n- Add enhanced-dev policy to config/policies.yaml:\n  - Develop phase: on_success: test, on_failure: develop (direct jumps)\n  - Test phase: AI routing for success and failure (test-decision capability)\n    - on_success: Test quality assessment with confidence thresholds\n    - on_failure: Analyze failures, decide between fix code vs fix tests\n    - Enable messaging for test results\n  - Validate phase: Partial success handling with validation-decision\n    - on_success: close\n    - on_partial_success: Assess quality, decide between develop/validate/close\n- Add quality-gate policy with validation phase using partial_success\n- Add flexible-workflow policy with multiple conditional transitions\n- Document each policy's use case and when to use it\n\n## Expected Deliverables\n- enhanced-dev policy with conditional transitions\n- quality-gate policy\n- flexible-workflow policy\n- Documentation of use cases","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:51:34.429298+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-t6f7e","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T20:11:03.636861+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:11:04.097097+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T20:11:04.097097+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-t74","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:34:53.322186+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:53.497962+01:00","deleted_at":"2026-01-06T04:34:53.497962+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-t752","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:35:16.512408+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:35:16.577144+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-06T23:35:16.577144+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-t7g1","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:24:23.844544+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:24:24.016006+01:00","deleted_at":"2026-01-07T18:24:24.016006+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-t80a5","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:40:53.104815+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:40:53.157742+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-09T20:40:53.157742+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-t94k","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:26:24.971964+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:26:25.082837+01:00","deleted_at":"2026-01-07T14:26:25.082837+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-t95w","title":"2.2.6 Create Example Policies with Conditional Transitions","description":"Add example policies to config/policies.yaml demonstrating various transition patterns: enhanced-dev, quality-gate, flexible-workflow with different conditional routing scenarios.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-07T00:05:24.851407+01:00","updated_at":"2026-01-07T00:06:15.832092+01:00","deleted_at":"2026-01-07T00:06:15.832092+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-t9mj","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T16:00:25.150454+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T16:00:25.208033+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-06T16:00:25.208033+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ta3f","title":"3.1.8 Implement Size Limit Enforcement","description":"Monitor and enforce database size limits. Add size limits to config, check size on startup, trigger cleanup if exceeded. Implement enforceSizeLimits() and getDatabaseStats() methods.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:09:15.252244+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:12:28.540456+01:00","deleted_at":"2026-01-07T01:12:28.540456+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-tanz","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:33:22.183526+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:22.255581+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T18:33:22.255581+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-taxd","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:59:43.179851+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:59:43.247842+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T02:59:43.247842+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-tcd0j","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:20:30.175475+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:30.378537+01:00","deleted_at":"2026-01-09T01:20:30.378537+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-tcq0","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T05:46:21.766189+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:46:21.881888+01:00","deleted_at":"2026-01-07T05:46:21.881888+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-th16","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T21:44:09.737701+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:44:09.821328+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T21:44:09.821328+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-tio","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:35:53.361258+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:35:53.429967+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-06T04:35:53.429967+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-tj2z6","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:15:57.837292+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:57.911579+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-09T01:15:57.911579+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-tjin","title":"3.1.2 Add Retention Policy Configuration","description":"Add retention settings to main configuration. Add retention section to config/config.yaml with active_window_days, archive_threshold_days, delete_threshold_days, enabled, schedule_interval_hours. Add validation for thresholds and loadRetentionPolicy() function.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:09:03.157129+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:12:28.950967+01:00","deleted_at":"2026-01-07T01:12:28.950967+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-tl3m","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T21:44:11.296674+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:44:11.434007+01:00","deleted_at":"2026-01-07T21:44:11.434007+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-tlfi","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:40:13.885605+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:40:13.979729+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T18:40:13.979729+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-tmla","title":"3.1.7 Add Scheduled Cleanup","description":"Implement periodic cleanup job with background timer. Create startScheduledCleanup() method that runs cleanup at configured interval, tracks last cleanup time, and prevents double runs.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:09:13.673198+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:12:28.540456+01:00","deleted_at":"2026-01-07T01:12:28.540456+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-tnsk","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T18:31:17.73957+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:31:17.806291+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T18:31:17.806291+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-to3u","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T15:02:08.761055+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T15:02:08.825784+01:00","deleted_at":"2026-01-07T15:02:08.825784+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-torfj","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:08:08.799054+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:08:09.006924+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-11T00:08:09.006924+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-tq8mb","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:16:32.639009+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:16:32.688384+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-09T20:16:32.688384+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-tr0k","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:51:18.873882+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:51:19.031884+01:00","deleted_at":"2026-01-07T02:51:19.031884+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-trfb","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:24:24.122057+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:24:24.1647+01:00","deleted_at":"2026-01-07T18:24:24.1647+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-tryxe","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T23:03:53.58445+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:03:53.658472+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T23:03:53.658472+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-tt9i","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:59:43.787103+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:59:43.869545+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T02:59:43.869545+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ttgj8","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:20:54.706525+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:54.906101+01:00","deleted_at":"2026-01-09T01:20:54.906101+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-tu13","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T16:34:51.081826+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T16:34:51.14756+01:00","deleted_at":"2026-01-07T16:34:51.14756+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-tuy2c","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T23:03:56.034525+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:03:56.156053+01:00","deleted_at":"2026-01-09T23:03:56.156053+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-tved","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-08T05:56:17.784832+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:56:17.849893+01:00","deleted_at":"2026-01-08T05:56:17.849893+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-two1","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:28:07.929532+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:28:08.079907+01:00","deleted_at":"2026-01-06T23:28:08.079907+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-tybys","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:17:06.599336+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:17:06.71445+01:00","deleted_at":"2026-01-08T23:17:06.71445+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-tyft","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:40:15.391447+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:40:15.505524+01:00","deleted_at":"2026-01-07T18:40:15.505524+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-tyv9","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:57:13.672438+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:57:13.711134+01:00","deleted_at":"2026-01-06T15:57:13.711134+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-u1fy0","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:38:36.42834+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:38:36.502761+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-09T01:38:36.502761+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-u2lp","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T05:46:21.27555+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:46:21.34864+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T05:46:21.34864+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-u2qek","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:49:38.903928+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:49:39.022125+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-09T04:49:39.022125+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-u2xh","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T06:03:26.825571+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T06:03:26.99003+01:00","deleted_at":"2026-01-07T06:03:26.99003+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-u7pj","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T02:59:43.083641+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:59:43.147539+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T02:59:43.147539+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-u817","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T02:59:43.280103+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:59:43.34361+01:00","deleted_at":"2026-01-07T02:59:43.34361+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-u8px9","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:40:52.870655+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:40:53.066937+01:00","deleted_at":"2026-01-09T20:40:53.066937+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-u9da","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:39:12.060022+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:39:12.167766+01:00","deleted_at":"2026-01-07T14:39:12.167766+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-uaq0y","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:38:37.672417+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:38:37.721262+01:00","deleted_at":"2026-01-09T01:38:37.721262+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ub7z","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T15:02:09.870781+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T15:02:09.976801+01:00","deleted_at":"2026-01-07T15:02:09.976801+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-uftl1","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:41:43.272953+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:41:43.336015+01:00","deleted_at":"2026-01-09T04:41:43.336015+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ugdfc","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:15:58.19435+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:58.268708+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-09T01:15:58.268708+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-uhe8","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:05:10.181956+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:05:10.249607+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T19:05:10.249607+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ui3u","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T03:43:27.820785+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:43:28.238622+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T03:43:28.238622+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-uiw","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:35:54.237552+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:35:54.299213+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-06T04:35:54.299213+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-uj0","title":"Agent Shepherd Fallback Agent System Implementation","description":"Problem Statement\nWhen running ashep quickstart, validation fails because policies require capabilities (testing, qa, review, architecture) that don't exist in synced OpenCode agents. This prevents new users from getting started immediately.\n\nSolution: Cascading Fallback Agent Hierarchy\nA three-tier fallback system that allows capabilities to map to existing real agents in OpenCode:\nPhase-Level (specific) → Policy-Level (policy-wide) → Global-Level (system-wide)\n\nKey concept: When a policy requires a capability that no agent has, the system falls back to a specified agent (e.g., build) to handle the task anyway.\n\nDesign Decisions Confirmed\n1. Configuration Structure\nconfig.yaml (Global Level):\nfallback:\n  enabled: true              # Master switch - if false, NO fallback anywhere\n  default_agent: build       # Default fallback agent for all capabilities\n  mappings:                 # Optional: global capability-specific mappings\n    review: summary\n    documentation: summary\n    architecture: plan\n\npolicies.yaml (Policy and Phase Levels):\npolicies:\n  simple:\n    fallback_enabled: true        # Inherits from global if not set\n    fallback_agent: build        # Inherits from global if not set\n    fallback_mappings:           # Optional: policy-specific mappings\n      review: summary\n    phases:\n      - name: test\n        capabilities: [testing]\n        # Phase-level override:\n        fallback_agent: general\n        # OR disable for this phase:\n        fallback_enabled: false\n\n2. Hierarchy Rules\n- Cascading: Phase-level overrides Policy-level overrides Global-level\n- Default inheritance: If a level doesn't specify settings, inherit from higher level\n- Disable: If fallback_enabled: false at any level, fallback is disabled for that level\n- Master switch: If config.fallback.enabled: false, NO fallback anywhere\n\n3. Mappings Explained\nmappings allows capability-specific fallback agents:\n- Without mappings: All missing capabilities use default_agent: build\n- With mappings: Specific capabilities use different agents:\n  - review: summary → Review tasks handled by summary agent\n  - architecture: plan → Architecture tasks handled by plan agent\n  - Everything else → Falls back to build\nWhy mappings?\n- Better agent matching for different work types\n- summary agent is better at review/documentation than build agent\n- plan agent is better at architecture than build agent\n- Still provides default fallback for anything else\n\n4. Confirmed Defaults\n- Default fallback agent: build (has: coding, refactoring, building)\n- Default enabled state: true (turned on for both config and policies)\n- Default mappings: Keep simple initially - only default_agent: build (users can add mappings later)\n- Backward compatibility: Treat as disabled if config doesn't have fallback fields\n\n5. Runtime Behavior\nAgent Selection Logic:\nfunction selectAgent(capability, policy, phase) {\n  // 1. Try to find agent with capability\n  let agent = getAgentsByCapability(capability);\n  \n  if (!agent) {\n    // 2. No agent has capability - use fallback\n    agent = getFallbackAgent(capability, policy, phase);\n    \n    if (agent) {\n      logger.info(`ℹ️ Using fallback agent '${agent.name}' for capability '${capability}'`);\n    }\n  }\n  \n  return agent;\n}\n\nfunction getFallbackAgent(capability, policy, phase) {\n  // Check cascading hierarchy:\n  // 1. Phase-level override?\n  if (phase.fallback_agent) return getAgent(phase.fallback_agent);\n  \n  // 2. Phase disabled?\n  if (phase.fallback_enabled === false) return null;\n  \n  // 3. Policy mappings?\n  if (policy.fallback_mappings?.[capability]) return getAgent(policy.fallback_mappings[capability]);\n  \n  // 4. Policy disabled?\n  if (policy.fallback_enabled === false) return null;\n  \n  // 5. Global mappings?\n  if (config.fallback?.mappings?.[capability]) return getAgent(config.fallback.mappings[capability]);\n  \n  // 6. Global disabled?\n  if (!config.fallback?.enabled) return null;\n  \n  // 7. Use policy or global default_agent\n  const fallbackId = policy.fallback_agent || config.fallback?.default_agent;\n  return fallbackId ? getAgent(fallbackId) : null;\n}\n\n6. Validation Updates\nValidator must:\n1. Check if fallback agents exist in OpenCode for all 3 levels\n2. Verify fallback agents are active\n3. Show info messages about which capabilities will use fallback\n4. Error if fallback enabled but agent doesn't exist or is inactive\n5. Pass validation when fallback covers missing capabilities\n\nExample validation output:\n✅ Main configuration: Valid\n✅ Policy definitions: Valid\n✅ Agent registry: Valid\nℹ️  Policy chain validation: Using fallback for 2 capabilities\n   • policies.yaml: default.test: Capability 'testing' handled by fallback agent 'Build Agent'\n   • policies.yaml: default.review: Capability 'review' handled by fallback agent 'Summary Agent'\n✅ Policy chain validation: Valid\n\nImplementation Plan\nPhase 1: Schema Updates\n1. Update config.schema.json:\n   - Add fallback object schema\n   - Include enabled (boolean), default_agent (string), mappings (object)\n   - Mark as optional for backward compatibility\n2. Update policies.schema.json:\n   - Add fallback_enabled (boolean, optional) to policy level\n   - Add fallback_agent (string, optional) to policy level\n   - Add fallback_mappings (object, optional) to policy level\n   - Add fallback_agent (string, optional) to phase level\n   - Add fallback_enabled (boolean, optional) to phase level\n\nPhase 2: Configuration Loading\n3. Update config.ts:\n   - Load and parse fallback section from config.yaml\n   - Provide default values (enabled: false, no mappings) if not present\n4. Update policy.ts:\n   - Parse fallback fields when loading policies\n   - Handle inheritance logic (policy inherits from global if not set)\n\nPhase 3: Validation\n5. Update policy-capability-validator.ts:\n   - Modify validateCapability() to check fallback hierarchy\n   - Add new validation function validateFallbackAgent()\n   - Update error messages to include fallback information\n   - Change severity: missing capability with valid fallback = info/warning (not error)\n   - Add error type for invalid fallback config (agent doesn't exist or inactive)\n\nPhase 4: Runtime Selection\n6. Update agent-registry.ts:\n   - Add getFallbackAgent(capability, policy, phase) function\n   - Integrate with selectAgent() to use fallback when needed\n   - Add logging when fallback is used\n\nPhase 5: CLI Updates\n7. Update cmdInit() in cli/index.ts:\n   - Add fallback section to default config.yaml:\n          fallback:\n       enabled: true\n       default_agent: build\n     \n8. Update cmdQuickstart() in cli/index.ts:\n   - Add explanation about fallback system\n   - Show which capabilities are using fallback\n   - Make it clear this is normal for first-time setup\n9. Update validation output in cmdValidatePolicyChain():\n   - Show fallback info clearly\n   - Distinguish between critical errors (no agent, no fallback) and fallback usage\n\nPhase 6: Documentation\n10. Update README.md:\n    - Add section explaining fallback system\n    - Include configuration examples\n    - Explain when and why to use fallback\n11. Update docs/config-config.md:\n    - Document fallback configuration section\n    - Provide examples of global and policy-level mappings\n    - Explain master switch behavior\n12. Update docs/policies-config.md:\n    - Document fallback fields at policy and phase level\n    - Show cascading hierarchy examples\n    - Explain disable functionality\n13. Update docs/architecture.md (if applicable):\n    - Explain fallback system in architecture overview\n    - Add fallback to workflow diagrams\n\nTesting Checklist\n- [ ] Schema validation accepts fallback configurations\n- [ ] Fallback disabled when not present in config (backward compatibility)\n- [ ] Global fallback works for all missing capabilities\n- [ ] Policy-level fallback overrides global\n- [ ] Phase-level fallback overrides policy and global\n- [ ] fallback_enabled: false disables fallback at that level\n- [ ] config.fallback.enabled: false disables all fallbacks\n- [ ] Validation passes when fallback covers missing capabilities\n- [ ] Validation errors when fallback agent doesn't exist\n- [ ] Validation errors when fallback agent is inactive\n- [ ] Runtime uses fallback agent when capability missing\n- [ ] Runtime logs when fallback is used\n- [ ] Mappings route capabilities to correct agents\n- [ ] Default configuration creates working system after quickstart\n\nFiles to Modify\n- .agent-shepherd/schemas/config.schema.json\n- .agent-shepherd/schemas/policies.schema.json\n- .agent-shepherd/src/core/config.ts\n- .agent-shepherd/src/core/policy.ts\n- .agent-shepherd/src/core/agent-registry.ts\n- .agent-shepherd/src/core/policy-capability-validator.ts\n- .agent-shepherd/src/core/policy-tree-visualizer.ts (may need updates to show fallback)\n- .agent-shepherd/src/cli/index.ts\n- .agent-shepherd/README.md\n- .agent-shepherd/docs/config-config.md\n- .agent-shepherd/docs/policies-config.md\n\nCurrent State\n- Problem: Validation fails in ashep quickstart due to missing capabilities\n- Solution: Cascading fallback agent system confirmed\n- All design decisions finalized and agreed upon\n- Ready to begin implementation","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-05T02:41:26.628174+01:00","updated_at":"2026-01-06T23:41:58.185078+01:00","closed_at":"2026-01-06T23:41:58.185078+01:00","close_reason":"Closed","labels":["another-test-label","ashep-hitl:","ashep-phase:","test-label"]}
{"id":"agent-shepherd-ull","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:36:26.242561+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:36:26.283083+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-06T04:36:26.283083+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ulqh","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T16:00:25.708363+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T16:00:25.78719+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-06T16:00:25.78719+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ume1","title":"3.2.2 Implement Archive Database Class","description":"Create ArchiveLogger class for archive database access. Extend Logger or create separate class with read-only methods for querying archived runs and decisions.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:09:22.106531+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:12:28.303182+01:00","deleted_at":"2026-01-07T01:12:28.303182+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-umfy6","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:15:31.096117+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:31.172659+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-09T01:15:31.172659+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-umgz3","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:12:18.003268+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:12:18.147978+01:00","labels":["label2","label3"],"deleted_at":"2026-01-08T23:12:18.147978+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-umkv","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T06:03:27.954656+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T06:03:28.075204+01:00","deleted_at":"2026-01-07T06:03:28.075204+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-unj","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-06T04:42:30.215564+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:42:30.28038+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-06T04:42:30.28038+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-upwut","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:16:32.282083+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:16:32.357759+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-09T20:16:32.357759+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-uq4","title":"Update policy-tree-visualizer.ts to show fallback","description":"File: .agent-shepherd/src/core/policy-tree-visualizer.ts\n\nTask: Update visualization to display fallback agent information in policy tree\n\nRequired Changes:\n\n1. Analyze current visualization structure to understand where to add fallback info\n\n2. Add fallback indicators to the visual representation:\n   - Show when a phase uses fallback\n   - Display which fallback agent is used\n   - Indicate fallback level (global, policy, phase)\n\n3. Example visualization enhancement:\n```\nPhase: test\n├─ Capability: testing\n│  ├─ Agent: Build Agent (fallback - global)\n└─ Timeout: 30m\n\nPhase: review\n├─ Capability: review\n│  ├─ Agent: Summary Agent (fallback - policy mapping)\n└─ Timeout: 15m\n```\n\n4. Add color coding or styling:\n   - Fallback agents shown in different color/style\n   - Indicate fallback level with icon or text\n   - Make fallback visually distinct from matched agents\n\n5. Update node data structure to include fallback info:\n```typescript\ninterface PhaseNode {\n  // ... existing properties\n  fallbackAgent?: string;\n  fallbackLevel?: 'global' | 'policy' | 'phase';\n  isFallback?: boolean;\n}\n```\n\n6. Ensure visualization handles all cases:\n   - No fallback needed (agent has capability)\n   - Fallback at global level\n   - Fallback at policy level\n   - Fallback at phase level\n   - Fallback disabled\n\nAcceptance Criteria:\n- [ ] Fallback info displayed in visualization\n- [ ] Fallback agents clearly indicated\n- [ ] Fallback level shown\n- [ ] Visual distinction between fallback and matched agents\n- [ ] All fallback cases handled\n- [ ] Node structure updated with fallback data\n- [ ] Visualization is clear and informative","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-05T02:44:34.428954+01:00","updated_at":"2026-01-05T03:14:33.63331+01:00","closed_at":"2026-01-05T03:14:33.63331+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-uq4","depends_on_id":"agent-shepherd-uj0","type":"parent-child","created_at":"2026-01-05T02:45:37.279716+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-uqs","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-06T04:35:54.781842+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:35:55.160354+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-06T04:35:55.160354+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-ust8x","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-09T01:15:57.947542+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:58.023035+01:00","deleted_at":"2026-01-09T01:15:58.023035+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-ux20y","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T23:03:54.753916+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:03:54.952894+01:00","deleted_at":"2026-01-09T23:03:54.952894+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-uxzzh","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:17:04.322595+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:17:04.393833+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-08T23:17:04.393833+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-uyy","title":"Test excluded","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T15:39:52.328054+01:00","created_by":"tonyhartmann","updated_at":"2026-01-05T15:40:06.262193+01:00","labels":["ashep:excluded"],"deleted_at":"2026-01-05T15:40:06.262193+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-uz3vk","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:12:16.723472+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:12:16.816714+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-08T23:12:16.816714+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-uzub","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T16:34:50.891336+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T16:34:50.956458+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T16:34:50.956458+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-v0z4","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T05:54:21.761978+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:54:21.876471+01:00","deleted_at":"2026-01-08T05:54:21.876471+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-v1ec","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:18:30.672927+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:18:30.719322+01:00","deleted_at":"2026-01-07T19:18:30.719322+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-v2j6","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:35:16.916554+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:35:17.085514+01:00","deleted_at":"2026-01-06T23:35:17.085514+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-v33d","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:39:11.198634+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:39:11.261876+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T14:39:11.261876+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-v6i","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:34:53.997193+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:54.036107+01:00","deleted_at":"2026-01-06T04:34:54.036107+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-v7a2","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T18:29:39.423319+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:29:39.821115+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T18:29:39.821115+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-v7jl","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T02:43:59.735698+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:43:59.807489+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T02:43:59.807489+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-v97hi","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-10T00:11:57.490354+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T00:11:57.949714+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-10T00:11:57.949714+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-vbgn","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T06:03:27.777277+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T06:03:27.923426+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T06:03:27.923426+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-vc0s1","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:46:39.457355+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:46:39.599778+01:00","labels":["label2","label3"],"deleted_at":"2026-01-09T20:46:39.599778+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-veo","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:34:53.530622+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:53.619852+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-06T04:34:53.619852+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-vfpl","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T03:57:12.905245+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T03:57:13.031695+01:00","deleted_at":"2026-01-08T03:57:13.031695+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-vgrc","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T14:30:20.825741+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:30:20.892421+01:00","deleted_at":"2026-01-07T14:30:20.892421+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-vho4","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T05:04:22.735302+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:04:22.808967+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T05:04:22.808967+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-vj5ja","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:38:37.589834+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:38:37.638421+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-09T01:38:37.638421+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-vjb","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:34:53.928072+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:53.967027+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-06T04:34:53.967027+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-vjs0g","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:52:28.328584+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:52:28.776355+01:00","deleted_at":"2026-01-11T00:52:28.776355+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-vkkl0","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T23:23:29.432422+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:23:29.562873+01:00","deleted_at":"2026-01-09T23:23:29.562873+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-vl50","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T05:46:21.686582+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:46:21.732466+01:00","deleted_at":"2026-01-07T05:46:21.732466+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-vl5f","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:35:18.386846+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:35:18.492175+01:00","deleted_at":"2026-01-06T23:35:18.492175+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-vm9ks","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T23:23:27.085746+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:23:27.155779+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-09T23:23:27.155779+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-vn4wh","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T04:50:41.974846+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:50:42.655117+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T04:50:42.655117+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-vnj7","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:39:11.903353+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:39:11.947266+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T14:39:11.947266+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-vo7w","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T22:55:51.591246+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:55:51.646903+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-08T22:55:51.646903+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-vp8z","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:24:23.028243+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:24:23.094829+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T18:24:23.094829+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-vpstv","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:06:42.470772+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:06:42.585614+01:00","deleted_at":"2026-01-09T20:06:42.585614+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-vsyt4","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:23:33.94935+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:23:34.066228+01:00","deleted_at":"2026-01-09T01:23:34.066228+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-vtj15","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-11T00:08:08.070027+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:08:08.277629+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-11T00:08:08.277629+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-vy32p","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:50:40.244592+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:50:40.382013+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-09T04:50:40.382013+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-w0sov","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:06:42.300297+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:06:42.439443+01:00","labels":["label2","label3"],"deleted_at":"2026-01-09T20:06:42.439443+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-w1mu","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T18:40:14.265732+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:40:14.336455+01:00","deleted_at":"2026-01-07T18:40:14.336455+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-w3n5","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-07T05:46:20.581805+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:46:20.652872+01:00","deleted_at":"2026-01-07T05:46:20.652872+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-w3nt","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-08T22:55:50.324523+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:55:50.391771+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-08T22:55:50.391771+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-w6jp","title":"2.2.1 Extend PhaseConfig Interface","description":"Add optional transitions block to PhaseConfig interface. Define TransitionBlock and TransitionConfig interfaces with support for string-based and AI-based conditional routing.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-07T00:05:14.089758+01:00","updated_at":"2026-01-07T00:06:15.832092+01:00","deleted_at":"2026-01-07T00:06:15.832092+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-w75","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:35:53.935436+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:35:54.086849+01:00","deleted_at":"2026-01-06T04:35:54.086849+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-w84q","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:28:07.547713+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:28:07.710058+01:00","deleted_at":"2026-01-06T23:28:07.710058+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-w8o3","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:00:15.477504+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:00:15.642504+01:00","deleted_at":"2026-01-07T19:00:15.642504+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-w8rrf","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T20:06:40.30654+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:06:40.380133+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-09T20:06:40.380133+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-w9ik4","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:17:05.396509+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:17:05.587569+01:00","deleted_at":"2026-01-08T23:17:05.587569+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-wawpo","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T20:46:37.340311+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:46:37.409692+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-09T20:46:37.409692+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-wb9x","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:18:29.543206+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:18:29.611849+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T19:18:29.611849+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-wbs","title":"Update README.md with fallback system documentation","description":"File: .agent-shepherd/README.md\n\nTask: Add section explaining fallback system with configuration examples\n\nRequired Changes:\n\n1. Add new section \"Fallback Agent System\" after the Quick Start section\n\n2. Include in the new section:\n   - What the fallback system is and why it exists\n   - When and why to use fallback\n   - Basic configuration examples\n   - How to cascading hierarchy works\n   - Example use cases\n\n3. Example content structure:\n```markdown\n## Fallback Agent System\n\nWhen a policy requires a capability that no agent has, the fallback system allows\nyou to specify a default agent to handle the task anyway. This is especially useful\nfor getting started quickly with default agents.\n\n### When to Use Fallback\n\n- **First-time setup**: Get started immediately with default agents\n- **Testing workflows**: Test workflows before adding specialized agents\n- **Limited agent pool**: Use available agents for all capability requirements\n\n### Basic Configuration\n\nAdd to `.agent-shepherd/config/config.yaml`:\n\n```yaml\nfallback:\n  enabled: true\n  default_agent: build\n```\n\n### Cascading Hierarchy\n\nThe fallback system works on three levels:\n\n1. **Global Level** (config.yaml): System-wide default\n2. **Policy Level** (policies.yaml): Policy-specific override\n3. **Phase Level** (policies.yaml): Phase-specific override\n\nEach level can override the levels above it.\n\n### Advanced Configuration\n\nUse capability-specific mappings for better agent matching:\n\n```yaml\nfallback:\n  enabled: true\n  default_agent: build\n  mappings:\n    review: summary\n    architecture: plan\n    documentation: summary\n```\n\nSee [docs/config-config.md](docs/config-config.md) for detailed configuration options.\n```\n\n4. Link to detailed documentation:\n   - Link to docs/config-config.md for full config reference\n   - Link to docs/policies-config.md for policy-level configuration\n\nAcceptance Criteria:\n- [ ] New \"Fallback Agent System\" section added\n- [ ] Explains what and why clearly\n- [ ] Includes basic configuration example\n- [ ] Documents cascading hierarchy\n- [ ] Shows advanced configuration with mappings\n- [ ] Links to detailed documentation\n- [ ] Section is well-formatted and easy to read","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-05T02:44:34.408136+01:00","updated_at":"2026-01-05T03:18:03.15476+01:00","closed_at":"2026-01-05T03:18:03.15476+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-wbs","depends_on_id":"agent-shepherd-uj0","type":"parent-child","created_at":"2026-01-05T02:45:00.52337+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-wdp9i","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:08:13.122256+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:08:13.409217+01:00","deleted_at":"2026-01-11T00:08:13.409217+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-wekcu","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:12:17.266928+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:12:17.314589+01:00","deleted_at":"2026-01-08T23:12:17.314589+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-wepl1","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-09T20:46:38.962768+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:46:39.422965+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T20:46:39.422965+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-wfed","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:05:11.483525+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:05:11.596093+01:00","deleted_at":"2026-01-07T19:05:11.596093+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-wfhy","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T06:03:25.800969+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T06:03:25.867451+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T06:03:25.867451+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-wfqf","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:41:58.535545+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:41:58.600623+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T02:41:58.600623+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-wi3p","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:18:30.170723+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:18:30.256982+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T19:18:30.256982+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-wj3d","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-08T03:57:11.421275+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T03:57:11.497818+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-08T03:57:11.497818+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-wjax","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:11:47.668884+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:11:47.779629+01:00","deleted_at":"2026-01-07T18:11:47.779629+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-wkkl3","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:08:09.292569+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:08:09.721205+01:00","deleted_at":"2026-01-11T00:08:09.721205+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-wkxk","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T03:57:12.494862+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T03:57:12.698038+01:00","deleted_at":"2026-01-08T03:57:12.698038+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-wkyf","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:14:40.234534+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:14:40.303396+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T18:14:40.303396+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-wl7dp","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:31:30.435765+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:31:30.861068+01:00","deleted_at":"2026-01-11T00:31:30.861068+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-wngju","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T05:10:41.814575+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T05:10:42.131084+01:00","deleted_at":"2026-01-09T05:10:42.131084+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-woaj","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:14:40.618701+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:14:40.662867+01:00","deleted_at":"2026-01-07T18:14:40.662867+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-worp","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T05:54:20.104035+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:54:20.170094+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-08T05:54:20.170094+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-wquh3","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:40:52.623163+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:40:52.721888+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-09T20:40:52.721888+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-wt1n8","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:49:39.304062+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:49:39.404784+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-09T04:49:39.404784+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-wtif2","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T23:23:27.188865+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:23:27.259089+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-09T23:23:27.259089+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-wu47","title":"2.5.2 Enhance buildDecisionInstructions()","description":"Use prompt templates with rich context.\n\n## Tasks\n- Enhance buildDecisionInstructions() method:\n  - Load template based on capability from config/decision-prompts.yaml\n  - Build context object for template substitution\n  - Substitute variables in template\n  - Include additional context sections\n- Build context object:\n  - issue: id, title, description, type, priority\n  - phase: name, description\n  - outcome: success, message, error, warnings, duration_ms\n  - policy: name\n  - allowed_destinations, confidence_thresholds\n  - custom_instructions\n- Add additional context to prompt:\n  - Recent decisions (last 5):\n    - Query getRecentDecisionsForIssue(issue.id, 5)\n    - Format as list: - [type]: [decision]\n  - Phase history:\n    - Query getPhaseHistoryForIssue(issue.id)\n    - Format as list: - [phase]: [status] ([duration]ms)\n\n## Expected Deliverables\n- Enhanced buildDecisionInstructions() with templates\n  - Context object built with all data\n  - Recent decisions included in prompt\n  - Phase history included in prompt","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:53:23.405131+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-wuaa","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:44:01.781492+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:44:01.907303+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T02:44:01.907303+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-wub","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:42:31.14018+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:42:31.303961+01:00","deleted_at":"2026-01-06T04:42:31.303961+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-wun68","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:31:30.20775+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:31:30.366555+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-11T00:31:30.366555+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-wv6v","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T21:44:09.580511+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:44:09.694553+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-07T21:44:09.694553+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-wvmxl","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T23:23:27.393172+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:23:27.484097+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-09T23:23:27.484097+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ww8b","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:35:17.604733+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:35:17.649553+01:00","deleted_at":"2026-01-06T23:35:17.649553+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-wwkqy","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:23:33.559456+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:23:33.75138+01:00","deleted_at":"2026-01-09T01:23:33.75138+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-wwr3","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:59:43.900159+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:59:43.965699+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T02:59:43.965699+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-wxgdz","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:43:41.017053+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:43:41.15308+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-08T23:43:41.15308+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-wxuv","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T03:57:11.309961+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T03:57:11.385929+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-08T03:57:11.385929+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-wxwq","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:44:01.09198+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:44:01.13182+01:00","deleted_at":"2026-01-07T02:44:01.13182+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-wz4","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:36:24.78491+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:36:24.842255+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-06T04:36:24.842255+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-wzbc","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T22:55:52.423793+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:55:52.573485+01:00","labels":["label2","label3"],"deleted_at":"2026-01-08T22:55:52.573485+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-wzt84","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:20:55.063013+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:55.11151+01:00","deleted_at":"2026-01-09T01:20:55.11151+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-x0na","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T22:07:37.974184+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T22:07:38.038043+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T22:07:38.038043+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-x3wd","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:39:10.412231+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:39:10.477516+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T14:39:10.477516+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-x6f7","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:11:45.51738+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:11:45.583771+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T18:11:45.583771+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-x7lpl","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T23:23:28.090522+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:23:28.286308+01:00","deleted_at":"2026-01-09T23:23:28.286308+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-xaae","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T03:38:13.061601+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:38:13.186796+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T03:38:13.186796+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-xaho3","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:43:43.017896+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:43:43.160948+01:00","labels":["label2","label3"],"deleted_at":"2026-01-08T23:43:43.160948+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-xbal","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:54:02.077428+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:54:02.187737+01:00","labels":["label2","label3"],"deleted_at":"2026-01-06T15:54:02.187737+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-xe6","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:42:31.428702+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:42:31.468297+01:00","deleted_at":"2026-01-06T04:42:31.468297+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-xhj7","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:11:46.337674+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:11:46.524511+01:00","deleted_at":"2026-01-07T18:11:46.524511+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-xjjv","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:59:45.004687+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:59:45.143503+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T02:59:45.143503+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-xjrn","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T02:57:15.590258+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T02:57:15.687521+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-08T02:57:15.687521+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-xqin","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:41:59.549368+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:41:59.721165+01:00","deleted_at":"2026-01-07T02:41:59.721165+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-xql","title":"Update cmdValidatePolicyChain() validation output","description":"File: .agent-shepherd/src/cli/index.ts\n\nTask: Update validation output to show fallback info clearly\n\nRequired Changes:\n\n1. Locate cmdValidatePolicyChain() function in src/cli/index.ts\n\n2. Update validation output to distinguish between:\n   - Critical errors (no agent, no fallback) - show as ERROR\n   - Fallback usage - show as INFO/WARNING\n   - Success with fallback - show as WARNING/INFO\n\n3. Example output format:\n```\n✅ Main configuration: Valid\n✅ Policy definitions: Valid\n✅ Agent registry: Valid\n\nℹ️  Policy chain validation: Using fallback for 2 capabilities\n   • policies.yaml: default.test: Capability 'testing' handled by fallback agent 'Build Agent'\n   • policies.yaml: default.review: Capability 'review' handled by fallback agent 'Summary Agent'\n\n✅ Policy chain validation: Valid\n```\n\n4. Collect fallback information from validation results:\n   - Parse validation results for fallback usage\n   - Group by policy and phase\n   - Count total capabilities using fallback\n\n5. Handle edge cases:\n   - No fallback needed (all capabilities have agents)\n   - Fallback errors (fallback agent doesn't exist)\n   - Mixed state (some capabilities use fallback, some have errors)\n\nAcceptance Criteria:\n- [ ] Validation output shows fallback info clearly\n- [ ] Critical errors and fallback usage are visually distinct\n- [ ] Output shows capability → fallback agent mapping\n- [ ] Counts total capabilities using fallback\n- [ ] Handles no fallback case gracefully\n- [ ] Shows errors for invalid fallback config\n- [ ] Mixed state handled correctly","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T02:44:34.394538+01:00","updated_at":"2026-01-05T17:08:30.527341+01:00","closed_at":"2026-01-05T17:08:30.527341+01:00","close_reason":"Closed","labels":["test:label"]}
{"id":"agent-shepherd-xsn2v","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:38:38.597748+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:38:38.719452+01:00","deleted_at":"2026-01-09T01:38:38.719452+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-xthn","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T05:04:24.264911+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:04:24.711056+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T05:04:24.711056+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-xtie6","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:43:41.979844+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:43:42.16888+01:00","deleted_at":"2026-01-08T23:43:42.16888+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-xtjhe","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T23:43:41.293938+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:43:41.387506+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-08T23:43:41.387506+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-xv24","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T02:57:16.260347+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T02:57:16.447293+01:00","deleted_at":"2026-01-08T02:57:16.447293+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-xv5t","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T16:00:25.815971+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T16:00:25.874974+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-06T16:00:25.874974+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-xv9m0","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:24:05.110846+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:24:05.160272+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-09T01:24:05.160272+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-xvx","title":"refactor-directory-structure","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:00:10.425253+01:00","updated_at":"2025-12-21T03:01:25.922803+01:00","closed_at":"2025-12-21T03:01:25.922803+01:00","close_reason":"Completed"}
{"id":"agent-shepherd-xvx.1","title":"1. Directory Structure Creation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:00:15.884816+01:00","updated_at":"2025-12-21T03:31:17.176475+01:00","closed_at":"2025-12-21T03:31:17.176475+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.1","depends_on_id":"agent-shepherd-xvx","type":"parent-child","created_at":"2025-12-21T02:00:15.885579+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.1.1","title":"1.1 Create .agent-shepherd/ directory structure with subdirectories (config/, bin/, src/, schemas/, tests/, docs/)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:00:21.107746+01:00","updated_at":"2025-12-21T02:52:10.247179+01:00","closed_at":"2025-12-21T02:52:10.247179+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.1.1","depends_on_id":"agent-shepherd-xvx.1","type":"parent-child","created_at":"2025-12-21T02:00:21.108603+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.2","title":"2. File Movement","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:00:26.299612+01:00","updated_at":"2025-12-21T03:31:17.176576+01:00","closed_at":"2025-12-21T03:31:17.176576+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.2","depends_on_id":"agent-shepherd-xvx","type":"parent-child","created_at":"2025-12-21T02:00:26.300428+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.2.1","title":"2.1 Move source files from src/ to .agent-shepherd/src/","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:00:31.790759+01:00","updated_at":"2025-12-21T02:53:28.772399+01:00","closed_at":"2025-12-21T02:53:28.772399+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.2.1","depends_on_id":"agent-shepherd-xvx.2","type":"parent-child","created_at":"2025-12-21T02:00:31.791521+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.2.2","title":"2.2 Move schema files from schemas/ to .agent-shepherd/schemas/","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:00:37.030352+01:00","updated_at":"2025-12-21T02:53:45.369823+01:00","closed_at":"2025-12-21T02:53:45.369823+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.2.2","depends_on_id":"agent-shepherd-xvx.2","type":"parent-child","created_at":"2025-12-21T02:00:37.031153+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.2.3","title":"2.3 Move test files from tests/ to .agent-shepherd/tests/","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:00:42.224707+01:00","updated_at":"2025-12-21T02:54:04.972294+01:00","closed_at":"2025-12-21T02:54:04.972294+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.2.3","depends_on_id":"agent-shepherd-xvx.2","type":"parent-child","created_at":"2025-12-21T02:00:42.225507+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.2.4","title":"2.4 Move docs from docs/ to .agent-shepherd/docs/","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:00:47.546953+01:00","updated_at":"2025-12-21T02:54:21.244615+01:00","closed_at":"2025-12-21T02:54:21.244615+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.2.4","depends_on_id":"agent-shepherd-xvx.2","type":"parent-child","created_at":"2025-12-21T02:00:47.548326+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.2.5","title":"2.5 Move README.md and package.json to .agent-shepherd/","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:00:52.834416+01:00","updated_at":"2025-12-21T02:54:37.142558+01:00","closed_at":"2025-12-21T02:54:37.142558+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.2.5","depends_on_id":"agent-shepherd-xvx.2","type":"parent-child","created_at":"2025-12-21T02:00:52.83549+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.3","title":"3. Import and Path Updates","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:00:58.131436+01:00","updated_at":"2025-12-21T03:31:17.176508+01:00","closed_at":"2025-12-21T03:31:17.176508+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.3","depends_on_id":"agent-shepherd-xvx","type":"parent-child","created_at":"2025-12-21T02:00:58.132623+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.3.1","title":"3.1 Update all import paths in source files to work from new locations","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:01:03.422802+01:00","updated_at":"2025-12-21T02:57:42.964223+01:00","closed_at":"2025-12-21T02:57:42.964223+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.3.1","depends_on_id":"agent-shepherd-xvx.3","type":"parent-child","created_at":"2025-12-21T02:01:03.424086+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.3.2","title":"3.2 Create path resolution utilities for dynamic path handling","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:01:08.747018+01:00","updated_at":"2025-12-21T02:55:08.176602+01:00","closed_at":"2025-12-21T02:55:08.176602+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.3.2","depends_on_id":"agent-shepherd-xvx.3","type":"parent-child","created_at":"2025-12-21T02:01:08.748097+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.4","title":"4. Build System Updates","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:01:14.06288+01:00","updated_at":"2025-12-21T03:31:17.207081+01:00","closed_at":"2025-12-21T03:31:17.207081+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.4","depends_on_id":"agent-shepherd-xvx","type":"parent-child","created_at":"2025-12-21T02:01:14.063933+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.4.1","title":"4.1 Update build system to output to .agent-shepherd/bin/ashep","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:01:19.461886+01:00","updated_at":"2025-12-21T02:58:02.175367+01:00","closed_at":"2025-12-21T02:58:02.175367+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.4.1","depends_on_id":"agent-shepherd-xvx.4","type":"parent-child","created_at":"2025-12-21T02:01:19.46309+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.4.2","title":"4.2 Modify package.json bin field to point to new location","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T02:01:24.771621+01:00","updated_at":"2026-01-09T00:45:38.723323+01:00","dependencies":[{"issue_id":"agent-shepherd-xvx.4.2","depends_on_id":"agent-shepherd-xvx.4","type":"parent-child","created_at":"2025-12-21T02:01:24.772674+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.4.3","title":"4.3 Update build scripts and validate build process","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:01:29.990643+01:00","updated_at":"2025-12-21T02:58:39.822109+01:00","closed_at":"2025-12-21T02:58:39.822109+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.4.3","depends_on_id":"agent-shepherd-xvx.4","type":"parent-child","created_at":"2025-12-21T02:01:29.991476+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.5","title":"5. CLI and Discovery Implementation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:01:35.364181+01:00","updated_at":"2025-12-21T03:31:17.280757+01:00","closed_at":"2025-12-21T03:31:17.280757+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.5","depends_on_id":"agent-shepherd-xvx","type":"parent-child","created_at":"2025-12-21T02:01:35.365414+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.5.1","title":"5.1 Implement CLI discovery logic (findAgentShepherdDir function)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:01:40.685991+01:00","updated_at":"2026-01-06T23:29:45.841498+01:00","closed_at":"2026-01-06T23:29:45.841498+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-xvx.5.1","depends_on_id":"agent-shepherd-xvx.5","type":"parent-child","created_at":"2025-12-21T02:01:40.687088+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.5.2","title":"5.2 Update CLI entry point to use discovered paths","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:01:45.94781+01:00","updated_at":"2026-01-06T23:30:53.598185+01:00","closed_at":"2026-01-06T23:30:53.598185+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-xvx.5.2","depends_on_id":"agent-shepherd-xvx.5","type":"parent-child","created_at":"2025-12-21T02:01:45.948524+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.6","title":"6. Installation and Migration","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:01:51.256013+01:00","updated_at":"2025-12-21T03:31:17.378134+01:00","closed_at":"2025-12-21T03:31:17.378134+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.6","depends_on_id":"agent-shepherd-xvx","type":"parent-child","created_at":"2025-12-21T02:01:51.256992+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.6.1","title":"6.1 Modify ashep init command to create .agent-shepherd/ structure","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:01:56.470928+01:00","updated_at":"2025-12-21T02:59:02.210871+01:00","closed_at":"2025-12-21T02:59:02.210871+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.6.1","depends_on_id":"agent-shepherd-xvx.6","type":"parent-child","created_at":"2025-12-21T02:01:56.471661+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.6.2","title":"6.2 Update default file locations in config and core modules","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:27:43.851898+01:00","updated_at":"2025-12-21T02:59:17.702105+01:00","closed_at":"2025-12-21T02:59:17.702105+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.6.2","depends_on_id":"agent-shepherd-xvx.6","type":"parent-child","created_at":"2025-12-21T02:27:43.852581+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.6.3","title":"6.3 Add migration logic for existing installations","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:27:49.045882+01:00","updated_at":"2025-12-21T02:59:34.024196+01:00","closed_at":"2025-12-21T02:59:34.024196+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.6.3","depends_on_id":"agent-shepherd-xvx.6","type":"parent-child","created_at":"2025-12-21T02:27:49.04668+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.6.4","title":"6.4 Handle backward compatibility for existing installations","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:27:54.225217+01:00","updated_at":"2025-12-21T02:59:41.264193+01:00","closed_at":"2025-12-21T02:59:41.264193+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.6.4","depends_on_id":"agent-shepherd-xvx.6","type":"parent-child","created_at":"2025-12-21T02:27:54.226012+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.6.5","title":"6.5 Implement error handling for conflicting file locations","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:27:59.419865+01:00","updated_at":"2025-12-21T02:59:48.450494+01:00","closed_at":"2025-12-21T02:59:48.450494+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.6.5","depends_on_id":"agent-shepherd-xvx.6","type":"parent-child","created_at":"2025-12-21T02:27:59.420626+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.7","title":"7. Testing and Validation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:28:04.620684+01:00","updated_at":"2025-12-21T03:31:17.469996+01:00","closed_at":"2025-12-21T03:31:17.469996+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.7","depends_on_id":"agent-shepherd-xvx","type":"parent-child","created_at":"2025-12-21T02:28:04.621579+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.7.1","title":"7.1 Update all test files to work with new import paths","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:28:10.064203+01:00","updated_at":"2025-12-21T02:59:59.048024+01:00","closed_at":"2025-12-21T02:59:59.048024+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.7.1","depends_on_id":"agent-shepherd-xvx.7","type":"parent-child","created_at":"2025-12-21T02:28:10.065021+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.7.2","title":"7.2 Create tests for CLI discovery functionality","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:28:15.24636+01:00","updated_at":"2025-12-21T03:00:14.306202+01:00","closed_at":"2025-12-21T03:00:14.306202+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.7.2","depends_on_id":"agent-shepherd-xvx.7","type":"parent-child","created_at":"2025-12-21T02:28:15.247175+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.7.3","title":"7.3 Test installation process creates correct structure","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:28:20.430588+01:00","updated_at":"2025-12-21T03:01:33.016442+01:00","closed_at":"2025-12-21T03:01:33.016442+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.7.3","depends_on_id":"agent-shepherd-xvx.7","type":"parent-child","created_at":"2025-12-21T02:28:20.431315+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.7.4","title":"7.4 Run full test suite and fix any failures","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:28:25.894184+01:00","updated_at":"2025-12-21T03:01:33.131827+01:00","closed_at":"2025-12-21T03:01:33.131827+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.7.4","depends_on_id":"agent-shepherd-xvx.7","type":"parent-child","created_at":"2025-12-21T02:28:25.894924+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.7.5","title":"7.5 Validate end-to-end workflow in new structure","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:28:31.095188+01:00","updated_at":"2025-12-21T03:01:33.237248+01:00","closed_at":"2025-12-21T03:01:33.237248+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.7.5","depends_on_id":"agent-shepherd-xvx.7","type":"parent-child","created_at":"2025-12-21T02:28:31.095919+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.7.6","title":"7.6 Test backward compatibility and migration","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:28:36.282313+01:00","updated_at":"2025-12-21T03:01:33.381329+01:00","closed_at":"2025-12-21T03:01:33.381329+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.7.6","depends_on_id":"agent-shepherd-xvx.7","type":"parent-child","created_at":"2025-12-21T02:28:36.283203+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.8","title":"8. Documentation Updates","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:28:41.476038+01:00","updated_at":"2025-12-21T03:01:33.489308+01:00","closed_at":"2025-12-21T03:01:33.489308+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.8","depends_on_id":"agent-shepherd-xvx","type":"parent-child","created_at":"2025-12-21T02:28:41.476817+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.8.1","title":"8.1 Update documentation to reference new file locations","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:28:46.674127+01:00","updated_at":"2025-12-21T03:01:33.603699+01:00","closed_at":"2025-12-21T03:01:33.603699+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.8.1","depends_on_id":"agent-shepherd-xvx.8","type":"parent-child","created_at":"2025-12-21T02:28:46.674988+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xvx.8.2","title":"8.2 Update any hardcoded paths in docs or code","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T02:28:51.866098+01:00","updated_at":"2025-12-21T03:01:33.712943+01:00","closed_at":"2025-12-21T03:01:33.712943+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-xvx.8.2","depends_on_id":"agent-shepherd-xvx.8","type":"parent-child","created_at":"2025-12-21T02:28:51.866816+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-xwalw","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:20:55.789323+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:55.930775+01:00","labels":["label2","label3"],"deleted_at":"2026-01-09T01:20:55.930775+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-xwsud","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:11:03.478843+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:11:03.603602+01:00","deleted_at":"2026-01-09T20:11:03.603602+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-xx0b","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T14:32:17.679275+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:32:17.744753+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T14:32:17.744753+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-xx3t","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:05:10.581683+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:05:10.627394+01:00","deleted_at":"2026-01-07T19:05:10.627394+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-xx4p","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:05:10.662236+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:05:10.781207+01:00","deleted_at":"2026-01-07T19:05:10.781207+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-xyo","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:32:31.160092+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:31.255745+01:00","deleted_at":"2026-01-06T04:32:31.255745+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-y04j","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T21:44:11.088555+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:44:11.257021+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T21:44:11.257021+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-y0ujr","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:39:40.875313+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:39:40.979407+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-09T04:39:40.979407+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-y2sg","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:14:39.809155+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:14:39.875673+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T18:14:39.875673+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-y3i3w","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:16:33.698327+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:16:33.829439+01:00","deleted_at":"2026-01-09T20:16:33.829439+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-y4m6c","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:46:37.665637+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:46:37.760536+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-09T20:46:37.760536+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-y5wpu","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:40:52.274694+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:40:52.351064+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-09T20:40:52.351064+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-y64p","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:33:43.97317+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:44.061085+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T18:33:44.061085+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-y82a","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T20:36:36.308111+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T20:36:36.408927+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-07T20:36:36.408927+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-y93m","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:26:24.234944+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:26:24.398817+01:00","deleted_at":"2026-01-07T14:26:24.398817+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-y9bp","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:32:18.08841+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:32:18.154011+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T14:32:18.154011+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-y9syu","title":"Agent Registry Files Extension","description":"Extend Agent Shepherd to support individual agent registry files for better maintainability of complex agent configurations, similar to the workflow files extension. This epic implements a directory structure with agents/enabled/ for active agent files and agents/available/ for storage, allowing users to organize complex agent configurations in separate files while maintaining backward compatibility with agents.yaml.","notes":"## Scratchpad: Detailed Implementation Plan\n\n### What: Agent Registry File System\nDirectory Structure:\n.agent-shepherd/\n├── config/agents.yaml           # Unchanged - core agents + defaults\n└── agents/\n    ├── enabled/                 # NEW: Loaded agent registry files (recursive)\n    │   └── [nested organization allowed]\n    └── available/               # NEW: Storage only (ignored by system)\n\nSchema:\nAgent registry files use identical schema to agents.yaml entries:\nagents:\n  - id: specialized-coding-agent\n    name: \"Specialized Coding Agent\" \n    capabilities: [\"coding\", \"refactoring\", \"testing\"]\n    priority: 15\n    active: true\n    provider: \"anthropic\"\n    model: \"claude-3-sonnet-20240229\"\n    constraints:\n      read_only: false\n      performance_tier: \"standard\"\n    metadata:\n      source: \"preset:full-stack-dev\"\n      tags: [\"typescript\", \"react\"]\n\n### Why: Benefits \u0026 Rationale\nScalability: Complex agent configurations with many specialized agents make agents.yaml unwieldy\nMaintainability: Separate files allow focused editing without touching unrelated agents  \nOrganization: Users can organize agents in folders for large numbers of specialized agents\nBackward Compatibility: Existing setups continue working unchanged\nFlexibility: Simple agents stay in agents.yaml, complex ones get dedicated files\nPreset Integration: Enables presets to deliver agent configurations as separate files\n\n### How: Implementation Steps\nPhase 1: Core Infrastructure (agent-registry.ts)\n1.1 Add getAgentsPath() utility function\n- Location: .agent-shepherd/src/core/agent-registry.ts\n- Purpose: Returns path to agents directory\n- Implementation: Similar to getWorkflowsPath() in policy.ts\n1.2 Modify AgentRegistry.loadAgents() to scan agents/enabled/ recursively\n- Load agents.yaml as before\n- Recursively scan agents/enabled/*.yaml files\n- Parse and merge agent configurations\n- Handle precedence: agents.yaml wins on conflicts\n1.3 Add validation for individual agent registry files\n- Validate YAML syntax and schema compliance\n- Ensure agent IDs are unique across all files\n- Handle malformed files gracefully\n1.4 Handle precedence (agents.yaml \u003e agent registry files)\n- Implement merging logic that preserves main config priority\n- Log warnings when conflicts occur\n- Document precedence behavior\n\nPhase 2: CLI Commands (cli/index.ts)\n2.1 Add ashep agent list command\n- List all agents from agents.yaml + enabled/ directory\n- Show source (main config vs file) and status\n- Support filtering by capability or active status\n2.2 Add ashep agent archive \u003cname\u003e command\n- Move agent file from agents/enabled/ to agents/available/\n- Update agent registry immediately\n- Handle nested directory structures\n2.3 Add ashep agent activate \u003cname\u003e command\n- Move agent file from agents/available/ to agents/enabled/\n- Reload agent registry\n- Validate agent configuration\n2.4 Add ashep agent create \u003cname\u003e command\n- Create new agent file template in agents/enabled/\n- Include all required fields with sensible defaults\n- Open in user's editor\n\nPhase 3: Configuration \u0026 Validation\n3.1 Ensure agents.schema.json works for individual files\n- Verify schema in .agent-shepherd/schemas/agents.schema.json is compatible\n- Schema should validate individual agent entries, not the full agents array\n3.2 Update config-validator.ts to validate agent files in enabled/\n- Extend validation to scan agents/enabled/ directory\n- Report validation errors with file paths\n- Skip agents/available/ directory\n\nPhase 4: Tests\n4.1 Add tests for loading agents from enabled/ directory\n- Test recursive scanning of nested directories\n- Verify agents are loaded and merged correctly\n- Test precedence handling (agents.yaml wins)\n4.2 Add tests for precedence (agents.yaml wins over agent files)\n- Mock conflicting agent definitions\n- Verify main config takes priority\n- Test warning logging for conflicts\n4.3 Add tests for invalid agent files\n- Test malformed YAML handling\n- Test schema validation failures\n- Test duplicate agent ID detection\n4.4 Add tests for available/ being ignored\n- Ensure agents in available/ are not loaded\n- Test that available/ files don't affect registry\n4.5 Add tests for new agent CLI commands\n- Mock file system operations\n- Test list, archive, activate, create commands\n- Verify registry updates after operations\n\nPhase 5: Documentation Updates\n5.1 Add section on agent files to docs/agents-config.md\n- Explain enabled/ vs available/ directories\n- Document precedence rules\n- Show examples of moving complex agents to files\n5.2 Document enabled/ vs available/ folders\n- enabled/: Actively loaded into agent registry\n- available/: Storage only, ignored by system\n- Use cases for each\n5.3 Document precedence rules\n- agents.yaml always takes precedence\n- Agent files supplement, don't override\n- Warning when conflicts occur\n5.4 Add examples of moving complex agents to files\n- Show before/after examples\n- Demonstrate file organization strategies\n- Include CLI usage examples\n5.5 Document new agent CLI commands in docs/cli-reference.md\n- Complete command reference with options\n- Usage examples and output samples\n5.6 Brief mention of agent file support in README.md\n- Add to features list\n- Link to detailed documentation\n5.7 Update architecture section in AGENTS.md\n- Mention agent files alongside workflow files\n- Explain how they enable preset system\n\n### Edge Cases \u0026 Considerations\nPrecedence Conflicts: Document that agents.yaml wins, but log warnings\nFile Organization: Allow unlimited nesting under enabled/ for user organization  \nMigration: No automatic migration - users manually move agents\nValidation: Same validation rules apply to agent files as agents.yaml entries\nPerformance: Recursive scanning should be fine (agents are not high-frequency)\nShared Agents: Multiple agent files can reference same agent capabilities\n\n### Testing Strategy\n- Unit tests: Core loading and merging logic\n- Integration tests: Full agent registry with file scanning\n- CLI tests: Command functionality with mocked filesystem\n- Regression tests: Ensure agents.yaml still works unchanged\n- Edge case tests: Precedence, conflicts, invalid files\n\n### Rollout Plan\n1. Implement core loading logic in agent-registry.ts\n2. Add CLI commands for agent file management  \n3. Update validation and error handling\n4. Add comprehensive tests\n5. Update all documentation\n6. Test with complex agent configurations\n7. Release with backward compatibility note\n\n### Dependencies\n- None (standalone epic, can run parallel to workflow files)\n- Enables Epic 3 (Presets) by providing agent file infrastructure\n\nThis plan mirrors the proven workflow files epic structure while adapting it for agent registry management. The implementation will provide the foundation needed for the presets system to deliver agent configurations as separate, manageable files.\n\n### Execution Note\nWhen assigned this epic, consume the overall context and select the next available child issue to work on, rather than working on the epic directly.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-10T01:34:39.254653+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:35:27.969952+01:00"}
{"id":"agent-shepherd-y9syu.1","title":"Phase 1: Core Infrastructure (agent-registry.ts)","description":"Implement core changes to agent-registry.ts to support loading agent files from agents/enabled/ directory.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:34:41.471886+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:34:41.471886+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.1","depends_on_id":"agent-shepherd-y9syu","type":"parent-child","created_at":"2026-01-10T01:34:41.488225+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.1.1","title":"1.1 Add getAgentsPath() utility function","description":"Add getAgentsPath() utility function in .agent-shepherd/src/core/agent-registry.ts to return path to agents directory, similar to getWorkflowsPath() in policy.ts.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:34:43.240709+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:34:43.240709+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.1.1","depends_on_id":"agent-shepherd-y9syu.1","type":"parent-child","created_at":"2026-01-10T01:34:43.251976+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.1.2","title":"1.2 Modify AgentRegistry.loadAgents() to scan agents/enabled/ recursively","description":"Modify AgentRegistry.loadAgents() to load agents.yaml as before, recursively scan agents/enabled/*.yaml files, parse and merge agent configurations, handle precedence: agents.yaml wins on conflicts.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:34:44.59822+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:34:44.59822+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.1.2","depends_on_id":"agent-shepherd-y9syu.1","type":"parent-child","created_at":"2026-01-10T01:34:44.602622+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.1.3","title":"1.3 Add validation for individual agent registry files","description":"Add validation for individual agent registry files: validate YAML syntax and schema compliance, ensure agent IDs are unique across all files, handle malformed files gracefully.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:34:45.888655+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:34:45.888655+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.1.3","depends_on_id":"agent-shepherd-y9syu.1","type":"parent-child","created_at":"2026-01-10T01:34:45.894573+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.1.4","title":"1.4 Handle precedence (agents.yaml \u003e agent registry files)","description":"Implement merging logic that preserves main config priority, log warnings when conflicts occur, document precedence behavior.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:34:47.886957+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:34:47.886957+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.1.4","depends_on_id":"agent-shepherd-y9syu.1","type":"parent-child","created_at":"2026-01-10T01:34:47.890998+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.2","title":"Phase 2: CLI Commands (cli/index.ts)","description":"Add new CLI commands for managing agent registry files: list, archive, activate, create.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:34:49.209374+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:34:49.209374+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.2","depends_on_id":"agent-shepherd-y9syu","type":"parent-child","created_at":"2026-01-10T01:34:49.216488+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.2.1","title":"2.1 Add ashep agent list command","description":"Add ashep agent list command to list all agents from agents.yaml + enabled/ directory, show source (main config vs file) and status, support filtering by capability or active status.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:34:50.655115+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:34:50.655115+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.2.1","depends_on_id":"agent-shepherd-y9syu.2","type":"parent-child","created_at":"2026-01-10T01:34:50.663459+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.2.2","title":"2.2 Add ashep agent archive \u003cname\u003e command","description":"Add ashep agent archive \u003cname\u003e command to move agent file from agents/enabled/ to agents/available/, update agent registry immediately, handle nested directory structures.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:34:51.958696+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:34:51.958696+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.2.2","depends_on_id":"agent-shepherd-y9syu.2","type":"parent-child","created_at":"2026-01-10T01:34:51.966436+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.2.3","title":"2.3 Add ashep agent activate \u003cname\u003e command","description":"Add ashep agent activate \u003cname\u003e command to move agent file from agents/available/ to agents/enabled/, reload agent registry, validate agent configuration.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:34:53.234288+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:34:53.234288+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.2.3","depends_on_id":"agent-shepherd-y9syu.2","type":"parent-child","created_at":"2026-01-10T01:34:53.240251+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.2.4","title":"2.4 Add ashep agent create \u003cname\u003e command","description":"Add ashep agent create \u003cname\u003e command to create new agent file template in agents/enabled/, include all required fields with sensible defaults, open in user's editor.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:34:54.906252+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:34:54.906252+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.2.4","depends_on_id":"agent-shepherd-y9syu.2","type":"parent-child","created_at":"2026-01-10T01:34:54.92578+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.3","title":"Phase 3: Configuration \u0026 Validation","description":"Ensure agents.schema.json works for individual files and update config-validator.ts to validate agent files in enabled/.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:34:56.047341+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:34:56.047341+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.3","depends_on_id":"agent-shepherd-y9syu","type":"parent-child","created_at":"2026-01-10T01:34:56.048027+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.3.1","title":"3.1 Ensure agents.schema.json works for individual files","description":"Verify schema in .agent-shepherd/schemas/agents.schema.json is compatible, schema should validate individual agent entries, not the full agents array.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:34:57.276597+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:34:57.276597+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.3.1","depends_on_id":"agent-shepherd-y9syu.3","type":"parent-child","created_at":"2026-01-10T01:34:57.277139+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.3.2","title":"3.2 Update config-validator.ts to validate agent files in enabled/","description":"Extend validation to scan agents/enabled/ directory, report validation errors with file paths, skip agents/available/ directory.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:34:58.663696+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:34:58.663696+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.3.2","depends_on_id":"agent-shepherd-y9syu.3","type":"parent-child","created_at":"2026-01-10T01:34:58.664609+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.4","title":"Phase 4: Tests","description":"Add comprehensive tests for agent registry files functionality including loading, precedence, validation, and CLI commands.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:34:59.757488+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:34:59.757488+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.4","depends_on_id":"agent-shepherd-y9syu","type":"parent-child","created_at":"2026-01-10T01:34:59.758392+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.4.1","title":"4.1 Add tests for loading agents from enabled/ directory","description":"Add tests for loading agents from enabled/ directory: test recursive scanning of nested directories, verify agents are loaded and merged correctly, test precedence handling (agents.yaml wins).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:35:01.01128+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:35:01.01128+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.4.1","depends_on_id":"agent-shepherd-y9syu.4","type":"parent-child","created_at":"2026-01-10T01:35:01.012011+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.4.2","title":"4.2 Add tests for precedence (agents.yaml wins over agent files)","description":"Add tests for precedence (agents.yaml wins over agent files): mock conflicting agent definitions, verify main config takes priority, test warning logging for conflicts.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:35:02.127989+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:35:02.127989+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.4.2","depends_on_id":"agent-shepherd-y9syu.4","type":"parent-child","created_at":"2026-01-10T01:35:02.128808+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.4.3","title":"4.3 Add tests for invalid agent files","description":"Add tests for invalid agent files: test malformed YAML handling, test schema validation failures, test duplicate agent ID detection.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:35:03.36644+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:35:03.36644+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.4.3","depends_on_id":"agent-shepherd-y9syu.4","type":"parent-child","created_at":"2026-01-10T01:35:03.367282+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.4.4","title":"4.4 Add tests for available/ being ignored","description":"Add tests for available/ being ignored: ensure agents in available/ are not loaded, test that available/ files don't affect registry.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:35:04.539576+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:35:04.539576+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.4.4","depends_on_id":"agent-shepherd-y9syu.4","type":"parent-child","created_at":"2026-01-10T01:35:04.540454+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.4.5","title":"4.5 Add tests for new agent CLI commands","description":"Add tests for new agent CLI commands: mock file system operations, test list, archive, activate, create commands, verify registry updates after operations.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:35:06.01715+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:35:06.01715+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.4.5","depends_on_id":"agent-shepherd-y9syu.4","type":"parent-child","created_at":"2026-01-10T01:35:06.017976+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.5","title":"Phase 5: Documentation Updates","description":"Update all relevant documentation to reflect the new agent registry files feature.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:35:07.027303+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:35:07.027303+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.5","depends_on_id":"agent-shepherd-y9syu","type":"parent-child","created_at":"2026-01-10T01:35:07.028128+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.5.1","title":"5.1 Add section on agent files to docs/agents-config.md","description":"Add section on agent files to docs/agents-config.md: explain enabled/ vs available/ directories, document precedence rules, show examples of moving complex agents to files.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:35:08.4846+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:35:08.4846+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.5.1","depends_on_id":"agent-shepherd-y9syu.5","type":"parent-child","created_at":"2026-01-10T01:35:08.485447+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.5.2","title":"5.2 Document enabled/ vs available/ folders","description":"Document enabled/ vs available/ folders: enabled/ actively loaded into agent registry, available/ storage only ignored by system, use cases for each.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:35:09.739854+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:35:09.739854+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.5.2","depends_on_id":"agent-shepherd-y9syu.5","type":"parent-child","created_at":"2026-01-10T01:35:09.740635+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.5.3","title":"5.3 Document precedence rules","description":"Document precedence rules: agents.yaml always takes precedence, agent files supplement don't override, warning when conflicts occur.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:35:10.916072+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:35:10.916072+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.5.3","depends_on_id":"agent-shepherd-y9syu.5","type":"parent-child","created_at":"2026-01-10T01:35:10.916934+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.5.4","title":"5.4 Add examples of moving complex agents to files","description":"Add examples of moving complex agents to files: show before/after examples, demonstrate file organization strategies, include CLI usage examples.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:35:12.10214+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:35:12.10214+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.5.4","depends_on_id":"agent-shepherd-y9syu.5","type":"parent-child","created_at":"2026-01-10T01:35:12.102943+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.5.5","title":"5.5 Document new agent CLI commands in docs/cli-reference.md","description":"Document new agent CLI commands in docs/cli-reference.md: complete command reference with options, usage examples and output samples.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:35:13.533424+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:35:13.533424+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.5.5","depends_on_id":"agent-shepherd-y9syu.5","type":"parent-child","created_at":"2026-01-10T01:35:13.534233+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.5.6","title":"5.6 Brief mention of agent file support in README.md","description":"Brief mention of agent file support in README.md: add to features list, link to detailed documentation.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:35:14.606546+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:35:14.606546+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.5.6","depends_on_id":"agent-shepherd-y9syu.5","type":"parent-child","created_at":"2026-01-10T01:35:14.607463+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.5.7","title":"5.7 Update architecture section in AGENTS.md","description":"Update architecture section in AGENTS.md: mention agent files alongside workflow files, explain how they enable preset system.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:35:15.845183+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:35:15.845183+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.5.7","depends_on_id":"agent-shepherd-y9syu.5","type":"parent-child","created_at":"2026-01-10T01:35:15.845993+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.6","title":"Edge Cases \u0026 Considerations","description":"Address edge cases: precedence conflicts (agents.yaml wins, log warnings), file organization (unlimited nesting under enabled/), migration (no automatic, manual), validation (same rules), performance (recursive scanning fine), shared agents (multiple files can reference same capabilities).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:35:18.091768+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:35:18.091768+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.6","depends_on_id":"agent-shepherd-y9syu","type":"parent-child","created_at":"2026-01-10T01:35:18.092667+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.7","title":"Testing Strategy","description":"Implement comprehensive testing: unit tests for core loading/merging logic, integration tests for full registry with file scanning, CLI tests with mocked filesystem, regression tests for agents.yaml compatibility, edge case tests for precedence/conflicts/invalid files.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:35:19.4099+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:35:19.4099+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.7","depends_on_id":"agent-shepherd-y9syu","type":"parent-child","created_at":"2026-01-10T01:35:19.4107+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.8","title":"Rollout Plan","description":"Execute rollout: 1. Implement core loading logic in agent-registry.ts, 2. Add CLI commands for agent file management, 3. Update validation and error handling, 4. Add comprehensive tests, 5. Update all documentation, 6. Test with complex agent configurations, 7. Release with backward compatibility note.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:35:20.766018+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:35:20.766018+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.8","depends_on_id":"agent-shepherd-y9syu","type":"parent-child","created_at":"2026-01-10T01:35:20.76714+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-y9syu.9","title":"Dependencies","description":"Note dependencies: None (standalone epic, can run parallel to workflow files), enables Epic 3 (Presets) by providing agent file infrastructure.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T01:35:21.9493+01:00","created_by":"tonyhartmann","updated_at":"2026-01-10T01:35:21.9493+01:00","dependencies":[{"issue_id":"agent-shepherd-y9syu.9","depends_on_id":"agent-shepherd-y9syu","type":"parent-child","created_at":"2026-01-10T01:35:21.950087+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-ybi","title":"Update docs/policies-config.md with fallback fields","description":"File: .agent-shepherd/docs/policies-config.md\n\nTask: Document fallback fields at policy and phase level with hierarchy examples\n\nRequired Changes:\n\n1. Add new section \"Fallback Agent Configuration\" in the policies documentation\n\n2. Document policy-level fallback fields:\n   - fallback_enabled (boolean, optional): Enable/disable for this policy\n   - fallback_agent (string, optional): Fallback agent for this policy\n   - fallback_mappings (object, optional): Capability-specific mappings\n\n3. Document phase-level fallback fields:\n   - fallback_agent (string, optional): Override fallback agent for this phase\n   - fallback_enabled (boolean, optional): Disable fallback for this phase\n\n4. Provide cascading hierarchy examples:\n\nExample 1: Policy Override Global\n```yaml\n# config.yaml\nfallback:\n  enabled: true\n  default_agent: build\n\n# policies.yaml\npolicies:\n  my-policy:\n    fallback_enabled: true\n    fallback_agent: summary  # Override global default\n```\n\nExample 2: Phase Override Policy\n```yaml\npolicies:\n  my-policy:\n    fallback_enabled: true\n    fallback_agent: summary\n    phases:\n      - name: test\n        capabilities: [testing]\n        fallback_agent: general  # Override policy default\n```\n\nExample 3: Disable Fallback at Phase Level\n```yaml\npolicies:\n  my-policy:\n    fallback_enabled: true\n    fallback_agent: summary\n    phases:\n      - name: review\n        capabilities: [review]\n        fallback_enabled: false  # No fallback for this phase\n```\n\n5. Explain disable functionality:\n   - fallback_enabled: false at any level disables fallback\n   - Cascading: Phase disables → No fallback for this phase\n   - Cascading: Policy disables → No fallback for any phase in this policy\n   - Cascading: Global disables → No fallback anywhere\n\n6. Add inheritance rules:\n   - If not specified, inherit from parent level\n   - Explicit false always disables\n   - Explicit value always overrides inheritance\n\nAcceptance Criteria:\n- [ ] Fallback section added to policies documentation\n- [ ] Policy-level fields documented\n- [ ] Phase-level fields documented\n- [ ] Cascading hierarchy examples provided\n- [ ] Disable functionality explained clearly\n- [ ] Inheritance rules documented\n- [ ] Examples are clear and well-commented\n- [ ] Documentation is comprehensive","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-05T02:44:34.419129+01:00","updated_at":"2026-01-05T03:23:47.512091+01:00","closed_at":"2026-01-05T03:23:47.512091+01:00","close_reason":"Completed","dependencies":[{"issue_id":"agent-shepherd-ybi","depends_on_id":"agent-shepherd-uj0","type":"parent-child","created_at":"2026-01-05T02:45:00.599749+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-ybu35","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T05:10:41.663401+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T05:10:41.773418+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-09T05:10:41.773418+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-yc6h","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:36:03.459032+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:36:03.560992+01:00","deleted_at":"2026-01-07T02:36:03.560992+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ycfvn","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:20:54.450752+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:54.551662+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-09T01:20:54.551662+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ycj","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-06T04:34:52.865141+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:52.922214+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-06T04:34:52.922214+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-ydmu","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:54:01.082614+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:54:01.157223+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-06T15:54:01.157223+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-yey2g","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T20:11:02.120161+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T20:11:02.198041+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-09T20:11:02.198041+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-yh55h","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-08T23:12:16.131736+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T23:12:16.208351+01:00","deleted_at":"2026-01-08T23:12:16.208351+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-yhn0","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T21:44:10.124931+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:44:10.179654+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T21:44:10.179654+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-yippe","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:08:12.726365+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:08:13.05113+01:00","labels":["label2","label3"],"deleted_at":"2026-01-11T00:08:13.05113+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-yiv9","title":"3.1.4 Create Archive Database Schema","description":"Initialize archive database with same schema as active. Create runs_archive.db with identical tables (runs_archive, decisions_archive) and indexes. Ensure schema matches active database exactly for seamless data movement.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:09:06.978656+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:12:28.950967+01:00","deleted_at":"2026-01-07T01:12:28.950967+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-yje","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:34:54.575475+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:54.696791+01:00","labels":["label2","label3"],"deleted_at":"2026-01-06T04:34:54.696791+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ymfc","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:05:11.309265+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:05:11.450281+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T19:05:11.450281+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ynn3","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T03:43:28.267645+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:43:28.393001+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T03:43:28.393001+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ynz4","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T15:02:08.663857+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T15:02:08.729334+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T15:02:08.729334+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-yqnc","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:51:20.301888+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:51:20.400223+01:00","deleted_at":"2026-01-07T02:51:20.400223+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-yr2r","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:41:59.83175+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:41:59.87617+01:00","deleted_at":"2026-01-07T02:41:59.87617+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-yr7k","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:57:12.445995+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:57:12.506969+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-06T15:57:12.506969+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-yr7xz","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T04:41:41.341091+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T04:41:41.448288+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T04:41:41.448288+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-ys9o","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-06T15:57:13.878326+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:57:14.233253+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-06T15:57:14.233253+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-yufqg","title":"label-workflow-test: Explicit workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:23:32.405535+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:23:32.485232+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-09T01:23:32.485232+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-yvn","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:42:32.064678+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:42:32.189371+01:00","labels":["label2","label3"],"deleted_at":"2026-01-06T04:42:32.189371+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-yxef","title":"label-workflow-test: Full workflow lifecycle test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T02:59:44.508759+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:59:44.968315+01:00","labels":["ashep-workflow:simple"],"deleted_at":"2026-01-07T02:59:44.968315+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-yxvtl","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:20:54.211639+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:54.414746+01:00","deleted_at":"2026-01-09T01:20:54.414746+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-yykg","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:57:14.262562+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:57:14.377255+01:00","labels":["label2","label3"],"deleted_at":"2026-01-06T15:57:14.377255+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-yyr3","title":"3.1.9 Add Cleanup Metrics","description":"Track cleanup operations for monitoring. Define CleanupMetrics interface, record metrics after each cleanup, store in database, and provide queries for cleanup statistics and trends.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T01:09:16.732769+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T01:12:28.540456+01:00","deleted_at":"2026-01-07T01:12:28.540456+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-z0s8","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T05:54:20.52385+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T05:54:20.588553+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-08T05:54:20.588553+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-z1jhx","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:16:00.143065+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:16:00.272357+01:00","deleted_at":"2026-01-09T01:16:00.272357+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-z2kk","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T06:03:27.022178+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T06:03:27.069164+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T06:03:27.069164+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-z2xlr","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T23:23:28.489417+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:23:28.610988+01:00","deleted_at":"2026-01-09T23:23:28.610988+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-z47","title":"label-workflow-test: Phase label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:42:30.504306+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:42:30.590804+01:00","labels":["ashep-phase:implement"],"deleted_at":"2026-01-06T04:42:30.590804+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-z536f","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T23:03:54.276205+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T23:03:54.47224+01:00","deleted_at":"2026-01-09T23:03:54.47224+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-z61m","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T04:53:55.452952+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T04:53:55.517443+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T04:53:55.517443+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-z61vo","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T00:52:30.174823+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T00:52:30.295293+01:00","deleted_at":"2026-01-11T00:52:30.295293+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-z688","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T18:33:22.074675+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:33:22.145332+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T18:33:22.145332+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-z7i","title":"label-workflow-test: No matching policy test","status":"tombstone","priority":2,"issue_type":"epic","created_at":"2026-01-06T04:24:42.951993+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:32:28.992691+01:00","deleted_at":"2026-01-06T04:32:28.992691+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"epic"}
{"id":"agent-shepherd-z8mol","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:24:05.274477+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:24:05.392543+01:00","deleted_at":"2026-01-09T01:24:05.392543+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-za3s","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:28:08.237145+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:28:08.346619+01:00","deleted_at":"2026-01-06T23:28:08.346619+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-zaxh","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T21:46:03.242721+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T21:46:03.463829+01:00","deleted_at":"2026-01-07T21:46:03.463829+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-zbad","title":"label-workflow-test: HITL label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:39:11.604578+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:39:11.66848+01:00","labels":["ashep-hitl:manual-intervention"],"deleted_at":"2026-01-07T14:39:11.66848+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-zcze","title":"label-workflow-test: Non-exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:58:05.720674+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:58:05.763011+01:00","deleted_at":"2026-01-06T15:58:05.763011+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-zd7q","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T03:38:11.102628+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T03:38:11.17145+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T03:38:11.17145+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-zgna","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:28:08.108214+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:28:08.14563+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-06T23:28:08.14563+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-zhj","title":"Agent Shepherd Label System - Complete Implementation","description":"## Epic Overview\n\nThis epic implements a comprehensive label-based workflow orchestration system for Agent Shepherd using Beads labels.\n\n### Core Features\n\n1. **Trigger System** - Automatic workflow selection via `ashep-workflow:` labels and issue type matching\n2. **Phase Tracking** - Track current phase via `ashep-phase:` labels\n3. **Status/HITL Markers** - Mark human-in-the-loop states via `ashep-hitl:` labels\n4. **Exclusion Control** - Exclude issues via `ashep-excluded` label\n\n### Design Summary\n\n**Label Naming Convention:**\n- `ashep-workflow:\u003cname\u003e` - Explicit workflow assignment\n- `ashep-phase:\u003cname\u003e` - Current workflow phase\n- `ashep-excluded` - Exclusion marker\n- `ashep-hitl:\u003creason\u003e` - Human-in-the-loop state\n\n**Trigger System Priority:**\n1. Explicit workflow label (`ashep-workflow:xxx`) → Direct assignment\n2. Issue type matching → Policy with matching issue_types array (highest priority wins)\n3. Default policy → Fallback\n\n**HITL Reason Design:**\n- Predefined reasons: approval, manual-intervention, timeout, error, review-request\n- Custom reasons allowed with alphanumeric-dash-underscore validation\n- Configurable via `config.hitl.allowed_reasons`\n\n### Implementation Scope\n\n- **Total Phases:** 6\n- **Files Modified:** 13 files\n- **New Code:** ~1500 lines\n- **New Test Files:** 6 files (~830 lines)\n- **Documentation Updates:** 5 files\n\n### Dependencies\n\nAll phases must be completed sequentially:\n- Phase 1 → Phase 2 → Phase 3 → Phase 4 → Phase 5 → Phase 6\n\n---\n\n## Scratchpad\n\n**Implementation Phases:**\n\n**Phase 1: Infrastructure - Foundation (~4 hours)**\n- Add BeadsIssue.labels field\n- Implement getIssueLabels(), updateIssueLabels(), addIssueLabel(), removeIssueLabel()\n- Update getIssue() and getReadyIssues() to include labels\n- Write unit tests for label functions\n- Files: beads.ts, tests/beads-labels.test.ts\n\n**Phase 2: Schema \u0026 Configuration (~3 hours)**\n- Add workflow section to config.schema.json (invalid_label_strategy)\n- Add hitl section to config.schema.json (allowed_reasons, allow_custom, custom_validation)\n- Add issue_types and priority fields to policies.schema.json\n- Update cmdInit() to add new config sections to default config\n- Write config loading tests\n- Files: config.schema.json, policies.schema.json, src/cli/index.ts\n\n**Phase 3: Trigger System (~6 hours)**\n- Update PolicyConfig interface with issue_types and priority\n- Implement matchPolicy() method in PolicyEngine\n- Update processIssue() to use matchPolicy() instead of getDefaultPolicyName()\n- Implement invalid workflow label handling based on config\n- Implement priority-based selection with tie-breaking (config order)\n- Write unit tests for trigger system\n- Files: policy.ts, tests/trigger-system.test.ts\n\n**Phase 4: Phase \u0026 HITL Tracking (~6 hours)**\n- Implement setPhaseLabel(), removePhaseLabels(), hasPhaseLabel()\n- Implement setHITLLabel(), clearHITLLabels(), hasHITLLabel()\n- Implement validateHITLReason() in policy.ts\n- Update processIssue() to read phase labels and resume from current phase\n- Update applyTransition() to manage phase labels on transitions\n- Update applyTransition() to set/clear HITL labels\n- Add approval note generation when HITL triggered\n- Write unit tests for phase and HITL tracking\n- Files: beads.ts, policy.ts, worker-engine.ts, tests/phase-tracking.test.ts, tests/hitl-tracking.test.ts\n\n**Phase 5: Exclusion Control (~2 hours)**\n- Implement hasExcludedLabel() helper\n- Update getEligibleIssues() to filter by label (not text)\n- Remove excluded_tags from WorkerConfig interface\n- Update constructor to remove excluded_tags\n- Write unit tests for exclusion logic\n- Files: beads.ts, worker-engine.ts, tests/exclusion-control.test.ts\n\n**Phase 6: Documentation \u0026 Integration Tests (~5 hours)**\n- Update docs/policies-config.md with trigger system\n- Remove deprecated trigger fields from documentation\n- Update docs/config-config.md with workflow and hitl sections\n- Update docs/architecture.md with label system\n- Update README.md with label usage examples\n- Write integration tests for full workflow\n- Update AGENTS.md with new label conventions\n- Files: policies-config.md, config-config.md, architecture.md, README.md, AGENTS.md, tests/integration/label-workflow.test.ts\n\n**Testing Strategy:**\n- Unit Tests: 90%+ coverage for new code\n- Integration Tests: 5 end-to-end workflow scenarios\n- Manual Testing: 7-step checklist\n\n**Breaking Changes:**\n- Removed: excluded_tags from WorkerConfig\n- Behavior Change: Issues filtered by label, not text content\n- Schema Changes: New fields in config and policies schemas\n\n**Migration Guide:**\n1. Update any issues using text-based exclusion to use ashep-excluded label\n2. Remove excluded_tags from config.yaml\n3. Run `ashep validate` to check configuration\n4. Review updated policies.yaml for trigger system\n5. Test workflow with a sample issue\n\n---\n\n## Execution Note\n\nWhen assigned this epic, consume the overall context and select the next available child issue to work on, rather than working on the epic directly.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-05T17:24:55.676336+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:37:05.058217+01:00","closed_at":"2026-01-06T04:37:05.058217+01:00","close_reason":"All 6 phases completed successfully. Label-based workflow system fully implemented with documentation and tests."}
{"id":"agent-shepherd-zhj.1","title":"Phase 1: Infrastructure - Foundation","description":"Add label fetching and management capabilities to Beads integration.\n\n**Tasks:**\n1.1 Update BeadsIssue interface to include labels field\n1.2 Implement getIssueLabels() function\n1.3 Implement updateIssueLabels() function  \n1.4 Implement addIssueLabel() helper\n1.5 Implement removeIssueLabel() helper\n1.6 Update getIssue() to include labels\n1.7 Update getReadyIssues() to include labels\n1.8 Write unit tests for label functions\n\n**Files:**\n- src/core/beads.ts (+150 lines)\n- tests/beads-labels.test.ts (new file, +200 lines)\n\n**Effort:** ~4 hours | **Risk:** Low\n\n**Dependencies:** None (first phase)\n\n**Acceptance Criteria:**\n- [ ] BeadsIssue.labels field exists\n- [ ] getIssueLabels() returns array of label strings\n- [ ] updateIssueLabels() adds and removes labels correctly\n- [ ] getIssue() includes labels in returned object\n- [ ] getReadyIssues() includes labels for all issues\n- [ ] All label functions handle errors gracefully\n- [ ] Unit tests cover all label functions","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:25:25.30499+01:00","created_by":"tonyhartmann","updated_at":"2026-01-05T17:43:50.241984+01:00","closed_at":"2026-01-05T17:43:50.241984+01:00","close_reason":"Completed all Phase 1 tasks:\n- Added labels field to BeadsIssue interface\n- Implemented getIssueLabels, updateIssueLabels, addIssueLabel, removeIssueLabel functions\n- Updated getIssue and getReadyIssues to include labels\n- Created comprehensive unit tests in tests/beads-labels.test.ts\n- All tests passing (13 tests)\n- Lint and type-check successful","dependencies":[{"issue_id":"agent-shepherd-zhj.1","depends_on_id":"agent-shepherd-zhj","type":"parent-child","created_at":"2026-01-05T17:25:25.305662+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-zhj.1.1","title":"1.1 Update BeadsIssue interface to include labels field","description":"Add the  field to the BeadsIssue interface in src/core/beads.ts.\n\nThis field will hold the array of Beads labels associated with each issue.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:25:34.420464+01:00","created_by":"tonyhartmann","updated_at":"2026-01-05T17:43:16.764066+01:00","closed_at":"2026-01-05T17:43:16.764066+01:00","close_reason":"Added labels field to BeadsIssue interface","dependencies":[{"issue_id":"agent-shepherd-zhj.1.1","depends_on_id":"agent-shepherd-zhj.1","type":"parent-child","created_at":"2026-01-05T17:25:34.421114+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-zhj.1.2","title":"1.2 Implement getIssueLabels function","description":"Implement getIssueLabels(issueId: string): Promise\u003cstring[]\u003e function that fetches all labels for a given issue using the  command and returns an array of label strings.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:25:38.100654+01:00","created_by":"tonyhartmann","updated_at":"2026-01-05T17:43:20.446305+01:00","closed_at":"2026-01-05T17:43:20.446305+01:00","close_reason":"Implemented getIssueLabels function using bd label list command","dependencies":[{"issue_id":"agent-shepherd-zhj.1.2","depends_on_id":"agent-shepherd-zhj.1","type":"parent-child","created_at":"2026-01-05T17:25:38.106271+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-zhj.1.3","title":"1.3 Implement updateIssueLabels function","description":"Implement updateIssueLabels(issueId: string, addLabels: string[], removeLabels: string[]): Promise\u003cvoid\u003e function that adds and removes labels using  and  commands.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:26:01.920581+01:00","created_by":"tonyhartmann","updated_at":"2026-01-05T17:43:24.317617+01:00","closed_at":"2026-01-05T17:43:24.317617+01:00","close_reason":"Implemented updateIssueLabels function using addIssueLabel and removeIssueLabel","dependencies":[{"issue_id":"agent-shepherd-zhj.1.3","depends_on_id":"agent-shepherd-zhj.1","type":"parent-child","created_at":"2026-01-05T17:26:01.930091+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-zhj.1.4","title":"1.4 Implement addIssueLabel helper","description":"Implement addIssueLabel(issueId: string, label: string): Promise\u003cvoid\u003e function that adds a single label using bd update command.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:26:05.53831+01:00","created_by":"tonyhartmann","updated_at":"2026-01-05T17:43:32.481416+01:00","closed_at":"2026-01-05T17:43:32.481416+01:00","close_reason":"Implemented addIssueLabel helper using bd label add command","dependencies":[{"issue_id":"agent-shepherd-zhj.1.4","depends_on_id":"agent-shepherd-zhj.1","type":"parent-child","created_at":"2026-01-05T17:26:05.542607+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-zhj.1.5","title":"1.7 Update getReadyIssues to include labels","description":"Modify getReadyIssues() function in beads.ts to call getIssueLabels() for each issue and populate the labels field in returned BeadsIssue objects.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:26:26.054716+01:00","created_by":"tonyhartmann","updated_at":"2026-01-05T17:43:36.715869+01:00","closed_at":"2026-01-05T17:43:36.715869+01:00","close_reason":"Updated getReadyIssues to include labels by calling getIssueLabels for each issue","dependencies":[{"issue_id":"agent-shepherd-zhj.1.5","depends_on_id":"agent-shepherd-zhj.1","type":"parent-child","created_at":"2026-01-05T17:26:26.065372+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-zhj.1.7","title":"1.8 Write unit tests for label functions","description":"Create tests/beads-labels.test.ts with comprehensive unit tests for all new label functions including getIssueLabels, updateIssueLabels, addIssueLabel, removeIssueLabel, and verify that getIssue and getReadyIssues include labels.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:26:30.839765+01:00","created_by":"tonyhartmann","updated_at":"2026-01-05T17:43:40.59034+01:00","closed_at":"2026-01-05T17:43:40.59034+01:00","close_reason":"Created comprehensive unit tests for all label functions in tests/beads-labels.test.ts","dependencies":[{"issue_id":"agent-shepherd-zhj.1.7","depends_on_id":"agent-shepherd-zhj.1","type":"parent-child","created_at":"2026-01-05T17:26:30.843879+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-zhj.1.8","title":"1.6 Update getIssue to include labels","description":"Modify getIssue function in beads.ts to call getIssueLabels and populate the labels field in returned BeadsIssue object.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:28:27.95181+01:00","created_by":"tonyhartmann","updated_at":"2026-01-05T17:43:44.919579+01:00","closed_at":"2026-01-05T17:43:44.919579+01:00","close_reason":"Updated getIssue to include labels by calling getIssueLabels","dependencies":[{"issue_id":"agent-shepherd-zhj.1.8","depends_on_id":"agent-shepherd-zhj.1","type":"parent-child","created_at":"2026-01-05T17:28:27.952606+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-zhj.2","title":"Phase 2: Schema and Configuration","description":"Add trigger system and HITL configuration to schemas and default config.\n\n**Tasks:**\n2.1 Update config.schema.json with workflow section\n2.2 Update config.schema.json with hitl section\n2.3 Update policies.schema.json with issue_types and priority fields\n2.4 Remove deprecated trigger fields from policies.schema.json\n2.5 Update cmdInit to add workflow section to default config\n2.6 Update cmdInit to add hitl section to default config\n2.7 Write config loading tests\n\n**Files:**\n- schemas/config.schema.json (+50 lines)\n- schemas/policies.schema.json (+20 lines)\n- src/cli/index.ts (+30 lines)\n\n**Effort:** ~3 hours | **Risk:** Low\n\n**Dependencies:** Phase 1\n\n**Acceptance Criteria:**\n- [ ] config.schema.json includes workflow section\n- [ ] config.schema.json includes hitl section\n- [ ] policies.schema.json includes issue_types field\n- [ ] policies.schema.json includes priority field\n- [ ] cmdInit adds workflow and hitl to default config\n- [ ] Config validation accepts all new fields\n- [ ] Deprecated trigger fields handled appropriately","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:26:36.243322+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T01:51:56.019686+01:00","closed_at":"2026-01-06T01:51:56.019686+01:00","close_reason":"Completed all Phase 2 tasks: Added workflow and hitl sections to config.schema.json, added issue_types and priority fields to policies.schema.json, updated cmdInit to add workflow and hitl to default config, wrote config loading tests with 9 passing tests","dependencies":[{"issue_id":"agent-shepherd-zhj.2","depends_on_id":"agent-shepherd-zhj","type":"parent-child","created_at":"2026-01-05T17:26:36.247421+01:00","created_by":"daemon"},{"issue_id":"agent-shepherd-zhj.2","depends_on_id":"agent-shepherd-zhj.1","type":"blocks","created_at":"2026-01-05T17:28:53.051704+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-zhj.2.1","title":"2.2 Update config.schema.json with hitl section","description":"Add hitl configuration section to config.schema.json with allowed_reasons.predefined array, allow_custom boolean, and custom_validation enum (none, alphanumeric, alphanumeric-dash-underscore).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:27:16.705826+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T01:44:58.587178+01:00","closed_at":"2026-01-06T01:44:58.587178+01:00","close_reason":"Added workflow and hitl sections to config.schema.json with invalid_label_strategy and allowed_reasons configuration","dependencies":[{"issue_id":"agent-shepherd-zhj.2.1","depends_on_id":"agent-shepherd-zhj.2","type":"parent-child","created_at":"2026-01-05T17:27:16.715979+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-zhj.2.2","title":"2.3 Update policies.schema.json with issue_types and priority fields","description":"Add issue_types array field and priority integer field (1-100, default 50) to policyConfig definition in policies.schema.json.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:27:27.540404+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T01:45:23.153507+01:00","closed_at":"2026-01-06T01:45:23.153507+01:00","close_reason":"Added issue_types array and priority integer fields to policyConfig definition in policies.schema.json","dependencies":[{"issue_id":"agent-shepherd-zhj.2.2","depends_on_id":"agent-shepherd-zhj.2","type":"parent-child","created_at":"2026-01-05T17:27:27.541155+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-zhj.2.3","title":"2.6 Update cmdInit to add hitl section to default config","description":"Modify the cmdInit function in src/cli/index.ts to include the hitl configuration section with default allowed_reasons settings when creating new config.yaml files.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:27:33.143852+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T01:46:06.309074+01:00","closed_at":"2026-01-06T01:46:06.309074+01:00","close_reason":"Updated cmdInit to add both workflow and hitl sections to default config with appropriate defaults","dependencies":[{"issue_id":"agent-shepherd-zhj.2.3","depends_on_id":"agent-shepherd-zhj.2","type":"parent-child","created_at":"2026-01-05T17:27:33.153977+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-zhj.3","title":"Phase 3: Trigger System","description":"Implement automatic workflow selection based on labels and issue types.\n\n**Tasks:**\n3.1 Update PolicyConfig interface with issue_types and priority\n3.2 Implement matchPolicy method in PolicyEngine\n3.3 Update processIssue to use matchPolicy instead of getDefaultPolicyName\n3.4 Implement invalid workflow label handling based on config\n3.5 Implement priority-based selection with tie-breaking (config order)\n3.6 Write unit tests for trigger system\n\n**Files:**\n- src/core/policy.ts (+100 lines)\n- tests/trigger-system.test.ts (new file, +150 lines)\n\n**Effort:** ~6 hours | **Risk:** Medium\n\n**Dependencies:** Phase 2\n\n**Acceptance Criteria:**\n- [ ] matchPolicy method exists and works correctly\n- [ ] Explicit workflow label takes precedence\n- [ ] Issue type matching works correctly\n- [ ] Priority-based selection works\n- [ ] Config order breaks priority ties correctly\n- [ ] Default policy used when no match\n- [ ] Invalid workflow label handled according to config strategy\n- [ ] Worker Engine uses matchPolicy instead of getDefaultPolicyName\n- [ ] All unit tests passing","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:26:41.610552+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T02:23:12.73941+01:00","closed_at":"2026-01-06T02:23:12.73941+01:00","close_reason":"Phase 3: Trigger System completed. All acceptance criteria met:\n- matchPolicy method exists and works correctly\n- Explicit workflow label takes precedence\n- Issue type matching works correctly\n- Priority-based selection works\n- Config order breaks priority ties correctly\n- Default policy used when no match\n- Invalid workflow label handled according to config strategy\n- Worker Engine uses matchPolicy instead of getDefaultPolicyName\n- All unit tests passing (13 tests)","dependencies":[{"issue_id":"agent-shepherd-zhj.3","depends_on_id":"agent-shepherd-zhj","type":"parent-child","created_at":"2026-01-05T17:26:41.614586+01:00","created_by":"daemon"},{"issue_id":"agent-shepherd-zhj.3","depends_on_id":"agent-shepherd-zhj.2","type":"blocks","created_at":"2026-01-05T17:28:53.04256+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-zhj.3.1","title":"3.1 Update PolicyConfig interface with issue_types and priority","description":"Add issue_types string array and priority number fields to the PolicyConfig interface in src/core/policy.ts.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:27:36.631932+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T02:23:02.693281+01:00","closed_at":"2026-01-06T02:23:02.693281+01:00","close_reason":"Closed via update","dependencies":[{"issue_id":"agent-shepherd-zhj.3.1","depends_on_id":"agent-shepherd-zhj.3","type":"parent-child","created_at":"2026-01-05T17:27:36.650704+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-zhj.3.2","title":"3.5 Implement priority-based selection with tie-breaking","description":"Implement sorting logic in matchPolicy to select policies by highest priority, using config order to break ties when multiple policies have same priority.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:27:43.025283+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T02:23:02.696602+01:00","closed_at":"2026-01-06T02:23:02.696602+01:00","close_reason":"Closed via update","dependencies":[{"issue_id":"agent-shepherd-zhj.3.2","depends_on_id":"agent-shepherd-zhj.3","type":"parent-child","created_at":"2026-01-05T17:27:43.030783+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-zhj.3.4","title":"3.2 Implement matchPolicy method in PolicyEngine","description":"Implement matchPolicy(issue: BeadsIssue): string method in PolicyEngine class that checks for explicit workflow label, matches by issue type using priority, and falls back to default policy.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:27:43.031769+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T02:23:02.701587+01:00","closed_at":"2026-01-06T02:23:02.701587+01:00","close_reason":"Closed via update","dependencies":[{"issue_id":"agent-shepherd-zhj.3.4","depends_on_id":"agent-shepherd-zhj.3","type":"parent-child","created_at":"2026-01-05T17:27:43.032238+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-zhj.4","title":"Phase 4: Phase and HITL Tracking","description":"Track workflow phases and human-in-the-loop states via labels.\n\n**Tasks:**\n4.1 Implement setPhaseLabel function\n4.2 Implement removePhaseLabels helper\n4.3 Implement setHITLLabel function\n4.4 Implement clearHITLLabels function\n4.5 Implement validateHITLReason function\n4.6 Update processIssue to read phase labels and resume from current phase\n4.7 Update applyTransition to manage phase labels on transitions\n4.8 Update applyTransition to set/clear HITL labels\n4.9 Add approval note generation when HITL triggered\n4.10 Write unit tests for phase and HITL tracking\n\n**Files:**\n- src/core/beads.ts (additional changes)\n- src/core/policy.ts (additional changes)\n- src/core/worker-engine.ts (+80 lines)\n- tests/phase-tracking.test.ts (new file, +120 lines)\n- tests/hitl-tracking.test.ts (new file, +100 lines)\n\n**Effort:** ~6 hours | **Risk:** Medium\n\n**Dependencies:** Phase 3\n\n**Acceptance Criteria:**\n- [ ] setPhaseLabel sets correct label format\n- [ ] removePhaseLabels removes all phase labels\n- [ ] setHITLLabel sets correct label format\n- [ ] clearHITLLabels removes all HITL labels\n- [ ] validateHITLReason validates predefined reasons\n- [ ] validateHITLReason validates custom reasons based on config\n- [ ] processIssue reads phase label and resumes correctly\n- [ ] applyTransition updates phase label on advance\n- [ ] applyTransition keeps phase label on retry\n- [ ] applyTransition sets HITL label on approval block\n- [ ] applyTransition removes all tracking labels on close\n- [ ] Approval note generated when HITL triggered\n- [ ] All unit tests passing","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:26:59.323371+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T03:11:46.489037+01:00","closed_at":"2026-01-06T03:11:46.489037+01:00","close_reason":"All tasks completed - Phase 4: Phase and HITL Tracking implementation done","dependencies":[{"issue_id":"agent-shepherd-zhj.4","depends_on_id":"agent-shepherd-zhj","type":"parent-child","created_at":"2026-01-05T17:26:59.332451+01:00","created_by":"daemon"},{"issue_id":"agent-shepherd-zhj.4","depends_on_id":"agent-shepherd-zhj.3","type":"blocks","created_at":"2026-01-05T17:28:52.957742+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-zhj.4.1","title":"4.3 Implement setHITLLabel function","description":"Implement setHITLLabel(issueId: string, reason: string): Promise\u003cvoid\u003e function that adds ashep-hitl:reason label to an issue.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:27:49.462378+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T03:11:22.944174+01:00","closed_at":"2026-01-06T03:11:22.944174+01:00","close_reason":"Implemented setHITLLabel function in beads.ts","dependencies":[{"issue_id":"agent-shepherd-zhj.4.1","depends_on_id":"agent-shepherd-zhj.4","type":"parent-child","created_at":"2026-01-05T17:27:49.472428+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-zhj.4.2","title":"4.5 Implement validateHITLReason function","description":"Implement validateHITLReason(reason: string, config: HitlConfig): boolean function in policy.ts that validates HITL reasons against predefined list and custom validation rules.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:27:54.921333+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T03:11:22.944235+01:00","closed_at":"2026-01-06T03:11:22.944235+01:00","close_reason":"Implemented validateHITLReason function in policy.ts","dependencies":[{"issue_id":"agent-shepherd-zhj.4.2","depends_on_id":"agent-shepherd-zhj.4","type":"parent-child","created_at":"2026-01-05T17:27:54.932061+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-zhj.4.3","title":"4.8 Update applyTransition to set/clear HITL labels","description":"Modify applyTransition in WorkerEngine to set ashep-hitl: label when blocking for approval and clear HITL labels when resuming or closing.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:28:02.339789+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T03:11:23.043426+01:00","closed_at":"2026-01-06T03:11:23.043426+01:00","close_reason":"Updated applyTransition to set/clear HITL labels in worker-engine.ts","dependencies":[{"issue_id":"agent-shepherd-zhj.4.3","depends_on_id":"agent-shepherd-zhj.4","type":"parent-child","created_at":"2026-01-05T17:28:02.351488+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-zhj.5","title":"Phase 5: Exclusion Control","description":"Exclude issues from processing via ashep-excluded label.\n\n**Tasks:**\n5.1 Implement hasExcludedLabel helper\n5.2 Update getEligibleIssues to filter by label (not text)\n5.3 Remove excluded_tags from WorkerConfig interface\n5.4 Update constructor to remove excluded_tags\n5.5 Write unit tests for exclusion logic\n\n**Files:**\n- src/core/beads.ts (additional changes)\n- src/core/worker-engine.ts (additional changes)\n- tests/exclusion-control.test.ts (new file, +60 lines)\n\n**Effort:** ~2 hours | **Risk:** Low\n\n**Dependencies:** Phase 4\n\n**Acceptance Criteria:**\n- [ ] hasExcludedLabel correctly identifies excluded issues\n- [ ] getEligibleIssues filters by label (not text)\n- [ ] excluded_tags removed from WorkerConfig\n- [ ] Constructor does not use excluded_tags\n- [ ] Excluded issues are skipped with log message\n- [ ] Unit tests passing","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:27:03.982728+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T03:34:34.364027+01:00","closed_at":"2026-01-06T03:34:34.364027+01:00","close_reason":"Completed all tasks:\n- Added hasExcludedLabel helper function in beads.ts\n- Updated getEligibleIssues to filter by ashep-excluded label instead of text matching\n- Removed excluded_tags from WorkerConfig interface\n- Updated constructor to remove excluded_tags usage\n- Created comprehensive unit tests (9 tests passing)\n- All tests passing (118 pass, 1 pre-existing failure)\n- Lint and type-check passing","dependencies":[{"issue_id":"agent-shepherd-zhj.5","depends_on_id":"agent-shepherd-zhj","type":"parent-child","created_at":"2026-01-05T17:27:03.983358+01:00","created_by":"daemon"},{"issue_id":"agent-shepherd-zhj.5","depends_on_id":"agent-shepherd-zhj.4","type":"blocks","created_at":"2026-01-05T17:28:53.043691+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-zhj.5.1","title":"5.2 Update getEligibleIssues to filter by label","description":"Modify getEligibleIssues in WorkerEngine to filter out issues with ashep-excluded label (replacing text-based filtering).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:28:08.35426+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T03:34:11.30615+01:00","closed_at":"2026-01-06T03:34:11.30615+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-zhj.5.1","depends_on_id":"agent-shepherd-zhj.5","type":"parent-child","created_at":"2026-01-05T17:28:08.369682+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-zhj.6","title":"Phase 6: Documentation and Integration Tests","description":"Update all documentation and write end-to-end tests.\n\n**Tasks:**\n6.1 Update docs/policies-config.md with trigger system\n6.2 Remove deprecated trigger fields from documentation\n6.3 Update docs/config-config.md with workflow and hitl sections\n6.4 Update docs/architecture.md with label system\n6.5 Update README.md with label usage examples\n6.6 Write integration tests for full workflow\n6.7 Update AGENTS.md with new label conventions\n\n**Files:**\n- docs/policies-config.md (+150/-20 lines)\n- docs/config-config.md (+100/-10 lines)\n- docs/architecture.md (+50/-10 lines)\n- README.md (+80 lines)\n- AGENTS.md (+30 lines)\n- tests/integration/label-workflow.test.ts (new file, +200 lines)\n\n**Effort:** ~5 hours | **Risk:** Low\n\n**Dependencies:** Phase 5\n\n**Acceptance Criteria:**\n- [ ] docs/policies-config.md documents trigger system\n- [ ] Deprecated trigger fields removed or marked as deprecated\n- [ ] docs/config-config.md documents workflow section\n- [ ] docs/config-config.md documents hitl section\n- [ ] docs/architecture.md shows label-based workflow\n- [ ] README.md has label usage examples\n- [ ] AGENTS.md documents label conventions\n- [ ] Integration tests cover full workflow scenarios\n- [ ] Integration tests cover exclusion control\n- [ ] Integration tests cover invalid workflow handling\n- [ ] All tests passing","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:27:10.763617+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:36:33.000466+01:00","closed_at":"2026-01-06T04:36:33.000466+01:00","close_reason":"Phase 6 completed: All documentation updated and integration tests passing.","dependencies":[{"issue_id":"agent-shepherd-zhj.6","depends_on_id":"agent-shepherd-zhj","type":"parent-child","created_at":"2026-01-05T17:27:10.770932+01:00","created_by":"daemon"},{"issue_id":"agent-shepherd-zhj.6","depends_on_id":"agent-shepherd-zhj.5","type":"blocks","created_at":"2026-01-05T17:28:53.033622+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-zhj.6.1","title":"6.4 Update docs/config-config.md with hitl section","description":"Add HITL configuration section documentation to docs/config-config.md explaining allowed_reasons configuration and validation options.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:28:14.106853+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:34:24.073371+01:00","closed_at":"2026-01-06T23:34:24.073371+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-zhj.6.1","depends_on_id":"agent-shepherd-zhj.6","type":"parent-child","created_at":"2026-01-05T17:28:14.121414+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-zhj.6.3","title":"6.5 Update docs/architecture.md with label system","description":"Update docs/architecture.md to describe the new label-based workflow orchestration system and its integration with Beads.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:28:19.999578+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T23:38:21.950344+01:00","closed_at":"2026-01-06T23:38:21.950344+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-zhj.6.3","depends_on_id":"agent-shepherd-zhj.6","type":"parent-child","created_at":"2026-01-05T17:28:20.025882+01:00","created_by":"daemon"}]}
{"id":"agent-shepherd-zhvq","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:05:09.728426+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:05:09.808826+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T19:05:09.808826+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-zj4o","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:57:12.990484+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:57:13.150444+01:00","deleted_at":"2026-01-06T15:57:13.150444+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-zjf1","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:32:18.598057+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:32:18.772244+01:00","deleted_at":"2026-01-07T14:32:18.772244+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-zjzh","title":"label-workflow-test: Default workflow label test","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-07T20:36:35.937952+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T20:36:36.031311+01:00","labels":["ashep-workflow:default"],"deleted_at":"2026-01-07T20:36:36.031311+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"feature"}
{"id":"agent-shepherd-zkc","title":"Build Agent Shepherd Orchestration System","description":"The current agent ecosystem lacks effective orchestration for multi-step workflows, policy enforcement, and human-in-the-loop coordination. Agent Shepherd fills this gap by providing a production-ready TypeScript/Bun project that orchestrates AI coding agents across Beads issues, using OpenCode as the execution environment, enabling safe, explainable, and autonomous software development.\n\n**Reference Documentation**: See @urls.md for authoritative links to Beads, OpenCode, OpenSpec, BMAD Method, ReactFlow, and architectural inspiration from Steve Yegge's articles on agent autonomy and multi-step development.\n\n- Add full CLI interface with commands for worker, monitor, work, init, install, sync-agents, ui\n- Implement Worker Engine to pull from Beads and launch agents in OpenCode sessions\n- Add Monitor Engine for supervision, timeout detection, and HITL handling\n- Create Policy Engine for workflow phase transitions and retries\n- Build Agent Registry with capability-based agent selection\n- Integrate logging with JSONL and SQLite dual storage like Beads\n- Add OpenCode integration using @opencode-ai/sdk for session management\n- Implement Beads integration via shell commands for issue management\n- Develop minimal ReactFlow-based UI for flow visualization\n- Include installer and init commands with default configs","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:08:55.459449+01:00","updated_at":"2025-12-20T04:52:42.934476+01:00","closed_at":"2025-12-20T04:52:42.934476+01:00","close_reason":"Closed"}
{"id":"agent-shepherd-zkc.1","title":"1. Project Setup","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:09:00.638344+01:00","updated_at":"2025-12-20T03:22:52.613069+01:00","closed_at":"2025-12-20T03:22:52.613072+01:00","dependencies":[{"issue_id":"agent-shepherd-zkc.1","depends_on_id":"agent-shepherd-zkc","type":"parent-child","created_at":"2025-12-19T04:09:00.639092+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.1.1","title":"1.1 Create package.json with Bun, TypeScript, dependencies (@opencode-ai/sdk, react, reactflow, etc.)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:09:05.798752+01:00","updated_at":"2025-12-20T03:21:46.661272+01:00","closed_at":"2025-12-20T03:21:46.661288+01:00","dependencies":[{"issue_id":"agent-shepherd-zkc.1.1","depends_on_id":"agent-shepherd-zkc.1","type":"parent-child","created_at":"2025-12-19T04:09:05.800528+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.1.2","title":"1.2 Create tsconfig.json and bunfig.toml","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:09:10.960841+01:00","updated_at":"2025-12-20T03:22:11.345351+01:00","closed_at":"2025-12-20T03:22:11.345364+01:00","dependencies":[{"issue_id":"agent-shepherd-zkc.1.2","depends_on_id":"agent-shepherd-zkc.1","type":"parent-child","created_at":"2025-12-19T04:09:10.961557+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.1.3","title":"1.3 Set up directory structure (src/cli, src/core, src/utils, .agent-shepherd, docs, schemas, ui)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:09:16.119436+01:00","updated_at":"2025-12-20T03:22:31.861087+01:00","closed_at":"2025-12-20T03:22:31.861102+01:00","dependencies":[{"issue_id":"agent-shepherd-zkc.1.3","depends_on_id":"agent-shepherd-zkc.1","type":"parent-child","created_at":"2025-12-19T04:09:16.120257+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.1.4","title":"1.4 Initialize git repo if not present","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:09:21.276527+01:00","updated_at":"2025-12-20T03:22:47.420668+01:00","closed_at":"2025-12-20T03:22:47.420671+01:00","dependencies":[{"issue_id":"agent-shepherd-zkc.1.4","depends_on_id":"agent-shepherd-zkc.1","type":"parent-child","created_at":"2025-12-19T04:09:21.277268+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.2","title":"2. Core Modules","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:09:26.439505+01:00","updated_at":"2025-12-20T03:40:04.541689+01:00","closed_at":"2025-12-20T03:40:04.541695+01:00","dependencies":[{"issue_id":"agent-shepherd-zkc.2","depends_on_id":"agent-shepherd-zkc","type":"parent-child","created_at":"2025-12-19T04:09:26.440864+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.2.1","title":"2.1 Implement Beads integration (shell commands, issue parsing)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:09:31.63218+01:00","updated_at":"2025-12-20T03:26:24.821954+01:00","closed_at":"2025-12-20T03:26:24.821969+01:00","dependencies":[{"issue_id":"agent-shepherd-zkc.2.1","depends_on_id":"agent-shepherd-zkc.2","type":"parent-child","created_at":"2025-12-19T04:09:31.632898+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.2.2","title":"2.2 Implement OpenCode integration (@opencode-ai/sdk, sessions, messages)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:09:36.788732+01:00","updated_at":"2025-12-20T03:32:32.980554+01:00","closed_at":"2025-12-20T03:32:32.980569+01:00","dependencies":[{"issue_id":"agent-shepherd-zkc.2.2","depends_on_id":"agent-shepherd-zkc.2","type":"parent-child","created_at":"2025-12-19T04:09:36.789375+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.2.3","title":"2.3 Implement Policy Engine (YAML parsing, phase transitions)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:09:41.935739+01:00","updated_at":"2025-12-20T03:37:45.113358+01:00","closed_at":"2025-12-20T03:37:45.113383+01:00","dependencies":[{"issue_id":"agent-shepherd-zkc.2.3","depends_on_id":"agent-shepherd-zkc.2","type":"parent-child","created_at":"2025-12-19T04:09:41.936527+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.2.4","title":"2.4 Implement Agent Registry (YAML loading, capability matching)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:09:47.087352+01:00","updated_at":"2025-12-20T03:38:46.282+01:00","closed_at":"2025-12-20T03:38:46.282013+01:00","dependencies":[{"issue_id":"agent-shepherd-zkc.2.4","depends_on_id":"agent-shepherd-zkc.2","type":"parent-child","created_at":"2025-12-19T04:09:47.087979+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.2.5","title":"2.5 Implement Logging (JSONL + SQLite dual storage)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:09:52.242+01:00","updated_at":"2025-12-20T03:39:59.362041+01:00","closed_at":"2025-12-20T03:39:59.362056+01:00","dependencies":[{"issue_id":"agent-shepherd-zkc.2.5","depends_on_id":"agent-shepherd-zkc.2","type":"parent-child","created_at":"2025-12-19T04:09:52.242811+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.3","title":"3. Engines","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:09:57.408816+01:00","updated_at":"2025-12-20T03:45:54.236904+01:00","closed_at":"2025-12-20T03:45:54.236906+01:00","dependencies":[{"issue_id":"agent-shepherd-zkc.3","depends_on_id":"agent-shepherd-zkc","type":"parent-child","created_at":"2025-12-19T04:09:57.409589+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.3.1","title":"3.1 Implement Worker Engine (ready issues, agent selection, run creation)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:10:02.582721+01:00","updated_at":"2025-12-20T03:43:44.185417+01:00","closed_at":"2025-12-20T03:43:44.185712+01:00","dependencies":[{"issue_id":"agent-shepherd-zkc.3.1","depends_on_id":"agent-shepherd-zkc.3","type":"parent-child","created_at":"2025-12-19T04:10:02.583451+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.3.2","title":"3.2 Implement Monitor Engine (stall detection, HITL handling, timeouts)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:10:07.741749+01:00","updated_at":"2025-12-20T03:44:44.364833+01:00","closed_at":"2025-12-20T03:44:44.364848+01:00","dependencies":[{"issue_id":"agent-shepherd-zkc.3.2","depends_on_id":"agent-shepherd-zkc.3","type":"parent-child","created_at":"2025-12-19T04:10:07.742544+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.3.3","title":"3.3 Implement CLI commands (worker, monitor, work, init, install, sync-agents, ui)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:10:12.902208+01:00","updated_at":"2025-12-20T03:45:49.057219+01:00","closed_at":"2025-12-20T03:45:49.057234+01:00","dependencies":[{"issue_id":"agent-shepherd-zkc.3.3","depends_on_id":"agent-shepherd-zkc.3","type":"parent-child","created_at":"2025-12-19T04:10:12.902963+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.4","title":"4. UI and Installer","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:10:18.054881+01:00","updated_at":"2025-12-20T04:52:10.23356+01:00","closed_at":"2025-12-20T04:52:10.233564+01:00","dependencies":[{"issue_id":"agent-shepherd-zkc.4","depends_on_id":"agent-shepherd-zkc","type":"parent-child","created_at":"2025-12-19T04:10:18.055569+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.4.1","title":"4.1 Create placeholder ReactFlow UI with basic flow visualization","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:10:23.229129+01:00","updated_at":"2025-12-20T04:17:56.635554+01:00","closed_at":"2025-12-20T04:17:56.635569+01:00","dependencies":[{"issue_id":"agent-shepherd-zkc.4.1","depends_on_id":"agent-shepherd-zkc.4","type":"parent-child","created_at":"2025-12-19T04:10:23.23+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.4.2","title":"4.2 Implement UI server with configurable port","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:10:28.384023+01:00","updated_at":"2025-12-20T04:18:17.923676+01:00","closed_at":"2025-12-20T04:18:17.923679+01:00","dependencies":[{"issue_id":"agent-shepherd-zkc.4.2","depends_on_id":"agent-shepherd-zkc.4","type":"parent-child","created_at":"2025-12-19T04:10:28.384702+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.4.3","title":"4.3 Implement installer (check dependencies, suggest installs)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:10:33.588583+01:00","updated_at":"2026-01-05T03:36:29.949185+01:00","closed_at":"2026-01-05T03:36:29.949185+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-zkc.4.3","depends_on_id":"agent-shepherd-zkc.4","type":"parent-child","created_at":"2025-12-19T04:10:33.589391+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.4.4","title":"4.4 Implement init (create .agent-shepherd with defaults)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:10:38.738923+01:00","updated_at":"2025-12-20T05:09:53.871449+01:00","closed_at":"2025-12-20T05:09:53.871449+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-zkc.4.4","depends_on_id":"agent-shepherd-zkc.4","type":"parent-child","created_at":"2025-12-19T04:10:38.739595+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.5","title":"5. Configuration and Schemas","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:10:43.891944+01:00","updated_at":"2025-12-20T04:52:18.770819+01:00","closed_at":"2025-12-20T04:52:18.770823+01:00","dependencies":[{"issue_id":"agent-shepherd-zkc.5","depends_on_id":"agent-shepherd-zkc","type":"parent-child","created_at":"2025-12-19T04:10:43.892975+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.5.1","title":"5.1 Create JSON schemas for config, policies, agents, run outcomes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:10:49.049342+01:00","updated_at":"2025-12-20T04:21:21.587438+01:00","closed_at":"2025-12-20T04:21:21.587452+01:00","dependencies":[{"issue_id":"agent-shepherd-zkc.5.1","depends_on_id":"agent-shepherd-zkc.5","type":"parent-child","created_at":"2025-12-19T04:10:49.049967+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.5.2","title":"5.2 Create default config.yaml, policies.yaml, agents.yaml","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:16:40.408281+01:00","updated_at":"2025-12-20T05:09:53.871212+01:00","closed_at":"2025-12-20T05:09:53.871212+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-zkc.5.2","depends_on_id":"agent-shepherd-zkc.5","type":"parent-child","created_at":"2025-12-19T04:16:40.409172+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.5.3","title":"5.3 Validate configurations at startup","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:16:45.564711+01:00","updated_at":"2025-12-20T04:24:31.065428+01:00","closed_at":"2025-12-20T04:24:31.065441+01:00","dependencies":[{"issue_id":"agent-shepherd-zkc.5.3","depends_on_id":"agent-shepherd-zkc.5","type":"parent-child","created_at":"2025-12-19T04:16:45.566059+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.6","title":"6. Testing and Validation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:16:50.71872+01:00","updated_at":"2025-12-20T04:52:26.893017+01:00","closed_at":"2025-12-20T04:52:26.89302+01:00","dependencies":[{"issue_id":"agent-shepherd-zkc.6","depends_on_id":"agent-shepherd-zkc","type":"parent-child","created_at":"2025-12-19T04:16:50.719658+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.6.1","title":"6.1 Add unit tests for core modules","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:16:55.887891+01:00","updated_at":"2025-12-20T04:33:43.131494+01:00","closed_at":"2025-12-20T04:33:43.13151+01:00","dependencies":[{"issue_id":"agent-shepherd-zkc.6.1","depends_on_id":"agent-shepherd-zkc.6","type":"parent-child","created_at":"2025-12-19T04:16:55.88863+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.6.2","title":"6.2 Add integration tests for CLI commands","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:17:01.144705+01:00","updated_at":"2025-12-20T04:36:39.421229+01:00","closed_at":"2025-12-20T04:36:39.421243+01:00","dependencies":[{"issue_id":"agent-shepherd-zkc.6.2","depends_on_id":"agent-shepherd-zkc.6","type":"parent-child","created_at":"2025-12-19T04:17:01.145758+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.6.3","title":"6.3 Validate with linting and type checking","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:17:06.416477+01:00","updated_at":"2025-12-20T04:48:49.912354+01:00","closed_at":"2025-12-20T04:48:49.912368+01:00","dependencies":[{"issue_id":"agent-shepherd-zkc.6.3","depends_on_id":"agent-shepherd-zkc.6","type":"parent-child","created_at":"2025-12-19T04:17:06.417387+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.6.4","title":"6.4 Test end-to-end workflow (mock Beads/OpenCode)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:17:11.686495+01:00","updated_at":"2025-12-20T05:09:53.870971+01:00","closed_at":"2025-12-20T05:09:53.870971+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-zkc.6.4","depends_on_id":"agent-shepherd-zkc.6","type":"parent-child","created_at":"2025-12-19T04:17:11.687232+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.7","title":"7. Documentation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:17:16.941347+01:00","updated_at":"2025-12-20T04:52:34.687636+01:00","closed_at":"2025-12-20T04:52:34.68764+01:00","dependencies":[{"issue_id":"agent-shepherd-zkc.7","depends_on_id":"agent-shepherd-zkc","type":"parent-child","created_at":"2025-12-19T04:17:16.942073+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.7.1","title":"7.1 Create README.md with setup and usage","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:17:22.203471+01:00","updated_at":"2025-12-20T05:09:53.8707+01:00","closed_at":"2025-12-20T05:09:53.8707+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-zkc.7.1","depends_on_id":"agent-shepherd-zkc.7","type":"parent-child","created_at":"2025-12-19T04:17:22.204272+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.7.2","title":"7.2 Expand docs/architecture.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:17:27.488323+01:00","updated_at":"2025-12-20T05:09:53.869952+01:00","closed_at":"2025-12-20T05:09:53.869952+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-zkc.7.2","depends_on_id":"agent-shepherd-zkc.7","type":"parent-child","created_at":"2025-12-19T04:17:27.489289+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zkc.7.3","title":"7.3 Document CLI commands and configs","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T04:17:32.761881+01:00","updated_at":"2025-12-20T05:09:44.17745+01:00","closed_at":"2025-12-20T05:09:44.17745+01:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-shepherd-zkc.7.3","depends_on_id":"agent-shepherd-zkc.7","type":"parent-child","created_at":"2025-12-19T04:17:32.762762+01:00","created_by":"tonyhartmann"}]}
{"id":"agent-shepherd-zm02","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T05:04:23.742383+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T05:04:23.936191+01:00","deleted_at":"2026-01-07T05:04:23.936191+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-zmhb","title":"label-workflow-test: Batch label update test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T14:32:19.555931+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T14:32:19.688106+01:00","labels":["label2","label3"],"deleted_at":"2026-01-07T14:32:19.688106+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-znwvp","title":"label-workflow-test: Phase label remove test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-11T01:06:41.670281+01:00","created_by":"tonyhartmann","updated_at":"2026-01-11T01:06:42.113133+01:00","deleted_at":"2026-01-11T01:06:42.113133+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-zon7","title":"label-workflow-test: Exclusion toggle test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T15:54:01.584276+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T15:54:01.676142+01:00","deleted_at":"2026-01-06T15:54:01.676142+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-zrej","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T18:14:39.505962+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T18:14:39.573236+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T18:14:39.573236+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-zs9l","title":"2.3.4 Implement validateTransitionLimits()","description":"Validate specific transition doesn't exceed limits.\n\n## Tasks\n- Create validateTransitionLimits(issueId: string, fromPhase: string, toPhase: string): Promise\u003cboolean\u003e:\n  - Checks specific transition pattern (e.g., develop→test)\n  - Configurable per transition pair\n  - If transitionCount \u003e= maxTransitions:\n    - Triggers HITL with transition limit reason\n    - Returns false (block transition)\n  - Returns true (allow transition)\n- Design rationale:\n  - Checks specific transition pattern (e.g., develop→test)\n  - Configurable per transition pair\n  - Triggers HITL when limit exceeded\n  - Proactive escalation before patterns become infinite loops\n- Add configuration for transition limits:\n  - Add to policy config or global config\n  - Default limit: 5 (configurable)\n  - Can override per transition pair\n\n## Expected Deliverables\n- validateTransitionLimits() method implemented\n- HITL triggering when limits exceeded\n- Transition blocking logic\n- Configuration for transition limits","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:52:01.655916+01:00","updated_at":"2026-01-06T23:56:02.258539+01:00","deleted_at":"2026-01-06T23:56:02.258539+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"agent-shepherd-zt3","title":"label-workflow-test: HITL label set test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T04:34:14.02397+01:00","created_by":"tonyhartmann","updated_at":"2026-01-06T04:34:14.104305+01:00","labels":["ashep-hitl:approval"],"deleted_at":"2026-01-06T04:34:14.104305+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-zt3fb","title":"label-workflow-test: HITL label clear test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:15:32.065917+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:15:32.262876+01:00","deleted_at":"2026-01-09T01:15:32.262876+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-zucd","title":"label-workflow-test: Invalid workflow label test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T19:00:15.077166+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T19:00:15.139609+01:00","labels":["ashep-workflow:nonexistent-workflow"],"deleted_at":"2026-01-07T19:00:15.139609+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-zukd","title":"label-workflow-test: Default policy test","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2026-01-08T22:55:50.531183+01:00","created_by":"tonyhartmann","updated_at":"2026-01-08T22:55:50.608123+01:00","deleted_at":"2026-01-08T22:55:50.608123+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"chore"}
{"id":"agent-shepherd-zvznj","title":"label-workflow-test: Empty label ops test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-09T01:20:55.965399+01:00","created_by":"tonyhartmann","updated_at":"2026-01-09T01:20:56.081437+01:00","deleted_at":"2026-01-09T01:20:56.081437+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-zwmv","title":"label-workflow-test: Exclusion test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:41:59.754158+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:41:59.797655+01:00","labels":["ashep-excluded"],"deleted_at":"2026-01-07T02:41:59.797655+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-zyrq","title":"label-workflow-test: Phase label read test","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T02:51:18.784208+01:00","created_by":"tonyhartmann","updated_at":"2026-01-07T02:51:18.844381+01:00","labels":["ashep-phase:test"],"deleted_at":"2026-01-07T02:51:18.844381+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"agent-shepherd-zz8b","title":"2.1.5 Update Worker Engine Transition Handling","description":"Extend applyTransition() to handle jump_back and dynamic_decision types. Add cases for new transition types while maintaining backward compatibility with existing types.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-07T00:04:56.247295+01:00","updated_at":"2026-01-07T00:06:15.832092+01:00","deleted_at":"2026-01-07T00:06:15.832092+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
